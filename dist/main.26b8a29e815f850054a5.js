!function(e){function t(t){for(var r,o,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)o=s[d],i[o]&&p.push(i[o][0]),i[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);p.length;)p.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,s=1;s<a.length;s++){var l=a[s];0!==i[l]&&(r=!1)}r&&(n.splice(t--,1),e=o(o.s=a[0]))}return e}var r={},i={0:0},n=[];function o(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=r,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;n.push([459,1]),a()}({115:function(e,t){var a=function(e){return e?e.sort(function(e,t){var a=parseInt(e),r=parseInt(t);return a>r?1:a<r?-1:0}):null},r=function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t};t.rowsToObjects=function(e,t){return t.reduce(function(t,a){return t.push(e.reduce(function(e,t,r){return e[t]=a[r],e},{})),t},[])},t.sortNumbers=function(e,t){if(!e||!t)return null;e=e.reduce(function(e,a){var i=r(t,a);return i&&e.push(i),e},[]);for(var i=a(e),n={min:i[0]},o=i.length-1;o>=0;o--){var s=i[o];if("number"==typeof s){n.max=s;break}}return n.constant=n.max-n.min,console.log("sorted",i,n),n},t.getNested=r,t.sortAscending=a},303:function(e){e.exports=[{name:"building_use",label_en:"The current use of the building",label_ar:"الإستخدام الحالي للمبنى",validation:"'required'",type:"radio",options:[{value:1,label_en:"For housing only",label_ar:"للسكن فقط"},{value:2,label_en:"For housing and work",label_ar:"للسكن والعمل"},{value:3,label_en:"For work only (workshops and shops)",label_ar:"(للعمل فقط(مشاغل ودكاكين"},{value:4,label_en:"Housing and General Facility",label_ar:"سكن ومرفق عام"},{value:5,label_en:"General annex",label_ar:"مرفق عام"},{value:6,label_en:"Not used",label_ar:"غير مستخدم"},{value:7,label_en:"Hangars for animals and birds",label_ar:"حظائر للحيوانات والطيور"},{value:8,label_en:"For storage",label_ar:"للتخزين"}]},{name:"housing_units",label_en:"Number of housing units",label_ar:"عدد الشقق في المبنى",type:"text",validation:{required:!0}},{name:"building_stories",label_en:"Number of stories",label_ar:"عدد طوابق المبنى",type:"text",validation:"required|numeric|min:1"},{name:"building_type",label_en:"The type building",label_ar:"نوع المبنى",type:"radio",validation:"'required'",options:[{value:1,label_en:"Villa or detached",label_ar:".فيلا+بيت مستقل"},{value:2,label_en:"Apartment",label_ar:"عمارة"},{value:3,label_en:"Tent",label_ar:"خيم وبركسات"},{value:4,label_en:"Other",label_ar:"شيء آخر"}]},{name:"building_condition",label_en:"The state of the public building",label_ar:"حالة المبنى العامة ",type:"text",validation:"'required'"},{name:"notes",label_en:"Notes",label_ar:"ملاحظات",type:"textarea",validation:""}]},350:function(e,t,a){e.exports=a.p+"static/img/ejmap-logo.defd5c5.svg"},36:function(e,t,a){var r=a(385);e.exports={layers:{name:"Layers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},data_type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Point",icon:"scatter_plot"},{name:"LineString",icon:"timeline"},{name:"MultiPolygon",icon:"bubble_chart"}]},spatial_intersect:{type:Array,_text:"Areas for Analysis",_multiple:!0,_options:function(e){return console.log("areas analysis select function"),e.state._col_areaLayers}},filtered:{type:Boolean,_text:"Filtered by area"},sourceUrl:{type:String,_text:"Source Link"},sourceLong:{type:String,_text:"Source - Full Text"},sourceShort:{type:String,_text:"Source - Short Text"}}},layerAttributes:{name:"Attributes",canPaste:!0,schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"},{name:"Array"},{name:"Date"}]},func:{type:Array,_text:"Functions",_multiple:!0,_options:[{name:"count",color:"secondary"},{name:"sum",color:"tertiary"}],_computed:function(e,t,a,r){var i=e.state["_col_"+a].filter(function(e){return e.layer===r});if(i){var n=["count",""];return n="Number"===t.type?n.concat(["sum"]):n,i.reduce(function(e,t){return"Number"===t.type&&e.push("sum: "+t.name),e},n)}}},required:{type:Boolean,_text:"Required"},public:{type:Boolean,_text:"Public"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},layerCalcs:{name:"Attributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},layer:{type:r.Schema.Types.ObjectId,required:!0},func:{type:Array,_text:"Functions",_multiple:!0,_combobox:!0,_categorised:!0,_options:function(e,t){var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{}),i=e.state._col_layerAttributes,n=r[e.state._col_layers_selected].spatial_intersect,o=a.reduce(function(e,t){return t.spatial_intersect.some(function(e){return n.indexOf(e)>-1})&&e.push(t._id),e},[]);return i.reduce(function(e,t){if(t.func.length>0){var a=o.indexOf(t.layer);if(a>-1){var i=o[a];e[i]=e[i]||{name:r[i].text_en,items:["count"]},t.func.forEach(function(a){a&&e[i].items.push(t.name+"."+a)})}}return e},{})}}}},indicatorSections:{name:"Sections",schema:{name:{type:String,required:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},geodata:{type:Array,_text:"Feature Layers",_multiple:!0,_options:function(e){return e.state._col_layers}}}},indicatorBlocks:{name:"Modules",canPaste:!0,schema:{type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Figure"},{name:"Chart"},{name:"Table"},{name:"List"},{name:"Map"}]},active:{type:Boolean,_text:"Active"},layer:{type:r.Schema.Types.ObjectId,required:!0},text_en:{type:String,required:!0,_text:"Name (English)"},text_ar:{type:String,_text:"Name (Arabic)"},areaLayer:{type:Array,_text:"Spatial Intersect",_multiple:!0,_options:function(e){return e.state._col_areaLayers}},figure:{type:Array,_text:"Figure",_categorised:!0,_options:function(e,t){var a=e.state._col_layers;if("Map"===t.type)return a.reduce(function(e,t){return e.push({name:t.text_en,value:t._id}),e},[]);if(!t.areaLayer)return{error:{name:"First select a spatial intersect",value:"error"}};var r=a.reduce(function(e,t){return e[t._id]=t,e},{attached:{text_en:"Area"}}),i=e.state._col_indicatorAttributes.map(function(e){return e.func=["%%%"],e.layer="attached",e}),n=e.state._col_layerCalcs.map(function(e){return e.func=["%%%"],e}).concat(e.state._col_layerAttributes).concat(i);console.log("options layerAttrs",n);var o=a.reduce(function(e,a){return a.spatial_intersect.some(function(e){return t.areaLayer.indexOf(e)>-1})&&e.push(a._id),e},["attached"]),s=n.reduce(function(e,t){if(t.func.length>0){var a=o.indexOf(t.layer);if(a>-1){var i=o[a];e[i]=e[i]||{name:r[i].text_en,items:[]},t.func.forEach(function(a){a&&e[i].items.push((t.name+"."+a).replace(".%%%",""))})}}return e},{});return console.log("categorised options",s),s}},description_en:{type:String,_text:"Description (English)"},description_ar:{type:String,_text:"Description (Arabic)"},unit:{type:String,_text:"Unit"}}},features:{name:"Features",schema:"layerAttributes",params:"/:collection",canUpload:!0,storeByLayer:!0,layerCollection:"layers",layerAttributes:"layerAttributes"},indicators:{name:"Indicators",schema:"indicatorAttributes",schemaOpts:{strict:!0},layerCollection:"areaLayers",params:"/:collection",canUpload:!0},areaLayers:{name:"AreasLayers",schema:{name:{type:String,required:!0,_text:"Name"},code:{type:String,required:!0,unique:!0,_text:"Column Name"}}},areas:{name:"Areas",schema:"areaAttributes",params:"/:collection",canUpload:!0,layerCollection:"areaLayers"},areaAttributes:{name:"AreaAttributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:String,required:!0}}},indicatorAttributes:{name:"IndicatorAttributes",canPaste:!0,_description_en:"For non-spatial attribute data that is directly associatied with the spatial area i.e data from JIIS relating to a statistical area",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},surveyLayers:{name:"SurveyLayers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},featureLayer:{type:Array,_text:"Feature Layers",_options:function(e){return e.state._col_layers}}}},surveyLayerAttributes:{name:"Attributes",canPaste:!0,schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},surveyRecords:{name:"Survey Records",schema:"surveyLayerAttributes",params:"/:collection",layerCollection:"surveyLayers",storeByLayer:!0}}},378:function(e,t){e.exports=[{params:"/:query",name:"find",method:"get"},{params:"/:key",name:"distinct",method:"get"},{params:"",name:"create",auth:!0,method:"post",middleware:"formidable"},{params:"/:id",name:"del",auth:!0,method:"post"},{params:"/:params",name:"update",auth:!0,method:"post"},{params:"/:areaLayerId",name:"updateAnalysis",auth:!0,method:"post",restrict:["features"]},{params:"",name:"updateMany",auth:!0,method:"post",middleware:"formidable"},{params:"",name:"deleteMany",auth:!0,method:"post",middleware:""}]},384:function(e,t,a){"use strict";var r=a(69);a.n(r).a},446:function(e,t,a){"use strict";var r=a(70);a.n(r).a},447:function(e,t,a){"use strict";var r=a(71);a.n(r).a},448:function(e,t,a){"use strict";var r=a(72);a.n(r).a},450:function(e,t,a){var r={"./af":175,"./af.js":175,"./ar":176,"./ar-dz":177,"./ar-dz.js":177,"./ar-kw":178,"./ar-kw.js":178,"./ar-ly":179,"./ar-ly.js":179,"./ar-ma":180,"./ar-ma.js":180,"./ar-sa":181,"./ar-sa.js":181,"./ar-tn":182,"./ar-tn.js":182,"./ar.js":176,"./az":183,"./az.js":183,"./be":184,"./be.js":184,"./bg":185,"./bg.js":185,"./bm":186,"./bm.js":186,"./bn":187,"./bn.js":187,"./bo":188,"./bo.js":188,"./br":189,"./br.js":189,"./bs":190,"./bs.js":190,"./ca":191,"./ca.js":191,"./cs":192,"./cs.js":192,"./cv":193,"./cv.js":193,"./cy":194,"./cy.js":194,"./da":195,"./da.js":195,"./de":196,"./de-at":197,"./de-at.js":197,"./de-ch":198,"./de-ch.js":198,"./de.js":196,"./dv":199,"./dv.js":199,"./el":200,"./el.js":200,"./en-SG":201,"./en-SG.js":201,"./en-au":202,"./en-au.js":202,"./en-ca":203,"./en-ca.js":203,"./en-gb":204,"./en-gb.js":204,"./en-ie":205,"./en-ie.js":205,"./en-il":206,"./en-il.js":206,"./en-nz":207,"./en-nz.js":207,"./eo":208,"./eo.js":208,"./es":209,"./es-do":210,"./es-do.js":210,"./es-us":211,"./es-us.js":211,"./es.js":209,"./et":212,"./et.js":212,"./eu":213,"./eu.js":213,"./fa":214,"./fa.js":214,"./fi":215,"./fi.js":215,"./fo":216,"./fo.js":216,"./fr":217,"./fr-ca":218,"./fr-ca.js":218,"./fr-ch":219,"./fr-ch.js":219,"./fr.js":217,"./fy":220,"./fy.js":220,"./ga":221,"./ga.js":221,"./gd":222,"./gd.js":222,"./gl":223,"./gl.js":223,"./gom-latn":224,"./gom-latn.js":224,"./gu":225,"./gu.js":225,"./he":226,"./he.js":226,"./hi":227,"./hi.js":227,"./hr":228,"./hr.js":228,"./hu":229,"./hu.js":229,"./hy-am":230,"./hy-am.js":230,"./id":231,"./id.js":231,"./is":232,"./is.js":232,"./it":233,"./it-ch":234,"./it-ch.js":234,"./it.js":233,"./ja":235,"./ja.js":235,"./jv":236,"./jv.js":236,"./ka":237,"./ka.js":237,"./kk":238,"./kk.js":238,"./km":239,"./km.js":239,"./kn":240,"./kn.js":240,"./ko":241,"./ko.js":241,"./ku":242,"./ku.js":242,"./ky":243,"./ky.js":243,"./lb":244,"./lb.js":244,"./lo":245,"./lo.js":245,"./lt":246,"./lt.js":246,"./lv":247,"./lv.js":247,"./me":248,"./me.js":248,"./mi":249,"./mi.js":249,"./mk":250,"./mk.js":250,"./ml":251,"./ml.js":251,"./mn":252,"./mn.js":252,"./mr":253,"./mr.js":253,"./ms":254,"./ms-my":255,"./ms-my.js":255,"./ms.js":254,"./mt":256,"./mt.js":256,"./my":257,"./my.js":257,"./nb":258,"./nb.js":258,"./ne":259,"./ne.js":259,"./nl":260,"./nl-be":261,"./nl-be.js":261,"./nl.js":260,"./nn":262,"./nn.js":262,"./pa-in":263,"./pa-in.js":263,"./pl":264,"./pl.js":264,"./pt":265,"./pt-br":266,"./pt-br.js":266,"./pt.js":265,"./ro":267,"./ro.js":267,"./ru":268,"./ru.js":268,"./sd":269,"./sd.js":269,"./se":270,"./se.js":270,"./si":271,"./si.js":271,"./sk":272,"./sk.js":272,"./sl":273,"./sl.js":273,"./sq":274,"./sq.js":274,"./sr":275,"./sr-cyrl":276,"./sr-cyrl.js":276,"./sr.js":275,"./ss":277,"./ss.js":277,"./sv":278,"./sv.js":278,"./sw":279,"./sw.js":279,"./ta":280,"./ta.js":280,"./te":281,"./te.js":281,"./tet":282,"./tet.js":282,"./tg":283,"./tg.js":283,"./th":284,"./th.js":284,"./tl-ph":285,"./tl-ph.js":285,"./tlh":286,"./tlh.js":286,"./tr":287,"./tr.js":287,"./tzl":288,"./tzl.js":288,"./tzm":289,"./tzm-latn":290,"./tzm-latn.js":290,"./tzm.js":289,"./ug-cn":291,"./ug-cn.js":291,"./uk":292,"./uk.js":292,"./ur":293,"./ur.js":293,"./uz":294,"./uz-latn":295,"./uz-latn.js":295,"./uz.js":294,"./vi":296,"./vi.js":296,"./x-pseudo":297,"./x-pseudo.js":297,"./yo":298,"./yo.js":298,"./zh-cn":299,"./zh-cn.js":299,"./zh-hk":300,"./zh-hk.js":300,"./zh-tw":301,"./zh-tw.js":301};function i(e){var t=n(e);return a(t)}function n(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=n,e.exports=i,i.id=450},451:function(e,t,a){"use strict";var r=a(73);a.n(r).a},452:function(e,t,a){"use strict";var r=a(74);a.n(r).a},453:function(e,t,a){"use strict";var r=a(75);a.n(r).a},454:function(e,t,a){"use strict";var r=a(76);a.n(r).a},459:function(t,a,r){"use strict";r.r(a);var i=r(77),n=r.n(i),o=r(29),s=r.n(o),l=r(30),c=r.n(l),u=r(18),d=r.n(u),p=r(9),f=r.n(p),h=r(4),y=r.n(h),m=r(10),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",{attrs:{id:"keep",app:""}},[a("v-toolbar",{staticClass:"ejmap-border-bottom",attrs:{app:"",light:"","clipped-left":"",flat:"",color:"#fff"}},[a("img",{attrs:{src:r(350)},on:{click:function(t){return e.log()}}}),e._v(" "),a("v-toolbar-title",[a("div",{staticStyle:{"margin-bottom":"-5px"}},[e._v("Urban Analytics")]),e._v(" "),a("div",{staticClass:"grey--text",staticStyle:{"font-size":"0.6em"}},[e._v("East Jerusalem")])]),e._v(" "),a("v-spacer"),e._v(" "),e._l(e.items,function(t,r){return a("v-tooltip",{key:r,attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(r){var i=r.on;return[a("v-btn",e._g({staticClass:"hidden-xs-only",attrs:{to:t.route,icon:""}},i),[a("v-icon",{attrs:{color:"grey darken-1"}},[e._v(e._s(t.icon))])],1)]}}],null,!0)},[e._v(" "),a("span",[e._v(e._s(t.text))])])}),e._v(" "),a("v-menu",{scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"hidden-sm-and-up",attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}])},[e._v(" "),a("v-list",[e._l(e.items,function(t,r){return a("v-list-tile",{key:r,attrs:{bottom:"",to:t.route}},[a("v-list-tile-action",[a("v-icon",{attrs:{color:"grey darken-1"}},[e._v(e._s(t.icon))])],1),e._v(" "),a("v-list-tile-content",[e._v("\n              "+e._s(t.text)+"\n          ")])],1)}),e._v(" "),a("v-list-tile",{on:{click:e.toggleLogin}},[a("v-list-tile-action",[a("v-icon",{attrs:{color:"grey darken-1"}},[e._v("person")])],1),e._v(" "),e.activeUser?a("v-list-tile-content",[e._v("\n            Logout\n          ")]):a("v-list-tile-content",[e._v("\n            Login\n          ")])],1)],2)],1),e._v(" "),a("v-menu",{attrs:{"min-width":"300","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[a("v-list-tile",{staticClass:"hidden-xs-only"},[a("v-list-tile-content",[e.activeUser?a("v-list-tile-title",{staticClass:"grey--text body-1"},[e._v("\n                "+e._s(e.activeUser.email)+"\n              ")]):a("v-list-tile-title",{staticClass:"grey--text hidden-xs-only"},[e._v("\n                Login\n              ")])],1),e._v(" "),a("v-list-tile-action",[a("v-btn",e._g({staticClass:"hidden-xs-only",attrs:{icon:""}},Object.assign({},r,i)),[a("v-icon",{attrs:{color:"grey darken-1"}},[e._v("person")])],1)],1)],1)]}}],null,!0)},[e._v(" "),a("span",[e._v("Account")])])]}}])},[e._v(" "),a("v-card",[a("v-list",[e.activeUser?a("v-list-tile",{attrs:{avatar:""}},[a("v-list-tile-content",[a("v-list-tile-title",[e._v(e._s(e.activeUser.name))]),e._v(" "),a("v-list-tile-sub-title",[e._v("IPCC")])],1)],1):e._e()],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),e.activeUser?a("v-btn",{attrs:{color:"primary",flat:""},on:{click:e.logout}},[e._v("Logout")]):a("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return t.preventDefault(),e.login(t)}}},[e._v("Login")])],1)],1)],1)],2),e._v(" "),e.loading?a("v-container",[a("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[a("div",{staticClass:"text-xs-center"},[a("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),a("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)])],1):a("v-content",[a("router-view",{staticStyle:{height:"100%"}})],1)],1)};v._withStripped=!0;var _=r(22),g=r.n(_),b=r(46),x=r.n(b),k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"container",style:e.mapStyle},[e.layers?a("l-map",{ref:"myMap",staticClass:"main-map",style:{height:e.mapHeight},attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"map_"+e.featuresCollection},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["detailed"===e.baseMap?a("l-protobuf",{attrs:{url:"https://maps.tilehosting.com/data/v3/{z}/{x}/{y}.pbf?key=ArAI1SXQTYA6P3mWFnDs",options:e.protobufOpts}}):e._e(),e._v(" "),"basic"===e.baseMap?a("l-tile-layer",{attrs:{url:"https://cartodb-basemaps-b.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png",options:e.protobufOpts}}):e._e(),e._v(" "),"areas"===e.featuresCollection?a("l-geo-json",{attrs:{geojson:e.areasGeoJson,options:e.getGeoJsonOptions(),"options-style":e.getAreaStyle()}}):e._e(),e._v(" "),e._l(e.layers,function(t,r){return e.layers[r].on&&e.layers[r].features?a("l-geo-json",{directives:[{name:"else",rawName:"v-else"}],key:r,attrs:{geojson:e.layers[r].features,options:e.getGeoJsonOptions(r),"options-style":e.geoJsonStyle(r)}}):e._e()}),e._v(" "),a("div",{staticClass:"map-menu"},[a("v-menu",{attrs:{"min-width":"300px",flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}],null,!1,3491234933)},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{attrs:{dense:""}},[a("div",{staticClass:"px-4"},[a("div",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return[a("v-switch",{key:r,attrs:{color:"primary",label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})]}),e._v(" "),a("v-switch",{attrs:{color:"primary",label:"Legend"},model:{value:e.showLegend,callback:function(t){e.showLegend=t},expression:"showLegend"}})],2)])],1)],1),e._v(" "),e.loading?a("div",{staticStyle:{position:"absolute",top:"180px","z-index":"10",width:"100%"}},[a("div",{staticClass:"text-xs-center"},[a("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),a("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)]):e._e()],2):e._e(),e._v(" "),e.showLegend?a("div",{staticClass:"legend-right",style:e.legendStyle,attrs:{id:"map-legend"}},[a("div",[e.options&&e.options.areaSelect?a("area-select",{staticClass:"ejmap-border-bottom px-3 pt-1",staticStyle:{flex:"0"},attrs:{titleclass:"pb-0 pt-3 px-3 font-weight-medium"}}):e._e()],1),e._v(" "),e.allLayers?a("div",{staticStyle:{flex:"2","overflow-y":"auto","max-height":"85vh"}},[a("v-expansion-panel",{attrs:{expand:""},model:{value:e.layerPanels,callback:function(t){e.layerPanels=t},expression:"layerPanels"}},e._l(e.layers,function(t,r){return a("v-expansion-panel-content",{key:r,scopedSlots:e._u([{key:"header",fn:function(){return[e._v("\n        "+e._s(t.text_en)+"\n      ")]},proxy:!0}],null,!0)},[e._v(" "),a("v-card",{staticClass:"pt-0"},[a("v-card-text",{staticClass:"pt-0"},[e.layers[r].on?a("map-legend",{attrs:{legend:e.layers[r].legend,value:e.layers[r].attribute,items:Object.keys(e.layers[r].attributes)},on:{input:function(t){e.updateAttributeKey(r,t)}}}):e._e()],1)],1)],1)}),1)],1):a("v-card",{staticClass:"pt-0"},[a("v-card-text",{staticClass:"pt-0"},e._l(e.layers,function(t,r){return t.on?a("map-legend",{key:r,attrs:{legend:e.layers[r].legend,value:e.layers[r].attribute,items:Object.keys(e.layers[r].attributes)},on:{input:function(t){e.updateAttributeKey(r,t)}}}):e._e()}),1)],1)],1):e._e(),e._v(" "),a("v-dialog",{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-tabs",[e._l(e.editItems,function(t,r){return a("v-tab",{key:r},[e._v("\n      Record "+e._s(r+1)+"\n    ")])}),e._v(" "),a("v-tab",[e._v("\n      New\n    ")]),e._v(" "),e._l(e.editItems,function(t,r){return a("v-tab-item",{key:r},[a("editor",{attrs:{collection:"surveyRecords",filter:"surveyLayers",editItem:t},on:{close:function(t){return e.close()},update:function(t){return e.updateCollection(!0)}}})],1)}),e._v(" "),a("v-tab-item",[a("editor",{attrs:{collection:"surveyRecords",filter:"surveyLayers",attributes:e.attributes},on:{close:function(t){return e.close()},update:function(t){return e.updateCollection(!0)}}})],1)],2)],1)],1)};k._withStripped=!0;var w=r(302),C=r.n(w),S=r(460),$=r(461),L=r(462),A=r(463),j=r(464),O=r(465),E=r(466),I=function(){var e=this.$createElement;return(this._self._c||e)("div")};I._withStripped=!0;var T=r(1),D=r.n(T);r(356);if(void 0===D.a)throw new Error("leaflet library must be installed in order to use vue2-leaflet-vectorgrid.");if(void 0===D.a.vectorGrid)throw new Error("leaflet.vectorgrid library must be installed in order to use vue2-leaflet-vectorgrid.");var P={props:{url:{type:String,required:!0},options:{type:Object,default:function(){return{}}}},watch:{url:function(){this.updateLayer()},options:function(){this.updateLayer()}},mounted:function(){this.mapObject=D.a.vectorGrid.protobuf(this.url,this.options),this.$parent._isMounted&&this.deferredMountedTo(this.$parent.mapObject)},beforeDestroy:function(){this.removeLayer()},methods:{deferredMountedTo:function(e){this.mapObject.addTo(e),this.attributionControl=e.attributionControl;for(var t=0;t<this.$children.length;t++)"function"==typeof this.$children[t].deferredMountedTo&&this.$children[t].deferredMountedTo(this.mapObject)},setAttribution:function(e,t){this.attributionControl.removeAttribution(t),this.attributionControl.addAttribution(e)},setToken:function(e){this.options.token=e},removeLayer:function(){this.$parent.mapObject.removeLayer(this.mapObject)},updateLayer:function(){this.removeLayer(),this.mapObject=D.a.vectorGrid.protobuf(this.url,this.options),this.deferredMountedTo(this.$parent.mapObject)}}},F=r(2),U=Object(F.a)(P,I,[],!1,null,null,null);U.options.__file="public/Vue2LeafletVectorGridProtobuf.vue";var M=U.exports,B=r(116),N=r.n(B),z=(N()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.4},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.4},landcover:{fill:!0,weight:1,fillColor:"#53e033",color:"#53e033",fillOpacity:.1,opacity:.4},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.2,opacity:.4},park:{fill:!0,weight:1,fillColor:"#84ea5b",color:"#84ea5b",fillOpacity:.2,opacity:.4},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.2,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.2,opacity:.8}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.8}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[]),N()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.2},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.2},landcover:{fill:!0,weight:1,fillColor:"#fafafa",color:"#fafafa",fillOpacity:.1,opacity:.2},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.1,opacity:.2},park:{fill:!0,weight:1,fillColor:"#f3f3f3",color:"#f3f3f3",fillOpacity:.1,opacity:.2},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.1,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.1,opacity:.4}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.1,opacity:.4}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[])),Y=r(28),q=r.n(Y),K=r(378);r(379);var R,H="http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,J=q.a.create({baseURL:H,json:!0}),V=(R=x()(g.a.mark(function e(t,a,r,i){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},r=r||{},console.log("execute function"),e.next=5,m.default.prototype.$auth.getAccessToken();case 5:return n=e.sent,e.abrupt("return",J({method:t,url:a,data:r,headers:f()({Authorization:"Bearer "+n},i)}));case 7:case"end":return e.stop()}},e,this)})),function(e,t,a,r){return R.apply(this,arguments)});function G(e){return e=(e="object"===(void 0===e?"undefined":s()(e))&&e?c()(e):e)?"/"+e:""}var W=K.reduce(function(e,t){return e[t.name]=function(e,a,r,i,n){return a=G(a),n=G(n),console.log(t.method,""+e+n+"/"+t.name+a,r,i),V(t.method,""+e+n+"/"+t.name+a,r,i)},e},{}),Z=r(57),Q=r.n(Z),X=r(115),ee=r.n(X),te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.title?a("div",{staticClass:"body-1 mt-2"},[e._v(e._s(e.title))]):e._e(),e._v(" "),a("v-select",{staticClass:"caption",staticStyle:{width:"100%","margin-top":"-10px"},attrs:{color:"grey",items:e.items,value:e.value},on:{change:e.updateDisplayKey}}),e._v(" "),e.legend&&e.legend.type===Number?a("table",{staticClass:"body-1"},[a("tr",[a("td",{staticClass:"key-gradient",style:{backgroundImage:"linear-gradient("+e.legend.chroma(0)+","+e.legend.chroma(1)+")"}}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n          "+e._s(e.legend.items.max)+"\n        ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n          "+e._s(e.legend.items.min)+"\n        ")])])])]):e.legend?a("table",{staticClass:"caption"},e._l(e.legend.items,function(t,r){return a("tr",[a("td",{staticClass:"key-icon",style:{color:t}},[e._v("●")]),e._v(" "),a("td",{staticClass:"key-figures"},[a("span",{staticClass:"body-1 grey--text text--darken-2",staticStyle:{padding:"1px 5px"}},[e._v(e._s(r))])])])}),0):e._e()],1)};te._withStripped=!0;var ae={props:["legend","title","value","items"],data:function(){return{}},methods:{updateDisplayKey:function(e){console.log("updateDisplayKey",e),this.$emit("input",e)}}},re=Object(F.a)(ae,te,[],!1,null,null,null);re.options.__file="src/components/MapLegend.vue";var ie=re.exports,ne=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.items?a("v-select",{staticClass:"area-select",attrs:{items:e.items,"item-text":"name","item-value":"value","return-object":"",solo:"",flat:"",dense:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e()};ne._withStripped=!0;var oe={data:function(){return{selected:""}},computed:{items:function(){return this.$store.getters.selectedAreas?this.$store.getters.selectedAreas.map(function(e){return{name:e.feature.properties.name,value:e.feature.properties}}):null}},methods:{update:function(e){this.$store.commit("UPDATE",{key:"neighbourhood",value:e.areaCode}),this.$store.commit("UPDATE",{key:["map","center"],value:{lon:e.centroid_lng,lat:e.centroid_lat}})}},watch:{selected:function(e,t){console.log(e,t),e!==t&&this.update(e.value)}},created:function(){var e=this.$store.getters.selectedArea;this.selected={name:e.feature.properties.name,value:e.feature.properties}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedArea},function(t,a){e.selected={name:t.feature.properties.name,value:t.feature.properties}})}},se=(r(384),Object(F.a)(oe,ne,[],!1,null,null,null));se.options.__file="src/components/AreaSelect.vue";var le=se.exports,ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",[a("v-card-title",[e.schema&&e.schema.name?a("span",{staticClass:"headline"},[e._v(e._s(e.mode)+" "+e._s(e.schema.name.slice(0,e.schema.name.length-1)))]):e._e()]),e._v(" "),a("v-tabs",{attrs:{color:"#f3f3f3","slider-color":"grey",grow:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Single")]),e._v(" "),e.schema.canPaste?a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Multiple")]):e._e(),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},e._l(e.schema.schema,function(t,r){return a("v-flex",{attrs:{xs12:""}},[t._options&&Array.isArray(t._options)?a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options.map(function(e){return e.name})},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):"function"!=typeof t._options||t._categorised?t._categorised?a("div",[a("v-combobox",{attrs:{multiple:"","small-chips":""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}),e._v(" "),a("v-menu",{attrs:{"full-width":"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",color:"grey",outline:""},slot:"activator"},[e._v("\n              "+e._s(r)+"\n            ")]),e._v(" "),a("v-list",{attrs:{dense:""}},[e._l(t._options(e.$store,e.edited,e.collection),function(t,i){return[t.value?a("v-list-tile",{key:i,on:{click:function(a){return e.edited[r].push(t.value)}}},[e._v("\n                  "+e._s(t.name)+"\n\n                ")]):t.items?a("v-menu",{key:i,attrs:{"full-width":"","offset-x":"","max-height":"500","open-on-hover":""}},[a("v-list-tile",{attrs:{slot:"activator"},on:{click:function(e){}},slot:"activator"},[a("v-list-tile-title",[e._v(e._s(t.name))])],1),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t.items,function(t,n){return a("v-list-tile",{on:{click:function(a){return e.edited[r].push(i+"."+t)}}},[a("v-list-tile-title",[e._v(e._s(t))])],1)}),1)],1):e._e()]})],2)],1)],1):t.type===Boolean?a("v-switch",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):t._text?a("v-text-field",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-text-field",{attrs:{label:t._text,disabled:""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options(e.$store,e.edited,e.collection),"item-text":"name","item-value":"_id"},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}})],1)}),1)],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.save(e.edited._id)}}},[e._v("Save")])],1)],1),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("div",{staticClass:"title pb-2"},[e._v("Paste attributes")]),e._v("\n      Paste as rows of text, separated by commas or tabs: "),a("br"),e._v(" "),a("v-text-field",{attrs:{hint:Object.keys(e.schema.schema).join(", "),textarea:"","auto-grow":"",rows:"3"},model:{value:e.pasted,callback:function(t){e.pasted=t},expression:"pasted"}}),e._v("\n\n      Preview\n      "),e.pastedComputed?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:e.pastedComputed}}):e._e()],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.saveMany()}}},[e._v("Save")])],1)],1)],1)],1)};ce._withStripped=!0;var ue=r(31),de=r.n(ue),pe=r(36),fe={components:{VueJsonPretty:de.a},props:["collection","filter","nestedPath","editItem","attributes"],data:function(){return{activeTab:null,saving:!1,editedIndex:null,pasted:null,attributeTypes:["String","Number","Boolean"],editedCollection:null,edited:{},uploadDialog:!1,featureEdit:[],datatableTab:null,selectAll:!1,runedit:!1}},computed:{mode:function(){return this.editItem?"Edit":"Add"},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},schema:function(){return this.$store.getters.collectionSchema(this.collection,this.filter)},schemaNames:function(){return this.schema.name?[this.schema.name,this.relatedSchema.name].reduce(function(e,t){return t&&e.push(t.slice(0,t.length-1)),e},[]):null},pastedComputed:function(){var e=this,t=this.pasted;if(!t)return[];t=t.replace(/\t/g,","),console.log("replaced",t);var a=y()(this.schema.schema);return t.split("\n").reduce(function(t,r){var i=r.split(",");return i.length<2?t:(t.push(i.reduce(function(t,r,i){var n=a[i];return r=r.trim(),e.schema.schema[n].type===Boolean&&(r="true"===r.toLowerCase()),t[n]=r,t},{})),t)},[])}},methods:{edit:function(){this.runedit=!0;var e=this.editItem,t=this.templateFromSchema(this.schema.schema),a=this.$store.state["_col_"+this.collection];if(this.nestedPath){for(var r=0;r<a.length;r++)if(e===this.getNested(this.nestedPath,a[r])){e._id=a[r]._id,this.editedIndex=r;break}t=this.getNested(this.nestedPath,t),e._path=this.nestedPath}else this.editedIndex=a.indexOf(e);this.edited=f()({},t,e)},save:function(e){var t=this;this.saving=!0,this.filter&&(this.edited.layer=this.filterId);var a=pe[this.collection].params?this.selectedId:"",r={id:e,path:this.edited._path};console.log("saving",[this.collection,e,this.edited]),W.update(this.collection,r,this.edited,{},a).then(function(){t.$emit("update",!0)}).catch(function(e){alert(e)}).then(function(){t.saving=!1,t.$emit("close",!0)})},close:function(){this.edited={},this.$emit("close",!0)},saveMany:function(){var e=this;if(this.saving=!0,console.log("filterId: "+this.filterId+" collection: "+this.collection),this.pastedComputed[0]&&y()(this.pastedComputed[0]).length>1){this.pastedComputed=this.pastedComputed.map(function(t){return t.layer=e.filterId,t});var t=new FormData;t.append("data",c()(this.pastedComputed)),console.log("making request..."),W.create(this.collection,"",t).then(function(t){console.log("uploaded"),e.updateCollection(!0),e.close(),e.pasted=""})}},templateFromSchema:function(e){if(e)return y()(e).reduce(function(t,a){return e[a].type===Array?t[a]=[]:e[a].type===Boolean?t[a]=!1:t[a]="",t},{})}},watch:{editItem:function(){this.edit()}},mounted:function(){var e=pe[this.collection].schema;"string"==typeof e&&(e=this.attributes),"Add"===this.mode&&(this.edited=this.templateFromSchema(e))}},he=Object(F.a)(fe,ce,[],!1,null,null,null);he.options.__file="src/components/Editor.vue";var ye=he.exports,me=r(303),ve=r(115),_e=r(36),ge={name:"MapView",props:["featureLayers","featuresCollection","zoomLevel","options","areas","height","allLayers","legendBottom","editable"],components:{LMap:S.a,LTileLayer:$.a,LMarker:L.a,LPopup:A.a,LTooltip:j.a,LProtobuf:M,LPolygon:O.a,LGeoJson:E.a,MapLegend:ie,AreaSelect:le,Editor:ye},$_veeValidate:{validator:"new"},data:function(){var e=this;return{dialog:!1,itemTemplate:{},editItems:[],layerPanels:[],loadingValue:null,loading:!1,language:"ar",languages:["ar","en"],basemaps:{url:"https://{s}.basemaps.cartocdn.com/{z}/{x}/{y}.png",url2:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",url3:"http://a.tile.openstreetmap.fr/hot/${z}/${x}/${y}.png "},center:D.a.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:D.a.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5,scrollWheelZoom:!1},layers:{},geoJsonAreaOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.areaCode}),r.$store.commit("UPDATE",{key:"selectedFeature",value:t._id}),r.openEditor(t._id),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.centroid_lng,lat:t.centroid_lat}})}})}},geoJsonPolygonStyle:function(e){var t=e._selected?"black":"white";return{weight:1,color:t,opacity:.9,fillColor:t,fillOpacity:.6}},filtered:!1,survey:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!0},{text:"Detailed",type:"detailed",selected:!1}],baseMap:"basic",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}},geoJsonOptions:{onEachFeature:function(t,a){var r=e,i=y()(t.properties).reduce(function(e,a){return e+"<li>"+a+": "+t.properties[a]+"</li>"},"<ul>")+"</ul>";a.bindPopup(i),a.on({click:function(e){r.openEditor(e.target.feature.properties._id),console.log(e.target)},mouseover:function(e){}})}}}},computed:{attributes:function(){return this.featureLayers&&this.layers[this.featureLayers[0]]?this.layers[this.featureLayers[0]].attributes:null},showLegend:function(){return!this.hideLegend&&"areas"!==this.featuresCollection},featureLayersArray:function(){return this.featureLayers?Array.isArray(this.featureLayers)?this.featureLayers:[this.featureLayers]:[]},legendStyle:function(){var e=this.options?this.options.legendStyle:{};return f()({height:this.options&&this.options.legendBottom?"200px":"auto",maxHeight:this.options&&this.options.legendBottom?"200px":"auto",overflowY:"auto",overflowX:"visible!important"},e||{})},widthSmall:function(){return!!(this.$refs.container&&this.$refs.container.clientWidth<300)},mapHeight:function(){var e=document.getElementsByTagName("nav")[0].clientHeight;return this.height||window.innerHeight-e+"px"},mapStyle:function(){var e=this.options?this.options.mapStyle:{};return f()({display:this.options&&this.options.legendBottom?"block":"flex"},e||{})},areaStyle:function(){return this.layers?{weight:1,color:"#ccc",opacity:1,fillOpacity:0}:{}},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return C()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:z,maxNativeZoom:18,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},surveyQuestions:function(){return this.translate(me,"label",this.language)},scale:function(){return ve.sortNumbers(this.$store.getters.indicatorsForSelectedYear,this.$store.state.map.indicator.figure)},zoom:function(){return parseInt(this.zoomLevel)||this.$store.state.map.zoom||14},areasGeoJson:function(){var e=this.$store.getters.selectedAreas;return e?this.embedIds(e):null}},methods:{embedIds:function(e){return e.reduce(function(e,t){return t.feature.properties._id=t._id,e.push(t.feature),e},[])},close:function(){this.dialog=!1},updateLegend:function(e){var t=this.layers[e];if(t.on&&t.features){var a=t.attributes[t.attribute];if(a){var r={items:{}};if(console.log("attribute",a,r),"Number"===a.type)r.items=ee.a.sortNumbers(t.features,"properties."+t.attribute),r.type=Number,r.chroma=Q.a.scale(["#ff236c","#2377ff"]);else if("String"===a.type){var i=t.features.reduce(function(e,a){var r=a.properties[t.attribute];return-1===e.indexOf(r)&&e.push(r),e},[]);i=i.filter(function(e){return null!==e}).sort();var n=["#ff267e","#26ffa7","#267eff","#000","#f46441"];i.length>n.length&&(n=Q.a.scale(n).mode("lch").colors(i.length)),r.items=i.reduce(function(e,t,a){return e[t]=n[a],e},{}),r.items.null="#999",r.type=String}else"Boolean"===a.type&&(r.items={true:"red",false:"blue"},r.type=Boolean);this.$set(this.layers[e],"legend",r)}}},updateLayers:function(e,t){e="number"==typeof e?y()(this.layers)[e]:e,this.layers[e]&&this.$set(this.layers[e],"on",t),t?this.checkForUpdate():this.$forceUpdate(),console.log(this.layers)},updateAttributeKey:function(e,t){this.$set(this.layers[e],"attribute",t),this.updateLegend(e),console.log(this.layers)},getGeoJsonOptions:function(e){if(console.log("getgeojsonopts",e,this.layers[e]),"areas"===this.featuresCollection)return this.geoJsonAreaOptions;var t=this.layers[e].data_type,a="";return"Point"===t?(a=this.geoJsonPointOptions(e),console.log("geojsonopts - opts",a),a):"Polygon"===t||"MultiPolygon"===t||"LineString"===t||"MultiLineString"===t?this.geoJsonOptions:void 0},geoJsonPointOptions:function(e){console.log("geojsonopts",e);var t=this;return{pointToLayer:function(a,r){var i=t.getLegendStyle(a,e,t.layers[e].legend);return D.a.circleMarker(r,i)},onEachFeature:function(e,a){var r=e.properties;a.bindPopup("<p>"+r.type+"</p><p>"+r.students+"</p>"),a.on({click:function(e){t.openEditor(e.target.feature.properties._id),t.$store.commit("UPDATE",{key:"selectedFeature",value:e.target.feature.properties._id}),console.log(e)},mouseover:function(e){e.target.openPopup()},mouseout:function(e){e.target.closePopup()}})}}},geoJsonStyle:function(e){var t={weight:2,opacity:1,fillOpacity:.7,stroke:!1},a=this;return function(r){return a.getLegendStyle(r,a.layers[e].attribute,a.layers[e].legend,t)}},getLegendStyle:function(e,t,a,r){r=f()({radius:4,fillColor:"blue",weight:0,opacity:1,fillOpacity:.5},r);var i="fillColor",n=e.properties[t];return"LineString"!==e.geometry.type&&"MultiLineString"!==e.geometry.type||(r.stroke=!0,i="color"),this.showLegend&&a?(this.showLegend&&a.type===Number?r[i]=a.chroma(1-(n-a.items.min)/a.items.constant).hex():this.showLegend&&(r[i]=a.items[n]),r):r},getAreaStyle:function(){var e=this,t={weight:2,color:"grey",opacity:.4,fillColor:"grey",fillOpacity:.2};return function(a){return e.$store.state.neighbourhood===a.properties.areaCode?f()({},t,{color:"orange",fillColor:"orange"}):t}},updateMap:function(){},updateBaseMap:function(e,t){console.log(e,t),this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return D.a.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;W.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;W.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){var e=document.getElementsByClassName("v-toolbar__extension")[0].style;console.log(e),e.overflow="auto"},500)},translate:function(e,t,a){return function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":s()(i)))return i[a]=i[a+"_"+r],y()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(e,t,a)},update:function(){console.log("updating map...");var e=this.$children[0]?this.$children[0].mapObject:null;if(!e)return console.log("no map object",this.$children,this.$refs.myMap),this.$forceUpdate(),null;console.log("invalidating map - layers",this.layers),setTimeout(function(){return e.invalidateSize()},500)},log:function(e){},checkForUpdate:function(){var e=this,t=this.$store.state["_col_"+this.featuresCollection];if(!this.layers)return null;var a=y()(this.layers).reduce(function(a,r){return e.layers[r].on?(a.push(new d.a(function(a,i){var n={},o=e.layers[r].filtered,s=t[r]?t[r].length:0;if(e.loading||0!==s&&!o)return n[r]=t[r],a(n);e.$set(e.layers[r],"legend",{}),e.loading=!0,e.$store.dispatch("UPDATE_COLLECTION",{layer:r,name:e.featuresCollection}).then(function(t,i){return i&&console.log("update error",i),console.log("dispatch return",t),e.loading=!1,n[r]=t,e.updateLegend(r),a(n)})})),a):a},[]);d.a.all(a).then(function(t){console.log("promises complete",t,e.$store.state["_col_"+e.featuresCollection]),t.forEach(function(t){var a=y()(t)[0];e.$set(e.layers[a],"features",e.embedIds(t[a])),e.updateLegend(a)}),e.update()})},setLayers:function(){var e=this,t=_e[this.featuresCollection],a=this.$store.state["_col_"+t.layerCollection],r="string"==typeof t.layerAttributes?this.$store.state["_col_"+t.layerAttributes]:t.layerAttributes||[];a.forEach(function(t){var a=f()({features:"",legend:""},t);a.attributes=r.reduce(function(e,t){return a._id===t.layer&&t.func.length>0&&(e[t.name]=t),e},{}),a.attribute=y()(a.attributes)[0],a.on=e.featureLayersArray.indexOf(a._id)>-1,e.layerPanels.push(a.on),e.$set(e.layers,a._id,a)}),console.log("layers",this.layers)},openEditor:function(e){return this.editable?(this.dialog=!0,"surveyFeatures"!==this.featureCollection?null:void(this.editItems=this.$store.state._col_surveyRecords.filter(function(t){return t.feature===e}))):null}},created:function(){this.setLayers()},watch:{featureLayers:function(e,t){console.log("selected",e),this.updateLayers(t,!1),this.updateLayers(e,!0)},layerPanels:function(e,t){for(var a=0;a<e.length;a++)t[a]&&e[a]==t[a]||this.updateLayers(a,e[a])}},mounted:function(){var e=this;console.log("layers on mount",this.layers),this.$nextTick(function(){e.editFeatureDefaults=f()({},e.editFeature),e.checkForUpdate()}),this.$store.watch(function(e){return e.neighbourhood},this.checkForUpdate),this.$store.watch(function(e){return e._col_layers_selected},this.checkForUpdate),this.$store.watch(function(e){return e._col_indicatorSections_selected},this.checkForUpdate)}},be=(r(446),Object(F.a)(ge,k,[],!1,null,null,null));be.options.__file="src/components/MapView.vue";var xe=be.exports,ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"resize",rawName:"v-resize",value:e.centerMap,expression:"centerMap"}]},[a("table",{class:{mobile:e.$vuetify.breakpoint.xsOnly},attrs:{id:"navigator-key"}},[a("tr",{staticClass:"hidden-xs-only",attrs:{id:"navigator-header"}},[a("td",{attrs:{colspan:"2"}},[a("div",{staticClass:"subheading grey--text text--darken-2"},[e._v("\n          "+e._s(e.$store.state.navigator.indicator.name)+" - "+e._s(e.$store.state.year)+"\n          ")]),e._v(" "),a("div",{staticClass:"caption py-1"},[e._v("\n          "+e._s(e.details.neighbourhood)+"\n          "),a("div",{staticStyle:{height:"15px"}},[e._v("\n          "+e._s(e.details.value)+"\n        ")])])])]),e._v(" "),a("tr"),e._v(" "),a("tr",[a("td",{staticClass:"key-gradient"}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n            "+e._s(e.scale.max.toFixed(0))+"\n          ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n            "+e._s(e.scale.min.toFixed(0))+"\n          ")])])])]),e._v(" "),a("l-map",{ref:"map",attrs:{zoom:e.$store.state.navigator.zoom,center:e.$store.state.navigator.center,options:e.mapOptions,id:"navigation-map"},on:{click:function(t){return e.log()}}},e._l(e.$store.state._col_areas.filter(function(e){return e.feature}),function(t,r){return a("l-geo-json",{key:t._id,attrs:{geojson:t.feature,options:e.areasGeoJsonOptions,"options-style":e.getAreaStyle(t.feature.properties.id)}})}),1)],1)};ke._withStripped=!0;var we={name:"MapView",components:{LMap:S.a,LTileLayer:$.a,LMarker:L.a,LPopup:A.a,LTooltip:j.a,LPolygon:O.a,LGeoJson:E.a},data:function(){var e=this;return{zoom:15,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',showParagraph:!1,details:{neighbourhood:"",value:"",key:""},detailsDefault:{neighbourhood:"",value:"",key:""},mapOptions:{zoomSnap:.5},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e,i=r.$store.getters.indicatorsForSelectedYear.filter(function(e){return e.areaCode===t.properties.id})[0];a.bindPopup("<p><b>"+t.properties.name+"</b></p><p>"+r.$store.state.navigator.indicator.name+": "+i[r.$store.state.navigator.indicator.figure]+"</p>"),a.on({click:function(e){console.log("nnnnn",i);var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.centroid_lng,lat:t.centroid_lat}})},mouseover:function(e){e.target.openPopup()},mouseout:function(e){r.details=r.detailsDefault,e.target.closePopup()}})}},layers:{areas:!0}}},computed:{scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return parseInt(t[e.$store.state.navigator.indicator.figure])}).sort(function(e,t){return e-t});return console.log("scale sorted",this.$store.state.navigator.indicator.figure,t),{min:t[0]||0,constant:t[t.length-1]-t[0]||0,max:t[t.length-1]||0}}},methods:{log:function(){},getAreaStyle:function(e){var t=Q.a.scale(["#eaeaea",this.$vuetify.theme.primary]),a=this.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=t((a[this.$store.state.navigator.indicator.figure]-this.scale.min)/this.scale.constant),i=this.$store.state.neighbourhood===e?this.$vuetify.theme.tertiary:"#eee";return{weight:(this.$store.state.neighbourhood,1),color:i,opacity:1,fillColor:r,fillOpacity:1}},selectArea:function(e){},mouseoverArea:function(e){},centerMap:function(){var e=35.13-16175e-8*(window.innerWidth-800);console.log("navigation lng",e),this.$store.commit("UPDATE",{key:["navigator","center"],value:{lon:e,lat:this.$store.state.navigator.center.lat}})}},mounted:function(){this.$refs.map.mapObject.on("click",function(e){console.log(e)}),this.$refs.map.mapObject.zoomControl.setPosition("bottomright"),console.log("map",this.$refs.map.mapObject.zoomControl),this.$vuetify.breakpoint.xsOnly?(this.$store.commit("UPDATE",{key:["navigator","zoom"],value:11}),this.$store.commit("UPDATE",{key:["navigator","center"],value:this.$store.state.map.defaultCenter})):this.centerMap()}},Ce=(r(447),Object(F.a)(we,ke,[],!1,null,null,null));Ce.options.__file="src/components/MapNavigator.vue";var Se=Ce.exports,$e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.desserts},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.name))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.calories))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.fat))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.carbs))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.iron))])]}}])})};$e._withStripped=!0;var Le={data:function(){return{headers:[{text:"Dessert (100g serving)",align:"left",sortable:!1,value:"name"},{text:"Calories",value:"calories"},{text:"Fat (g)",value:"fat"},{text:"Carbs (g)",value:"carbs"},{text:"Protein (g)",value:"protein"},{text:"Iron (%)",value:"iron"}],desserts:[{name:"Frozen Yogurt",calories:159,fat:6,carbs:24,protein:4,iron:"1%"},{name:"Ice cream sandwich",calories:237,fat:9,carbs:37,protein:4.3,iron:"1%"},{name:"Eclair",calories:262,fat:16,carbs:23,protein:6,iron:"7%"},{name:"Cupcake",calories:305,fat:3.7,carbs:67,protein:4.3,iron:"8%"},{name:"Gingerbread",calories:356,fat:16,carbs:49,protein:3.9,iron:"16%"},{name:"Jelly bean",calories:375,fat:0,carbs:94,protein:0,iron:"0%"},{name:"Lollipop",calories:392,fat:.2,carbs:98,protein:0,iron:"2%"},{name:"Honeycomb",calories:408,fat:3.2,carbs:87,protein:6.5,iron:"45%"},{name:"Donut",calories:452,fat:25,carbs:51,protein:4.9,iron:"22%"},{name:"KitKat",calories:518,fat:26,carbs:65,protein:7,iron:"6%"}]}}},Ae=Object(F.a)(Le,$e,[],!1,null,null,null);Ae.options.__file="src/components/Viewer.vue";var je=Ae.exports,Oe=r(36),Ee={name:"App",components:{MapView:xe,Viewer:je},data:function(){return{loading:!0,miniNav:!0,activeUser:null,authenticated:!1,drawerIndicators:!1,layersPanel:!0,currentView:"map-view",layers:[]}},computed:{items:function(){var e=[{icon:"help",text:"About",route:"help"},{icon:"map",route:"map",text:"Map"},{icon:"bar_chart",text:"Urban Indicators",route:"indicators"}];return this.activeUser?e.concat([{icon:"settings",text:"Manage Data",route:"manage"}]):e}},props:{source:String},created:function(){var e=this;return x()(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshActiveUser();case 2:case"end":return t.stop()}},t,e)}))()},watch:{$route:"refreshActiveUser"},methods:{log:function(){console.log("store",this.$store.state),q.a.create({baseURL:"http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,json:!0})({method:"POST",url:"/planmonitor"}).then(function(e){console.log("logdata",e)})},toggleLogin:function(){this.activeUser?this.logout():this.login()},login:function(){this.$auth.loginRedirect()},refreshActiveUser:function(){var e=this;return x()(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.getUser();case 2:e.activeUser=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},logout:function(){var e=this;return x()(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.logout();case 2:return t.next=4,e.refreshActiveUser();case 4:e.$router.push("/");case 5:case"end":return t.stop()}},t,e)}))()},printUser:function(){console.log("USER"),console.log(this.activeUser),console.log(this.$auth)}},mounted:function(){var e=this,t=y()(Oe).reduce(function(e,t){var a=Oe[t].layerCollection;return a&&e.indexOf(a)<0&&e.push(a),e},[]);d.a.all(t.map(function(t){return e.$store.dispatch("UPDATE_COLLECTION",t)})).then(function(a){var r=a.reduce(function(e,a,r){return e[t[r]]=a,e},{});return console.log("layerColsObj",r),d.a.all(y()(Oe).reduce(function(t,a){var i=Oe[a].layerCollection;if(Oe[a].storeByLayer){var n=r[i].reduce(function(e,t){return e[t._id]=[],e},{});e.$store.commit("UPDATE",{key:"_col_"+a,value:n})}else i?(console.log("update by layer",a,i,r[i][0]._id),t.push(e.$store.dispatch("UPDATE_COLLECTION",{name:a,layer:r[i][0]._id}))):r[a]?console.log("did not dispatch",a):(console.log("this.$store.dispatch",a),t.push(e.$store.dispatch("UPDATE_COLLECTION",a)));return t},[]))}).then(function(){console.log("LOADING COMPLETE"),e.loading=!1})}},Ie=(r(448),Object(F.a)(Ee,v,[],!1,null,null,null));Ie.options.__file="src/App.vue";var Te=Ie.exports,De=r(118),Pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layer-select",{staticClass:"hidden-sm-and-up pa-2 px-3 ejmap-border-top ejmap-border-bottom",staticStyle:{"z-index":"4","background-color":"white"},attrs:{collection:"indicatorSections"}}),e._v(" "),e.$vuetify.breakpoint.xsOnly?a("v-carousel",{staticStyle:{"z-index":"2"},attrs:{id:"indicators-carosel",cycle:!1,"hide-controls":"","hide-delimiters":"",light:"",height:e.carouselHeight},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.items,function(t,r){return a("v-carousel-item",{key:r},[a("indicator-card",{attrs:{item:t,selected:e.selected===r,lazy:""}})],1)}),1):a("v-container",{staticStyle:{overflow:"hidden"},attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{staticStyle:{"z-index":"2"},attrs:{sm2:"","xs-12":""}},[a("editable-data-list",{attrs:{disabled:!0,collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{staticStyle:{"z-index":"2"},attrs:{sm7:"",xs12:""}},[a("div",{staticStyle:{position:"relative",display:"block"}},[a("div",{staticClass:"title mb-4 pt-1 hidden-xs-only"},[a("div",{staticClass:"mr-4",staticStyle:{display:"inline-block",float:"left","margin-top":"6px"}},[e._v("  "+e._s(e.section.text_en)+" ")]),e._v(" "),a("area-select",{staticClass:"title font-weight-light"})],1),e._v(" "),a("masonry",{attrs:{cols:{default:2,800:1},gutter:20}},e._l(e.items,function(t,r){return a("div",{key:t._id,staticStyle:{"margin-bottom":"20px"},attrs:{sm6:"",xs12:""},on:{click:function(t){return e.updateSelected(r)}}},[a("indicator-card",{attrs:{item:t,selected:e.selected===r}})],1)}),0)],1)])],1)],1),e._v(" "),e.$store.getters.indicatorsForSelectedYear?a("map-navigator",{class:{mobile:e.$vuetify.breakpoint.xsOnly},attrs:{id:"map-panel-navigator"}}):e._e(),e._v(" "),a("div",{staticClass:"hidden-xs-only",staticStyle:{position:"fixed",background:"none",top:"0",width:"74%",height:"100%","z-index":"1"}})],1)};Pe._withStripped=!0;var Fe={props:{title:String,"x-labels":Boolean,"y-labels":Boolean,clickHandler:Boolean},data:function(){var t=this;return{options:{axes:{display:!1},scales:{yAxes:[{display:t.$props.yLabels,gridLines:{display:!1},scaleLabel:{display:t.$props.yLabels},ticks:{display:t.$props.yLabels}}],xAxes:[{display:t.$props.xLabels,gridLines:{display:!1},scaleLabel:{display:t.$props.xLabels},ticks:{display:t.$props.xLabels}}]},legend:{display:!1},title:{display:!0,text:t.$props.title||""},maintainAspectRatio:!1,onClick:function(a,r){if(console.log("chartoutput",r[0]),t.$props.clickHandler){var i=t.$store.getters.selectedAreas.filter(function(e){return e.feature.properties.name===r[0]._model.label})[0].feature.properties;console.log("chartoutput",r[0]),t.$store.commit("UPDATE",{key:"neighbourhood",value:i.areaCode}),t.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),t.$store.commit("UPDATE",{key:["map","center"],value:{lon:i.centroid_lng,lat:i.centroid_lat}})}}}}}},Ue=r(47),Me=Ue.c.reactiveProp,Be={extends:Ue.b,mixins:[Fe,Me],mounted:function(){this.renderChart(this.chartData,this.options)}},Ne=Ue.c.reactiveProp,ze={extends:Ue.a,mixins:[Ne,Fe],mounted:function(){this.renderChart(this.chartData,this.options)}},Ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{class:[{selected:e.selected&&e.$vuetify.breakpoint.smAndUp},"indicator-hover"],attrs:{hover:"",ripple:e.$vuetify.breakpoint.smAndUp,raised:""}},["List"===e.type&&e.selectedIndicator?a("div",[a("v-list",e._l(e.selectedIndicator[e.figure[0]],function(t,r){return a("v-list-item",[a("v-list-tile-action",[e._v("\n            "+e._s(r)+"\n          ")]),e._v(" "),a("v-list-tile-content",[e._v("\n            "+e._s(t)+"\n          ")])],1)}),1)],1):"Figure"===e.type&&e.selectedIndicator?a("div",{staticClass:"pa-2",staticStyle:{position:"relative"},on:{click:function(t){return e.updateIndicator()}}},[a("div",{staticClass:"subheading font-weight-light",staticStyle:{width:"40%"}},[e._v(e._s(e.name))]),e._v(" "),"Figure"===e.type?a("div",{staticStyle:{"overflow-x":"visible",display:"inline-block","white-space":"nowrap"}},[a("span",{staticClass:"display-1 py-0"},[e._v(e._s(e.selectedIndicator[e.figure[0]]||0))]),e._v(" "),e.unit?a("span",{staticClass:"subheading ml-1"},[e._v(e._s(e.unit))]):e._e(),e._v(" "),a("div",{staticClass:"font-weight-light"},[e._v(e._s(e.year))])]):e._e(),e._v(" "),e.dataYears?a("div",{staticClass:"px-1",staticStyle:{position:"absolute",top:"-10px",right:"15px",width:"50%"}},[a("v-slider",{attrs:{"track-color":"transparent","always-dirty":"","inverse-label":"","tick-labels":e.makeSliderLabels(e.dataYears),ticks:"always","tick-size":2,min:e.dataYears[0],max:e.dataYears[e.dataYears.length-1],"z-index":"500"},model:{value:e.selectedYear,callback:function(t){e.selectedYear=t},expression:"selectedYear"}})],1):e._e(),e._v(" "),a("div",{style:e.chartWidthClass},["Figure"===e.type?a("bar-vertical",{staticClass:"bar-chart-minimal",staticStyle:{"margin-top":"0px"},attrs:{"chart-data":e.prepBarChartData,"click-handler":!0,"x-labels":!1,"y-labels":!1}}):"Chart"===e.type&&e.selectedIndicator?a("bar-vertical",{staticStyle:{height:"300px","margin-bottom":"-30px"},attrs:{"x-labels":!0,"y-labels":!0,"chart-data":e.generateChartDataSets}}):e._e()],1),e._v(" "),a("div",{staticClass:"text-xs-right",staticStyle:{"margin-right":"-18px",clear:"both",display:"block","margin-bottom":"-10px"}},[a("v-btn",{attrs:{icon:""}},[a("v-icon",{style:e.rotateStyle,attrs:{color:"grey"}},[e._v("keyboard_arrow_down")])],1)],1),e._v(" "),e.selected?a("div",{staticClass:"pa-2"},[e._v("\n  "+e._s(e.description)+"\n  "),a("br"),a("br"),e._v(" "),a("div",{staticClass:"grey--text text--darken-2"},[e._v("\n    Source: JIIS "+e._s(e.year||e.$store.state.year)+"\n  ")])]):e._e()]):e._e()])};Ye._withStripped=!0;var qe=r(24),Ke=r.n(qe),Re={components:{BarVertical:ze},data:function(){return{expand:!1,rotation:0,selectedYear:""}},props:["name","figure","description","unit","type","small","noChart","selected"],methods:{makeSliderLabels:function(e){for(var t=e[0],a=e[e.length-1]-t+1,r=[],i=0;i<a;i++){var n=t+i;r.push(e.indexOf(n)>-1?n:"")}return console.log("labels",r,e),r},log:function(){console.log("data",this),console.log("store",this.$store.state)},clickHandler:function(){console.log("click")},toggleRotate:function(){this.selected||(this.rotation=0===this.rotation?180:0)},updateIndicator:function(){if(this.log(),this.toggleRotate(),!this.figure[0]||!this.year)return null;this.$store.commit("UPDATE",{key:["navigator","indicator"],value:{figure:this.figure[0],name:this.name}}),this.$store.commit("UPDATE",{key:"year",value:this.year})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},validateYear:function(e){for(var t=e,a=0;a<this.dataYears.length;a++){if(-1!==this.dataYears.indexOf(t)){this.selectedYear=t;break}t++}return!0}},computed:{rotateStyle:function(){return{transform:"rotate("+this.rotation+"deg)"}},getDataByHoodYear:function(){var e=this;return this.$store.getters.dataByNeighbourhood.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByCityYear:function(){var e=this;return this.$store.state.cityIndicators.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByYear:function(){var e=this;return this.$store.state.indicators.filter(function(t){return t.year===e.thisYear})||[]},areaDataMatched:function(){var e=this;return this.$store.getters.indicatorsForSelectedArea.filter(function(t){return e.dataYears.some(function(e){return t.year===e})})},areaDataLatest:function(){return console.log("something"),this.areaDataMatched?this.areaDataMatched[this.areaDataMatched.length-1]:null},latestYear:function(){if(this.areaDataLatest)return console.log("arealatest",this.areaDataLatest),this.selectedYear},year:function(){return this.selectedYear||this.latestYear},selectedIndicator:function(){if(!this.dataYears||!this.selectedYear)return{};var e=this.areaDataMatched[this.dataYears.indexOf(this.selectedYear)];return console.log("selectedIndicator",e),e||((e={})[this.figure[0]]=0),e},dataYears:function(){var e=this.$store.getters.allIndicatorKeyYears[this.figure[0]];return console.log("datayears",e,this.$store.getters.allIndicatorKeyYears,this.$store.getters.allIndicatorsByYear),e},generateChartDataSets:function(){var e=this;if("Chart"!==this.type||!this.selectedIndicator)return console.log("chart data test",this.selectedIndicator),null;var t=this.selected?this.$vuetify.theme.primary:this.$vuetify.theme.grey;return{datasets:[{data:this.figure.map(function(t){return e.selectedIndicator[t]}),borderColor:t,type:"line",fill:!1}],labels:this.figure}},chartWidthClass:function(){var e={position:"relative",width:"95%"};return"Chart"!==this.type&&(e.marginTop="-60px"),"Chart"!==this.type&&this.$vuetify.breakpoint.smAndUp&&(e.marginTop="-60px",e.width="100%",e.paddingLeft="0"),e},prepBarChartData:function(){if(" Figure"===!this.type)return{};var e=this.figure,t=this.$store.state.neighbourhood,a=this.name,r=this.selected?this.$vuetify.theme.primary:"#000",i=this.$store.getters.allIndicatorsByYear;if(console.log("citydata",i),!i||!this.year)return{};i=i[this.year],console.log("citydata.year",i,this.year);var n=(i=i.map(function(t){return t[e]=t[e]||0,t})).sort(function(t,a){return!a[e]-!t[e]||+(t[e]>a[e])||-(t[e]<a[e])}),o=this.$store.getters.areaNames,s=this.$store.getters.selectedAreas;return console.log("sorted",n,o,s),{labels:n.map(function(e){return o[e.areaCode]}),area_code:t,datasets:[{label:a,backgroundColor:n.map(function(e){return e.areaCode===t?r:Ke.a.grey.lighten2}),data:n.map(function(t){return t[e]})}]}}},watch:{selectedYear:function(e,t){this.validateYear(e)},areaDataLatest:function(e){this.selectedYear=e.year}},mounted:function(){var e=this;this.$nextTick(function(){e.areaDataLatest?e.selectedYear=e.areaDataLatest.year:e.selectedYear=e.dataYears[e.dataYears.length-1],e.selected&&e.updateIndicator()})}},He=(r(451),Object(F.a)(Re,Ye,[],!1,null,null,null));He.options.__file="src/components/IndicatorKeyStat.vue";var Je=He.exports,Ve=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mt-5 mb-4",staticStyle:{background:"none"}},[t("div",{staticClass:"grey--text text--darken-2",staticStyle:{"text-transform":"uppercase","font-size":"18px",background:"none"}},[this._v(this._s(this.text))]),this._v(" "),t("v-divider",{staticClass:"my-2"})],1)};Ve._withStripped=!0;var Ge={props:["text"]},We=Object(F.a)(Ge,Ve,[],!1,null,null,null);We.options.__file="src/components/IndicatorHeading.vue";var Ze=We.exports;var Qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[e.datatable?a("div",[a("v-toolbar",{attrs:{flat:"",color:"rgba(0,0,0,0)"}},[a("v-toolbar-title",{staticClass:"grey--text text--darken-2 font-weight-light"},[e._v(e._s(e.title))]),e._v(" "),a("v-spacer"),e._v(" "),e.searchable?a("v-text-field",{staticClass:"mt-2 mr-3",attrs:{label:"Search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}):e._e(),e._v(" "),a("v-toolbar-items",{staticClass:"hidden-xs-only"},[e.multiselect?a("v-checkbox",{staticClass:"mt-3 mr-3",attrs:{label:"Select All",color:"grey",flat:""},on:{change:function(t){return e.toggleSelectAll()}},model:{value:e.selectAll,callback:function(t){e.selectAll=t},expression:"selectAll"}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1):e._e(),e._v(" "),e.multiselect?a("v-btn",{attrs:{color:"grey",flat:""},on:{click:function(t){return e.deleteSelected(e.collection)}}},[e._v("\n            Delete Selected\n          ")]):e._e(),e._v(" "),a("v-btn",{attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1)],1)],1),e._v(" "),a("v-data-table",{class:e.cssclass,attrs:{headers:e.featureHeaders,items:e.items,"rows-per-page-items":[10,20,50,100,-1],search:e.search},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",{staticClass:"attribute-row",on:{dblclick:function(a){return e.openEditor(t.item)}}},e._l(e.featureHeaders,function(r,i){return a("td",[r.type===Array?e._l(e.getNested(e.nestedPath,t.item)[r.value],function(t){return a("v-chip",{class:"func-"+t,attrs:{outline:"",small:""}},[e._v("\n              "+e._s(t)+"\n            ")])}):"select"===r.type?[a("v-checkbox",{staticStyle:{"padding-bottom":"0"},attrs:{color:"grey"},on:{change:function(a){return e.selectFeature(t.item)}},model:{value:t.item.feature._selected,callback:function(a){e.$set(t.item.feature,"_selected",a)},expression:"props.item.feature._selected"}})]:[e._v("\n            "+e._s(e.getNested(e.nestedPath,t.item)[r.value])+"\n          ")],e._v(" "),i===e.featureHeaders.length-1?a("div",{staticClass:"attribute-controls-wrapper"},[a("div",{staticClass:"attribute-controls",staticStyle:{top:"-30px"}},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.openEditor(t.item)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t.item._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()],2)}),0)]}}],null,!1,4180426252)}),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e()],1):a("div",[e.addtop?a("v-btn",{staticClass:"mb-2",staticStyle:{"margin-top":"-40px",float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e(),e._v(" "),a("v-list",{class:e.cssclass,attrs:{dense:""}},e._l(e.listItems,function(t,r){return a("v-list-tile",{key:r,staticClass:"attribute-row",on:{click:function(a){return e.select(r,t._id)}},model:{value:t.active,callback:function(a){e.$set(t,"active",a)},expression:"x.active"}},[e.listKey&&e.schema.schema[e.listKey]._options&&e.schema.schema[e.listKey]._options[0]?a("v-list-tile-action",[a("v-icon",[e._v(e._s(e.schema.schema[e.listKey]._options.filter(function(a){return a.name===t[e.listKey]})[0].icon)+" ")])],1):e._e(),e._v(" "),a("v-list-tile-content",[t._id?a("div",{staticClass:"attribute-controls-wrapper"},[e._v("\n        "+e._s(t.text||t.text_en||t.name)+"\n        "),e.disabled?e._e():a("div",{staticClass:"attribute-controls"},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.openEditor(t)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()]),e._v(" "),t.active?a("div",{staticStyle:{height:"100%"}}):e._e()],1)}),1),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n")],1):e._e()],1)]),e._v(" "),e.schema?a("v-dialog",{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("editor",{attrs:{collection:e.collection,filter:e.filter,editItem:e.editItem},on:{close:function(t){return e.close()},update:function(t){return e.updateCollection(!0)}}})],1):e._e()],1)};Qe._withStripped=!0;var Xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("form",{attrs:{enctype:"multipart/form-data",novalidate:""},on:{submit:function(t){return t.preventDefault(),e.processForm(t)}}},[a("div",{staticClass:"dropbox pa-3",staticStyle:{"background-color":"#fff"}},[a("input",{ref:"file",staticClass:"input-file",attrs:{type:"file",name:e.uploadFieldName},on:{change:function(t){return e.filesChange()}}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"function",items:e.uploadFunctions,label:"Function"},model:{value:e.uploadFunction,callback:function(t){e.uploadFunction=t},expression:"uploadFunction"}}):e._e(),e._v(" "),"update"==e.uploadFunction?a("div",[a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Existing Records"},model:{value:e.update.matchExisting,callback:function(t){e.$set(e.update,"matchExisting",t)},expression:"update.matchExisting"}}),e._v(" "),a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Upload"},model:{value:e.update.matchUpload,callback:function(t){e.$set(e.update,"matchUpload",t)},expression:"update.matchUpload"}}),e._v(" "),a("v-text-field",{attrs:{label:"Update Key"},model:{value:e.update.key,callback:function(t){e.$set(e.update,"key",t)},expression:"update.key"}})],1):e._e(),e._v(" "),a("v-select",{attrs:{name:"collection",items:e.collections,label:"Collection"},model:{value:e.collection,callback:function(t){e.collection=t},expression:"collection"}}),e._v(" "),a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"format",items:e.indicatorFormats,label:"Format"},model:{value:e.indicatorFormat,callback:function(t){e.indicatorFormat=t},expression:"indicatorFormat"}}):e._e(),e._v(" "),e.isSaving?a("v-checkbox",{attrs:{name:"discardOutliers",label:"Discard features outside of layer"},model:{value:e.discardOutliers,callback:function(t){e.discardOutliers=t},expression:"discardOutliers"}}):e._e(),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.isSaving?a("v-btn",{attrs:{type:"submit",loading:e.processing,color:"blue",dark:"",depressed:""}},[e._v("Upload")]):e._e()],1)])])};Xe._withStripped=!0;var et=r(36),tt={props:["layer","layerCollection"],data:function(){return{processing:!1,isSaving:!1,uploadedFiles:[],uploadError:null,currentStatus:null,uploadFieldName:"GeoJSON",file:"",neighbourhood:"",collection:"",layerSelected:"",indicatorFormats:["geojson","json","csv"],indicatorFormat:null,discardOutliers:!1,uploadFunction:"create",uploadFunctions:["create","update"],update:{key:"",matchUpload:"",matchExisting:""}}},methods:{filesChange:function(){this.isSaving=!0,this.file=this.$refs.file.files[0],this.neighbourhood=this.file.name.split(".")[0],this.indicatorFormat=this.file.name.split(".")[1]},close:function(){this.processing=!1,this.$emit("close",!0)},processForm:function(){var e=this;this.processing=!0;var t=et[this.collection].params?this.layerSelected:"",a=this.collection||alert("Collection required"),r="update"===this.uploadFunction?"updateMany":"create",i=new FormData;i.append("neighbourhood",this.neighbourhood),i.append("layer",this.layerSelected),i.append("file",this.file),i.append("format",this.indicatorFormat),i.append("update",c()(this.update)),i.append("discardOutliers",this.discardOutliers),W[r](a,null,i,{"Content-Type":"multipart/form-data"},t).then(function(){return console.log("SUCCESS!!"),e.$store.dispatch("UPDATE_COLLECTION",{name:a,layer:e.layerSelected})}).then(function(){e.$forceUpdate(),e.close()}).catch(function(t){if(e.processing=!1,console.log("err.response",t.response),!t.response)return alert(t),null;var a=t.response.data.errors;alert(y()(a).reduce(function(e,t){return e=e+"\n"+a[t].name+": "+a[t].message},""))})}},computed:{layers:function(){var e=this.$store.state["_col_"+this.layerCollection];if(e)return e.map(function(e){return{text:e.name,value:e._id}})},collections:function(){return console.log("generating collections"),y()(et).reduce(function(e,t){return et[t].canUpload&&e.push(t),e},[])}},mounted:function(){this.layerSelected=this.layer}},at=Object(F.a)(tt,Xe,[],!1,null,null,null);at.options.__file="src/components/Upload.vue";var rt=at.exports,it=r(36),nt={components:{VueJsonPretty:de.a,Upload:rt,Editor:ye},props:["collection","filter","datatable","listKey","nestedPath","cssclass","addtop","addbottom","multiselect","disabled","searchable","title"],data:function(){return{search:"",updateKey:0,dialog:!1,mode:null,saving:!1,editedIndex:null,layerDialog:!1,attributeDialog:!1,selected:0,selectedId:"",editedCollection:null,edited:{},editItem:null,selectAll:!1}},computed:{schema:function(){return this.$store.getters.collectionSchema(this.collection,this.filter)},menuItems:function(){return this.$store.getters.areaLayers},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},listItems:function(){var e=this,t=this.items.map(function(t,a){return t.active=e.selected===a,t});return console.log("listitems",t),t},items:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;if("features"===this.collection){var t=this.$store.state._col_features[this.filterId];return t?(t=Array.isArray(t)?t:t[this.$store.state.neighbourhood],this.multiselect?t.map(function(e,t){return e.feature.properties._selected=e.feature.properties._selected||!1,e.feature.properties._index=t,e}):items):[]}var a=n()(this.$store.state["_col_"+this.collection]);return console.log("collectiondata",this.collection,a),a[0]?this.filter&&a[0]?(console.log("filterlayer",this.filter),a.filter(function(t){return t.layer===e.filterId})):a:[]}),firstItem:function(){return this.$store.state["_col_"+self.collection]?this.$store.state["_col_"+self.collection][0]:{}},tabledata:function(){if(this.layer)return this.layer.attributes},featureHeaders:function(){var e=this;if(!this.schema.schema)return[];var t=this.multiselect?[{value:"select",type:"select",_text:""}]:[],a=y()(this.schema.schema).reduce(function(t,a){return e.schema.schema[a]._text&&t.push({value:a,text:e.schema.schema[a]._text,type:e.schema.schema[a].type}),t},t);return console.log("featureHeaders",a),a}},methods:{openEditor:function(e){this.editItem=e,this.dialog=!0},addSelects:function(e,t){return this.multiselect?e.map(function(e,a){return e.feature._selected=e._selected||t||!1,e.feature.properties._index=a,e}):e},updateCollection:function(e){var t=this;if(!e&&"features"===!this.collection&&!this.$store.state["_col_"+this.collection+"_selected"])return d.a.reject();var a=this;return console.log("EDITABLEDATALIST updating collection "+this.collection),new d.a(function(r,i){var n=t.collection;if("features"===t.collection||"areas"===t.collection){var o=a.filterId;n={name:t.collection,layer:o},(!o||!e&&t.$store.state._col_features[o])&&i("No layer specified")}a.$store.dispatch("UPDATE_COLLECTION",n).then(function(e){console.log("forcing update"),a.$forceUpdate(),r(e)}).catch(function(e){console.log("update failed",e),i()})})},selectFeature:function(e,t){var a=this.$store.state._col_layers_selected;console.log(e,a),this.$store.commit("UPDATE_FEATURE_PROPERTIES",{layer:a,feature:e})},setMode:function(){this.$store.commit("UPDATE",{key:"mode",value:this.collection})},select:function(e,t){console.log("index",e,t),this.selected=e,this.selectedId=t,console.log("updating selected value: ",this.collection,t),this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:t}),this.setMode();var a=this;this.$nextTick(function(){return a.$forceUpdate()})},del:function(e,t){var a=this;this.loading=!0,confirm("Are you sure you want to delete this item?")&&W.del(e,t).then(function(e){a.updateCollection(!0),a.selected=a.selected>0?a.selected-1:0,a.loading=!1})},close:function(){this.dialog=!1},toggleSelectAll:function(){this.addSelects(this.items,this.selectAll);var e={name:"features",layer:this.$store.state["_col_"+this.filter+"_selected"],data:this.addSelects(this.items,this.selectAll)},t=this;this.$store.dispatch("UPDATE_COLLECTION",e).then(function(){return t.$forceUpdate()})},deleteSelected:function(){var e=this;console.log(this.items);var t=void 0,a=this.items.filter(function(e){return e.feature._selected}),r=it[this.collection].params?this.filterId:null;if(!confirm("Are you sure you want to delete "+a.length+" items?"))return null;t=this.selectAll&&this.filter?{layer:this.$store.state["_col_"+this.filter+"_selected"]}:a.map(function(e){return e._id}),W.deleteMany(this.collection,"",t,"",r).then(function(){console.log("deleted"),e.updateCollection(!0)})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},forceUpdate:function(){this.$forceUpdate(),console.log("force updated",this.$store.getters.selectedLayerAttributes)},logStore:function(){console.log("data",this),console.log("store",this.$store.state)}},watch:{dialog:function(e){console.log(e),e||this.close()},menuItems:function(e){console.log("menuItems",newValue)},filterId:function(e){console.log("WATCH: layerchanged",e),"features"===this.collection&&this.updateCollection()}},created:function(){console.log("created"),this.updateCollection().then(function(e){}).catch(function(e){return console.log("failed to update store")}),this.datatable||this.setMode()},mounted:function(){}},ot=(r(452),Object(F.a)(nt,Qe,[],!1,null,null,null));ot.options.__file="src/components/EditableDataList.vue";var st=ot.exports,lt=function(){var e=this,t=e.$createElement;return(e._self._c||t)("v-select",{staticClass:"area-select",attrs:{items:e.$store.state["_col_"+e.collection],"item-text":"text_en","item-value":"_id",solo:"",flat:"",dense:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})};lt._withStripped=!0;var ct={props:["collection"],data:function(){return{selected:""}},computed:{},methods:{update:function(e){this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:e})}},watch:{selected:function(e,t){console.log(e,t),e!==t&&this.update(e)}},created:function(){this.selected=this.$store.state["_col_"+this.collection+"_selected"]},mounted:function(){var e=this;this.$store.watch(function(t,a){return t["_col_"+e.collection+"_selected"]},function(t,a){e.selected=t})}},ut=Object(F.a)(ct,lt,[],!1,null,null,null);ut.options.__file="src/components/LayerSelect.vue";var dt=ut.exports,pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.item.datatable?a("div",{staticClass:"py-3"},[a("v-divider"),e._v(" "),a("div",{staticClass:"title py-3"},[e._v(e._s(e.item.name))]),e._v(" "),a("v-data-table",{attrs:{items:e.item.data,headers:e.item.headers,"rows-per-page-items":[-1]},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(e.item.headers,function(r){return a("td",[e._v(e._s(t.item[r.value]))])})}}],null,!1,119581540)})],1):"Figure"===e.item.type||"List"===e.item.type||"Chart"===e.item.type?a("indicator-key-stat",{attrs:{selected:e.selected,name:e.item.text,figure:e.item.figure,description:e.item.description,unit:e.item.unit,year:e.item.year,type:e.item.type}}):"Map"===e.item.type?a("div",[a("v-card",[a("div",{staticClass:"subheading font-weight-light my-2 px-2",staticStyle:{position:"absolute",top:"0","z-index":"2"}},[e._v(e._s(e.item.text))]),e._v(" "),a("map-view",{staticClass:"ejmap-border",staticStyle:{position:"relative"},attrs:{contextmenu:"",featuresCollection:"features",zoomLevel:"12",height:"400px",featureLayers:e.item.figure,areas:!0,options:{legendBottom:!0}}})],1)],1):e._e()};pt._withStripped=!0;var ft={components:{MapView:xe,IndicatorKeyStat:Je},props:["selected","item"],data:function(){return{}}},ht=Object(F.a)(ft,pt,[],!1,null,null,null);ht.options.__file="src/components/IndicatorCard.vue";var yt={components:{MapView:xe,MapNavigator:Se,BarHorizontal:Be,BarVertical:ze,IndicatorKeyStat:Je,IndicatorHeading:Ze,EditableDataList:st,AreaSelect:le,IndicatorCard:ht.exports,LayerSelect:dt},data:function(){return{selected:0,activeTab:null,selectedData:this.$store.getters.selected}},computed:{items:function(){var e=this.$store.getters.selectedIndicatorBlocks;console.log("indicator blocks",e);var t,a,r,i=(t=e,a=["text","description"],r=this.$store.state.language,a="string"==typeof a?[a]:a,function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":s()(i)))return a.forEach(function(e){i[e+"_"+r]&&(i[e]=i[e+"_"+r])}),y()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(t=Array.isArray(t)?t:[t],a,r));return console.log("translateion",i),console.log("indicatorsByArea",this.$store.getters.indicatorsByArea),i},featureLayers:function(){var e=this.$store.getters.selectedIndicatorSection;return e?e.geodata:null},section:function(){var e=this;return this.$store.state._col_indicatorSections.filter(function(t){return t._id===e.$store.state._col_indicatorSections_selected})[0]},carouselHeight:function(){return window.innerHeight/100*45}},methods:{updateSelected:function(e){this.selected=e,console.log("updated select",this.selected)},log:function(){console.log("store",this.$store.state)}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedIndicatorSection},function(t,a){if(console.log("section changed",t),e.selected=0,!t||!Array.isArray(t.geodata)||0===t.geodata.length)return null;t.geodata.forEach(function(t){e.$store.state["_col_"+t]||e.$store.dispatch("UPDATE_COLLECTION",{name:"features",query:{},layer:t})}),e.$store.commit("UPDATE",{key:["map","zoom"],value:15})}),console.log("store",this.$store.state)}},mt=(r(453),Object(F.a)(yt,Pe,[],!1,null,null,null));mt.options.__file="src/components/IndicatorsNew.vue";var vt=mt.exports,_t=function(){var e=this.$createElement,t=this._self._c||e;return this.$store.state._col_features?t("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",height:"",featureLayers:this.$store.state._col_layers_selected,featuresCollection:"features",zoomLevel:"12",allLayers:!0,options:{legendStyle:this.legendStyle,areaSelect:!0,mapStyle:{flexDirection:"row-reverse"}}}}):this._e()};_t._withStripped=!0;var gt={components:{MapView:xe},data:function(){return{legendStyle:{height:"100%",maxHeight:"100%",width:"25%",maxWidth:"300px",minWidth:"200px",left:0,borderRight:"1px solid #e3e3e3",backgroundColor:"#fff"}}}},bt=Object(F.a)(gt,_t,[],!1,null,null,null);bt.options.__file="src/components/MapFull.vue";var xt=bt.exports,kt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{staticClass:"px-3 pt-0",attrs:{fluid:"","grid-list-xl":""}},[a("div",{staticStyle:{}},[a("div",{staticClass:"data-toolbar",style:{top:e.$vuetify.breakpoint.xsOnly?"140px":0}},[a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"mb-2",attrs:{color:"grey",flat:"",icon:e.iconise},on:{click:function(t){e.uploadDialog=!0}}},r),[a("v-icon",{},[e._v("cloud_upload")]),e._v(" "),a("span",{staticClass:"hidden-sm-and-down ml-2"},[e._v("Upload")])],1)]}}])},[e._v(" "),a("span",[e._v("Upload Data")])]),e._v(" "),a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"mb-2",attrs:{color:"grey",flat:"",icon:e.iconise},on:{click:function(t){e.analysisDialog=!0}}},r),[a("v-icon",{},[e._v("assessment")]),e._v(" "),a("span",{staticClass:"hidden-sm-and-down ml-2"},[e._v("Update Feature Analysis")])],1)]}}])},[e._v(" "),a("span",[e._v("Update Feature Analysis")])])],1)]),e._v(" "),a("v-tabs",{staticClass:"mt-2 mx-4",attrs:{color:"background","slider-color":"primary","show-arrows":""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[e._l(e.tabs,function(t,r,i){return a("v-tab",{key:i,attrs:{ripple:""},on:{click:function(t){return e.update(r)}}},[e._v(e._s(t.text_en))])}),e._v(" "),e._l(e.tabs,function(t,r,i){return a("v-tab-item",{key:i,staticClass:"pt-4",attrs:{lazy:""}},[e.$vuetify.breakpoint.xsOnly?a("layer-select",{staticClass:"ejmap-border pa-2",staticStyle:{"background-color":"white"},attrs:{collection:t.filter.collection}}):e._e(),e._v(" "),a("div",{staticClass:"text-xs-right caption grey--text",style:{marginTop:e.$vuetify.breakpoint.xsOnly?"10px":"-20px"}},[a("span",[e._v("Layer id: "+e._s(e.$store.state["_col_"+t.uploadLayerCol+"_selected"]))])]),e._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"",xs12:""}},[e.$vuetify.breakpoint.smAndUp?a("editable-data-list",{attrs:{collection:t.filter.collection,listKey:t.filter.listKey,addbottom:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[t.map?a("v-flex",{staticClass:"mb-2",style:{height:e.$vuetify.breakpoint.xsOnly?"602px":"402px"},attrs:{xs12:""}},[a("map-view",{class:t.map.classObj||{minimap:e.minimapOn,fullmap:!e.minimapOn,"ejmap-border":!0},style:t.map.style||"position:relative;height:402px;",attrs:{featuresCollection:t.map.featuresCollection,height:t.map.height||"400px",featureLayers:t.map.featureLayers,options:t.map.options||{legendBottom:e.scrollLow||e.$vuetify.breakpoint.xsOnly,areaSelect:!0}}})],1):e._e(),e._v(" "),e._l(t.tables,function(t,r){return["datalist"===t.type&&t.collection?a("v-flex",{key:r,attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 py-2"}),e._v(" "),"datalist"===t.type&&t.collection?a("editable-data-list",{attrs:{collection:t.collection,filter:t.filter,title:t.heading,datatable:!1!==t.datatable,multiselect:t.multiselect,nestedPath:t.nestedPath,searchable:t.searchable,childClass:t.childClass,addtop:!t.addbottom,addbottom:t.addbottom,areas:"areas"===t.collection}}):e._e()],1):"json"===t.type&&e.$store.state.selectedFeature?a("v-flex",{key:r,staticClass:"py-5",attrs:{xs12:""}},[a("div",{staticClass:"py-2 subheading font-weight-light  ejmap-border-bottom"},[e._v("Indicators ")]),e._v(" "),a("v-tabs",{attrs:{"slider-color":"primary",color:"background"}},[e._l(e.$store.getters.indicatorsForSelectedArea,function(t,r){return a("v-tab",{key:r,attrs:{ripple:""}},[e._v("\n        "+e._s(t.year)+"\n      ")])}),e._v(" "),e._l(e.$store.getters.indicatorsForSelectedArea,function(e,t){return a("v-tab-item",{key:t},[a("v-card",{attrs:{flat:""}},[a("vue-json-pretty",{staticClass:"pa-3 mb-2 code caption",attrs:{data:e}})],1)],1)})],2)],1):e._e()]})],2)],1)],1)],1)})],2)],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.uploadDialog,callback:function(t){e.uploadDialog=t},expression:"uploadDialog"}},[a("upload",{attrs:{layer:e.tabs[e.tab].uploadLayer,layerCollection:e.tabs[e.tab].uploadLayerCol},on:{close:function(t){e.uploadDialog=!1}}})],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.analysisDialog,callback:function(t){e.analysisDialog=t},expression:"analysisDialog"}},[a("analysis",{attrs:{layer:e.$store.state._col_layers_selected,areaLayer:e.$store.state._col_areaLayers_selected},on:{close:function(t){e.analysisDialog=!1}}})],1)],1)};kt._withStripped=!0;var wt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-3"},[a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),a("v-select",{attrs:{name:"areaLayer",items:e.areaLayers,label:"Area"},model:{value:e.areaLayerSelected,callback:function(t){e.areaLayerSelected=t},expression:"areaLayerSelected"}}),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{color:"blue",dark:"",depressed:"",loading:e.processing},on:{click:function(t){return e.updateAnalysis()}}},[e._v("Analyse")])],1)],1)};wt._withStripped=!0;r(36);var Ct={props:["layer","areaLayer"],data:function(){return{processing:!1,layerSelected:"",areaLayerSelected:""}},methods:{close:function(){this.$emit("close",!0)},updateAnalysis:function(){var e=this;this.processing=!0,W.updateAnalysis("features",this.areaLayerSelected,{},{},this.layerSelected).then(function(t,a){a&&console.log(a),e.processing=!1,e.$store.dispatch("UPDATE_COLLECTION",{name:"indicators",layer:e.$store.state._col_areaLayers_selected})})}},computed:{layers:function(){return this.$store.state._col_layers.map(function(e){return{text:e.name,value:e._id}})||[]},areaLayers:function(){return this.$store.state._col_areaLayers.map(function(e){return{text:e.name,value:e._id}})||[]}},mounted:function(){this.layerSelected=this.layer||this.$store.state._col_layers_selected,this.areaLayerSelected=this.areaLayer||this.$store.state._col_areaLayers_selected}},St=Object(F.a)(Ct,wt,[],!1,null,null,null);St.options.__file="src/components/Analysis.vue";var $t=St.exports,Lt={components:{EditableDataList:st,MapView:xe,Upload:rt,VueJsonPretty:de.a,Analysis:$t,AreaSelect:le,LayerSelect:dt},data:function(){return{uploadDialog:!1,analysisDialog:!1,activeTab:null,pages:null,tab:"features",scrollLow:!1,minimap:{position:"fixed",top:"20px",left:"20px",width:"20%",height:"200px"}}},computed:{minimapOn:function(){return this.scrollLow&&this.$vuetify.breakpoint.mdAndUp},iconise:function(){return this.$vuetify.breakpoint.smAndDown},tabs:function(){return{features:{text_en:"Features",uploadLayer:this.$store.state._col_layers_selected,uploadLayerCol:"layers",filter:{collection:"layers",listKey:"data_type"},map:{featuresCollection:"features",featureLayers:this.$store.state._col_layers_selected},tables:[{type:"datalist",heading:"Attributes",collection:"layerAttributes",filter:"layers"},{type:"datalist",heading:"Calculations",collection:"layerCalcs",filter:"layers"},{type:"datalist",heading:"Features Table",multiselect:!0,collection:"features",filter:"layers",nestedPath:"feature.properties",searchable:!0}]},areas:{text_en:"Areas",uploadLayer:"areas",uploadLayerCol:"areaLayers",filter:{collection:"areaLayers"},map:{featuresCollection:"areas"},tables:[{type:"datalist",heading:"Attributes",collection:"areaAttributes",filter:"areaLayers"},{type:"datalist",heading:"Areas",collection:"areas",filter:"areaLayers",multiselect:!0,nestedPath:"feature.properties",searchable:!0}]},indicatorAttributes:{text_en:"Indicators",uploadLayer:this.$store.state._col_areaLayers_selected,uploadLayerCol:"areaLayers",filter:{collection:"areaLayers"},map:{featuresCollection:"areas"},tables:[{type:"datalist",heading:"Attached Attributes",collection:"indicatorAttributes",filter:"areaLayers"},{type:"json"}]},indicatorSections:{text_en:"Sections",filter:{collection:"indicatorSections"},tables:[{type:"datalist",heading:"Blocks",collection:"indicatorBlocks",filter:"indicatorSections"}]},surveys:{text_en:"Surveys",uploadLayer:this.$store.state._col_surveyLayers_selected,uploadLayerCol:"surveyLayers",filter:{collection:"surveyLayers"},map:{featuresCollection:"features",featureLayers:this.$store.getters.getSelected("surveyLayers").featureLayer},tables:[{type:"datalist",heading:"Questions",collection:"surveyLayerAttributes",filter:"surveyLayers"},{type:"datalist",heading:"Survey Results",multiselect:!0,collection:"surveyRecords",filter:"surveyLayers",searchable:!0}]}}}},methods:{update:function(e){console.log("activetab",this.activeTab);var t=this;this.tab=e,this.$store.commit("UPDATE",{key:"tab",value:e}),this.$nextTick(function(){t.$forceUpdate()})},log:function(){console.log("data",this),console.log("store",this.$store.state)}},mounted:function(){var e=this;window.addEventListener("scroll",function(t){window.scrollY>500&&!e.scrollLow?e.scrollLow=!0:window.scrollY<500&&e.scrollLow&&(e.scrollLow=!1)})}},At=(r(454),Object(F.a)(Lt,kt,[],!1,null,null,null));At.options.__file="src/components/ManageDataMaster.vue";var jt=At.exports,Ot=r(117),Et=r.n(Ot),It=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-layout",{attrs:{row:"",wrap:""}},e._l(e.items,function(t,r){return a("v-flex",{attrs:{xs12:"","py-4":""}},[a("div",{staticClass:"title pb-2"},[e._v(e._s(t.heading))]),e._v(" "),a("div",{staticClass:"subheading",staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.text))]),e._v(" "),t.code?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:t.code}}):e._e()],1)}),1)],1)};It._withStripped=!0;var Tt={components:{VueJsonPretty:de.a},data:function(){return{itemsX:[{heading:"Features"},{heading:"Features"},{heading:"Features"}],items:[{heading:"Features",text:"Spatial data points (either points, polygons or lines) with attribute information including which feature layer it is associated with.",code:{type:"point",geometry:[],properties:{year:2015,feature_layer:"education",type:"college",students:500,gender:"mixed",quality_rating:10}}},{heading:"Feature Layers",text:"Feature layers determine the layer type and methods of analysis to be performed on it.",code:{name:"education",type:"point",columns:{type:{type:"string",func:"count"},students:{type:"integer",func:"sum"},gender:{type:"string",func:"count"},quality_rating:{type:"integer",func:"average"}}}},{heading:"Areas",text:"Statistical areas with which the features should be grouped for analysis"},{heading:"Area Indicators",text:"Area indicators include the results of spatial analysis between the Areas and Features and any additional secondary data e.g from JIIS"},{heading:"Surveys",text:"Surveys are extensions of Feature Layers that can be used for collecting field data.\n\nSurveys can use an existing Feature Layer as a template or create a new one. In most cases spatial data will need to be uploaded in advance of the conducting the survey.However, point data can be added live via the survey map"}]}}},Dt=Object(F.a)(Tt,It,[],!1,null,null,null);Dt.options.__file="src/components/Help.vue";var Pt=Dt.exports;"http://localhost:8080"===window.location.origin||window.location.origin;console.log("routing from",{redirect_uri:window.location.origin+"/implicit/callback"}),m.default.use(Et.a,{client_id:"***REMOVED***",issuer:"https://dev-160658.okta.com/oauth2/default",redirect_uri:window.location.origin+"/implicit/callback",scope:"openid profile email"}),m.default.use(De.a);var Ft=new De.a({mode:"history",routes:[{path:"/",component:vt},{path:"/upload",component:rt,meta:{requiresAuth:!0}},{path:"/manage",component:jt,meta:{requiresAuth:!0}},{path:"/map",component:xt},{path:"/indicators",component:vt},{path:"/implicit/callback",component:Et.a.handleCallback()},{path:"/help",component:Pt}]});Ft.beforeEach(m.default.prototype.$auth.authRedirectGuard());var Ut=Ft,Mt=r(307),Bt=r.n(Mt),Nt=(r(455),r(456),r(305)),zt=r(119),Yt={primary:Ke.a.orange.lighten1,secondary:Ke.a.grey.lighten3,tertiary:Ke.a.blue.base,error:"#b71c1c",background:"#f8f9fa",grey:Ke.a.grey.base},qt=r(306),Kt=r(36),Rt=r(457)();m.default.use(Bt.a,{options:{customProperties:!0},theme:Yt}),m.default.use(Nt.a),m.default.use(zt.a),m.default.use(qt.a),m.default.config.productionTip=!0;var Ht=y()(Kt).reduce(function(e,t){return e["_col_"+t]=Kt[t].storeByLayer?{}:[],e["_col_"+t+"_selected"]="",e},{}),Jt=new zt.a.Store({state:f()({mode:null,neighbourhoodsTest:null,selectedFeatureLayers:[],updateCount:0,indicators:[],collections:{},cityIndicators:[],neighbourhood:2412,selectedFeature:"",areaLayer:"5cf510e19bfa58b6c509903b",year:2016,language:"en",languages:["ar","en"],theme:Yt,tab:"",map:{zoom:15,center:{lat:31.827982118391024,lng:35.22958321000619},defaultCenter:{lat:31.78845754836993,lng:35.2121981978}},navigator:{zoom:11.8,center:{lat:31.8072,lng:35.02},defaultCenter:{lat:31.8072,lng:35.02},indicator:{figure:"pop_year_end",name:"Population"}},geo:{areas:[],facilities:[],educational:[],features:[],selected:null},layers:[]},Ht),actions:{UPDATE_COLLECTION:function(e,t){var a=e.state,r=e.commit,i={name:t.name||t,query:t.query||{},layer:t.layer};if(Kt[i.name].storeByLayer){if(i.layer=i.layer||a._col_layers_selected,i.layer||rej("no feature layer defined"),console.log(i.layer),a["_col_"+Kt[i.name].layerCollection].filter(function(e){return e._id===i.layer})[0].filtered){var n=a._col_areaLayers.filter(function(e){return e._id===a._col_areaLayers_selected})[0].code;i.query["feature.properties."+n]=a.neighbourhood,i.nestedKey=a.neighbourhood}}else i.name;function o(e){if("features"===i.name)r("UPDATE_FEATURES",{key:i.layer,value:e,nestedKey:i.nestedKey});else{var t="_col_"+i.name,n=t+"_selected";r("UPDATE",{key:t,value:e}),!a[n]&&e[0]&&r("UPDATE",{key:n,value:e[0]._id})}}return new d.a(function(e,a){if(t.data)return console.log("supplied data",t.data),o(t.data),e(t.data);console.log("making api request",i.name,i.query,i.layer),W.find(i.name,i.query,"",{lean:!0},i.layer).then(function(t,r){r&&(console.log("api error",r),a(r)),o(t.data),e(t.data)}).catch(function(e){e.response&&console.log("api error: "+i.name,e.response)})})},UPDATE_INDICATORS:function(e){var t=e.state,a=e.commit;W.find("indicators",{areaLayer:t.areaLayer}).then(function(e){return a("UPDATE",{key:"indicators",value:e.data})}).catch(function(e){console.log("failed to update indicators",e)})}},mutations:{GET_INDICATORS:function(e){W.find("areas",{}).then(function(t){e.geo.areas=t.data}),W.find("indicators",{}).then(function(t){if(!t.data)return console.log("cannot retrieve in"),null;var a=t.data.map(function(e){return e.dependency_youth=((e.age_0_4+e.age_5_14+e.age_15_24)/e.pop_year_end*100).toFixed(1),e.growth_total=(e.pop_growth_total/e.pop_year_end*100).toFixed(1),e.growth_natural=(e.pop_growth_natural/e.pop_year_end*100).toFixed(1),e.household_size=(e.pop_year_end/e.dwellings_total).toFixed(1),e.dwelling_density=(e.dwelling_area_avg/e.household_size).toFixed(1),e.prevyear=t.data.filter(function(t){return t.name===e.name&&t.year===e.year-1})[0],e.dwellings_new=e.prevyear?e.dwellings_total-e.prevyear.dwellings_total:null,e.dwelling_growth=(e.dwellings_new/e.dwellings_total*100).toFixed(1),e.age_distribution_labels=["age_0_4","age_5_14","age_15_24","age_25_44","age_45_64","age_65_74","age_75_"],e.age_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.pop_year_end*100}),e.dwelling_area_distribution_labels=["dwellings_area_0_40","dwellings_area_41_60","dwellings_area_61_80","dwellings_area_81_100","dwellings_area_101_140","dwellings_area_141"],e.dwelling_area_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.dwellings_total*100}),e});e.indicators=a.filter(function(e){return 9999!==e.area_code}),e.cityIndicators=a.filter(function(e){return 9999===e.area_code});var r={sum:function(e,t){return e.reduce(function(e,a){if(!a.feature.properties.mygeodat_5)return e;var r=a.feature.properties;return["total",a.feature.properties.mygeodat_5.toString()].forEach(function(a){e[a]=e[a]||{},e[a].types=e[a].types||{},t.forEach(function(t){"string"==typeof r[t]?e[a].types[r[t]]=e[a].types[r[t]]?e[a].types[r[t]]+1:1:e[a][t]=e[a][t]?e[a][t]+parseInt(r[t]):r[t]||0})}),e},{})}};W.find("features",{}).then(function(t){e.geo.facilities=t.data,e.facilities=t.data.map(function(e){return e.feature.properties}),console.log("facilities",e.facilities);var a=t.data.filter(function(e){return"Educational"===e.feature.properties.Use});e.geo.educational=a,a=r.sum(a,["Sort1","Sort2","Gender","no_student","no_females","no_classes","Type"]),e.indicators.forEach(function(t,r){2015===t.year&&t.area_code&&(e.indicators[r]=f()({},t,a[t.area_code.toString()]))}),e.cityIndicators.forEach(function(t,r){2015===t.year&&(e.cityIndicators[r]=f()({},t,a.total))}),console.log("cityindicators",e.cityIndicators)})})},UPDATE_FEATURES:function(e,t){console.log("updating feature",t.nestedKey,t.key,t.value),m.default.set(e._col_features,t.key,t.value)},UPDATE_FEATURE_PROPERTIES:function(e,t){e._col_features[t.layer].splice(t.feature._index,1,t.feature);var a=function e(t){if(Array.isArray(t)){if("number"==typeof t[0])return t;e(t[0])}else e(t.geometry.coordinates)}(t.feature.feature.geometry.coordinates);console.log("coords",a),e.map.center={lat:a[1],lng:a[0]}},UPDATE:function(e,t){if(Array.isArray(t.key))console.log("updating store nested: "+c()(t.key),t.value),m.default.set(e[t.key[0]],t.key[1],t.value);else{var a=t.value[0]&&t.value[0]._id?t.value.map(function(e){return e._id}):"";console.log("updating store value: "+t.key,t.value,a),e[t.key]=t.value}},UPDATE_AREA:function(e,t){var a=e.geo.areas.filter(function(e){return e.feature.properties.id===t})[0];console.log(a),e.neighbourhood=t,e.map.center={lon:a.feature.properties.Centroids_x,lat:a.feature.properties.Centroids_y}}},getters:{areaSelect:function(e,t){return e.indicators?t.dataByYear.concat(t.dataByCityYear):[]},neighbourhoods:function(e,t){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.name)&&e.push(t.name),e},[]):[]},years:function(e){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.year)&&t.year&&e.push(t.year),e},[]):[]},dataByYear:function(e){return e.indicators?e.indicators.filter(function(t){return t.year===e.year}):[]},dataByNeighbourhood:function(e){if(!e.indicators)return[];var t=e.indicators.filter(function(t){return t.area_code===e.neighbourhood});return t.length>0?t:e.cityIndicators},dataByHoodYear:function(e,t){return e._col_indicators.filter(function(t){return t.areaCode===e.neighbourhood&&t.year===e.year})[0]||{}},dataByCityYear:function(e){return e.cityIndicators.filter(function(t){return t.year===e.year})[0]||{}},educationalByHood:function(e){console.log("edubyhood - init",e.geo.educational);var t=e.geo.educational.reduce(function(t,a){return a.feature.properties.mygeodat_5===e.neighbourhood&&t.push(a.feature.properties),t},[]);return console.log("edubyhood",t),t},educationalGeoByHood:function(e){if(!e.geo.educational)return[];var t=e.geo.educational.filter(function(t){return t.feature.properties.mygeodat_5===e.neighbourhood});return console.log("educational geo",t),t},selectedFeature:function(e){return e._col_features[e._col_layers_selected]?e._col_features[e._col_layers_selected].filter(function(t){return t.feature.properties._id===e.selectedFeature})[0]:null},selectedAreas:function(e){return e._col_areas.filter(function(t){return t.layer===e._col_areaLayers_selected})},selectedArea:function(e,t){return t.selectedAreas.filter(function(t){return t.feature.properties.id===e.neighbourhood})[0]},areaNames:function(e,t){return t.selectedAreas?t.selectedAreas.reduce(function(e,t){return e[t.feature.properties.areaCode]=t.feature.properties.name,e},{}):null},selectedLayer:function(e){return e._col_layers?e._col_layers.filter(function(t){return t._id===e._col_layers_selected})[0]:null},selectedLayerAttributes:function(e){return e._col_layerAttributes?e._col_layerAttributes.filter(function(t){return t.layer===e._col_layers_selected}):null},selectedIndicatorBlocks:function(e){return e._col_indicatorBlocks?e._col_indicatorBlocks.filter(function(t){return t.active&&t.layer===e._col_indicatorSections_selected}):null},selectedIndicatorSection:function(e){return e._col_indicatorSections_selected?e._col_indicatorSections.filter(function(t){return t._id===e._col_indicatorSections_selected})[0]:null},allIndicatorKeyYears:function(e,t){var a=t.allIndicatorsByYear;return a?y()(a).reduce(function(e,t){var r=parseInt(t);return a[t].forEach(function(t){y()(t).forEach(function(a){e[a]=e[a]||[],t[a]&&-1===e[a].indexOf(r)&&e[a].push(r)})}),e},{}):null},allIndicatorsByYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.year?(e[t.year]=e[t.year]||[],e[t.year].push(Rt(t)),e):e},{}):null},allIndicatorsByArea:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||[],e[t.areaCode].push(Rt(t)),e):e},{}):null},allIndicatorsByAreaYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||{},e[t.areaCode][t.year]=t,e):e},{}):null},indicatorsForSelectedYear:function(e,t){if(t.allIndicatorsByYear)return t.allIndicatorsByYear[e.year]},indicatorsForSelectedArea:function(e,t){if(t.allIndicatorsByArea&&t.allIndicatorsByArea[e.neighbourhood])return t.allIndicatorsByArea[e.neighbourhood].sort(function(e,t){return e.year-t.year})},selectedIndicator:function(e,t){return a=[e.neighbourhood,e.year],r=t.allIndicatorsByAreaYear,(a="string"==typeof a?a.split("."):a)?a.reduce(function(e,t){return e&&e[t]?e[t]:null},r):r;var a,r},featuresBySelectedArea:function(e){return y()(e._col_features).reduce(function(t,a){return t[a]=e._col_features[a][e.neighbourhood],t},{})},selectedFeatures:function(e,t){var a=void 0;return"indicatorSections"===e.mode?a=t.selectedIndicatorSection?t.selectedIndicatorSection.geodata:null:"layers"===e.mode&&(a=[e._col_layers_selected]),a&&a[0]?a.map(function(t){var a=e._col_features[t];return a?a.map(function(e){return e.feature}):[e._col_features,t,e._col_features[t],y()(e._col_features),s()(e._col_features)]}):null},collectionSchema:function(e){return function(t,a){var r=f()({},Kt[t]);if("string"==typeof r.schema){var i=e["_col_"+r.schema].filter(function(t){return t.layer===e["_col_"+a+"_selected"]});r.schema=n()(i).reduce(function(e,t){return t._text=t._text||t.name,e[t.name]=t,e},{})}return console.log("collectionSchema",r,e["_col_"+a+"_selected"]),r||{}}},getSelected:function(e){return function(t){var a=e["_col_"+t+"_selected"];return e["_col_"+t].filter(function(e){return e._id===a})[0]||{}}}}});new m.default({router:Ut,store:Jt,render:function(e){return e(Te)}}).$mount("#app")},69:function(e,t,a){},70:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){},75:function(e,t,a){},76:function(e,t,a){}});