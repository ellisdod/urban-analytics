!function(e){function t(t){for(var r,n,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)n=s[d],i[n]&&p.push(i[n][0]),i[n]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);p.length;)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,s=1;s<a.length;s++){var l=a[s];0!==i[l]&&(r=!1)}r&&(o.splice(t--,1),e=n(n.s=a[0]))}return e}var r={},i={0:0},o=[];function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;o.push([460,1]),a()}({305:function(e,t){var a=function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t};t.sortNumbers=function(e,t){if(!e||!t)return null;var r=(e=e.map(function(e){return a(t,e)})).sort(function(e,t){var a=parseInt(e),r=parseInt(t);return a>r?1:a<r?-1:0}),i={min:r[0]};console.log("sorted",r);for(var o=r.length-1;o>=0;o--){var n=r[o];if("number"==typeof n){i.max=n;break}}return i.constant=i.max-i.min,i},t.getNested=a},332:function(e,t,a){e.exports=a.p+"static/img/undp-logo.92bc5f1.svg"},375:function(e,t){e.exports=[{params:"/:query",name:"find",method:"get"},{params:"/:key",name:"distinct",method:"get"},{params:"",name:"create",auth:!0,method:"post",middleware:"formidable"},{params:"/:id",name:"del",auth:!0,method:"post"},{params:"/:params",name:"update",auth:!0,method:"post"},{params:"",name:"update",auth:!0,method:"post"},{params:"/:areaLayerId",name:"updateAnalysis",auth:!0,method:"post",restrict:["features"]},{params:"",name:"updateMany",auth:!0,method:"post",middleware:"formidable"},{params:"",name:"deleteMany",auth:!0,method:"post",middleware:""}]},381:function(e,t,a){"use strict";var r=a(70);a.n(r).a},382:function(e,t,a){"use strict";var r=a(71);a.n(r).a},383:function(e,t,a){"use strict";var r=a(72);a.n(r).a},385:function(e,t,a){var r={"./af":147,"./af.js":147,"./ar":148,"./ar-dz":149,"./ar-dz.js":149,"./ar-kw":150,"./ar-kw.js":150,"./ar-ly":151,"./ar-ly.js":151,"./ar-ma":152,"./ar-ma.js":152,"./ar-sa":153,"./ar-sa.js":153,"./ar-tn":154,"./ar-tn.js":154,"./ar.js":148,"./az":155,"./az.js":155,"./be":156,"./be.js":156,"./bg":157,"./bg.js":157,"./bm":158,"./bm.js":158,"./bn":159,"./bn.js":159,"./bo":160,"./bo.js":160,"./br":161,"./br.js":161,"./bs":162,"./bs.js":162,"./ca":163,"./ca.js":163,"./cs":164,"./cs.js":164,"./cv":165,"./cv.js":165,"./cy":166,"./cy.js":166,"./da":167,"./da.js":167,"./de":168,"./de-at":169,"./de-at.js":169,"./de-ch":170,"./de-ch.js":170,"./de.js":168,"./dv":171,"./dv.js":171,"./el":172,"./el.js":172,"./en-SG":173,"./en-SG.js":173,"./en-au":174,"./en-au.js":174,"./en-ca":175,"./en-ca.js":175,"./en-gb":176,"./en-gb.js":176,"./en-ie":177,"./en-ie.js":177,"./en-il":178,"./en-il.js":178,"./en-nz":179,"./en-nz.js":179,"./eo":180,"./eo.js":180,"./es":181,"./es-do":182,"./es-do.js":182,"./es-us":183,"./es-us.js":183,"./es.js":181,"./et":184,"./et.js":184,"./eu":185,"./eu.js":185,"./fa":186,"./fa.js":186,"./fi":187,"./fi.js":187,"./fo":188,"./fo.js":188,"./fr":189,"./fr-ca":190,"./fr-ca.js":190,"./fr-ch":191,"./fr-ch.js":191,"./fr.js":189,"./fy":192,"./fy.js":192,"./ga":193,"./ga.js":193,"./gd":194,"./gd.js":194,"./gl":195,"./gl.js":195,"./gom-latn":196,"./gom-latn.js":196,"./gu":197,"./gu.js":197,"./he":198,"./he.js":198,"./hi":199,"./hi.js":199,"./hr":200,"./hr.js":200,"./hu":201,"./hu.js":201,"./hy-am":202,"./hy-am.js":202,"./id":203,"./id.js":203,"./is":204,"./is.js":204,"./it":205,"./it-ch":206,"./it-ch.js":206,"./it.js":205,"./ja":207,"./ja.js":207,"./jv":208,"./jv.js":208,"./ka":209,"./ka.js":209,"./kk":210,"./kk.js":210,"./km":211,"./km.js":211,"./kn":212,"./kn.js":212,"./ko":213,"./ko.js":213,"./ku":214,"./ku.js":214,"./ky":215,"./ky.js":215,"./lb":216,"./lb.js":216,"./lo":217,"./lo.js":217,"./lt":218,"./lt.js":218,"./lv":219,"./lv.js":219,"./me":220,"./me.js":220,"./mi":221,"./mi.js":221,"./mk":222,"./mk.js":222,"./ml":223,"./ml.js":223,"./mn":224,"./mn.js":224,"./mr":225,"./mr.js":225,"./ms":226,"./ms-my":227,"./ms-my.js":227,"./ms.js":226,"./mt":228,"./mt.js":228,"./my":229,"./my.js":229,"./nb":230,"./nb.js":230,"./ne":231,"./ne.js":231,"./nl":232,"./nl-be":233,"./nl-be.js":233,"./nl.js":232,"./nn":234,"./nn.js":234,"./pa-in":235,"./pa-in.js":235,"./pl":236,"./pl.js":236,"./pt":237,"./pt-br":238,"./pt-br.js":238,"./pt.js":237,"./ro":239,"./ro.js":239,"./ru":240,"./ru.js":240,"./sd":241,"./sd.js":241,"./se":242,"./se.js":242,"./si":243,"./si.js":243,"./sk":244,"./sk.js":244,"./sl":245,"./sl.js":245,"./sq":246,"./sq.js":246,"./sr":247,"./sr-cyrl":248,"./sr-cyrl.js":248,"./sr.js":247,"./ss":249,"./ss.js":249,"./sv":250,"./sv.js":250,"./sw":251,"./sw.js":251,"./ta":252,"./ta.js":252,"./te":253,"./te.js":253,"./tet":254,"./tet.js":254,"./tg":255,"./tg.js":255,"./th":256,"./th.js":256,"./tl-ph":257,"./tl-ph.js":257,"./tlh":258,"./tlh.js":258,"./tr":259,"./tr.js":259,"./tzl":260,"./tzl.js":260,"./tzm":261,"./tzm-latn":262,"./tzm-latn.js":262,"./tzm.js":261,"./ug-cn":263,"./ug-cn.js":263,"./uk":264,"./uk.js":264,"./ur":265,"./ur.js":265,"./uz":266,"./uz-latn":267,"./uz-latn.js":267,"./uz.js":266,"./vi":268,"./vi.js":268,"./x-pseudo":269,"./x-pseudo.js":269,"./yo":270,"./yo.js":270,"./zh-cn":271,"./zh-cn.js":271,"./zh-hk":272,"./zh-hk.js":272,"./zh-tw":273,"./zh-tw.js":273};function i(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=385},386:function(e,t,a){"use strict";var r=a(73);a.n(r).a},451:function(e,t,a){"use strict";var r=a(74);a.n(r).a},452:function(e,t,a){"use strict";var r=a(75);a.n(r).a},453:function(e,t,a){"use strict";var r=a(76);a.n(r).a},454:function(e,t,a){"use strict";var r=a(77);a.n(r).a},455:function(e,t,a){"use strict";var r=a(78);a.n(r).a},460:function(e,t,a){"use strict";a.r(t);var r=a(28),i=a.n(r),o=a(5),n=a.n(o),s=a(29),l=a.n(s),c=a(13),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",{attrs:{id:"keep",app:""}},[r("v-toolbar",{staticClass:"ejmap-border-bottom",attrs:{app:"",light:"","clipped-left":"",flat:"",color:"#fff"}},[r("v-toolbar-side-icon",{on:{click:function(t){t.stopPropagation(),e.miniNav=!e.miniNav}}}),e._v(" "),r("v-toolbar-title",[r("div",{staticStyle:{"margin-bottom":"-5px"}},[e._v("Urban Analytics")]),e._v(" "),r("div",{staticClass:"grey--text",staticStyle:{"font-size":"0.6em"}},[e._v("East Jerusalem")])]),e._v(" "),r("v-spacer"),e._v(" "),e._l(e.items,function(t,a){return r("v-tooltip",{key:a,attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(a){var i=a.on;return[r("v-btn",e._g({attrs:{to:t.route,icon:""}},i),[r("v-icon",{attrs:{color:"grey darken-2"}},[e._v(e._s(t.icon))])],1)]}}],null,!0)},[e._v(" "),r("span",[e._v(e._s(t.text))])])}),e._v(" "),r("v-menu",{attrs:{"min-width":"300","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[r("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[r("v-list-tile",[r("v-list-tile-content",[e.activeUser?r("v-list-tile-title",{staticClass:"grey--text body-1"},[e._v("\n                "+e._s(e.activeUser.email)+"\n              ")]):r("v-list-tile-title",{staticClass:"grey--text"},[e._v("\n                Login\n              ")])],1),e._v(" "),r("v-list-tile-action",[r("v-btn",e._g({attrs:{icon:""}},Object.assign({},a,i)),[r("v-icon",{attrs:{color:"grey darken-2"}},[e._v("person")])],1)],1)],1)]}}],null,!0)},[e._v(" "),r("span",[e._v("Account")])])]}}])},[e._v(" "),r("v-card",[r("v-list",[e.activeUser?r("v-list-tile",{attrs:{avatar:""}},[r("v-list-tile-content",[r("v-list-tile-title",[e._v(e._s(e.activeUser.name))]),e._v(" "),r("v-list-tile-sub-title",[e._v("IPCC")])],1)],1):e._e()],1),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),e.activeUser?r("v-btn",{attrs:{color:"primary",flat:""},on:{click:e.logout}},[e._v("Logout")]):r("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return t.preventDefault(),e.login(t)}}},[e._v("Login")])],1)],1)],1)],2),e._v(" "),e.loading?r("v-container",[r("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[r("div",{staticClass:"text-xs-center"},[r("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),r("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)])],1):r("v-content",[r("router-view",{staticStyle:{height:"100%"}})],1),e._v(" "),r("div",{staticClass:"pa-3",staticStyle:{position:"absolute",bottom:"20px",left:"20px"}},[r("img",{staticStyle:{position:"absolute",bottom:"20px"},attrs:{src:a(332),width:"46px;"}})])],1)};u._withStripped=!0;var d=a(23),p=a.n(d),f=a(46),v=a.n(f),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{height:"400px"}},[a("l-map",{ref:"myMap",staticClass:"main-map",attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"map_"+e.featuresCollection},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["detailed"===e.baseMap?a("l-protobuf",{attrs:{url:"https://maps.tilehosting.com/data/v3/{z}/{x}/{y}.pbf?key=ArAI1SXQTYA6P3mWFnDs",options:e.protobufOpts}}):e._e(),e._v(" "),"basic"===e.baseMap?a("l-tile-layer",{attrs:{url:"https://cartodb-basemaps-b.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png",options:e.protobufOpts}}):e._e(),e._v(" "),e.areas?a("l-geo-json",{attrs:{geojson:e.areasGeoJson,"options-style":e.areaStyle,options:e.getGeoJsonOptions()}}):e._e(),e._v(" "),e._l(e.featuresListParsed,function(t,r){return e.featureLayers?a("l-geo-json",{key:r,attrs:{geojson:t,options:e.getGeoJsonOptions(r),"options-style":e.geoJsonStyle(r)}}):e._e()})],2),e._v(" "),a("div",{staticClass:"map-menu"},[a("v-menu",{attrs:{"min-width":"300px",flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}])},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{attrs:{dense:""}},[a("div",{staticClass:"px-4"},[a("div",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return[a("v-switch",{key:r,attrs:{color:"primary",label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})]}),e._v(" "),a("v-switch",{attrs:{color:"primary",label:"Legend"},model:{value:e.showLegend,callback:function(t){e.showLegend=t},expression:"showLegend"}})],2)])],1)],1),e._v(" "),e.showLegend&&e.legends?a("div",{staticStyle:{"max-height":"400px","overflow-y":"auto","overflow-x":"visible!important"},attrs:{id:"map-legend"}},e._l(e.legends,function(t,r){return a("div",{key:r},[a("div",{staticClass:"body-1 mt-2"},[e._v(e._s(e.featuresOpts[r].text))]),e._v(" "),a("v-select",{staticClass:"caption",staticStyle:{width:"100px","margin-top":"-15px"},attrs:{color:"grey",items:Object.keys(e.featuresAttrs[r])},model:{value:e.displayKey[r],callback:function(t){e.$set(e.displayKey,r,t)},expression:"displayKey[i]"}}),e._v(" "),t&&t.type===Number?a("table",[a("tr",[a("td",{staticClass:"key-gradient",style:{backgroundImage:"linear-gradient("+t.chroma(0)+","+t.chroma(1)+")"}}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n            "+e._s(t.items.max)+"\n          ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n            "+e._s(t.items.min)+"\n          ")])])])]):t?a("table",e._l(t.items,function(t,r){return a("tr",[a("td",{staticClass:"key-icon",style:{color:t}},[e._v("‚óè")]),e._v(" "),a("td",{staticClass:"key-figures"},[a("span",{staticClass:"grey--text text--darken-2",staticStyle:{"background-color":"#fff",padding:"1px 5px"}},[e._v(e._s(r))])])])}),0):e._e()],1)}),0):e._e()],1)])};h._withStripped=!0;var m=a(22),y=a.n(m),_=a(58),g=a.n(_),b=a(9),x=a.n(b),w=a(461),k=a(462),C=a(463),S=a(464),A=a(465),$=a(466),j=a(467),O=function(){var e=this.$createElement;return(this._self._c||e)("div")};O._withStripped=!0;var D=a(1),E=a.n(D);a(353);if(void 0===E.a)throw new Error("leaflet library must be installed in order to use vue2-leaflet-vectorgrid.");if(void 0===E.a.vectorGrid)throw new Error("leaflet.vectorgrid library must be installed in order to use vue2-leaflet-vectorgrid.");var F={props:{url:{type:String,required:!0},options:{type:Object,default:function(){return{}}}},watch:{url:function(){this.updateLayer()},options:function(){this.updateLayer()}},mounted:function(){this.mapObject=E.a.vectorGrid.protobuf(this.url,this.options),this.$parent._isMounted&&this.deferredMountedTo(this.$parent.mapObject)},beforeDestroy:function(){this.removeLayer()},methods:{deferredMountedTo:function(e){this.mapObject.addTo(e),this.attributionControl=e.attributionControl;for(var t=0;t<this.$children.length;t++)"function"==typeof this.$children[t].deferredMountedTo&&this.$children[t].deferredMountedTo(this.mapObject)},setAttribution:function(e,t){this.attributionControl.removeAttribution(t),this.attributionControl.addAttribution(e)},setToken:function(e){this.options.token=e},removeLayer:function(){this.$parent.mapObject.removeLayer(this.mapObject)},updateLayer:function(){this.removeLayer(),this.mapObject=E.a.vectorGrid.protobuf(this.url,this.options),this.deferredMountedTo(this.$parent.mapObject)}}},T=a(2),P=Object(T.a)(F,O,[],!1,null,null,null);P.options.__file="public/Vue2LeafletVectorGridProtobuf.vue";var I=P.exports,U=a(118),M=a.n(U),N=(M()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.4},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.4},landcover:{fill:!0,weight:1,fillColor:"#53e033",color:"#53e033",fillOpacity:.1,opacity:.4},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.2,opacity:.4},park:{fill:!0,weight:1,fillColor:"#84ea5b",color:"#84ea5b",fillOpacity:.2,opacity:.4},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.2,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.2,opacity:.8}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.8}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[]),M()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.2},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.2},landcover:{fill:!0,weight:1,fillColor:"#fafafa",color:"#fafafa",fillOpacity:.1,opacity:.2},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.1,opacity:.2},park:{fill:!0,weight:1,fillColor:"#f3f3f3",color:"#f3f3f3",fillOpacity:.1,opacity:.2},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.1,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.1,opacity:.4}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.1,opacity:.4}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[])),B=a(21),z=a.n(B),Y=a(375);a(376);var q,K="http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,J=z.a.create({baseURL:K,json:!0}),H=(q=v()(p.a.mark(function e(t,a,r,i){var o;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},r=r||{},e.next=4,c.default.prototype.$auth.getAccessToken();case 4:return o=e.sent,e.abrupt("return",J({method:t,url:a,data:r,headers:n()({Authorization:"Bearer "+o},i)}));case 6:case"end":return e.stop()}},e,this)})),function(e,t,a,r){return q.apply(this,arguments)});function G(e){return e=(e="object"===(void 0===e?"undefined":y()(e))&&e?i()(e):e)?"/"+e:""}var V=Y.reduce(function(e,t){return e[t.name]=function(e,a,r,i,o){return a=G(a),o=G(o),console.log(t.method,""+e+o+"/"+t.name+a,r,i),H(t.method,""+e+o+"/"+t.name+a,r,i)},e},{}),R=a(38),Z=a.n(R),Q=a(305),W=a.n(Q),X=a(47),ee={name:"MapView",props:["featureLayers","featuresCollection","zoomLevel","options","areas"],components:{LMap:w.a,LTileLayer:k.a,LMarker:C.a,LPopup:S.a,LTooltip:A.a,LProtobuf:I,LPolygon:$.a,LGeoJson:j.a},$_veeValidate:{validator:"new"},data:function(){var e=this;return{showLegend:!0,language:"ar",languages:["ar","en"],basemaps:{url:"https://{s}.basemaps.cartocdn.com/{z}/{x}/{y}.png",url2:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",url3:"http://a.tile.openstreetmap.fr/hot/${z}/${x}/${y}.png "},center:E.a.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:E.a.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5},geoJsonOptions:{onEachFeature:function(e,t){var a=x()(e.properties).reduce(function(t,a){return t+"<li>"+a+": "+e.properties[a]+"</li>"},"<ul>")+"</ul>";t.bindPopup(a),t.on({click:function(e){console.log(e.target)},mouseover:function(e){}})}},geoJsonAreaOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;console.log(e.target),r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),r.$store.commit("UPDATE",{key:"selectedFeature",value:e.target.feature.properties._id}),console.log("changed",this.$store.state.neighbourhood),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.Centroids_x,lat:t.Centroids_y}})}})}},geoJsonPolygonStyle:function(e){var t=e._selected?"black":"white";return{weight:1,color:t,opacity:.9,fillColor:t,fillOpacity:.6}},layers:{areas:!0},filtered:!1,displayKey:{0:"",1:"",2:""},survey:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!0},{text:"Detailed",type:"detailed",selected:!1}],baseMap:"basic",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}}}},computed:{items:function(){return this.$auth.isAuthenticated(),[]},areaStyle:function(){return this.featureLayers?{weight:1,color:"#ccc",opacity:1,fillOpacity:0}:{}},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return g()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:N,maxNativeZoom:18,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},surveyQuestions:function(){return this.translate(X,"label",this.language)},scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return t[e.$store.state.map.indicator.figure]}).sort(function(e,t){return e-t});return{min:t[0],max:t[t.length-1]-t[0]}},zoom:function(){return parseInt(this.zoomLevel)||this.$store.state.map.zoom||14},featuresListParsed:function(){return this.featuresList&&this.featuresList[0]?(console.log("MapView featuresList",this.featuresList,this.options),this.log(),this.featuresList.reduce(function(e,t){return e.push(t.reduce(function(e,t){return t.feature&&e.push(t.feature),e},[])),e},[])):null},areasGeoJson:function(){var e=this.$store.state._col_areas;return e?e.reduce(function(e,t){return t.feature.properties._id=t._id,e.push(t.feature),e},[]):null},featuresList:function(){var e=this;return this.featureLayers?(this.log("featureslist"),this.featureLayers.map(function(t){var a=e.$store.state._col_features[t];return a?Array.isArray(a)?(e.filtered=!1,a):(e.filtered=!0,a[e.$store.state.neighbourhood]):null})):null},featuresOpts:function(){var e=this;return this.featureLayers?this.featureLayers.map(function(t){var a=e.$store.state._col_layers.filter(function(e){return e._id===t})[0];return a?{type:a.data_type,text:a.text_en}:null}):null},featuresAttrs:function(){var e=this;if(!this.featureLayers)return null;console.log("featureAttrs - featurelayers",this.featureLayers);var t=this.featureLayers.reduce(function(t,a,r){return t.push(e.$store.state._col_layerAttributes.reduce(function(e,t,r){return t.layer===a&&0!==t.func.length&&(e[t.name]=t),e},{})),t},[]);return console.log("attrs",t),t},legends:function(){var e=this;if(!this.featuresAttrs||!this.featuresList[0]||!this.displayKey[0])return null;var t=this.featuresAttrs.map(function(t,a){var r=e.displayKey[a],i={items:{}};if(!t[r])return null;if("Number"===t[r].type)i.items=W.a.sortNumbers(e.featuresList[a],"feature.properties."+r),i.type=Number,i.chroma=Z.a.scale(["#ff236c","#2377ff"]);else if("String"===t[r].type){var o=e.featuresList[a].reduce(function(e,t){var a=t.feature.properties[r];return-1===e.indexOf(a)&&e.push(a),e},[]);o=(o=o.filter(function(e){return null!==e})).sort();var n=["#ff236c","#2377ff","#f4f141","#42f4b9","#f46441"];o.length>n.length&&(n=Z.a.scale(n).mode("lch").colors(o.length)),i.items=o.reduce(function(e,t,a){return e[t]=n[a],e},{}),i.items.null="#999",i.type=String}else"Boolean"===t[r].type&&(i.items={true:"red",false:"blue"},i.type=Boolean);return e.log(),i});return this.log(),t[0]&&t[0].items?t:null},legendsOrdered:function(){return this.legends.map(function(e){return x.a.sort()})}},methods:{resetDisplayKey:function(){if(!this.featuresAttrs)return null;var e=this.featuresAttrs.reduce(function(e,t,a){return e[a]=x()(t)[0],e},{});return this.displayKey=e,this.displayKey},getGeoJsonOptions:function(e){if("areas"===this.featuresCollection)return this.geoJsonAreaOptions;if(!this.featuresOpts||!this.featuresOpts[e])return{};var t=this.featuresOpts[e].type;return"Point"===t?this.geoJsonPointOptions(e):"MultiPolygon"===t?this.geoJsonAreaOptions:void 0},geoJsonPointOptions:function(e){var t=this;return t.legends?{pointToLayer:function(a,r){var i=t.legends?t.legends[e]:null,o=void 0===e?null:t.displayKey[e],n=t.getLegendStyle(a,o,i);return E.a.circleMarker(r,n)},onEachFeature:function(e,a){var r=e.properties;a.bindPopup("<p>"+r.type+"</p><p>"+r.students+"</p>"),a.on({click:function(e){t.$store.commit("UPDATE",{key:"selectedFeature",value:e.target.feature.properties._id}),console.log(e)},mouseover:function(e){e.target.openPopup()},mouseout:function(e){e.target.closePopup()}})}}:null},geoJsonStyle:function(e){var t={weight:2,opacity:1,fillOpacity:.7,stroke:!1},a=this,r=a.legends?a.legends[e]:null,i=void 0===e?null:a.displayKey[e];return function(e){return"Point"===e.geometry.type?null:a.getLegendStyle(e,i,r,t)}},getLegendStyle:function(e,t,a,r){r=n()({radius:4,fillColor:"blue",weight:0,opacity:1,fillOpacity:.5},r);var i=e.properties[t];return this.showLegend&&a?(this.showLegend&&a.type===Number?r.fillColor=a.chroma((i-a.items.min)/a.items.constant).hex():this.showLegend&&(r.fillColor=a.items[i]),r):r},getAreaStyle:function(e){return this.$store.state.neighbourhood===e?{weight:2,color:"black",opacity:.6,fillColor:"#fff",fillOpacity:0}:{opacity:0,fillOpacity:0}},updateMap:function(){},updateBaseMap:function(e,t){console.log(e,t),this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return E.a.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;V.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;V.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){var e=document.getElementsByClassName("v-toolbar__extension")[0].style;console.log(e),e.overflow="auto"},500)},translate:function(e,t,a){return function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":y()(i)))return i[a]=i[a+"_"+r],x()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(e,t,a)},log:function(e){}},watch:{featuresAttrs:function(){this.resetDisplayKey()}},mounted:function(){var e=this;window.screen.width<800&&this.updateBaseMap("basic",!0),this.editFeature=X.reduce(function(e,t){return e[t.name]="",e},{}),this.editFeatureDefaults=n()({},this.editFeature),this.resetDisplayKey();var t=this;setTimeout(function(){console.log("mounting map"),t.log(),t.$refs.myMap&&t.$refs.myMap.mapObject.invalidateSize()},1e3),this.$store.watch(function(e,t){return e.neighbourhood},function(t,a){e.filtered&&e.$store.dispatch("UPDATE_COLLECTION",{layer:e.featureLayers[0],name:"features"}).then(function(){e.$refs.myMap.mapObject.invalidateSize()})})}},te=(a(381),Object(T.a)(ee,h,[],!1,null,null,null));te.options.__file="src/components/MapView.vue";var ae=te.exports,re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("table",{attrs:{id:"navigator-key"}},[a("tr",{attrs:{id:"navigator-header"}},[a("td",{staticClass:"subheading grey--text text--darken-2",attrs:{colspan:"2"}},[e._v("\n          "+e._s(e.$store.state.navigator.indicator.name)+" - "+e._s(e.$store.state.year)+"\n          "),a("div",{staticClass:"caption py-1"},[e._v("\n          "+e._s(e.details.neighbourhood)+"\n          "),a("div",[e._v("\n          "+e._s(e.details.value)+"\n        ")])])])]),e._v(" "),a("tr"),e._v(" "),a("tr",[a("td",{staticClass:"key-gradient"}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n            "+e._s(e.scale.max.toFixed(0))+"\n          ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n            "+e._s(e.scale.min.toFixed(0))+"\n          ")])])])]),e._v(" "),a("l-map",{attrs:{zoom:e.$store.state.navigator.zoom,center:e.$store.state.navigator.center,options:e.mapOptions,id:"navigation-map"}},e._l(e.$store.state._col_areas.filter(function(e){return e.feature}),function(t,r){return a("l-geo-json",{key:t._id,attrs:{geojson:t.feature,options:e.areasGeoJsonOptions,"options-style":e.getAreaStyle(t.feature.properties.id)}})}),1)],1)};re._withStripped=!0;var ie={name:"MapView",components:{LMap:w.a,LTileLayer:k.a,LMarker:C.a,LPopup:S.a,LTooltip:A.a,LPolygon:$.a,LGeoJson:j.a},data:function(){var e=this;return{zoom:14,center:L.latLng(31.801141899926307,35.18584083885216),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',showParagraph:!1,details:{neighbourhood:"",value:"",key:""},detailsDefault:{neighbourhood:"",value:"",key:""},mapOptions:{zoomSnap:.5},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.Centroids_x,lat:t.Centroids_y}})},mouseover:function(e){var t=r.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e.target.feature.properties.id})[0];r.details={neighbourhood:t.name,value:t[r.$store.state.navigator.indicator.figure],key:""}},mouseout:function(e){r.details=r.detailsDefault}})}},layers:{areas:!0}}},computed:{scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return parseInt(t[e.$store.state.navigator.indicator.figure])}).sort(function(e,t){return e-t});return console.log("scale sorted",this.$store.state.navigator.indicator.figure,t),{min:t[0]||0,constant:t[t.length-1]-t[0]||0,max:t[t.length-1]||0}}},methods:{getAreaStyle:function(e){var t=Z.a.scale(["white","orange"]),a=this.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=t((a[this.$store.state.navigator.indicator.figure]-this.scale.min)/this.scale.constant),i=this.$store.state.neighbourhood===e?this.$vuetify.theme.tertiary:"#eee";return{weight:(this.$store.state.neighbourhood,1),color:i,opacity:1,fillColor:r,fillOpacity:1}},selectArea:function(e){},mouseoverArea:function(e){}},mounted:function(){}},oe=(a(382),Object(T.a)(ie,re,[],!1,null,null,null));oe.options.__file="src/components/MapNavigator.vue";var ne=oe.exports,se=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.desserts},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.name))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.calories))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.fat))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.carbs))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.iron))])]}}])})};se._withStripped=!0;var le={data:function(){return{headers:[{text:"Dessert (100g serving)",align:"left",sortable:!1,value:"name"},{text:"Calories",value:"calories"},{text:"Fat (g)",value:"fat"},{text:"Carbs (g)",value:"carbs"},{text:"Protein (g)",value:"protein"},{text:"Iron (%)",value:"iron"}],desserts:[{name:"Frozen Yogurt",calories:159,fat:6,carbs:24,protein:4,iron:"1%"},{name:"Ice cream sandwich",calories:237,fat:9,carbs:37,protein:4.3,iron:"1%"},{name:"Eclair",calories:262,fat:16,carbs:23,protein:6,iron:"7%"},{name:"Cupcake",calories:305,fat:3.7,carbs:67,protein:4.3,iron:"8%"},{name:"Gingerbread",calories:356,fat:16,carbs:49,protein:3.9,iron:"16%"},{name:"Jelly bean",calories:375,fat:0,carbs:94,protein:0,iron:"0%"},{name:"Lollipop",calories:392,fat:.2,carbs:98,protein:0,iron:"2%"},{name:"Honeycomb",calories:408,fat:3.2,carbs:87,protein:6.5,iron:"45%"},{name:"Donut",calories:452,fat:25,carbs:51,protein:4.9,iron:"22%"},{name:"KitKat",calories:518,fat:26,carbs:65,protein:7,iron:"6%"}]}}},ce=Object(T.a)(le,se,[],!1,null,null,null);ce.options.__file="src/components/Viewer.vue";var ue={name:"App",components:{MapView:ae,Viewer:ce.exports},data:function(){return{loading:!0,miniNav:!0,activeUser:null,authenticated:!1,drawerIndicators:!1,layersPanel:!0,currentView:"map-view",layers:[],indicators:[{heading:"Demographics",icon:"keyboard_arrow_up","icon-alt":"keyboard_arrow_down",text:"More",model:!1,children:[{name:"Persons",value:29e4},{name:"Median Age",value:25.4},{name:"Growth - natural (2018)",value:"3.5%"},{name:"Growth - migration (2018)",value:"4.5%"},{name:"Gender m/f",value:"49/50"}]},{heading:"Housing",icon:"keyboard_arrow_up","icon-alt":"keyboard_arrow_down",text:"More",model:!1,children:[{name:"Housing Units",value:36700},{name:"Avg. Persons per Household",value:5.2},{name:"Avg. Rooms per Household",value:3.5},{name:"Avg. Area of Household",value:"70m2"}]},{heading:"Services",icon:"keyboard_arrow_up","icon-alt":"keyboard_arrow_down",text:"More",model:!1,children:[{name:"Secondary Schools",value:3},{name:"Primary Schools",value:2},{name:"Kindergartens",value:5}]}]}},computed:{items:function(){var e=[{icon:"help",text:"About",route:"help"},{icon:"cloud_download",text:"Export Data"},{icon:"bar_chart",text:"Urban Indicators",route:"indicators"}];return this.activeUser?e.concat([{icon:"settings",text:"Manage Data",route:"manage"}]):e}},props:{source:String},created:function(){var e=this;return v()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshActiveUser();case 2:case"end":return t.stop()}},t,e)}))()},watch:{$route:"refreshActiveUser"},methods:{login:function(){this.$auth.loginRedirect()},refreshActiveUser:function(){var e=this;return v()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.getUser();case 2:e.activeUser=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},logout:function(){var e=this;return v()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.logout();case 2:return t.next=4,e.refreshActiveUser();case 4:e.$router.push("/");case 5:case"end":return t.stop()}},t,e)}))()},printUser:function(){console.log("USER"),console.log(this.activeUser),console.log(this.$auth)}},mounted:function(){var e=this;this.$store.dispatch("UPDATE_COLLECTION","layers").then(function(t){var a=[e.$store.dispatch("UPDATE_COLLECTION","indicators"),e.$store.dispatch("UPDATE_COLLECTION","indicatorSections"),e.$store.dispatch("UPDATE_COLLECTION","indicatorBlocks"),e.$store.dispatch("UPDATE_COLLECTION","layerCalcs"),e.$store.dispatch("UPDATE_COLLECTION","layerAttributes"),e.$store.dispatch("UPDATE_COLLECTION","areas"),e.$store.dispatch("UPDATE_COLLECTION","areaAttributes"),e.$store.dispatch("UPDATE_COLLECTION","areaLayers")];return l.a.all(a)}).then(function(){console.log("LOADING COMPLETE"),e.loading=!1})}},de=(a(383),Object(T.a)(ue,u,[],!1,null,null,null));de.options.__file="src/App.vue";var pe=de.exports,fe=a(120),ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{attrs:{sm7:"",xs12:""}},[a("v-container",{attrs:{fluid:"","grid-list-xl":"","pa-0":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",featureLayers:e.featureLayers,featuresCollection:"features",zoomLevel:"12",areas:!0}})],1),e._v(" "),e._l(e.items,function(t,r){return a("v-flex",{key:t._id,attrs:{sm6:"",xs12:""},on:{click:function(t){return e.updateSelected(r)}}},[t.datatable?a("div",{staticClass:"py-3"},[a("v-divider"),e._v(" "),a("div",{staticClass:"title py-3"},[e._v(e._s(t.name))]),e._v(" "),a("v-data-table",{attrs:{items:t.data,headers:t.headers,"rows-per-page-items":[-1]},scopedSlots:e._u([{key:"items",fn:function(r){return e._l(t.headers,function(t){return a("td",[e._v(e._s(r.item[t.value]))])})}}],null,!0)})],1):"Figure"===t.type||"List"===t.type||"Chart"===t.type?a("indicator-key-stat",{attrs:{selected:e.selected===r,name:t.text,figure:t.figure,description:t.description,unit:t.unit,year:t.year,type:t.type}}):e._e()],1)})],2)],1)],1),e._v(" "),a("v-flex",{attrs:{sm2:"",xs12:""}},[e.$store.getters.indicatorsForSelectedYear?a("map-navigator",{attrs:{id:"map-panel-navigator"}}):e._e(),e._v(" "),a("div",{attrs:{id:"info-panel"}})],1)],1)],1)],1)};ve._withStripped=!0;var he={props:{title:String,"x-labels":Boolean,"y-labels":Boolean,clickHandler:Boolean},data:function(){var e=this;return{options:{axes:{display:!1},scales:{yAxes:[{display:e.$props.yLabels,gridLines:{display:!1},scaleLabel:{display:e.$props.yLabels},ticks:{display:e.$props.yLabels}}],xAxes:[{display:e.$props.xLabels,gridLines:{display:!1},scaleLabel:{display:e.$props.xLabels},ticks:{display:e.$props.xLabels}}]},legend:{display:!1},title:{display:!0,text:e.$props.title||""},maintainAspectRatio:!1,onClick:function(t,a){if(e.$props.clickHandler){var r=e.$store.getters.dataByYear.filter(function(e){return e.name===a[0]._model.label})[0].area_code;e.$store.commit("UPDATE_AREA",r)}}}}}},me=a(48),ye=me.c.reactiveProp,_e={extends:me.b,mixins:[he,ye],mounted:function(){this.renderChart(this.chartData,this.options)}},ge=me.c.reactiveProp,be={extends:me.a,mixins:[ge,he],mounted:function(){this.renderChart(this.chartData,this.options)}},xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"indicator-hover",attrs:{flat:!e.selected}},["List"===e.type&&e.selectedIndicator?a("div",[a("v-list",e._l(e.selectedIndicator[e.figure[0]],function(t,r){return a("v-list-item",[a("v-list-tile-action",[e._v("\n            "+e._s(r)+"\n          ")]),e._v(" "),a("v-list-tile-content",[e._v("\n            "+e._s(t)+"\n          ")])],1)}),1)],1):e.selectedIndicator?a("div",{staticClass:"pa-2",staticStyle:{position:"relative"},on:{click:function(t){return e.updateIndicator()}}},[a("div",{staticClass:"subheading font-weight-light",staticStyle:{width:"40%"}},[e._v(e._s(e.name))]),e._v(" "),"Figure"===e.type?a("div",{staticStyle:{"overflow-x":"visible",display:"inline-block","white-space":"nowrap"}},[a("span",{staticClass:"display-1 py-0"},[e._v(e._s(e.selectedIndicator[e.figure[0]]))]),e._v(" "),e.unit?a("span",{staticClass:"subheading ml-1"},[e._v(e._s(e.unit))]):e._e(),e._v(" "),a("div",{staticClass:"font-weight-light"},[e._v(e._s(e.year))])]):e._e(),e._v(" "),a("div",{staticClass:"caption"},[e._v(e._s(e.description))]),e._v(" "),e.dataYears?a("div",{staticClass:"px-1",staticStyle:{position:"absolute",top:"-10px",right:"15px",width:"50%"}},[a("v-slider",{attrs:{color:"grey lighten-2","track-color":"transparent","always-dirty":"","inverse-label":"","tick-labels":e.dataYears,ticks:"always","tick-size":2,min:e.dataYears[0],max:e.dataYears[e.dataYears.length-1]},model:{value:e.selectedYear,callback:function(t){e.selectedYear=t},expression:"selectedYear"}})],1):e._e(),e._v(" "),a("div",{style:e.chartWidthClass},["Figure"===e.type?a("bar-vertical",{staticClass:"bar-chart-minimal",staticStyle:{"margin-top":"0px"},attrs:{"chart-data":e.prepBarChartData,"click-handler":!0,"x-labels":!1,"y-labels":!1}}):"Chart"===e.type&&e.selectedIndicator?a("bar-vertical",{staticStyle:{height:"300px","margin-bottom":"-30px"},attrs:{"x-labels":!0,"y-labels":!0,"chart-data":e.generateChartDataSets}}):e._e()],1),e._v(" "),a("div",{staticClass:"text-xs-right",staticStyle:{"margin-right":"-18px",clear:"both",display:"block","margin-bottom":"-10px"}},[a("v-btn",{attrs:{icon:""},on:{click:function(t){return e.toggleExpand()}}},[a("v-icon",{style:e.rotateStyle,attrs:{color:"grey"}},[e._v("keyboard_arrow_down")])],1)],1),e._v(" "),e.expand?a("div",{staticClass:"pa-2"},[e._v("\n  Lorem ipsum dolor sit amet, id principes honestatis sadipscing eum, malorum ceteros percipitur ea qui. Omnesque postulant eu quo, ei mei wisi vituperata repudiandae. No est meliore consulatu,e.\n  "),a("br"),a("br"),e._v(" "),a("div",{staticClass:"grey--text text--darken-2"},[e._v("\n    Source: JIIS "+e._s(e.year||e.$store.state.year)+" "),a("span",{staticStyle:{float:"right"}},[a("v-icon",[e._v("save_alt")]),e._v(" Download data")],1)])]):e._e()]):e._e()])};xe._withStripped=!0;var we=a(30),ke=a.n(we),Ce={components:{BarVertical:be},data:function(){return{expand:!1,rotation:0,selectedYear:""}},props:["name","figure","description","unit","type","small","noChart","selected"],methods:{log:function(){console.log("data",this),console.log("store",this.$store.state)},toggleExpand:function(){this.expand=!this.expand,this.rotation=0===this.rotation?180:0},updateIndicator:function(){if(this.log(),!this.figure[0]||!this.year)return null;this.$store.commit("UPDATE",{key:["navigator","indicator"],value:{figure:this.figure[0],name:this.name}}),this.$store.commit("UPDATE",{key:"year",value:this.year})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},validateYear:function(e){for(var t=e,a=0;a<this.dataYears.length;a++){if(-1!==this.dataYears.indexOf(t)){this.year=t;break}t++}}},computed:{rotateStyle:function(){return{transform:"rotate("+this.rotation+"deg)"}},getDataByHoodYear:function(){var e=this;return this.$store.getters.dataByNeighbourhood.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByCityYear:function(){var e=this;return this.$store.state.cityIndicators.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByYear:function(){var e=this;return this.$store.state.indicators.filter(function(t){return t.year===e.thisYear})||[]},areaDataMatched:function(){var e=this,t=this.$store.getters.indicatorsForSelectedArea;if(!t)return null;var a=t.reduce(function(t,a){return e.figure.some(function(e){return a[e]})&&t.push(a),t},[]);return console.log("areaDataMatched",a),a},areaDataLatest:function(){return console.log("something"),this.areaDataMatched?this.areaDataMatched[this.areaDataMatched.length-1]:null},latestYear:function(){if(this.areaDataLatest)return console.log("arealatest",this.areaDataLatest),this.selectedYear},year:function(){return this.selectedYear||this.latestYear},selectedIndicator:function(){return this.dataYears&&this.selectedYear?this.areaDataMatched[this.dataYears.indexOf(this.selectedYear)]:{}},dataYears:function(){return this.areaDataMatched?this.areaDataMatched.map(function(e){return e.year}):null},generateChartDataSets:function(){var e=this;return"Chart"===this.type&&this.selectedIndicator?{datasets:[{data:this.figure.map(function(t){return e.selectedIndicator[t]}),borderColor:"#000",type:"line",fill:!1}],labels:this.figure}:(console.log("chart data test",this.selectedIndicator),null)},chartWidthClass:function(){var e="Chart"===this.type?{width:"100%"}:{width:"70%",marginTop:"-60px"};return n()({position:"relative",float:"right"},e)},prepBarChartData:function(){if(" Figure"===!this.type)return{};var e=this.figure,t=this.$store.state.neighbourhood,a=this.$vuetify.theme.tertiary,r=this.$store.getters.allIndicatorsByYear;if(console.log("citydata",r),!r||!this.year)return{};r=r[this.year],console.log("citydata.year",r,this.year);var i=(r=r.map(function(t){return t[e]=t[e]||0,t})).sort(function(t,a){return!a[e]-!t[e]||+(t[e]>a[e])||-(t[e]<a[e])}),o=this.name;return console.log("sorted",i),{labels:i.map(function(e){return e.name}),area_code:t,datasets:[{label:o,backgroundColor:i.map(function(e){return e.area_code===t?a:ke.a.grey.lighten2}),data:i.map(function(t){return t[e]})}]}}},mounted:function(){this.areaDataLatest&&(this.selectedYear=this.areaDataLatest.year),this.selected&&this.updateIndicator()}},Se=(a(386),Object(T.a)(Ce,xe,[],!1,null,null,null));Se.options.__file="src/components/IndicatorKeyStat.vue";var Ae=Se.exports,Le=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mt-5 mb-4",staticStyle:{background:"none"}},[t("div",{staticClass:"grey--text text--darken-2",staticStyle:{"text-transform":"uppercase","font-size":"18px",background:"none"}},[this._v(this._s(this.text))]),this._v(" "),t("v-divider",{staticClass:"my-2"})],1)};Le._withStripped=!0;var $e={props:["text"]},je=Object(T.a)($e,Le,[],!1,null,null,null);je.options.__file="src/components/IndicatorHeading.vue";var Oe=je.exports;var De=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[e.datatable?a("div",[a("div",{staticClass:"datatable-toolbar",staticStyle:{"margin-top":"-40px",float:"right"}},[e.multiselect?a("v-checkbox",{staticClass:"mt-2 mr-3",staticStyle:{float:"left"},attrs:{label:"Select All",color:"grey",flat:""},on:{change:function(t){return e.toggleSelectAll()}},model:{value:e.selectAll,callback:function(t){e.selectAll=t},expression:"selectAll"}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1):e._e(),e._v(" "),e.multiselect?a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){return e.deleteSelected(e.collection)}}},[e._v("\n            Delete Selected\n          ")]):e._e(),e._v(" "),a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1)],1),e._v(" "),a("v-data-table",{class:e.cssclass,attrs:{headers:e.featureHeaders,items:e.items,"rows-per-page-items":[10,20,50,100,-1]},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",{staticClass:"attribute-row",on:{dblclick:function(a){return e.edit(e.collection,t.item,e.nestedPath)}}},e._l(e.featureHeaders,function(r,i){return a("td",[r.type===Array?e._l(e.getNested(e.nestedPath,t.item)[r.value],function(t){return a("v-chip",{class:"func-"+t,attrs:{outline:"",small:""}},[e._v("\n              "+e._s(t)+"\n            ")])}):"select"===r.type?[a("v-checkbox",{staticStyle:{"padding-bottom":"0"},attrs:{color:"grey"},on:{change:function(a){return e.selectFeature(t.item)}},model:{value:t.item.feature._selected,callback:function(a){e.$set(t.item.feature,"_selected",a)},expression:"props.item.feature._selected"}})]:[e._v("\n            "+e._s(e.getNested(e.nestedPath,t.item)[r.value])+"\n          ")],e._v(" "),i===e.featureHeaders.length-1?a("div",{staticClass:"attribute-controls-wrapper"},[a("div",{staticClass:"attribute-controls",staticStyle:{top:"-30px"}},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.edit(e.collection,t.item,e.nestedPath)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t.item._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()],2)}),0)]}}],null,!1,1816074636)}),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e()],1):a("div",[e.addtop?a("v-btn",{staticClass:"mb-2",staticStyle:{"margin-top":"-40px",float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e(),e._v(" "),a("v-list",{class:e.cssclass,attrs:{dense:""}},e._l(e.listItems,function(t,r){return a("v-list-tile",{key:r,staticClass:"attribute-row",on:{click:function(a){return e.select(r,t._id)}},model:{value:t.active,callback:function(a){e.$set(t,"active",a)},expression:"x.active"}},[e.listKey&&e.schema.schema[e.listKey]._options&&e.schema.schema[e.listKey]._options[0]?a("v-list-tile-action",[a("v-icon",[e._v(e._s(e.schema.schema[e.listKey]._options.filter(function(a){return a.name===t[e.listKey]})[0].icon)+" ")])],1):e._e(),e._v(" "),a("v-list-tile-content",[t._id?a("div",{staticClass:"attribute-controls-wrapper"},[e._v("\n        "+e._s(t.text||t.text_en||t.name)+"\n        "),a("div",{staticClass:"attribute-controls"},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.edit(e.collection,t)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()]),e._v(" "),t.active?a("div",{staticStyle:{height:"100%"}}):e._e()],1)}),1),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n")],1):e._e()],1)]),e._v(" "),e.editedSchema?a("v-dialog",{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v(e._s(e.mode)+" "+e._s(e.schema.name.slice(0,e.schema.name.length-1)))])]),e._v(" "),a("v-tabs",{attrs:{color:"#f3f3f3","slider-color":"grey",grow:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Single")]),e._v(" "),e.editedSchema.canPaste?a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Multiple")]):e._e(),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},e._l(e.editedSchema.schema,function(t,r){return a("v-flex",{attrs:{xs12:""}},[t._options&&Array.isArray(t._options)?a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options.map(function(e){return e.name})},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):"function"!=typeof t._options||t._categorised?t._categorised?a("div",[a("v-combobox",{attrs:{multiple:"","small-chips":""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}),e._v(" "),a("v-menu",{attrs:{"full-width":"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",color:"grey",outline:""},slot:"activator"},[e._v("\n              "+e._s(r)+"\n            ")]),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t._options(e.$store,e.edited,e.collection),function(t,i){return a("v-menu",{key:i,attrs:{"full-width":"","offset-x":"","max-height":"500","open-on-hover":""}},[a("v-list-tile",{attrs:{slot:"activator"},on:{click:function(e){}},slot:"activator"},[a("v-list-tile-title",[e._v(e._s(t.name))])],1),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t.items,function(t,o){return a("v-list-tile",{on:{click:function(a){return e.edited[r].push(i+"."+t)}}},[a("v-list-tile-title",[e._v(e._s(t))])],1)}),1)],1)}),1)],1)],1):t.type===Boolean?a("v-switch",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):t._text?a("v-text-field",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-text-field",{attrs:{label:t._text,disabled:""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options(e.$store,e.edited,e.collection),"item-text":"name","item-value":"_id"},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}})],1)}),1)],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.save(e.editedCollection,e.edited._id)}}},[e._v("Save")])],1)],1),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("div",{staticClass:"title pb-2"},[e._v("Paste attributes")]),e._v("\n      Paste as rows of text, separated by commas or tabs: "),a("br"),e._v(" "),a("v-text-field",{attrs:{hint:Object.keys(e.editedSchema.schema).join(", "),textarea:"","auto-grow":"",rows:"3"},model:{value:e.pasted,callback:function(t){e.pasted=t},expression:"pasted"}}),e._v("\n\n      Preview\n      "),e.pastedComputed?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:e.pastedComputed}}):e._e()],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.saveMany(e.editedCollection,e.edited.layer)}}},[e._v("Save")])],1)],1)],1)],1)],1):e._e()],1)};De._withStripped=!0;var Ee=a(79),Fe=a.n(Ee),Te=a(45),Pe=a.n(Te),Ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("form",{attrs:{enctype:"multipart/form-data",novalidate:""},on:{submit:function(t){return t.preventDefault(),e.processForm(t)}}},[a("div",{staticClass:"dropbox pa-3",staticStyle:{"background-color":"#fff"}},[a("input",{ref:"file",staticClass:"input-file",attrs:{type:"file",name:e.uploadFieldName},on:{change:function(t){return e.filesChange()}}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"function",items:e.uploadFunctions,label:"Function"},model:{value:e.uploadFunction,callback:function(t){e.uploadFunction=t},expression:"uploadFunction"}}):e._e(),e._v(" "),"update"==e.uploadFunction?a("div",[a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Existing Records"},model:{value:e.update.matchExisting,callback:function(t){e.$set(e.update,"matchExisting",t)},expression:"update.matchExisting"}}),e._v(" "),a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Upload"},model:{value:e.update.matchUpload,callback:function(t){e.$set(e.update,"matchUpload",t)},expression:"update.matchUpload"}}),e._v(" "),a("v-text-field",{attrs:{label:"Update Key"},model:{value:e.update.key,callback:function(t){e.$set(e.update,"key",t)},expression:"update.key"}})],1):e._e(),e._v(" "),a("v-select",{attrs:{name:"collection",items:e.collections,label:"Collection"},model:{value:e.collection,callback:function(t){e.collection=t},expression:"collection"}}),e._v(" "),a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"format",items:e.indicatorFormats,label:"Format"},model:{value:e.indicatorFormat,callback:function(t){e.indicatorFormat=t},expression:"indicatorFormat"}}):e._e(),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.isSaving?a("v-btn",{attrs:{type:"submit",loading:e.processing,color:"blue",dark:"",depressed:""}},[e._v("Upload")]):e._e()],1)])])};Ie._withStripped=!0;var Ue=a(95),Me={props:["layer","layerCollection"],data:function(){return{processing:!1,isSaving:!1,uploadedFiles:[],uploadError:null,currentStatus:null,uploadFieldName:"GeoJSON",file:"",neighbourhood:"",collection:"",collections:["features","areas","indicators"],layerSelected:"",indicatorFormats:["geojson","json","csv"],indicatorFormat:null,uploadFunction:"create",uploadFunctions:["create","update"],update:{key:"",matchUpload:"",matchExisting:""}}},methods:{filesChange:function(){this.isSaving=!0,this.file=this.$refs.file.files[0],this.neighbourhood=this.file.name.split(".")[0],this.indicatorFormat=this.file.name.split(".")[1]},close:function(){this.$emit("close",!0)},processForm:function(){var e=this;this.processing=!0;var t=this.layerSelected||this.layer,a=Ue[this.collection].params?this.layer:"",r=this.collection||alert("Collection required"),o="update"===this.uploadFunction?"updateMany":"create",n=new FormData;n.append("neighbourhood",this.neighbourhood),n.append("layer",t),n.append("file",this.file),n.append("format",this.indicatorFormat),n.append("update",i()(this.update)),V[o](r,null,n,{"Content-Type":"multipart/form-data"},a).then(function(a){console.log("SUCCESS!!"),e.$store.dispatch("UPDATE_COLLECTION",{name:"features",layer:t}),e.close()}).catch(function(e){if(console.log(e.response),!e.response)return null;var t=e.response.data.error.errors;alert(x()(t).reduce(function(e,a){return e=e+"\n"+t[a].name+": "+t[a].message},""))})}},computed:{layers:function(){var e=this.$store.state["_col_"+this.layerCollection];if(e)return e.map(function(e){return{text:e.name,value:e._id}})}},mounted:function(){this.layerSelected=this.layer}},Ne=Object(T.a)(Me,Ie,[],!1,null,null,null);Ne.options.__file="src/components/Upload.vue";var Be=Ne.exports,ze=a(95),Ye={components:{VueJsonPretty:Pe.a,Upload:Be},props:["collection","filter","datatable","listKey","nestedPath","cssclass","addtop","addbottom","multiselect"],data:function(){return{updateKey:0,activeTab:null,dialog:!1,mode:null,saving:!1,editedIndex:null,layerDialog:!1,attributeDialog:!1,selected:0,selectedId:"",pasted:null,attributeTypes:["String","Number","Boolean"],editedCollection:null,edited:{},uploadDialog:!1,featureEdit:[],datatableTab:null,selectAll:!1}},computed:{menuItems:function(){return this.$store.getters.areaLayers},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},listItems:function(){var e=this,t=this.items.map(function(t,a){return t.active=e.selected===a,t});return console.log("listitems",t),t},items:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;if("features"===this.collection){var t=this.$store.state._col_features[this.filterId];return t?(t=Array.isArray(t)?t:t[this.$store.state.neighbourhood],this.multiselect?t.map(function(e,t){return e.feature.properties._selected=e.feature.properties._selected||!1,e.feature.properties._index=t,e}):items):[]}var a=Fe()(this.$store.state["_col_"+this.collection]);return console.log("collectiondata",this.collection,a),a[0]?this.filter&&a[0]?(console.log("filterlayer",this.filter),a.filter(function(t){return t.layer===e.filterId})):a:[]}),filteredItems:function(){},firstItem:function(){return this.$store.state["_col_"+self.collection]?this.$store.state["_col_"+self.collection][0]:{}},schema:function(){var e=this,t=ze[this.collection];if("features"===this.collection){var a=this.$store.getters.selectedLayerAttributes;a?(console.log("attrs",a),t=n()(t,{schema:this.schemaFromAttributes(Fe()(a))})):this.$store.dispatch("UPDATE_COLLECTION","layerAttributes").then(function(a){console.log("callback attrs",a),t=n()(t,{schema:e.schemaFromAttributes(Fe()(a))})})}return console.log("schema",t),console.log("schematype",y()(t.schema)),t||{}},editedSchema:function(){return n()({},this.schema)},schemaNames:function(){return[this.schema.name,this.relatedSchema.name].reduce(function(e,t){return t&&e.push(t.slice(0,t.length-1)),e},[])},tabledata:function(){if(this.layer)return this.layer.attributes},featureHeaders:function(){var e=this;if(!this.schema.schema)return[];var t=this.multiselect?[{value:"select",type:"select",_text:""}]:[],a=x()(this.schema.schema).reduce(function(t,a){return e.schema.schema[a]._text&&t.push({value:a,text:e.schema.schema[a]._text,type:e.schema.schema[a].type}),t},t);return console.log("featureHeaders",a),a},pastedComputed:function(){var e=this,t=this.pasted;if(!t)return[];t=t.replace(/\t/g,","),console.log("replaced",t);var a=x()(this.editedSchema.schema);return t.split("\n").reduce(function(t,r){var i=r.split(",");return i.length<2?t:(t.push(i.reduce(function(t,r,i){var o=a[i];return r=r.trim(),e.editedSchema.schema[o].type===Boolean&&(r="true"===r.toLowerCase()),t[o]=r,t},{})),t)},[])}},methods:{addSelects:function(e,t){return this.multiselect?e.map(function(e,a){return e.feature._selected=e._selected||t||!1,e.feature.properties._index=a,e}):e},updateCollection:function(e){var t=this;if(!e&&"features"===!this.collection||!e&&this.$store.state["_col_"+this.collection+"_selected"])return l.a.reject();var a=this;return console.log("EDITABLEDATALIST updating collection "+this.collection),new l.a(function(r,i){var o=t.collection;if("features"===t.collection){var n=a.filterId;o={name:"features",layer:n},(!n||!e&&t.$store.state._col_features[n])&&i("No layer specified")}a.$store.dispatch("UPDATE_COLLECTION",o).then(function(e){a.$forceUpdate(),r(e)}).catch(function(e){console.log("update failed",e),i()})})},templateFromSchema:function(e){if(e)return x()(e).reduce(function(t,a){return e[a].type===Array?t[a]=[]:e[a].type===Boolean?t[a]=!1:t[a]="",t},{})},schemaFromAttributes:function(e){var t=this;return console.log("schema from attributes, attrs",e),e.reduce(function(e,a){return a.layer===t.$store.state._col_layers_selected&&(a._text=a._text||a.name,e[a.name]=a),e},{})},selectFeature:function(e,t){console.log(e),this.$store.commit("UPDATE_FEATURE_PROPERTIES",{layer:this.$store.state._col_layers_selected,feature:e})},select:function(e,t){var a=this;console.log("index",e,t),this.selected=e,this.selectedId=t,console.log("updating selected value: ",this.collection,t),this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:t}),this.$nextTick(function(){return a.$forceUpdate()})},add:function(e){console.log(e),this.mode="Add",this.editedCollection=e,this.edited=this.templateFromSchema(ze[e].schema),this.dialog=!0,console.log("dialog data",e,this.edited)},edit:function(e,t,a){this.mode="Edit";var r=this.templateFromSchema(ze[e].schema),i=this.$store.state["_col_"+e];if(a){for(var o=0;o<i.length;o++)if(t===this.getNested(a,i[o])){t._id=i[o]._id,this.editedIndex=o;break}r=this.getNested(a,r),t._path=a}else this.editedIndex=i.indexOf(t);this.edited=n()({},r,t),this.editedCollection=e,this.dialog=!0,console.log("this",this)},del:function(e,t){var a=this;this.loading=!0,confirm("Are you sure you want to delete this item?")&&V.del(e,t).then(function(e){a.updateCollection(!0),a.selected=a.selected>0?a.selected-1:0,a.loading=!1})},close:function(){this.saving=!1,this.dialog=!1},save:function(e,t,a){var r=this;this.saving=!0,this.close(),this.filter&&(this.edited.layer=this.filterId);var i=ze[e].params?this.selectedId:"",o={id:t,path:this.edited._path};console.log("saving",[e,t,this.edited]),V.update(e,o,this.edited,{},i).then(function(e){r.updateCollection(!0),r.close()})},saveMany:function(e,t){var a=this;if(this.saving=!0,console.log("filterId: "+this.filterId+" collection: "+e),this.pastedComputed[0]&&x()(this.pastedComputed[0]).length>1){this.pastedComputed=this.pastedComputed.map(function(e){return e.layer=a.filterId,e});var r=new FormData;r.append("data",i()(this.pastedComputed)),console.log("making request..."),V.create(e,"",r).then(function(e){console.log("uploaded"),a.updateCollection(!0),a.close(),a.pasted=""})}},toggleSelectAll:function(){var e=this,t=(this.addSelects(this.items,this.selectAll),{name:"features",layer:this.filter,data:this.addSelects(this.items,this.selectAll)});this.$store.dispatch("UPDATE_COLLECTION",t).then(function(){return e.$forceUpdate()})},deleteSelected:function(){var e=this;console.log(this.items);var t=this.items.filter(function(e){return e.feature._selected});confirm("Are you sure you want to delete "+t.length+" items?")&&V.deleteMany("features","",t.map(function(e){return e._id}),"",this.filterId).then(function(){console.log("deleted"),e.updateCollection(!0)})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},forceUpdate:function(){this.$forceUpdate(),console.log("force updated",this.$store.getters.selectedLayerAttributes)},logStore:function(){console.log("data",this),console.log("store",this.$store.state)}},watch:{dialog:function(e){console.log(e),e||this.close()},menuItems:function(e){console.log("menuItems",newValue)},filterId:function(e){console.log("WATCH: layerchanged",e),"features"===this.collection&&this.updateCollection()}},created:function(){console.log("created"),this.updateCollection().then(function(e){}).catch(function(e){return console.log("failed to update store")})},mounted:function(){}},qe=(a(451),Object(T.a)(Ye,De,[],!1,null,null,null));qe.options.__file="src/components/EditableDataList.vue";var Ke=qe.exports,Je={components:{MapView:ae,MapNavigator:ne,BarHorizontal:_e,BarVertical:be,IndicatorKeyStat:Ae,IndicatorHeading:Oe,EditableDataList:Ke},data:function(){return{selected:0,activeTab:null,selectedData:this.$store.getters.selected}},computed:{items:function(){var e=this.$store.getters.selectedIndicatorBlocks;console.log("indicator blocks",e);var t,a,r,i=(t=e,a=["text","description"],r=this.$store.state.language,a="string"==typeof a?[a]:a,function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":y()(i)))return a.forEach(function(e){i[e+"_"+r]&&(i[e]=i[e+"_"+r])}),x()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(t=Array.isArray(t)?t:[t],a,r));return console.log("translateion",i),console.log("indicatorsByArea",this.$store.getters.indicatorsByArea),i},featureLayers:function(){var e=this.$store.getters.selectedIndicatorSection;return e?e.geodata:null}},methods:{updateSelected:function(e){this.selected=e,console.log("updated select",this.selected)},log:function(){console.log("store",this.$store.state)}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedIndicatorSection},function(t,a){if(console.log("section changed",t),!t||!Array.isArray(t.geodata)||0===t.geodata.length)return null;t.geodata.forEach(function(t){e.$store.state["_col_"+t]||e.$store.dispatch("UPDATE_COLLECTION",{name:"features",query:{},layer:t})}),e.$store.commit("UPDATE",{key:["map","zoom"],value:12})}),console.log("store",this.$store.state)}},He=(a(452),Object(T.a)(Je,ve,[],!1,null,null,null));He.options.__file="src/components/IndicatorsNew.vue";var Ge=He.exports,Ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-layout",{attrs:{row:"","align-center":"","justify-center":""}},[a("v-dialog",{attrs:{persistent:"","max-width":"500"},model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}},[a("v-card",[a("v-card-title",[a("svg",{attrs:{width:"80vh",height:"200"},domProps:{innerHTML:e._s(e.editFeaturePath)}})]),e._v(" "),a("v-card-text",[e._l(e.surveyQuestions,function(t){return["text"==t.type?a("v-text-field",{attrs:{name:t.name,"data-vv-name":t.name,label:t.label,"v-validate":"required|numeric","error-messages":e.errors.collect(t.name)},model:{value:e.editFeature[t.name],callback:function(a){e.$set(e.editFeature,t.name,a)},expression:"editFeature[item.name]"}}):"textarea"==t.type?a("v-textarea",{attrs:{name:t.name,"data-vv-name":t.name,label:t.label,"v-validate":t.validation,"error-messages":e.errors.collect(t.name)},model:{value:e.editFeature[t.name],callback:function(a){e.$set(e.editFeature,t.name,a)},expression:"editFeature[item.name]"}}):"radio"==t.type?a("v-radio-group",{attrs:{name:t.name,"data-vv-name":t.name,label:t.label,"error-messages":e.errors.collect(t.name)},model:{value:e.editFeature[t.name],callback:function(a){e.$set(e.editFeature,t.name,a)},expression:"editFeature[item.name]"}},e._l(t.options,function(e){return a("v-radio",{attrs:{label:e.label,value:e.value}})}),1):e._e()]})],2),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{on:{click:e.closeEditor}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{color:"primary"},on:{click:e.saveEditor}},[e._v("Save")])],1)],1)],1)],1),e._v(" "),a("l-map",{attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"main-map"},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["detailed"==e.baseMap?a("l-protobuf",{attrs:{url:"https://maps.tilehosting.com/data/v3/{z}/{x}/{y}.pbf?key=ArAI1SXQTYA6P3mWFnDs",options:e.protobufOpts}}):e._e(),e._v(" "),"basic"==e.baseMap?a("l-tile-layer",{attrs:{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:"&copy; <a href='http://osm.org/copyright'>OpenStreetMap</a> contributors",options:e.protobufOpts}}):e._e(),e._v(" "),e._l(e.surveyData,function(t,r){return e.survey?a("l-geo-json",{key:t._id,attrs:{options:e.geoJsonOptions,"options-style":t.feature.properties.style,geojson:t.feature}}):e._e()}),e._v(" "),e._l(e.$store.state.geo.areas,function(t,r){return e.layers.areas?a("l-geo-json",{key:t._id,attrs:{options:e.areasGeoJsonOptions,geojson:t.feature,"options-style":e.getAreaStyle(t.feature.properties.id)}}):e._e()})],2),e._v(" "),a("div",{attrs:{id:"map-menu"}},[a("v-menu",{attrs:{"close-on-content-click":!1,"min-width":"300px",flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}])},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{attrs:{dense:""}},[a("div",{staticClass:"px-4"},[a("div",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return[a("v-switch",{key:r,attrs:{label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})]})],2),e._v(" "),e._l(e.items,function(t,r){return t.children?a("v-list-group",{key:t.text,attrs:{"prepend-icon":t.model?t.icon:t["icon-alt"],"append-icon":""},scopedSlots:e._u([{key:"activator",fn:function(){return[a("v-list-tile",[a("v-list-tile-content",[a("v-list-tile-title",[e._v("\n              "+e._s(t.heading)+"\n            ")])],1)],1)]},proxy:!0}],null,!0),model:{value:t.model,callback:function(a){e.$set(t,"model",a)},expression:"item.model"}},[e._v(" "),e._l(t.children,function(t,r){return[a("v-switch",{key:r,attrs:{label:t.text},on:{click:function(a){return e.getSurveyData(t.text)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"child.selected"}})]})],2):t.heading?a("v-layout",{key:r,attrs:{row:"","align-center":""}},[a("v-flex",{attrs:{xs6:""}},[t.heading?a("v-subheader",[e._v("\n        "+e._s(t.heading)+"\n      ")]):e._e()],1)],1):t.divider?a("v-divider",{key:r,staticClass:"my-3",attrs:{dark:""}}):e._e()}),e._v(" "),a("v-divider"),e._v(" "),a("v-subheader",[e._v("Survey Data")]),e._v(" "),a("v-list-tile",{staticClass:"mb-3"},[e.surveyNames?a("v-select",{attrs:{items:e.surveyNames,"menu-props":"auto",label:"Select a survey","hide-details":"","prepend-icon":"map","single-line":""},on:{input:function(t){return e.getSurveyData(t)}},model:{value:e.selectedSurvey,callback:function(t){e.selectedSurvey=t},expression:"selectedSurvey"}}):a("v-btn",{on:{click:e.getSurveyNames}},[e._v("Load surveys")])],1),e._v(" "),e.survey?[a("v-divider"),e._v(" "),a("v-subheader",[e._v("Survey key")]),e._v(" "),e._l(e.surveyKeyArray,function(t,r){return a("v-list-tile",[a("v-list-tile-action",[a("v-icon",{attrs:{color:t.color}},[e._v("label")])],1),e._v(" "),a("v-list-tile-content",[e._v("\n      "+e._s(t.text)+"\n    ")])],1)}),e._v(" "),a("v-list-tile",[a("v-select",{attrs:{items:e.languages,"menu-props":"auto",label:"Select language","single-line":""},model:{value:e.language,callback:function(t){e.language=t},expression:"language"}})],1)]:e._e()],2)],1)],1)],1)};Ve._withStripped=!0;var Re={name:"MapView",components:{LMap:w.a,LTileLayer:k.a,LMarker:C.a,LPopup:S.a,LTooltip:A.a,LProtobuf:I,LPolygon:$.a,LGeoJson:j.a},$_veeValidate:{validator:"new"},data:function(){var e=this;return{language:"ar",languages:["ar","en"],url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",zoom:14,center:L.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:L.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5},geoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){r.openEditor(e)}})}},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){r.selectArea(e)}})}},layers:{areas:!0},areaStyle:{2111:{weight:2,color:"#fff",opacity:.9,fillColor:"#fff",fillOpacity:.5}},survey:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!1},{text:"Detailed",type:"detailed",selected:!0}],baseMap:"detailed",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}}}},computed:{items:function(){return this.$auth.isAuthenticated(),[]},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return g()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:N,maxNativeZoom:14,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},surveyQuestions:function(){return this.translate(X,"label",this.language)},scale:function(){var e=this,t=this.$store.getters.dataByYear.map(function(t){return t[e.$store.state.map.indicator]}).sort(function(e,t){return e-t});return{min:t[0],max:t[t.length-1]-t[0]}}},methods:{getAreaStyle:function(e){var t=Z.a.scale(["yellow","red"]),a=this.$store.getters.dataByYear.filter(function(t){return t.area_code===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=a[this.$store.state.map.indicator],i=t((r-this.scale.min)/this.scale.max);return console.log(e,this.scale,r,i,(r-this.scale.min)/this.scale.max),{weight:1,color:"#fff",opacity:.9,fillColor:i,fillOpacity:.6}},updateBaseMap:function(e,t){console.log(e,t),this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},showLongText:function(){this.showParagraph=!this.showParagraph},innerClick:function(){console.log(!0)},popup:function(e){console.log(e)},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return L.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;V.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;V.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},selectArea:function(e){this.$store.commit("UPDATE",{key:"neighbourhood",value:e.target.feature.properties.id}),this.$store.commit("UPDATE",{key:["map","zoom"],value:15}),this.$store.commit("UPDATE",{key:["map","center"],value:{lon:e.target.feature.properties.Centroids_x,lat:e.target.feature.properties.Centroids_y}})},openEditor:function(e){var t=this;this.surveyData.forEach(function(a,r){a._id==e.target.feature.properties.Id&&(t.editIndex=r)}),n()(this.editFeature,this.surveyData[this.editIndex].feature.properties.survey),this.editDialog=!0;var a=e.target._path.outerHTML,r=1/this.currentZoom*1/this.currentZoom*1/this.currentZoom*1/this.currentZoom*2e5,i=(a=a.replace(">",'transform="translate() scale('+r+')">')).match(/d="M[\d\s-]*/)[0].slice(4).split(" ").map(function(e){return parseInt(e)});i[0]=-i[0]*r+200,i[1]=-i[1]*r+50,a=(a=a.replace("translate()","translate("+i[0]+" "+i[1]+")")).replace(/stroke-width="\d"/,'stroke-width="0.2"'),this.editFeaturePath=a,this.editMapFeature=e.target.feature,this.editMapCenter=this.getCoordsPoint(e.target.feature)},closeEditor:function(){this.editDialog=!1,console.log(this.editFeatureDefaults),n()(this.editFeature,this.editFeatureDefaults),this.styleSurveyData(),this.$validator.reset()},saveEditor:function(){this.$validator.validateAll().then(function(e){e?alert("success"):alert("error")}).catch(function(){});var e=this.surveyData[this.editIndex],t={lastEdited:{time:new Date,user:this.$auth.getUser().email}};n()(e.feature.properties.survey,t,this.editFeature),V.update("buildings",{id:e._id},e),this.closeEditor()},styleSurveyData:function(){var e=this,t=x()(this.editFeature).length;this.surveyData.forEach(function(a){var r=g()(a.feature.properties.survey).filter(function(e){return null!=e&&null!=e}),i=e.surveyKey.notStarted.color;r.length>t?i=e.surveyKey.complete.color:a.feature.properties.survey.lastEdited&&(i=e.surveyKey.inProgress.color),a.feature.properties.style={weight:2,color:i,opacity:.9,fillColor:i,fillOpacity:.5}})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){var e=document.getElementsByClassName("v-toolbar__extension")[0].style;console.log(e),e.overflow="auto"},500)},translate:function(e,t,a){return function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":y()(i)))return i[a]=i[a+"_"+r],x()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),t.push(i),t},[])}(e,t,a)}},mounted:function(){var e=this;window.screen.width<800&&this.updateBaseMap("basic",!0),this.getSurveyNames(),this.editFeature=X.reduce(function(e,t){return e[t.name]="",e},{}),this.editFeatureDefaults=n()({},this.editFeature),this.$store.watch(function(e,t){return e.neighbourhood},function(t,a){9999===t&&(e.$store.commit("UPDATE",{key:["map","zoom"],value:12}),e.$store.commit("UPDATE",{key:["map","center"],value:e.$store.state.map.defaultCenter}))}),this.$store.watch(function(e,t){return e.map.indicator},function(t,a){9999===t&&(e.$store.commit("UPDATE",{key:["map","zoom"],value:12}),e.$store.commit("UPDATE",{key:["map","center"],value:e.$store.state.map.defaultCenter}))})}},Ze=(a(453),Object(T.a)(Re,Ve,[],!1,null,null,null));Ze.options.__file="src/components/MapSurvey.vue";var Qe=Ze.exports,We=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-btn",{on:{click:function(t){return e.log()}}},[e._v("log")]),e._v(" "),a("v-tabs",{staticClass:"mt-2",attrs:{color:"background","slider-color":"primary"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{key:1,attrs:{ripple:""},on:{click:function(t){return e.update("layers")}}},[e._v("Features ")]),e._v(" "),a("v-tab",{key:2,attrs:{ripple:""},on:{click:function(t){return e.update("areaLayers")}}},[e._v("Spatial Analysis")]),e._v(" "),a("v-tab",{key:3,attrs:{ripple:""},on:{click:function(t){return e.update("indicatorSections")}}},[e._v("Indicator Sections")]),e._v(" "),a("v-tab-item",{key:"0a"},["layers"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("div",{staticClass:"text-xs-right caption grey--text",staticStyle:{"margin-top":"-20px"}},[a("span",[e._v("Layer id: "+e._s(e.$store.state["_col_"+e.tab+"_selected"]))])]),e._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{collection:"layers",listKey:"data_type",addbottom:!0}})],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{staticStyle:{height:"402px"},attrs:{xs9:""}},[e.$store.state._col_features?a("map-view",{class:{minimap:e.scrollLow,fullmap:!e.scrollLow},staticStyle:{position:"relative",height:"402px"},attrs:{contextmenu:"",features:e.$store.state._col_features,featuresCollection:"features",dataType:"Point",zoomLevel:"12",featureLayers:[e.$store.state._col_layers_selected]}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs3:""}},[e.$store.getters.selectedLayer?a("div",{staticClass:"ejmap-border-top pl-3"},[a("div",{staticClass:"subheading font-weight-light py-2"},[e._v("Summary")]),e._v(" "),a("v-layout",{staticClass:"body-1 ejmap-border-bottom grey--text text--darken-2",attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[e._v("\n          Name: "),a("span",{staticStyle:{float:"right"}},[e._v(" "+e._s(e.$store.getters.selectedLayer.text_en)+" ")])]),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e._v("\n          Data Type: "),a("span",{staticStyle:{float:"right"}},[e._v(e._s(e.$store.getters.selectedLayer.data_type))])]),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e._v("\n          Feature Count: "),a("span",{staticStyle:{float:"right"}},[e._v(e._s(e.$store.state._col_features.length))])]),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e._v("\n          Source:\n        ")]),e._v(" "),a("area-select")],1)],1):e._e()]),e._v(" "),a("v-flex",{attrs:{xs6:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 pb-2"},[e._v("Layer Attributes")]),e._v(" "),e.$store.state._col_layers_selected?a("editable-data-list",{attrs:{collection:"layerAttributes",filter:"layers",datatable:!0,cssclass:"no-background",addtop:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs6:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 pb-2"},[e._v("Layer Calculations")]),e._v(" "),e.$store.state._col_layers_selected?a("editable-data-list",{attrs:{collection:"layerCalcs",filter:"layers",datatable:!0,cssclass:"no-background",addtop:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pb-2 pt-5 pl-3"},[e._v("Features Table")]),e._v(" "),a("editable-data-list",{directives:[{name:"show",rawName:"v-show",value:e.$store.state._col_layerAttributes_selected,expression:"$store.state._col_layerAttributes_selected"}],attrs:{collection:"features",filter:"layers",datatable:!0,multiselect:!0,nestedPath:"feature.properties",cssclass:"no-background",addtop:!0}})],1)],1)],1)],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"1a"},["areaLayers"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"areaLayers"}})],1),e._v(" "),a("v-flex",{attrs:{xs9:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm7:"",xs12:""}},[e.$store.state._col_areas?a("map-view",{staticStyle:{position:"relative",height:"402px"},attrs:{contextmenu:"",areas:!0,featuresCollection:"areas",dataType:"MultiPolygon",zoomLevel:"12"}}):e._e(),e._v(" "),e.$store.state.selectedFeature?a("div",{staticClass:"py-5"},[a("div",{staticClass:"pb-2 subheading font-weight-light  ejmap-border-bottom"},[e._v("Indicators ")]),e._v(" "),a("v-tabs",{attrs:{"slider-color":"primary",color:"background"}},[e._l(e.$store.getters.indicatorsForSelectedArea,function(t,r){return a("v-tab",{key:r,attrs:{ripple:""}},[e._v("\n          "+e._s(t.year)+"\n        ")])}),e._v(" "),e._l(e.$store.getters.indicatorsForSelectedArea,function(e,t){return a("v-tab-item",{key:t},[a("v-card",{attrs:{flat:""}},[a("vue-json-pretty",{staticClass:"pa-3 mb-2 code caption",attrs:{data:e}})],1)],1)})],2)],1):e._e()],1),e._v(" "),a("v-flex",{attrs:{sm5:"",xs12:""}},[a("div",{staticClass:"pb-2 subheading font-weight-light"},[e._v("Attached Attributes")]),e._v(" "),a("v-card",{attrs:{flat:""}},[e.$store.state._col_areaLayers_selected?a("editable-data-list",{attrs:{addbottom:!0,collection:"areaAttributes",filter:"areaLayers",datatable:!0}}):e._e()],1)],1),e._v(" "),a("v-flex",{attrs:{"offset-sm3":"",sm9:"",xs12:""}},[a("v-card")],1)],1)],1)],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"2a"},["indicatorSections"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-card",[e.$store.state._col_indicatorSections_selected?a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorBlocks",filter:"indicatorSections",datatable:!0}}):e._e()],1)],1)],1)],1):e._e()],1)],1),e._v(" "),a("div",{staticClass:"data-toolbar"},[a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){e.uploadDialog=!0}}},[a("v-icon",{staticClass:"mr-2"},[e._v("cloud_upload")]),e._v("\n    Upload\n    ")],1),e._v(" "),a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){e.analysisDialog=!0}}},[a("v-icon",{staticClass:"mr-2"},[e._v("assessment")]),e._v("\n    Update Feature Analysis\n    ")],1)],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.uploadDialog,callback:function(t){e.uploadDialog=t},expression:"uploadDialog"}},[a("upload",{attrs:{layer:e.$store.state["_col_"+e.tab+"_selected"],layerCollection:"layers"},on:{close:function(t){e.uploadDialog=!1}}})],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.analysisDialog,callback:function(t){e.analysisDialog=t},expression:"analysisDialog"}},[a("analysis",{attrs:{layer:e.$store.state._col_layers_selected,areaLayer:e.$store.state._col_areaLayers_selected},on:{close:function(t){e.analysisDialog=!1}}})],1)],1)};We._withStripped=!0;var Xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-3"},[a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),a("v-select",{attrs:{name:"areaLayer",items:e.areaLayers,label:"Area"},model:{value:e.areaLayerSelected,callback:function(t){e.areaLayerSelected=t},expression:"areaLayerSelected"}}),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{color:"blue",dark:"",depressed:"",loading:e.processing},on:{click:function(t){return e.updateAnalysis()}}},[e._v("Analyse")])],1)],1)};Xe._withStripped=!0;a(95);var et={props:["layer","areaLayer"],data:function(){return{processing:!1,layerSelected:"",areaLayerSelected:""}},methods:{close:function(){this.$emit("close",!0)},updateAnalysis:function(){var e=this;this.processing=!0,V.updateAnalysis("features",this.areaLayerSelected,{},{},this.layerSelected).then(function(){e.processing=!1})}},computed:{layers:function(){return this.$store.state._col_layers.map(function(e){return{text:e.name,value:e._id}})||[]},areaLayers:function(){return this.$store.state._col_areaLayers.map(function(e){return{text:e.name,value:e._id}})||[]}},mounted:function(){this.layerSelected=this.layer||this.$store.state._col_areaLayers_selected,this.areaLayerSelected=this.areaLayer||this.$store.state._col_layers_selected}},tt=Object(T.a)(et,Xe,[],!1,null,null,null);tt.options.__file="src/components/Analysis.vue";var at=tt.exports,rt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.$store.getters.selectedArea?a("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"btn-title px-0 mx-0",attrs:{flat:""}},r),[e._v("\n          "+e._s(e.$store.getters.selectedArea.feature.properties.id)+"\n        ")])]}}],null,!1,2171532916)},[e._v(" "),a("v-list",e._l(e.$store.getters.selectedAreas,function(t,r){return a("v-list-tile",{key:r,on:{click:function(a){return e.update(t.feature.properties)}}},[a("v-list-tile-title",[e._v(e._s(t.feature.properties.id))])],1)}),1)],1):e._e()};rt._withStripped=!0;var it={data:function(){return{}},computed:{},methods:{update:function(e){this.$store.commit("UPDATE",{key:"neighbourhood",value:e.id}),this.$store.commit("UPDATE",{key:["map","center"],value:{lon:e.Centroids_x,lat:e.Centroids_y}})}}},ot=(a(454),Object(T.a)(it,rt,[],!1,null,"08699199",null));ot.options.__file="src/components/AreaSelect.vue";var nt=ot.exports,st={components:{EditableDataList:Ke,MapView:ae,Upload:Be,VueJsonPretty:Pe.a,Analysis:at,AreaSelect:nt},data:function(){return{uploadDialog:!1,analysisDialog:!1,activeTab:null,pages:null,tab:"layers",scrollLow:!1,minimap:{position:"fixed",top:"20px",left:"20px",width:"20%",height:"200px"},pagesX:[{name:"features",mainCollection:"layers",relatedCollection:"layerAttributes",featuresCollection:"features"},{name:"spatial_areas",mainCollection:"areaLayers",featuresCollection:"areas",indicators:!0},{name:"indicators",mainCollection:"indicatorSections",relatedCollection:"indicatorBlocks",featuresCollection:"indicators",indicators:!0}]}},computed:{},methods:{update:function(e){var t=this;this.tab=e,this.$store.commit("UPDATE",{key:"tab",value:e}),this.$nextTick(function(){t.$forceUpdate()})},log:function(){console.log("data",this),console.log("store",this.$store.state)}},mounted:function(){var e=this;window.addEventListener("scroll",function(t){window.scrollY>500&&!e.scrollLow?e.scrollLow=!0:window.scrollY<500&&e.scrollLow&&(e.scrollLow=!1)})}},lt=(a(455),Object(T.a)(st,We,[],!1,null,null,null));lt.options.__file="src/components/ManageDataMaster.vue";var ct=lt.exports,ut=a(119),dt=a.n(ut),pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-layout",{attrs:{row:"",wrap:""}},e._l(e.items,function(t,r){return a("v-flex",{attrs:{xs12:"","py-4":""}},[a("div",{staticClass:"title pb-2"},[e._v(e._s(t.heading))]),e._v(" "),a("div",{staticClass:"subheading",staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.text))]),e._v(" "),t.code?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:t.code}}):e._e()],1)}),1)],1)};pt._withStripped=!0;var ft={components:{VueJsonPretty:Pe.a},data:function(){return{itemsX:[{heading:"Features"},{heading:"Features"},{heading:"Features"}],items:[{heading:"Features",text:"Spatial data points (either points, polygons or lines) with attribute information including which feature layer it is associated with.",code:{type:"point",geometry:[],properties:{year:2015,feature_layer:"education",type:"college",students:500,gender:"mixed",quality_rating:10}}},{heading:"Feature Layers",text:"Feature layers determine the layer type and methods of analysis to be performed on it.",code:{name:"education",type:"point",columns:{type:{type:"string",func:"count"},students:{type:"integer",func:"sum"},gender:{type:"string",func:"count"},quality_rating:{type:"integer",func:"average"}}}},{heading:"Areas",text:"Statistical areas with which the features should be grouped for analysis"},{heading:"Area Indicators",text:"Area indicators include the results of spatial analysis between the Areas and Features and any additional secondary data e.g from JIIS"},{heading:"Surveys",text:"Surveys are extensions of Feature Layers that can be used for collecting field data.\n\nSurveys can use an existing Feature Layer as a template or create a new one. In most cases spatial data will need to be uploaded in advance of the conducting the survey.However, point data can be added live via the survey map"}]}}},vt=Object(T.a)(ft,pt,[],!1,null,null,null);vt.options.__file="src/components/Help.vue";var ht=vt.exports;"http://localhost:8080"===window.location.origin||window.location.origin;console.log("routing from",{redirect_uri:window.location.origin+"/implicit/callback"}),c.default.use(dt.a,{client_id:"***REMOVED***",issuer:"https://dev-160658.okta.com/oauth2/default",redirect_uri:window.location.origin+"/implicit/callback",scope:"openid profile email"}),c.default.use(fe.a);var mt=new fe.a({mode:"history",routes:[{path:"/",component:Ge},{path:"/upload",component:Be},{path:"/manage",component:ct,meta:{requiresAuth:!0}},{path:"/map",component:Qe},{path:"/indicators",component:Ge},{path:"/implicit/callback",component:dt.a.handleCallback()},{path:"/help",component:ht}]});mt.beforeEach(c.default.prototype.$auth.authRedirectGuard());var yt=mt,_t=a(308),gt=a.n(_t),bt=(a(456),a(457),a(307)),xt=a(121),wt={primary:ke.a.orange.lighten1,secondary:ke.a.grey.lighten3,tertiary:ke.a.blue.base,error:"#b71c1c",background:"#f8f9fa"},kt=a(458)();c.default.use(gt.a,{options:{customProperties:!0},theme:wt}),c.default.use(bt.a),c.default.use(xt.a),c.default.config.productionTip=!0;var Ct=new xt.a.Store({state:{_col_layers:[],_col_layers_selected:"",_col_layerAttributes:[],_col_layerAttributes_selected:"",_col_areas:[],_col_areas_selected:"",_col_areaLayers:[],_col_areaLayers_selected:"",_col_features:{},_col_features_selected:"",_col_indicators:[],_col_indicators_selected:"",_col_indicatorSections:[],_col_indicatorSections_selected:"",_col_indicatorBlocks:[],_col_indicatorBlocks_selected:"",neighbourhoodsTest:null,updateCount:0,indicators:[],collections:{},cityIndicators:[],neighbourhood:2112,selectedFeature:"",areaLayer:"5cf510e19bfa58b6c509903b",year:2016,language:"en",languages:["ar","en"],theme:wt,tab:"",map:{zoom:14,center:{lat:31.827982118391024,lng:35.22958321000619},defaultCenter:{lat:31.827982118391024,lng:35.22958321000619}},navigator:{zoom:11,center:{lat:31.77487761850741,lng:35.20328852089031},defaultCenter:{lat:31.77487761850741,lng:35.20328852089031},indicator:{figure:"pop_year_end",name:"Population"}},geo:{areas:[],facilities:[],educational:[],features:[],selected:null},layers:[]},actions:{UPDATE_COLLECTION:function(e,t){var a=e.state,r=e.commit,i={name:t.name||t,query:t.query||{},layer:t.layer};if("features"===i.name&&(i.layer=i.layer||a._col_layers_selected,i.layer||rej("no feature layer defined"),a._col_layers.filter(function(e){return e._id===i.layer})[0].filtered)){var o=a._col_areaLayers.filter(function(e){return e._id===a._col_areaLayers_selected})[0].code;i.query["feature.properties."+o]=a.neighbourhood,i.nestedKey=a.neighbourhood}function n(e){if("features"===i.name)r("UPDATE_FEATURES",{key:i.layer,value:e,nestedKey:i.nestedKey});else{var t="_col_"+i.name,o=t+"_selected";r("UPDATE",{key:t,value:e}),a[o]||r("UPDATE",{key:o,value:e[0]._id})}}return new l.a(function(e,a){if(t.data)return console.log("supplied data",t.data),n(t.data),e(t.data);console.log("making api request",i.name,i.query,i.layer),V.find(i.name,i.query,"",{lean:!0},i.layer).then(function(t){n(t.data),e(t.data)}).catch(function(e){console.log("caught error",e),a(e)})})},UPDATE_INDICATORS:function(e){var t=e.state,a=e.commit;V.find("indicators",{areaLayer:t.areaLayer}).then(function(e){return a("UPDATE",{key:"indicators",value:e.data})}).catch(function(e){console.log("failed to update indicators",e)})}},mutations:{GET_INDICATORS:function(e){V.find("areas",{}).then(function(t){e.geo.areas=t.data}),V.find("indicators",{}).then(function(t){if(!t.data)return console.log("cannot retrieve in"),null;var a=t.data.map(function(e){return e.dependency_youth=((e.age_0_4+e.age_5_14+e.age_15_24)/e.pop_year_end*100).toFixed(1),e.growth_total=(e.pop_growth_total/e.pop_year_end*100).toFixed(1),e.growth_natural=(e.pop_growth_natural/e.pop_year_end*100).toFixed(1),e.household_size=(e.pop_year_end/e.dwellings_total).toFixed(1),e.dwelling_density=(e.dwelling_area_avg/e.household_size).toFixed(1),e.prevyear=t.data.filter(function(t){return t.name===e.name&&t.year===e.year-1})[0],e.dwellings_new=e.prevyear?e.dwellings_total-e.prevyear.dwellings_total:null,e.dwelling_growth=(e.dwellings_new/e.dwellings_total*100).toFixed(1),e.age_distribution_labels=["age_0_4","age_5_14","age_15_24","age_25_44","age_45_64","age_65_74","age_75_"],e.age_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.pop_year_end*100}),e.dwelling_area_distribution_labels=["dwellings_area_0_40","dwellings_area_41_60","dwellings_area_61_80","dwellings_area_81_100","dwellings_area_101_140","dwellings_area_141"],e.dwelling_area_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.dwellings_total*100}),e});e.indicators=a.filter(function(e){return 9999!==e.area_code}),e.cityIndicators=a.filter(function(e){return 9999===e.area_code});var r={sum:function(e,t){return e.reduce(function(e,a){if(!a.feature.properties.mygeodat_5)return e;var r=a.feature.properties;return["total",a.feature.properties.mygeodat_5.toString()].forEach(function(a){e[a]=e[a]||{},e[a].types=e[a].types||{},t.forEach(function(t){"string"==typeof r[t]?e[a].types[r[t]]=e[a].types[r[t]]?e[a].types[r[t]]+1:1:e[a][t]=e[a][t]?e[a][t]+parseInt(r[t]):r[t]||0})}),e},{})}};V.find("features",{}).then(function(t){e.geo.facilities=t.data,e.facilities=t.data.map(function(e){return e.feature.properties}),console.log("facilities",e.facilities);var a=t.data.filter(function(e){return"Educational"===e.feature.properties.Use});e.geo.educational=a,a=r.sum(a,["Sort1","Sort2","Gender","no_student","no_females","no_classes","Type"]),e.indicators.forEach(function(t,r){2015===t.year&&t.area_code&&(e.indicators[r]=n()({},t,a[t.area_code.toString()]))}),e.cityIndicators.forEach(function(t,r){2015===t.year&&(e.cityIndicators[r]=n()({},t,a.total))}),console.log("cityindicators",e.cityIndicators)})})},UPDATE_FEATURES:function(e,t){console.log("updating feature",t.nestedKey,t.key,t.value),t.nestedKey?(e._col_features[t.key]=e._col_features[t.key]||{},c.default.set(e._col_features[t.key],t.nestedKey,t.value)):c.default.set(e._col_features,t.key,t.value)},UPDATE_FEATURE_PROPERTIES:function(e,t){e._col_features[t.layer].splice(t.feature._index,1,t.feature);var a=t.feature.feature.geometry.coordinates[0][0][0];console.log("coords",a),e.map.center={lat:a[1],lng:a[0]}},UPDATE:function(e,t){if(Array.isArray(t.key)){console.log("updating store nested: "+i()(t.key),t.value);var a=t.key.slice(0,t.key.length-1).reduce(function(e,t){return e&&"undefined"!==e[t]?e[t]:void 0},e),r={};r[t.key.slice(-1)[0]]=t.value,n()(a,r)}else{var o=t.value[0]&&t.value[0]._id?t.value.map(function(e){return e._id}):"";console.log("updating store value: "+t.key,t.value,o),e[t.key]=t.value}},UPDATE_AREA:function(e,t){var a=e.geo.areas.filter(function(e){return e.feature.properties.id===t})[0];console.log(a),e.neighbourhood=t,e.map.center={lon:a.feature.properties.Centroids_x,lat:a.feature.properties.Centroids_y}}},getters:{areaSelect:function(e,t){return e.indicators?t.dataByYear.concat(t.dataByCityYear):[]},neighbourhoods:function(e,t){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.name)&&e.push(t.name),e},[]):[]},years:function(e){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.year)&&t.year&&e.push(t.year),e},[]):[]},dataByYear:function(e){return e.indicators?e.indicators.filter(function(t){return t.year===e.year}):[]},dataByNeighbourhood:function(e){if(!e.indicators)return[];var t=e.indicators.filter(function(t){return t.area_code===e.neighbourhood});return t.length>0?t:e.cityIndicators},dataByHoodYear:function(e,t){return e._col_indicators.filter(function(t){return t.areaCode===e.neighbourhood&&t.year===e.year})[0]||{}},dataByCityYear:function(e){return e.cityIndicators.filter(function(t){return t.year===e.year})[0]||{}},educationalByHood:function(e){console.log("edubyhood - init",e.geo.educational);var t=e.geo.educational.reduce(function(t,a){return a.feature.properties.mygeodat_5===e.neighbourhood&&t.push(a.feature.properties),t},[]);return console.log("edubyhood",t),t},educationalGeoByHood:function(e){if(!e.geo.educational)return[];var t=e.geo.educational.filter(function(t){return t.feature.properties.mygeodat_5===e.neighbourhood});return console.log("educational geo",t),t},selectedFeature:function(e){return e._col_features.filter(function(t){return t.feature.properties._id===e.selectedFeature})[0]},selectedAreas:function(e){return e._col_areas.filter(function(t){return t.layer===e._col_areaLayers_selected&&t.feature.properties.id})},selectedArea:function(e,t){return t.selectedAreas.filter(function(t){return t.feature.properties.id===e.neighbourhood})[0]},geojson:function(e){return e._col_features?e._col_features.map(function(e){return e.feature}):[]},selectedLayer:function(e){return e._col_layers?e._col_layers.filter(function(t){return t._id===e._col_layers_selected})[0]:null},selectedLayerAttributes:function(e){return e._col_layerAttributes?e._col_layerAttributes.filter(function(t){return t.layer===e._col_layers_selected}):null},selectedIndicatorBlocks:function(e){return e._col_indicatorBlocks?e._col_indicatorBlocks.filter(function(t){return t.active&&t.layer===e._col_indicatorSections_selected}):null},selectedIndicatorSection:function(e){return e._col_indicatorSections_selected?e._col_indicatorSections.filter(function(t){return t._id===e._col_indicatorSections_selected})[0]:null},allIndicatorsByYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.year?(e[t.year]=e[t.year]||[],e[t.year].push(kt(t)),e):e},{}):null},allIndicatorsByArea:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||[],e[t.areaCode].push(kt(t)),e):e},{}):null},allIndicatorsByAreaYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||{},e[t.areaCode][t.year]=t,e):e},{}):null},indicatorsForSelectedYear:function(e,t){if(t.allIndicatorsByYear)return t.allIndicatorsByYear[e.year]},indicatorsForSelectedArea:function(e,t){if(t.allIndicatorsByArea&&t.allIndicatorsByArea[e.neighbourhood])return t.allIndicatorsByArea[e.neighbourhood].sort(function(e,t){return e.year-t.year})},selectedIndicator:function(e,t){return a=[e.neighbourhood,e.year],r=t.allIndicatorsByAreaYear,(a="string"==typeof a?a.split("."):a)?a.reduce(function(e,t){return e&&e[t]?e[t]:null},r):r;var a,r}}});new c.default({router:yt,store:Ct,render:function(e){return e(pe)}}).$mount("#app")},47:function(e){e.exports=[{name:"building_use",label_en:"The current use of the building",label_ar:"ÿßŸÑÿ•ÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÑŸÑŸÖÿ®ŸÜŸâ",validation:"'required'",type:"radio",options:[{value:1,label_en:"For housing only",label_ar:"ŸÑŸÑÿ≥ŸÉŸÜ ŸÅŸÇÿ∑"},{value:2,label_en:"For housing and work",label_ar:"ŸÑŸÑÿ≥ŸÉŸÜ ŸàÿßŸÑÿπŸÖŸÑ"},{value:3,label_en:"For work only (workshops and shops)",label_ar:"(ŸÑŸÑÿπŸÖŸÑ ŸÅŸÇÿ∑(ŸÖÿ¥ÿßÿ∫ŸÑ ŸàÿØŸÉÿßŸÉŸäŸÜ"},{value:4,label_en:"Housing and General Facility",label_ar:"ÿ≥ŸÉŸÜ ŸàŸÖÿ±ŸÅŸÇ ÿπÿßŸÖ"},{value:5,label_en:"General annex",label_ar:"ŸÖÿ±ŸÅŸÇ ÿπÿßŸÖ"},{value:6,label_en:"Not used",label_ar:"ÿ∫Ÿäÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ"},{value:7,label_en:"Hangars for animals and birds",label_ar:"ÿ≠ÿ∏ÿßÿ¶ÿ± ŸÑŸÑÿ≠ŸäŸàÿßŸÜÿßÿ™ ŸàÿßŸÑÿ∑ŸäŸàÿ±"},{value:8,label_en:"For storage",label_ar:"ŸÑŸÑÿ™ÿÆÿ≤ŸäŸÜ"}]},{name:"housing_units",label_en:"Number of housing units",label_ar:"ÿπÿØÿØ ÿßŸÑÿ¥ŸÇŸÇ ŸÅŸä ÿßŸÑŸÖÿ®ŸÜŸâ",type:"text",validation:{required:!0}},{name:"building_stories",label_en:"Number of stories",label_ar:"ÿπÿØÿØ ÿ∑Ÿàÿßÿ®ŸÇ ÿßŸÑŸÖÿ®ŸÜŸâ",type:"text",validation:"required|numeric|min:1"},{name:"building_type",label_en:"The type building",label_ar:"ŸÜŸàÿπ ÿßŸÑŸÖÿ®ŸÜŸâ",type:"radio",validation:"'required'",options:[{value:1,label_en:"Villa or detached",label_ar:".ŸÅŸäŸÑÿß+ÿ®Ÿäÿ™ ŸÖÿ≥ÿ™ŸÇŸÑ"},{value:2,label_en:"Apartment",label_ar:"ÿπŸÖÿßÿ±ÿ©"},{value:3,label_en:"Tent",label_ar:"ÿÆŸäŸÖ Ÿàÿ®ÿ±ŸÉÿ≥ÿßÿ™"},{value:4,label_en:"Other",label_ar:"ÿ¥Ÿäÿ° ÿ¢ÿÆÿ±"}]},{name:"building_condition",label_en:"The state of the public building",label_ar:"ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ®ŸÜŸâ ÿßŸÑÿπÿßŸÖÿ© ",type:"text",validation:"'required'"},{name:"notes",label_en:"Notes",label_ar:"ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™",type:"textarea",validation:""}]},70:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){},75:function(e,t,a){},76:function(e,t,a){},77:function(e,t,a){},78:function(e,t,a){},95:function(e,t,a){var r=a(390);e.exports={layers:{name:"Layers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},data_type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Point",icon:"scatter_plot"},{name:"LineString",icon:"timeline"},{name:"MultiPolygon",icon:"bubble_chart"}]},spatial_intersect:{type:Array,_text:"Areas for Analysis",_multiple:!0,_options:function(e){return console.log("areas analysis select function"),e.state._col_areaLayers}},filtered:{type:Boolean,_text:"Filtered by area"}}},layerAttributes:{name:"Attributes",canPaste:!0,schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},func:{type:Array,_text:"Functions",_multiple:!0,_options:[{name:"count",color:"secondary"},{name:"sum",color:"tertiary"}],_computed:function(e,t,a,r){var i=e.state["_col_"+a].filter(function(e){return e.layer===r});if(i){var o=["count",""];return o="Number"===t.type?o.concat(["sum"]):o,i.reduce(function(e,t){return"Number"===t.type&&e.push("sum: "+t.name),e},o)}}},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},layerCalcs:{name:"Attributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},layer:{type:r.Schema.Types.ObjectId,required:!0},func:{type:Array,_text:"Functions",_multiple:!0,_combobox:!0,_categorised:!0,_options:function(e,t){var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{}),i=e.state._col_layerAttributes,o=r[e.state._col_layers_selected].spatial_intersect,n=a.reduce(function(e,t){return t.spatial_intersect.some(function(e){return o.indexOf(e)>-1})&&e.push(t._id),e},[]);return i.reduce(function(e,t){if(t.func.length>0){var a=n.indexOf(t.layer);if(a>-1){var i=n[a];e[i]=e[i]||{name:r[i].text_en,items:["count"]},t.func.forEach(function(a){a&&e[i].items.push(t.name+"."+a)})}}return e},{})}}}},indicatorSections:{name:"Sections",schema:{name:{type:String,required:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},geodata:{type:Array,_text:"Feature Layers",_multiple:!0,_options:function(e){return e.state._col_layers}}}},indicatorBlocks:{name:"Modules",canPaste:!0,schema:{type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Figure"},{name:"Chart"},{name:"Table"},{name:"List"}]},active:{type:Boolean,_text:"Active"},layer:{type:r.Schema.Types.ObjectId,required:!0},text_en:{type:String,required:!0,_text:"Name (English)"},text_ar:{type:String,_text:"Name (Arabic)"},areaLayer:{type:Array,_text:"Spatial Intersect",_multiple:!0,_options:function(e){return e.state._col_areaLayers}},figure:{type:Array,_text:"Figure",_categorised:!0,_options:function(e,t){if(!t.areaLayer)return{};var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{attached:{text_en:"Area"}}),i=e.state._col_areaAttributes.map(function(e){return e.func=["%%%"],e.layer="attached",e}),o=e.state._col_layerCalcs.map(function(e){return e.func=["%%%"],e}).concat(e.state._col_layerAttributes).concat(i);console.log("options layerAttrs",o);var n=a.reduce(function(e,a){return a.spatial_intersect.some(function(e){return t.areaLayer.indexOf(e)>-1})&&e.push(a._id),e},["attached"]),s=o.reduce(function(e,t){if(t.func.length>0){var a=n.indexOf(t.layer);if(a>-1){var i=n[a];e[i]=e[i]||{name:r[i].text_en,items:[]},t.func.forEach(function(a){a&&e[i].items.push((t.name+"."+a).replace(".%%%",""))})}}return e},{});return console.log("categorised options",s),s}},description_en:{type:String,_text:"Description (English)"},description_ar:{type:String,_text:"Description (Arabic)"},unit:{type:String,_text:"Unit"}}},features:{name:"Features",schema:"meta",params:"/:collection"},indicators:{name:"Indicators",schema:{},schemaOpts:{strict:!1}},areaLayers:{name:"AreasLayers",schema:{name:{type:String,required:!0,_text:"Name"},code:{type:String,required:!0,unique:!0,_text:"Column Name"}}},areas:{name:"Areas",schema:"spatial"},areaAttributes:{name:"Area Attributes",canPaste:!0,_description_en:"For non-spatial attribute data that is directly associatied with the spatial area i.e data from JIIS relating to a statistical area",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},buildings:{name:"Buildings",schema:"spatial"}}}});