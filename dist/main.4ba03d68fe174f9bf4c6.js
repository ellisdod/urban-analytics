!function(e){function t(t){for(var r,o,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)o=s[d],i[o]&&p.push(i[o][0]),i[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);p.length;)p.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,s=1;s<a.length;s++){var l=a[s];0!==i[l]&&(r=!1)}r&&(n.splice(t--,1),e=o(o.s=a[0]))}return e}var r={},i={0:0},n=[];function o(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=r,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;n.push([323,1]),a()}({125:function(e,t,a){"use strict";a.r(t),a.d(t,"translate",function(){return s});var r=a(3),i=a.n(r),n=a(27),o=a.n(n);function s(e,t,a){return t="string"==typeof t?[t]:t,function e(t,a,r){return t.reduce(function(t,n){if("object"===(void 0===n?"undefined":o()(n)))return a.forEach(function(e){n[e+"_"+r]&&(n[e]=n[e+"_"+r])}),i()(n).forEach(function(t){Array.isArray(n[t])&&e(n[t],a,r)}),(t=t||[]).push(n),t},[])}(e=Array.isArray(e)?e:[e],t,a)}},126:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticStyle:{background:"rgba(0,0,0,0.02)",border:"none"},attrs:{flat:""}},[a("table",{class:{mobile:e.$vuetify.breakpoint.xsOnly},attrs:{id:"navigator-key"}},[a("tr",{staticClass:"hidden-xs-only",attrs:{id:"navigator-header"}},[a("td",{attrs:{colspan:"2"}},[a("div",{staticClass:"subheading grey--text text--darken-2"},[e._v("\n          "+e._s(e.$store.state.navigator.indicator.name)+" - "+e._s(e.$store.state.year)+"\n          ")]),e._v(" "),a("div",{staticClass:"caption py-1"},[e._v("\n          "+e._s(e.details.neighbourhood)+"\n          "),a("div",{staticStyle:{height:"15px"}},[e._v("\n          "+e._s(e.details.value)+"\n        ")])])])]),e._v(" "),a("tr"),e._v(" "),a("tr",[a("td",{staticClass:"key-gradient ejmap-border"}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n            "+e._s(e.scale.max.toFixed(0))+"\n          ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n            "+e._s(e.scale.min.toFixed(0))+"\n          ")])])])]),e._v(" "),a("l-map",{ref:"map",attrs:{zoom:e.$store.state.navigator.zoom,center:e.$store.state.navigator.center,options:e.mapOptions,id:"navigation-map"},on:{click:function(t){return e.log()}}},e._l(e.$store.state._col_areas.filter(function(e){return e.feature}),function(t,r){return a("l-geo-json",{key:t._id,attrs:{geojson:t.feature,options:e.areasGeoJsonOptions,"options-style":e.getAreaStyle(t.feature.properties.id)}})}),1)],1)};r._withStripped=!0;var i=a(477),n=a(478),o=a(479),s=a(480),l=a(481),c=a(482),u=a(483),d=(a(5),a(42)),p=a.n(d),f=a(1),h=a.n(f),m=(a(466),{name:"MapView",components:{LMap:i.a,LTileLayer:n.a,LMarker:o.a,LPopup:s.a,LTooltip:l.a,LPolygon:c.a,LGeoJson:u.a},data:function(){var e=this;return{zoom:15,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',showParagraph:!1,details:{neighbourhood:"",value:"",key:""},detailsDefault:{neighbourhood:"",value:"",key:""},mapOptions:{zoomSnap:.5},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e,i=r.$store.getters.indicatorsForSelectedYear.filter(function(e){return e.areaCode===t.properties.id})[0];a.bindPopup("<p><b>"+t.properties.name+"</b></p><p>"+r.$store.state.navigator.indicator.name+": "+i[r.$store.state.navigator.indicator.figure]+"</p>"),a.on({click:function(e){console.log("nnnnn",i);var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.centroid_lng,lat:t.centroid_lat}})},mouseover:function(e){e.target.openPopup()},mouseout:function(e){r.details=r.detailsDefault,e.target.closePopup()}})}},layers:{areas:!0}}},computed:{scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return parseInt(t[e.$store.state.navigator.indicator.figure])}).sort(function(e,t){return e-t});return console.log("scale sorted",this.$store.state.navigator.indicator.figure,t),{min:t[0]||0,constant:t[t.length-1]-t[0]||0,max:t[t.length-1]||0}}},methods:{log:function(){},getAreaStyle:function(e){var t=p.a.scale(["#eaeaea",this.$vuetify.theme.primary]),a=this.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=t((a[this.$store.state.navigator.indicator.figure]-this.scale.min)/this.scale.constant),i=this.$store.state.neighbourhood===e?this.$vuetify.theme.tertiary:"#eee";return{weight:(this.$store.state.neighbourhood,1),color:i,opacity:1,fillColor:r,fillOpacity:1}},selectArea:function(e){},mouseoverArea:function(e){},centerMap:function(){var e=35.13-16175e-8*(window.innerWidth-800);console.log("navigation lng",e),this.$store.commit("UPDATE",{key:["navigator","center"],value:{lon:e,lat:this.$store.state.navigator.center.lat}})}},mounted:function(){var e=this;this.$refs.map.mapObject.on("click",function(e){console.log(e)}),this.$refs.map.mapObject.zoomControl.setPosition("bottomright"),this.$refs.map.mapObject.eachLayer(function(e){console.log("maplayer2",e)}),this.$nextTick(function(){var t=e.$refs.map.mapObject;console.log("panes",t.getPanes()),t.createPane("leaflet-top-pane",t.getPanes().mapPane);var a=t.getPane("leaflet-top-pane");a.style.zIndex=1e3,a.style.pointerEvents="none",t.getPanes().popupPane.style.zIndex=1010,h.a.mapboxGL({attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>',accessToken:"not-needed",pane:"leaflet-top-pane",style:"https://api.maptiler.com/maps/2785ad5b-ec8f-4c26-b65b-0fd7a95f2a2e/style.json?key=ArAI1SXQTYA6P3mWFnDs"}).addTo(e.$refs.map.mapObject)}),this.$vuetify.breakpoint.xsOnly&&(this.$store.commit("UPDATE",{key:["navigator","zoom"],value:11}),this.$store.commit("UPDATE",{key:["navigator","center"],value:this.$store.state.map.defaultCenter}))}}),y=(a(468),a(2)),v=Object(y.a)(m,r,[],!1,null,null,null);v.options.__file="src/components/MapNavigator.vue";t.a=v.exports},24:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"container",staticClass:"main-map",style:e.mapStyle},[e.layersSet?a("l-map",{ref:"map",style:{height:e.mapHeight},attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"map_"+e.featuresCollection},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["areas"===e.featuresCollection?a("l-geo-json",{attrs:{geojson:e.areasGeoJson,options:e.getGeoJsonOptions(),"options-style":e.getAreaStyle()}}):e._e(),e._v(" "),e._l(e.layers,function(t,r){return e.layers[r].on&&e.layers[r].features?a("l-geo-json",{directives:[{name:"else-if",rawName:"v-else-if",value:e.layersSet,expression:"layersSet"}],key:r,attrs:{geojson:e.layers[r].features,options:e.getGeoJsonOptions(r),"options-style":e.geoJsonStyle(r)}}):e._e()}),e._v(" "),a("div",{staticClass:"map-menu"},[a("v-menu",{attrs:{"min-width":"300px","close-on-content-click":!1,flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}],null,!1,3491234933)},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{staticClass:"pb-4",attrs:{dense:""}},[a("v-subheader",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return a("v-list-tile",[a("v-switch",{key:r,attrs:{color:"primary",label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})],1)}),e._v(" "),a("v-divider"),e._v(" "),a("v-subheader",[e._v("Legend")]),e._v(" "),a("v-list-tile",[a("v-switch",{attrs:{color:"primary",label:"Legend"},model:{value:e.showLegend,callback:function(t){e.showLegend=t},expression:"showLegend"}})],1),e._v(" "),e.surveyorAuth?[a("v-divider"),e._v(" "),a("v-subheader",[e._v("Surveys")]),e._v(" "),a("v-list-tile",[a("v-switch",{attrs:{color:"primary",label:"Survey Mode"},model:{value:e.editable,callback:function(t){e.editable=t},expression:"editable"}})],1),e._v(" "),a("v-list-tile",[a("layer-select",{attrs:{collection:"surveyLayers",label:"Select Survey",icon:"add"}})],1)]:e._e()],2)],1)],1)],2):e._e(),e._v(" "),e._l(e.layers,function(t,r){return"5d2f0b46fe977fdb42180cd2"===r&&t.on&&t.features?a("div",{staticClass:"map-info-panel ejmap-border-left ejmap-border-right"},[a("timeline",{attrs:{title:"Plan Submissions",features:t.features,figure:"timeline",dateKey:"date",attribute:t.attribute,labelKey:"plan_no",attributeStyle:t.attributes[t.attribute]}})],1):e._e()}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],style:{position:"absolute",top:"180px",zIndex:10,width:e.legendBottom?"100%":"70%"}},[a("div",{staticClass:"text-xs-center"},[a("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),a("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)]),e._v(" "),e.showLegend?a("div",{style:e.legendStyle,attrs:{id:"map-legend"}},[a("div",[e.options&&e.options.areaSelect?a("area-select",{staticClass:"ejmap-border-bottom px-3 pt-1",staticStyle:{flex:"0"},attrs:{titleclass:"pb-0 pt-3 px-3 font-weight-medium"}}):e._e()],1),e._v(" "),a("div",{staticStyle:{flex:"2","overflow-y":"auto","max-height":"85vh"}},[a("v-expansion-panel",{attrs:{expand:""},model:{value:e.layerPanels,callback:function(t){e.layerPanels=t},expression:"layerPanels"}},e._l(e.layers,function(t,r){return a("v-expansion-panel-content",{directives:[{name:"show",rawName:"v-show",value:t.showLegend,expression:"layer.showLegend"}],key:r,on:{click:function(t){return e.toggleLayer(r)}},scopedSlots:e._u([e.allLayers?{key:"header",fn:function(){return[e._v("\n        "+e._s(t.text_en)+"\n      ")]},proxy:!0}:null],null,!0)},[e._v(" "),a("v-card",{staticClass:"pt-2"},[a("v-card-text",{staticClass:"pa-0"},[a("div",{staticClass:"pt-1 px-3 grey--text text-uppercase"},[e._v("Filter")]),e._v(" "),a("v-list",e._l(t.filters,function(i,n,o){return t.on&&t.features?a("v-list-tile",{key:o,on:{click:function(a){return e.updateLayer(t._id,{key:"attribute",value:i.attribute})}}},[0!==o?[a("v-select",{staticClass:"caption",staticStyle:{flex:"3"},attrs:{items:["AND","OR"],value:"AND"}}),e._v(" "),a("v-btn",{staticStyle:{margin:"0px -10px -10px 10px"},attrs:{icon:""},on:{click:function(a){return e.removeFilter(t,n)}}},[a("v-icon",{attrs:{small:""}},[e._v("close")])],1)]:e._e(),e._v(" "),a("v-list-tile-content",[a("map-legend",{key:o,staticClass:"ejmap-border-bottom",attrs:{layer:t,attributes:t.attributes,attributeName:t.filters[n].attribute},on:{filterChange:function(a){e.updateLayer(t._id,a,"filters."+n),e.updateLayer(t._id,a)},layerChange:function(a){e.updateLayer(t._id,a)},toggleFeature:function(t){e.filterFeatures(r,t)}}})],1)],2):e._e()}),1),e._v(" "),a("div",{staticClass:"text-xs-right",staticStyle:{width:"100%"}},[a("v-btn",{staticClass:"caption grey--text",attrs:{depressed:"",color:"rgba(0,0,0,0)"},on:{click:function(a){return e.addFilter(t)}}},[e._v("Add filter"),a("v-icon",{attrs:{small:""}},[e._v("add")])],1)],1),e._v(" "),a("div",{staticClass:"px-3 grey--text text-uppercase"},[e._v("Opacity")]),e._v(" "),a("div",{staticClass:"px-3 caption grey--text text--darken-2",staticStyle:{display:"flex","flex-wrap":"wrap"}},[a("div",{staticClass:"caption mt-2",staticStyle:{flex:"1"}},[e._v("Fill")]),e._v(" "),a("v-slider",{staticClass:"px-2 mt-0",attrs:{min:"0",max:"100","track-color":"rgba(0,0,0,0)"},model:{value:t.fillOpacity,callback:function(a){e.$set(t,"fillOpacity",a)},expression:"layer.fillOpacity"}}),e._v(" "),a("div",{staticStyle:{"flex-basis":"100%"}}),e._v(" "),a("div",{staticClass:"caption mt-2",staticStyle:{flex:"1"}},[e._v("Stoke")]),e._v(" "),a("v-slider",{staticClass:"px-2 mt-0",attrs:{min:"0",max:"100","track-color":"rgba(0,0,0,0)"},model:{value:t.strokeOpacity,callback:function(a){e.$set(t,"strokeOpacity",a)},expression:"layer.strokeOpacity"}})],1)],1)],1)],1)}),1)],1)]):e._e(),e._v(" "),e.dialog&&e.editable?a("v-dialog",{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e.layersSet?a("l-map",{style:{height:"150px"},attrs:{zoom:18,center:e.$store.state.map.center,options:e.mapOptions,id:"preview_map"}},e._l(e.layers,function(t,r){return e.layers[r].on&&e.layers[r].features?a("l-geo-json",{directives:[{name:"else-if",rawName:"v-else-if",value:e.layersSet,expression:"layersSet"}],key:r,attrs:{geojson:e.layers[r].features,options:e.getGeoJsonOptions(r),"options-style":e.geoJsonStyle(r)}}):e._e()}),1):e._e(),e._v(" "),a("v-tabs",[e._l(e.editItems,function(t,r){return a("v-tab",{key:r},[e._v("\n      Record "+e._s(r+1)+"\n    ")])}),e._v(" "),a("v-tab",[e._v("\n      New Record\n    ")]),e._v(" "),e._l(e.editItems,function(t,r){return a("v-tab-item",{key:r},[a("editor",{attrs:{collection:"surveyRecords",filter:"surveyLayers",nestedPath:"properties",linkedFeature:e.$store.state._col_features_selected,editItem:t,permanent:!0},on:{close:function(t){return e.close()},update:function(){e.updateCollection("surveyRecords",e.$store.state._col_surveyLayers_selected).then(function(){return e.update()})}}})],1)}),e._v(" "),a("v-tab-item",[a("editor",{attrs:{collection:"surveyRecords",filter:"surveyLayers",nestedPath:"properties",linkedFeature:e.$store.state._col_features_selected,attributes:e.attributes,permanent:!0},on:{close:function(t){return e.close()},update:function(){e.updateCollection("surveyRecords",e.$store.state._col_surveyLayers_selected).then(function(){return e.update()})}}})],1)],2)],1):e._e()],2)};r._withStripped=!0;var i=a(21),n=a.n(i),o=a(27),s=a.n(o),l=a(3),c=a.n(l),u=a(314),d=a.n(u),p=a(7),f=a.n(p),h=a(477),m=a(478),y=a(479),v=a(480),_=a(481),g=a(482),b=a(483),x=function(){var e=this.$createElement;return(this._self._c||e)("div")};x._withStripped=!0;var k=a(1),S=a.n(k);a(371);if(void 0===S.a)throw new Error("leaflet library must be installed in order to use vue2-leaflet-vectorgrid.");if(void 0===S.a.vectorGrid)throw new Error("leaflet.vectorgrid library must be installed in order to use vue2-leaflet-vectorgrid.");var C={props:{url:{type:String,required:!0},options:{type:Object,default:function(){return{}}}},watch:{url:function(){this.updateLayer()},options:function(){this.updateLayer()}},mounted:function(){this.mapObject=S.a.vectorGrid.protobuf(this.url,this.options),this.$parent._isMounted&&this.deferredMountedTo(this.$parent.mapObject)},beforeDestroy:function(){this.removeLayer()},methods:{deferredMountedTo:function(e){this.mapObject.addTo(e),this.attributionControl=e.attributionControl;for(var t=0;t<this.$children.length;t++)"function"==typeof this.$children[t].deferredMountedTo&&this.$children[t].deferredMountedTo(this.mapObject)},setAttribution:function(e,t){this.attributionControl.removeAttribution(t),this.attributionControl.addAttribution(e)},setToken:function(e){this.options.token=e},removeLayer:function(){this.$parent.mapObject.removeLayer(this.mapObject)},updateLayer:function(){this.removeLayer(),this.mapObject=S.a.vectorGrid.protobuf(this.url,this.options),this.deferredMountedTo(this.$parent.mapObject)}}},w=a(2),$=Object(w.a)(C,x,[],!1,null,null,null);$.options.__file="public/Vue2LeafletVectorGridProtobuf.vue";var L=$.exports,A=a(127),j=a.n(A),O=(j()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.4},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.4},landcover:{fill:!0,weight:1,fillColor:"#53e033",color:"#53e033",fillOpacity:.1,opacity:.4},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.2,opacity:.4},park:{fill:!0,weight:1,fillColor:"#84ea5b",color:"#84ea5b",fillOpacity:.2,opacity:.4},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.2,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.2,opacity:.8}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.8}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[]),j()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.2},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.2},landcover:{fill:!0,weight:1,fillColor:"#fafafa",color:"#fafafa",fillOpacity:.1,opacity:.2},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.1,opacity:.2},park:{fill:!0,weight:1,fillColor:"#f3f3f3",color:"#f3f3f3",fillOpacity:.1,opacity:.2},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.1,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.1,opacity:.4}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.1,opacity:.4}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[])),E=a(5),I=(a(42),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-select",{staticClass:"caption grey--text pt-1",staticStyle:{width:"100%","margin-top":"-10px"},attrs:{color:"grey",items:Object.keys(e.attributes),value:e.attributeName},on:{change:function(t){e.updateFilter("attribute",t)}}}),e._v(" "),e.attribute&&e.attribute.range?a("div",{staticClass:"caption"},[e.attribute&&e.attribute.range?a("v-range-slider",{staticClass:"px-2 scale-gradient",attrs:{min:e.rangeMin,max:e.rangeMax,"track-color":"rgba(0,0,0,0)"},on:{end:function(t){e.updateFilter("range",e.range)}},model:{value:e.range,callback:function(t){e.range=t},expression:"range"}}):e._e(),e._v(" "),a("div",{staticStyle:{"margin-top":"-15px"}},[a("span",[e._v(e._s(e.range[0]))]),e._v(" "),a("span",{staticStyle:{float:"right"}},[e._v(e._s(e.range[1]))])])],1):e._e(),e._v(" "),e._l(e.valueStyles,function(t,r){return a("div",{key:r,staticClass:"caption px-0",staticStyle:{"background-color":"none"}},[a("v-switch",{attrs:{color:t.color,"input-value":t.on,label:t.name},on:{change:function(a){return e.updateFilterObject("categories",t.name,a)}}})],1)})],2)});I._withStripped=!0;var D={props:["layer","attributeName","attributes"],data:function(){return{range:[],fillOpacity:100*this.layer.fillOpacity,strokeOpacity:100*this.layer.strokeOpacity,rangeMin:"",rangeMax:""}},computed:{attribute:function(){return this.attributes[this.attributeName]},valueStyles:function(){return this.$store.getters.styles[this.layer._id][this.attributeName]}},methods:{updateLayer:function(e,t){this.$emit("layerChange",{key:e,value:t})},updateFilter:function(e,t){this.$emit("filterChange",{key:e,value:t})},updateFilterObject:function(e,t,a){var r={};r[t]=a,this.updateFilter(e,r)},setRange:function(){console.log("setting range"),this.attribute&&this.attribute.range&&(this.rangeMin=this.attribute.range.defaultMin,this.rangeMax=this.attribute.range.defaultMax,this.range=[this.rangeMin,this.rangeMax].slice(0))},toggleFeature:function(e,t){this.$emit("input",{val:e,attribute:t,range:this.range})}},watch:{attributeName:function(e,t){this.setRange()}},mounted:function(){this.setRange()}},T=(a(400),Object(w.a)(D,I,[],!1,null,null,null));T.options.__file="src/components/MapLegend.vue";var F=T.exports,P=a(53),U=a(87),M=a(86),B=a(52),N=(a(32),a(64)),q=a(38),z=(a(125),{name:"MapView",props:["featureLayers","featuresCollection","zoomLevel","options","areas","height","allLayers","legendBottom","editable"],components:{LMap:h.a,LTileLayer:m.a,LMarker:y.a,LPopup:v.a,LTooltip:_.a,LProtobuf:L,LPolygon:g.a,LGeoJson:b.a,MapLegend:F,AreaSelect:P.a,Editor:U.a,Timeline:M.a,LayerSelect:B.a},$_veeValidate:{validator:"new"},data:function(){return{layersSet:!1,dialog:!1,itemTemplate:{},layerPanels:[],loadingValue:null,loading:!1,language:"ar",languages:["ar","en"],basemaps:{url:"https://{s}.basemaps.cartocdn.com/{z}/{x}/{y}.png",url2:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",url3:"http://a.tile.openstreetmap.fr/hot/${z}/${x}/${y}.png "},center:S.a.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:S.a.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5,scrollWheelZoom:!1},layers:{},hidden:[],filtered:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!0},{text:"Detailed",type:"detailed",selected:!1}],baseMap:"basic",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}}}},computed:{surveyorAuth:function(){return N.getNested("state.activeUser.groups.Surveyor",this.$store)},attributes:function(){return this.featureLayers&&this.layers[this.featureLayers[0]]?this.layers[this.featureLayers[0]].attributes:null},showLegend:function(){return!this.hideLegend&&"areas"!==this.featuresCollection},featureLayersArray:function(){return this.featureLayers?Array.isArray(this.featureLayers)?this.featureLayers:[this.featureLayers]:[]},legendStyle:function(){var e=this.options?this.options.legendStyle:{};return f()({height:this.legendBottom?"200px":"auto",maxHeight:this.legendBottom?"200px":"none",maxWidth:this.legendBottom?"none":"300px",width:this.legendBottom?"100%":"auto",overflowY:"auto",overflowX:"visible!important"},e||{})},infoStyle:function(){return 0===this.legendStyle.left?{right:0}:{left:0}},widthSmall:function(){return!!(this.$refs.container&&this.$refs.container.clientWidth<300)},mapHeight:function(){var e=document.getElementsByTagName("nav")[0].clientHeight;return this.height||window.innerHeight-e+"px"},mapStyle:function(){var e=this.options?this.options.mapStyle:{};return f()({display:this.legendBottom?"block":"flex"},e||{})},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return d()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:O,maxNativeZoom:18,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},areasGeoJson:function(){var e=this.$store.getters.selectedAreas;return e?this.embedIds(e):null},editItems:function(){return this.$store.getters.surveyRecordsByFeature[this.$store.state._col_features_selected]}},methods:{addFilter:function(e){var t=c()(e.filters).slice(-1)[0];t=parseInt(t)+1;var a=c()(e.attributes);this.$set(e.filters,t.toString(),{attribute:a[t]})},removeFilter:function(e,t){this.$delete(e.filters,t.toString())},toggleLayer:function(e){},filterFeatures:function(e){console.log("filterFeatures");var t=this.layers[e],a=this.$store.state["_col_"+this.featuresCollection][e],r=c()(t.filters).reduce(function(e,a){var r=t.filters[a];return r.range?e=e.filter(function(e){return t=e,a=r.attribute,i=r.range[0],n=r.range[1],(o=t.feature.properties[a])>=i&&o<=n;var t,a,i,n,o}):r.categories&&(e=e.filter(function(e){return t=e,a=r.attribute,!1!==r.categories[t.feature.properties[a]];var t,a})),e},a);t.features=r.map(function(e){return e.feature}),this.update()},openMavatPlan:function(e){window.open().document.write('<html><body>\n        <form action="http://mavat.moin.gov.il/MavatPS/Forms/SV4.aspx?tid=4" method="post" name="redirect_form">\n        <input type="hidden" name="PL_ID" value="'+e+'">\n        <v-btn type="submit">Go to mavat website<v-btn>\n        </form></body></html>')},embedIds:function(e){return e.reduce(function(e,t){return t.feature.properties._id=t._id,e.push(t.feature),e},[])},close:function(){this.dialog=!1},getGeoJsonOptions:function(e){if("areas"===this.featuresCollection)return this.geoJsonAreaOptions;var t=this.layers[e].data_type,a={onEachFeature:this.featureInteract};if("Point"===t){var r=this;a.pointToLayer=function(t,a){return S.a.circleMarker(a,r.getLegendStyle(t,e))}}return a},featureInteract:function(e,t){var a=this,r=e.properties,i=c()(e.properties).reduce(function(e,t){return e+"<tr><td><b>"+t+"<b><td><td>"+r[t]+"</td><tr>"},"<table>")+"</table>";r.mavat_code&&(i=i+"<br><a onclick=\" let w = window.open();w.document.write('<html><body><form action=&quot;http://mavat.moin.gov.il/MavatPS/Forms/SV4.aspx?tid=4&quot; method=&quot;post&quot; name=&quot;redirect_form&quot;><input type=&quot;hidden&quot; name=&quot;PL_ID&quot; value=&quot;"+r.mavat_code+"&quot;><button type=&quot;submit&quot;>Go to mavat website</button></form></body></html>')\">Go to mavat</a>"),t.bindPopup(i),t.on({click:function(e){var t=e.target.feature.properties;a.openEditor(t._id),a.$store.commit("UPDATE",{key:"_col_features_selected",value:t._id}),a.$store.commit("UPDATE",{key:["map","center"],value:{lng:(e.target._bounds._northEast.lng+e.target._bounds._southWest.lng)/2,lat:(e.target._bounds._northEast.lat+e.target._bounds._southWest.lat)/2}}),console.log(e),a.$nextTick(function(){return a.$forceUpdate()})}})},geoJsonStyle:function(e){var t={},a=this;return function(r){return a.getLegendStyle(r,e,t)}},getLegendStyle:function(e,t,a){var r=this.layers[t],i=r.attribute,n=r.attributes[i],o=e.properties[i];a=f()({radius:4,fillColor:this.$store.state.colors[2],color:this.$store.state.colors[2],weight:1.5,stroke:!0,opacity:r.strokeOpacity/100,fillOpacity:r.fillOpacity/100},a);var s="fillColor";return e.geometry.type.indexOf("LineString")>-1&&(a.stroke=!0,s="color"),this.editable&&this.$store.getters.surveyRecordsByFeature[e.properties._id]&&(a.fillColor=a.color="green"),e.properties._id===this.$store.state._col_features_selected&&(a.color="red",a.weight=3),n?(n.categories?a[s]=n.categories[o].color:n.range?a[s]=this.$store.state.colorScale(1-(o-r.colorRange[0])/r.colorConstant).hex():(a.fillOpacity=0,a.opacity=0),a):a},getAreaStyle:function(){var e=this,t={weight:2,color:"grey",opacity:.4,fillColor:"grey",fillOpacity:.2};return function(a){return e.$store.state.neighbourhood===a.properties.areaCode?f()({},t,{color:"orange",fillColor:"orange"}):t}},updateBaseMap:function(e,t){this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return S.a.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;E.a.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;E.a.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){document.getElementsByClassName("v-toolbar__extension")[0].style.overflow="auto"},500)},update:function(){var e=this;this.$nextTick(function(){return e.$forceUpdate()});var t=this.$children[0]?this.$children[0].mapObject:null;t&&setTimeout(function(){return t.invalidateSize()},500)},layerOn:function(e,t){console.log("turning on layer: "+e,t),e="number"==typeof e?c()(this.layers)[e]:e,this.layers[e]&&(this.$set(this.layers[e],"on",t),this.$set(this.layers[e],"showLegend",this.allLayers||t));var a=c()(this.layers).indexOf(e);this.$set(this.layerPanels,a,t)},updateLayer:function(e,t,a){console.log("updating Layer");var r=this.layers[e],i=a?N.getNested(a,r):r;if("object"===s()(t.value))for(var n in i[t.key]||this.$set(i,t.key,{}),t.value)this.$set(i[t.key],n,t.value[n]);else i[t.key]=t.value;"range"===t.key&&(this.$set(r,"colorRange",t.value),this.$set(r,"colorConstant",t.value[1]-t.value[0])),this.filterFeatures(e)},updateRange:function(e){var t=this.layers[e.layer].attribute,a=this.layers[e.layer].attributes[t];this.$set(a,"range",{max:e.range[1],min:e.range[0],constant:e.range[1]-e.range[0]}),this.$forceUpdate()},addRanges:function(e,t){var a=this,r=this.layers[e];if(!t)return null;c()(r.attributes).forEach(function(e){if("Number"===r.attributes[e].type){var i=N.sortNumbers(t,"feature.properties."+e);i.defaultMin=i.min,i.defaultMax=i.max,a.$set(r.attributes[e],"range",i),e===r.attribute&&(r.colorRange=[i.min,i.max],r.colorConstant=i.max-i.min)}})},updateCollection:function(e,t){return this.$store.dispatch("UPDATE_COLLECTION",{name:e,layer:t})},checkForUpdate:function(){var e=this;if(!this.layers)return null;console.log("checking for update");var t=this.$store.state["_col_"+this.featuresCollection],a=c()(this.layers).reduce(function(a,r){var i=e.layers[r];return i.on?(a.push(new n.a(function(a,n){var o={},s=i.filtered,l=t[r]?t[r].length:0;if(e.loading||0!==l&&!s)return o[r]=t[r],a(o);e.loading=!0,e.updateCollection(e.featuresCollection,r).then(function(t,i){return i&&console.log("update error",i),e.loading=!1,o[r]=t,a(o)})})),a):a},[]);n.a.all(a).then(function(t){t.forEach(function(t){var a=c()(t)[0];e.addRanges(a,t[a]),e.filterFeatures(a)}),e.update()})},setLayers:function(){var e=this,t=this.$store.getters.styles,a=q[this.featuresCollection],r=(this.allLayers,this.$store.state["_col_"+a.layerCollection]);console.log("running set layers. total layers: "+r.length),r.forEach(function(a,r){var i=f()({features:"",legend:"",fillOpacity:60,strokeOpacity:80,filters:{0:{}},colorRange:null,colorConstant:null},a),n=t[i._id],o=e.featureLayersArray.indexOf(i._id)>-1;e.layerPanels.push(o),i.on=e.layerPanels[r],i.showLegend=e.allLayers||e.layerPanels[r],i.attributes=e.$store.state._col_layerAttributes.reduce(function(e,t){return t.legend&&t.layer===i._id&&(e[t.name]=t),e[t.name]&&n&&(e[t.name].categories=n[t.name]),e},{}),i.attribute=c()(i.attributes)[0],i.filters[0].attribute=i.attribute,e.$set(e.layers,i._id,i)}),this.layersSet=!0},openEditor:function(e){if(console.log("editor",e),!this.editable)return null;this.dialog=!0}},created:function(){this.setLayers()},watch:{featureLayers:function(e,t){if(e===t)return null;console.log("layeron: "+e+" layerOff:"+t),this.layerOn(t,!1),this.layerOn(e,!0)},layerPanels:function(e,t){console.log("layerPanels",e,t),this.checkForUpdate()},legendBottom:function(e){var t=this;this.$nextTick(function(){return t.$refs.map.mapObject.invalidateSize()})}},mounted:function(){var e=this;this.$nextTick(function(){e.editFeatureDefaults=f()({},e.editFeature)}),this.$nextTick(function(){S.a.mapboxGL({accessToken:"not-needed",style:"https://api.maptiler.com/maps/cf2300ae-87ee-48ba-8e4f-cfd93d0d461e/style.json?key=ArAI1SXQTYA6P3mWFnDs"}).addTo(e.$refs.map.mapObject)}),this.$store.watch(function(e){return e.neighbourhood},this.checkForUpdate)}}),Y=(a(465),Object(w.a)(z,r,[],!1,null,null,null));Y.options.__file="src/components/MapView.vue";t.a=Y.exports},318:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var r=function(){return{sum:function(e,t){return e.reduce(function(e,a){if(!a.feature.properties.mygeodat_5)return e;var r=a.feature.properties;return["total",a.feature.properties.mygeodat_5.toString()].forEach(function(a){e[a]=e[a]||{},e[a].types=e[a].types||{},t.forEach(function(t){"string"==typeof r[t]?e[a].types[r[t]]=e[a].types[r[t]]?e[a].types[r[t]]+1:1:e[a][t]=e[a][t]?e[a][t]+parseInt(r[t]):r[t]||0})}),e},{})}}}},321:function(e,t,a){"use strict";var r=a(8),i=a(129),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.$vuetify.breakpoint.xsOnly?a("div",[a("layer-select",{staticClass:"pa-2 px-3 ejmap-border-top ejmap-border-bottom",staticStyle:{"z-index":"4","background-color":"white"},attrs:{collection:"indicatorSections"}}),e._v(" "),a("v-carousel",{staticStyle:{"z-index":"2"},attrs:{id:"indicators-carosel",cycle:!1,"hide-controls":"","hide-delimiters":"",light:"",height:e.carouselHeight},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.items,function(t,r){return a("v-carousel-item",{key:r},[a("indicator-card",{attrs:{item:t,selected:e.selected===r,lazy:""}})],1)}),1)],1):a("div",{staticClass:"flex-contents"},[a("v-navigation-drawer",{staticStyle:{"z-index":"2",background:"none","padding-top":"40px"},attrs:{permanent:"",clipped:"",width:"200"}},[a("editable-data-list",{staticStyle:{background:"none"},attrs:{disabled:!0,collection:"indicatorSections"}})],1),e._v(" "),a("div",{staticStyle:{flex:"2","overflow-y":"auto"}},[a("v-container",{attrs:{fluid:"","pa-0":"","pb-5":""}},[a("v-layout",{attrs:{row:"",wrap:"","fill-height":"",pb5:"","pa-0":""}},[a("v-flex",{staticStyle:{"z-index":"2"},attrs:{xs12:"","pa-4":"","d-flex":""}},[a("div",{staticStyle:{position:"relative",display:"block",width:"100%",flex:"1"}},[a("div",{staticClass:"title mb-4 pt-1 pb-3 hidden-xs-only ejmap-border-bottom"},[a("div",{staticClass:"mr-4",staticStyle:{display:"inline-block",float:"left","margin-top":"6px"}},[e._v("  "+e._s(e.section.text_en)+" ")]),e._v(" "),a("area-select",{staticClass:"title font-weight-light"})],1),e._v(" "),e._l(e.figures,function(t,r){return a("indicator-card",{key:r,staticStyle:{"margin-bottom":"20px"},attrs:{item:t,selected:e.selected===t._id},on:{childClick:function(a){return e.updateSelected(t._id)}}})}),e._v(" "),e.charts?a("div",[a("div",{staticClass:"title mb-4 pt-1 pb-3 ejmap-border-bottom"}),e._v(" "),a("v-flex",{attrs:{xs12:"",sm6:""}},e._l(e.charts,function(t,r){return a("indicator-card",{key:r,staticStyle:{"margin-bottom":"20px"},attrs:{item:t,selected:e.selected===t._id},on:{childClick:function(a){return e.updateSelected(t._id)}}})}),1)],1):e._e(),e._v(" "),e.map?a("div",[a("div",{staticClass:"subheading mt-5 pt-4 pb-2 ejmap-border-top"},[a("span",{staticClass:"mr-3"},[e._v("Map")]),a("span",{staticClass:"font-weight-light"},[e._v(e._s(e.map.text))])]),e._v(" "),a("map-view",{staticClass:"ejmap-border",staticStyle:{position:"relative"},attrs:{contextmenu:"",featuresCollection:"features",zoomLevel:"12",height:"400px",featureLayers:e.map.figure,areas:!0}})],1):e._e()],2)])],1)],1)],1),e._v(" "),a("v-navigation-drawer",{staticStyle:{flex:"1"},attrs:{permanent:"",clipped:"",right:""}},[a("map-navigator",{staticClass:"ejmap-border-left",class:{mobile:e.$vuetify.breakpoint.xsOnly},attrs:{id:"map-panel-navigator"}})],1)],1)};n._withStripped=!0;var o=a(51),s=a(28),l=s.d.reactiveProp,c={extends:s.b,mixins:[o.a,l],mounted:function(){this.renderChart(this.chartData,this.options)}},u=s.d.reactiveProp,d={extends:s.a,mixins:[u,o.a],mounted:function(){this.renderChart(this.chartData,this.options)}},p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{class:[{selected:e.selected&&e.$vuetify.breakpoint.smAndUp},"indicator-hover"],staticStyle:{background:"none"},attrs:{flat:""},on:{click:function(t){return e.updateIndicator()}}},["List"===e.type&&e.selectedIndicator?a("div",[a("v-list",e._l(e.selectedIndicator[e.figure[0]],function(t,r){return a("v-list-item",[a("v-list-tile-action",[e._v("\n            "+e._s(r)+"\n          ")]),e._v(" "),a("v-list-tile-content",[e._v("\n            "+e._s(t)+"\n          ")])],1)}),1)],1):"Figure"===e.type&&e.selectedIndicator?a("v-layout",{staticClass:"pa-3",staticStyle:{position:"relative",background:"white"},attrs:{"align-center":"",wrap:""}},[a("v-flex",{attrs:{"order-xs1":"",xs4:"",sm4:"",md3:""}},[a("div",{staticClass:"subheading font-weight-light"},[e._v(e._s(e.name))]),e._v(" "),"Figure"===e.type?a("div",{staticStyle:{"overflow-x":"visible",display:"inline-block","white-space":"nowrap",height:"55px"}},[a("span",{staticClass:"display-1 py-0"},[e._v(e._s(e.selectedIndicator[e.figure[0]]||0))]),e._v(" "),e.unit?a("span",{staticClass:"subheading ml-1"},[e._v(e._s(e.unit))]):e._e()]):e._e(),e._v(" "),a("div",{staticClass:"font-weight-light"},[e._v(e._s(e.year))])]),e._v(" "),a("v-flex",{class:{"mb-5":e.selected&&e.$vuetify.breakpoint.smOnly,"my-3":e.selected&&e.$vuetify.breakpoint.xsOnly},attrs:{"order-xs3":"","order-sm2":"",xs10:"","xs-offset2":"",sm8:"","sm-offset-4":"",md5:"","pt-3":""}},[a("div",{style:e.chartWidthClass},["Figure"===e.type?a("bar-vertical",{staticClass:"bar-chart-minimal mt-4",attrs:{"chart-data":e.prepBarChartData,"click-handler":!0,"x-labels":!1,"y-labels":!1}}):e._e()],1)]),e._v(" "),a("v-flex",{class:{"hidden-sm-and-down":!e.selected},attrs:{"order-xs2":"",xs8:"","offset-xs0":"","order-sm3":"","offset-md1":"",md3:"",mt4:""}},[a("v-sparkline",{attrs:{value:e.timeChartData,color:e.chartColor,height:"70",smooth:"","stroke-linecap":"square","line-width":"8",width:"700"}}),e._v(" "),a("v-slider",{staticStyle:{width:"100%","margin-top":"0px","margin-bottom":"-30px"},attrs:{"track-color":"transparent","always-dirty":"","inverse-label":"","tick-labels":e.makeSliderLabels(e.dataYears),ticks:"always","tick-size":2,min:e.dataYears[0],max:e.dataYears[e.dataYears.length-1],"z-index":"500"},model:{value:e.selectedYear,callback:function(t){e.selectedYear=t},expression:"selectedYear"}})],1)],1):"Chart"===e.type?a("div",{staticClass:"pa-3",staticStyle:{background:"white"}},[a("div",{staticClass:"subheading font-weight-light"},[e._v(e._s(e.name))]),e._v(" "),a("bar-vertical",{staticStyle:{height:"300px","margin-bottom":"-40px"},attrs:{"x-labels":!0,"y-labels":!0,"chart-data":e.generateChartDataSets}})],1):e._e(),e._v(" "),e.selected?a("div",{staticClass:"pa-3",staticStyle:{"background-color":"rgba(0,0,0,0.03)"}},[a("v-flex",{staticClass:"grey--text text--darken-1",attrs:{xs12:""}},[a("div",[a("span",[e._v("Source:")]),a("a",{attrs:{href:e.layer.sourceUrl}},[e._v(e._s(e.layer.sourceShort))])]),e._v(" "),a("div",[a("span",[e._v("Notes:")]),e._v(e._s(e.description))])]),e._v(" "),a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticStyle:{position:"absolute",bottom:"5px",right:"5px"},attrs:{icon:""},on:{click:e.exportToCsv}},r),[a("v-icon",{attrs:{color:"grey"}},[e._v("get_app")])],1)]}}],null,!1,547078210)},[e._v(" "),a("span",[e._v("Download data")])])],1):e._e()],1)};p._withStripped=!0;var f=a(3),h=a.n(f),m=a(316),y=a.n(m),v=a(15),_=a.n(v),g={components:{BarVertical:d},data:function(){return{expand:!1,rotation:0,selectedYear:""}},props:["name","figure","description","unit","type","small","noChart","selected"],methods:{makeSliderLabels:function(e){for(var t=e[0],a=e[e.length-1]-t+1,r=[],i=0;i<a;i++){var n=t+i;r.push(e.indexOf(n)>-1?n:"")}return r},clickHandler:function(){},toggleRotate:function(){this.selected||(this.rotation=0===this.rotation?180:0)},updateIndicator:function(){if(this.$emit("childClick"),!this.figure[0]||!this.year||this.figure[1])return null;this.$store.commit("UPDATE",{key:["navigator","indicator"],value:{figure:this.figure[0],name:this.name}}),this.$store.commit("UPDATE",{key:"year",value:this.year})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},validateYear:function(e){for(var t=e,a=0;a<this.dataYears.length;a++){if(-1!==this.dataYears.indexOf(t)){this.selectedYear=t;break}t++}return!0},exportToCsv:function(){var e=this,t=function(e){for(var t="",a=0;a<e.length;a++){var r=null===e[a]?"":e[a].toString();e[a]instanceof Date&&(r=e[a].toLocaleString());var i=r.replace(/"/g,'""');i.search(/("|,|\n)/g)>=0&&(i='"'+i+'"'),a>0&&(t+=","),t+=i}return t+"\n"},a=this.figure[0],r=this.unit?this.name+" ("+this.unit+")":this.name,i=this.$store.getters.allIndicatorsByAreaYear,n=[[r],["Source",this.layer.sourceLong||""],["Link",this.layer.sourceUrl||""],["-"],["Name","Code"].concat(y()(this.dataYears))];n=h()(i).reduce(function(t,r){var n=[e.$store.getters.areaNames[r],r];return e.dataYears.forEach(function(e){var t=i[r][e][a]||"";n.push(t)}),t.push(n),t},n);for(var o=this.name.toLowerCase().replace(/[\s\.]/g,"_")+".csv",s="",l=0;l<n.length;l++)s+=t(n[l]);var c=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(c,o);else{var u=document.createElement("a");if(void 0!==u.download){var d=URL.createObjectURL(c);u.setAttribute("href",d),u.setAttribute("download",o),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)}}}},computed:{chartColor:function(){return this.selected?this.$vuetify.theme.primary:_.a.grey.lighten2},layer:function(){var e=this.figure[0].split(".")[0],t=this.$store.state._col_layers.filter(function(t){return t._id===e})[0];return t||{}},rotateStyle:function(){return{transform:"rotate("+this.rotation+"deg)"}},getDataByHoodYear:function(){var e=this;return this.$store.getters.dataByNeighbourhood.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByCityYear:function(){var e=this;return this.$store.state.cityIndicators.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByYear:function(){var e=this;return this.$store.state.indicators.filter(function(t){return t.year===e.thisYear})||[]},areaDataMatched:function(){var e=this;return this.$store.getters.indicatorsForSelectedArea.filter(function(t){return e.dataYears.some(function(e){return t.year===e})})},areaDataLatest:function(){return this.areaDataMatched?this.areaDataMatched[this.areaDataMatched.length-1]:null},latestYear:function(){if(this.areaDataLatest)return this.selectedYear},year:function(){return this.selectedYear||this.latestYear},selectedIndicator:function(){if(!this.dataYears||!this.selectedYear)return{};var e=this.areaDataMatched[this.dataYears.indexOf(this.selectedYear)];return e||((e={})[this.figure[0]]=0),e},dataYears:function(){return this.$store.getters.allIndicatorKeyYears[this.figure[0]]},generateChartDataSets:function(){var e=this;if("Chart"!==this.type||!this.selectedIndicator)return null;var t=this.selected?this.$vuetify.theme.primary:this.$vuetify.theme.grey;return{datasets:[{data:this.figure.map(function(t){return e.selectedIndicator[t]}),borderColor:t,type:"line",fill:!1}],labels:this.figure.map(function(e){return e.split(".").slice(-1)[0]})}},chartWidthClass:function(){var e={position:"relative",width:"95%"};return"Chart"!==this.type&&(e.marginTop="-60px"),"Chart"!==this.type&&this.$vuetify.breakpoint.smAndUp&&(e.marginTop="-60px",e.width="100%",e.paddingLeft="0"),e},prepBarChartData:function(){if(" Figure"===!this.type)return{};var e=this.figure,t=this.$store.state.neighbourhood,a=this.name,r=this.selected?this.$vuetify.theme.primary:_.a.grey.lighten1,i=this.$store.getters.allIndicatorsByYear;if(!i||!this.year)return{};var n=(i=(i=i[this.year]).map(function(t){return t[e]=t[e]||0,t})).sort(function(t,a){return!a[e]-!t[e]||+(t[e]>a[e])||-(t[e]<a[e])}),o=this.$store.getters.areaNames;this.$store.getters.selectedAreas;return{labels:n.map(function(e){return o[e.areaCode]}),area_code:t,datasets:[{label:a,backgroundColor:n.map(function(e){return e.areaCode===t?r:_.a.grey.lighten3}),borderWidth:1,borderColor:_.a.grey.lighten2,data:n.map(function(t){return t[e]})}]}},timeChartData:function(){var e=this,t=this.figure[0];return this.$store.getters.indicatorsForSelectedArea.filter(function(t){return e.dataYears.indexOf(t.year)>-1}).map(function(e){return e[t]})}},watch:{selectedYear:function(e,t){this.validateYear(e)},areaDataLatest:function(e){this.selectedYear=e.year}},mounted:function(){var e=this;this.$nextTick(function(){e.areaDataLatest?e.selectedYear=e.areaDataLatest.year:e.selectedYear=e.dataYears[e.dataYears.length-1],e.selected&&e.updateIndicator()})}},b=(a(470),a(2)),x=Object(b.a)(g,p,[],!1,null,null,null);x.options.__file="src/components/IndicatorKeyStat.vue";var k=x.exports,S=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mt-5 mb-4",staticStyle:{background:"none"}},[t("div",{staticClass:"grey--text text--darken-2",staticStyle:{"text-transform":"uppercase","font-size":"18px",background:"none"}},[this._v(this._s(this.text))]),this._v(" "),t("v-divider",{staticClass:"my-2"})],1)};S._withStripped=!0;var C={props:["text"]},w=Object(b.a)(C,S,[],!1,null,null,null);w.options.__file="src/components/IndicatorHeading.vue";var $=w.exports;var L=a(125),A=a(24),j=a(126),O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"editable-datatable"},[a("div",[e.datatable?a("div",[a("v-toolbar",{attrs:{flat:"",color:"rgba(0,0,0,0)"}},[a("v-toolbar-title",{staticClass:"grey--text text--darken-2 font-weight-light"},[e._v(e._s(e.title))]),e._v(" "),a("v-spacer"),e._v(" "),e.searchable?a("v-text-field",{staticClass:"mt-2 mr-3",attrs:{label:"Search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}):e._e(),e._v(" "),a("v-toolbar-items",{staticClass:"hidden-xs-only"},[e.multiselect?a("v-checkbox",{class:["mr-2",{"mt-3":e.$vuetify.breakpoint.mdAndUp,"mt-2":e.$vuetify.breakpoint.smAndDown}],attrs:{color:"grey",flat:"",label:"Select All"},on:{change:function(t){return e.toggleSelectAll()}},model:{value:e.selectAll,callback:function(t){e.selectAll=t},expression:"selectAll"}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1):e._e(),e._v(" "),e.multiselect?a("v-btn",{attrs:{color:"grey",flat:""},on:{click:function(t){return e.deleteSelected(e.collection)}}},[e._v("\n            Delete Selected\n          ")]):e._e(),e._v(" "),a("v-btn",{attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1)],1)],1),e._v(" "),e.items?a("v-data-table",{staticClass:"ejmap-border",class:e.cssclass,attrs:{headers:e.featureHeaders,items:e.items,"rows-per-page-items":[20,50,100],search:e.search},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",{staticClass:"attribute-row",on:{dblclick:function(a){return e.openEditor(t.item)}}},e._l(e.featureHeaders,function(r,i){return a("td",{class:[0===i?"font-weight-medium":"",r.type===Boolean?"text-xs-center":""]},[r.type===Array?e._l(e.getNested(r.value,t.item),function(t){return a("v-chip",{class:"func-"+t,attrs:{outline:"",small:""}},[e._v("\n              "+e._s("object"==typeof t?t["text_"+e.$store.state.language]||t["name_"+e.$store.state.language]||t.text||t.name:t)+"\n            ")])}):r.type===Boolean&&!0===e.getNested(r.value,t.item)?a("v-icon",{attrs:{small:"",color:"primary"}},[e._v("\n           check_circle\n         ")]):"select"===r.type?a("v-checkbox",{staticStyle:{"padding-bottom":"0"},attrs:{color:"grey"},model:{value:t.item._selected,callback:function(a){e.$set(t.item,"_selected",a)},expression:"props.item._selected"}}):[e._v("\n          "+e._s(e.getNested(r.value,t.item))+"\n        ")],e._v(" "),i===e.featureHeaders.length-1?a("div",{staticClass:"attribute-controls-wrapper"},[a("div",{staticClass:"attribute-controls",staticStyle:{top:"-30px"}},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.openEditor(t.item)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t.item._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()],2)}),0)]}}],null,!1,232958713)}):e._e(),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e()],1):a("div",[e.addtop?a("v-btn",{staticClass:"mb-2",staticStyle:{"margin-top":"-40px",float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e(),e._v(" "),a("v-list",{class:e.cssclass,attrs:{dense:""}},e._l(e.listItems,function(t,r){return a("v-list-tile",{key:r,staticClass:"attribute-row",on:{click:function(a){return e.select(r,t._id)}},model:{value:t.active,callback:function(a){e.$set(t,"active",a)},expression:"x.active"}},[e.listKey&&e.schema.schema[e.listKey]._options&&e.schema.schema[e.listKey]._options[0]?a("v-list-tile-action",[a("v-icon",[e._v(e._s(e.schema.schema[e.listKey]._options.filter(function(a){return a.name===t[e.listKey]})[0].icon)+" ")])],1):e._e(),e._v(" "),a("v-list-tile-content",[t._id?a("div",{staticClass:"attribute-controls-wrapper"},[e._v("\n        "+e._s(t.text||t.text_en||t.name)+"\n        "),e.disabled?e._e():a("div",{staticClass:"attribute-controls"},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.openEditor(t)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()]),e._v(" "),t.active?a("div",{staticStyle:{height:"100%"}}):e._e()],1)}),1),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.openEditor()}}},[a("v-icon",[e._v("add")]),e._v("Add\n")],1):e._e()],1)]),e._v(" "),e.schema&&e.dialog?a("v-dialog",{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("editor",{attrs:{collection:e.collection,filter:e.filter,editItem:e.editItem,nestedPath:e.nestedPath},on:{close:function(t){return e.close()},update:function(t){return e.updateCollection(!0)}}})],1):e._e()],1)};O._withStripped=!0;var E=a(21),I=a.n(E),D=a(49),T=a.n(D),F=a(33),P=a.n(F),U=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("form",{attrs:{enctype:"multipart/form-data",novalidate:""},on:{submit:function(t){return t.preventDefault(),e.processForm(t)}}},[a("div",{staticClass:"dropbox pa-3",staticStyle:{"background-color":"#fff"}},[a("input",{ref:"file",staticClass:"input-file",attrs:{type:"file",name:e.uploadFieldName},on:{change:function(t){return e.filesChange()}}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"function",items:e.uploadFunctions,label:"Function"},model:{value:e.uploadFunction,callback:function(t){e.uploadFunction=t},expression:"uploadFunction"}}):e._e(),e._v(" "),"update"==e.uploadFunction?a("div",[a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Existing Records"},model:{value:e.update.matchExisting,callback:function(t){e.$set(e.update,"matchExisting",t)},expression:"update.matchExisting"}}),e._v(" "),a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Upload"},model:{value:e.update.matchUpload,callback:function(t){e.$set(e.update,"matchUpload",t)},expression:"update.matchUpload"}}),e._v(" "),a("v-text-field",{attrs:{label:"Update Key"},model:{value:e.update.key,callback:function(t){e.$set(e.update,"key",t)},expression:"update.key"}})],1):e._e(),e._v(" "),a("v-select",{attrs:{name:"collection",items:e.collections,label:"Collection"},model:{value:e.collection,callback:function(t){e.collection=t},expression:"collection"}}),e._v(" "),a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"format",items:e.indicatorFormats,label:"Format"},model:{value:e.indicatorFormat,callback:function(t){e.indicatorFormat=t},expression:"indicatorFormat"}}):e._e(),e._v(" "),e.isSaving?a("v-checkbox",{attrs:{name:"discardOutliers",label:"Discard features outside of layer"},model:{value:e.discardOutliers,callback:function(t){e.discardOutliers=t},expression:"discardOutliers"}}):e._e(),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.isSaving?a("v-btn",{attrs:{type:"submit",loading:e.processing,color:"blue",dark:"",depressed:""}},[e._v("Upload")]):e._e()],1)])])};U._withStripped=!0;var M=a(50),B=a.n(M),N=(a(32),a(5)),q=a(38),z={props:["layer","layerCollection"],data:function(){return{processing:!1,isSaving:!1,uploadedFiles:[],uploadError:null,currentStatus:null,uploadFieldName:"GeoJSON",file:"",neighbourhood:"",collection:"",layerSelected:"",indicatorFormats:["geojson","json","csv"],indicatorFormat:null,discardOutliers:!1,uploadFunction:"create",uploadFunctions:["create","update"],update:{key:"",matchUpload:"",matchExisting:""}}},methods:{filesChange:function(){this.isSaving=!0,this.file=this.$refs.file.files[0],this.neighbourhood=this.file.name.split(".")[0],this.indicatorFormat=this.file.name.split(".")[1]},close:function(){this.processing=!1,this.$emit("close",!0)},processForm:function(){var e=this;this.processing=!0;var t=q[this.collection].params?this.layerSelected:"",a=this.collection||alert("Collection required"),r="update"===this.uploadFunction?"updateMany":"create",i=new FormData;i.append("neighbourhood",this.neighbourhood),i.append("layer",this.layerSelected),i.append("file",this.file),i.append("format",this.indicatorFormat),i.append("update",B()(this.update)),i.append("discardOutliers",this.discardOutliers),N.a[r](a,null,i,{"Content-Type":"multipart/form-data"},t).then(function(){return console.log("SUCCESS!!"),e.$store.dispatch("UPDATE_COLLECTION",{name:a,layer:e.layerSelected})}).then(function(){e.$forceUpdate(),e.close()}).catch(function(t){if(e.processing=!1,console.log("err.response",t.response),!t.response)return alert(t),null;var a=t.response.data.errors;alert(h()(a).reduce(function(e,t){return e=e+"\n"+a[t].name+": "+a[t].message},""))})}},computed:{layers:function(){var e=this.$store.state["_col_"+this.layerCollection];if(e)return e.map(function(e){return{text:e.name,value:e._id}})},collections:function(){return console.log("generating collections"),h()(q).reduce(function(e,t){return q[t].canUpload&&e.push(t),e},[])}},mounted:function(){this.layerSelected=this.layer}},Y=Object(b.a)(z,U,[],!1,null,null,null);Y.options.__file="src/components/Upload.vue";var R=Y.exports,H=a(87),K=a(64),G=a(38),J=(a(313)(),{components:{VueJsonPretty:P.a,Upload:R,Editor:H.a},props:["collection","filter","datatable","listKey","nestedPath","cssclass","addtop","addbottom","multiselect","disabled","searchable","title"],data:function(){return{search:"",updateKey:0,dialog:!1,mode:null,saving:!1,editedIndex:null,layerDialog:!1,attributeDialog:!1,selected:0,selectedId:"",editedCollection:null,edited:{},editItem:null,selectAll:!1,items:[]}},computed:{schema:function(){return this.$store.getters.collectionSchema(this.collection,this.filter)},menuItems:function(){return this.$store.getters.areaLayers},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},listItems:function(){var e=this;return this.items.map(function(t,a){return t.active=e.selected===a,t})},firstItem:function(){return this.$store.state["_col_"+self.collection]?this.$store.state["_col_"+self.collection][0]:{}},tabledata:function(){if(this.layer)return this.layer.attributes},featureHeaders:function(){var e=this;if(!this.schema.schema)return[];var t=this.multiselect?[{value:"_selected",type:"select",_text:"",sortable:!1}]:[];return h()(this.schema.schema).reduce(function(t,a){return e.schema.schema[a]._text&&t.push({value:e.nestedPath?e.nestedPath+"."+a:a,text:e.schema.schema[a]._text,type:e.schema.schema[a].type,class:["datatable-header","theme--dark"]}),t},t)}},methods:{prepareItems:function(){var e=this,t=[];return G[this.collection].storeByLayer?(t=this.$store.state["_col_"+this.collection][this.filterId]||[],t=Array.isArray(t)?t:t[this.$store.state.neighbourhood]):(t=T()(this.$store.state["_col_"+this.collection]),this.filter&&t[0]&&(t=t.filter(function(t){return t.layer===e.filterId}))),this.multiselect?this.addSelects(t):t||[]},getNested:function(e,t){return e?K.getNested(e,t):t},openEditor:function(e){this.editItem=e,this.dialog=!0},addSelects:function(e,t){return this.multiselect?e.map(function(e,a){return e._selected=t||!1,e._index=a,e}):e},updateCollection:function(e){var t=this;if(!e&&!G[this.collection].storeByLayer&&!this.$store.state["_col_"+this.collection+"_selected"])return this.items=this.prepareItems(),console.log("rejecting"),I.a.reject();var a=this;return new I.a(function(r,i){var n=t.collection;if(G[t.collection].storeByLayer){var o=a.filterId;n={name:t.collection,layer:o},(!o||!e&&t.$store.state._col_features[o])&&i("No layer specified")}a.$store.dispatch("UPDATE_COLLECTION",n).then(function(e){t.items=t.prepareItems(),a.$forceUpdate(),r(e)}).catch(function(e){console.log("update failed",e),i()})})},setMode:function(){this.$store.commit("UPDATE",{key:"mode",value:this.collection})},select:function(e,t){this.selected=e,this.selectedId=t,this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:t}),this.setMode();var a=this;this.$nextTick(function(){return a.$forceUpdate()})},del:function(e,t){var a=this;this.loading=!0,confirm("Are you sure you want to delete this item?")&&N.a.del(e,t).then(function(e){a.updateCollection(!0),a.selected=a.selected>0?a.selected-1:0,a.loading=!1})},close:function(){this.dialog=!1},toggleSelectAll:function(){var e=this.addSelects(this.items,this.selectAll),t={name:"features",layer:this.$store.state["_col_"+this.filter+"_selected"],data:e},a=this;this.$store.dispatch("UPDATE_COLLECTION",t).then(function(){return a.$forceUpdate()})},deleteSelected:function(){var e=this,t=void 0,a=this.items.reduce(function(t,a,r){return a._selected?(a._selected=!1,e.$set(e.items,r,a),t.push(a),t):t},[]),r=G[this.collection].params?this.filterId:null;if(!confirm("Are you sure you want to delete "+a.length+" items?"))return null;t=this.selectAll&&this.filter?{layer:this.$store.state["_col_"+this.filter+"_selected"]}:a.map(function(e){return e._id}),N.a.deleteMany(this.collection,"",t,"",r).then(function(){console.log("deleted"),e.updateCollection(!0)})},logStore:function(){}},watch:{dialog:function(e){e||this.close()},menuItems:function(e){},filterId:function(e){"features"===this.collection&&this.updateCollection()}},created:function(){console.log("created"),this.updateCollection().then(function(e){}).catch(function(e){return console.log("failed to update store")}),this.datatable||this.setMode()},mounted:function(){}}),V=(a(472),Object(b.a)(J,O,[],!1,null,null,null));V.options.__file="src/components/EditableDataList.vue";var W=V.exports,Z=a(53),X=a(52),Q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.item.datatable?a("div",{staticClass:"py-3"},[a("v-divider"),e._v(" "),a("div",{staticClass:"title py-3"},[e._v(e._s(e.item.name))]),e._v(" "),a("v-data-table",{attrs:{items:e.item.data,headers:e.item.headers,"rows-per-page-items":[-1]},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(e.item.headers,function(r){return a("td",[e._v(e._s(t.item[r.value]))])})}}],null,!1,119581540)})],1):"Figure"===e.item.type||"List"===e.item.type||"Chart"===e.item.type?a("indicator-key-stat",{staticClass:"ejmap-border",attrs:{selected:e.selected,name:e.item.text,figure:e.item.figure,description:e.item.description,unit:e.item.unit,year:e.item.year,type:e.item.type},on:{childClick:e.childClick}}):"Map"===e.item.type?a("div",[a("div",{staticClass:"subheading font-weight-light mb-2 mt-5 px-2 ejmap-border-bottom"},[e._v(e._s(e.item.text))]),e._v(" "),a("map-view",{staticClass:"ejmap-border",staticStyle:{position:"relative"},attrs:{contextmenu:"",featuresCollection:"features",zoomLevel:"12",height:"400px",featureLayers:e.item.figure,areas:!0}})],1):e._e()};Q._withStripped=!0;var ee=a(86),te={components:{MapView:A.a,IndicatorKeyStat:k,Timeline:ee.a},props:["selected","item"],data:function(){return{}},methods:{childClick:function(){this.$emit("childClick")}}},ae=Object(b.a)(te,Q,[],!1,null,null,null);ae.options.__file="src/components/IndicatorCard.vue";var re=ae.exports,ie={components:{MapView:A.a,MapNavigator:j.a,BarHorizontal:c,BarVertical:d,IndicatorKeyStat:k,IndicatorHeading:$,EditableDataList:W,AreaSelect:Z.a,IndicatorCard:re,LayerSelect:X.a},data:function(){return{nav:!0,selected:null,activeTab:null,selectedData:this.$store.getters.selected}},computed:{items:function(){var e=this.$store.getters.selectedIndicatorBlocks;console.log("indicator blocks",e);var t=Object(L.translate)(e,["text","description"],this.$store.state.language);return console.log("translateion",t),console.log("indicatorsByArea",this.$store.getters.indicatorsByArea),t},figures:function(){return this.items.filter(function(e){return"Figure"===e.type})},charts:function(){var e=this.items.filter(function(e){return"Chart"===e.type});return e[0]?e:null},map:function(){return this.items.filter(function(e){return"Map"===e.type})[0]},featureLayers:function(){var e=this.$store.getters.selectedIndicatorSection;return e?e.geodata:null},section:function(){var e=this;return this.$store.state._col_indicatorSections.filter(function(t){return t._id===e.$store.state._col_indicatorSections_selected})[0]},carouselHeight:function(){return window.innerHeight/100*45}},methods:{updateSelected:function(e){this.selected=e,console.log("updated select",this.selected)}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedIndicatorSection},function(t,a){if(console.log("section changed",t),e.selected=0,!t||!Array.isArray(t.geodata)||0===t.geodata.length)return null})}},ne=(a(473),Object(b.a)(ie,n,[],!1,null,null,null));ne.options.__file="src/components/IndicatorsNew.vue";var oe=ne.exports,se=function(){var e=this.$createElement,t=this._self._c||e;return this.$store.state._col_features?t("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",height:"",featureLayers:this.$store.state._col_layers_selected,featuresCollection:"features",zoomLevel:"12",allLayers:!0,options:{legendStyle:this.legendStyle,areaSelect:!0,mapStyle:{flexDirection:"row-reverse"}}}}):this._e()};se._withStripped=!0;var le={components:{MapView:A.a},data:function(){return{legendStyle:{height:"100%",maxHeight:"100%",width:"25%",maxWidth:"300px",minWidth:"200px",left:0,borderRight:"1px solid #e3e3e3",backgroundColor:"#fff"}}}},ce=Object(b.a)(le,se,[],!1,null,null,null);ce.options.__file="src/components/MapFull.vue";var ue=ce.exports,de=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{staticClass:"px-3 pt-0",attrs:{fluid:"","grid-list-xl":""}},[a("div",{staticStyle:{}},[a("div",{staticClass:"data-toolbar",style:{top:e.$vuetify.breakpoint.xsOnly?"140px":0}},[a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"mb-2",attrs:{color:"grey",flat:"",icon:e.iconise},on:{click:function(t){e.uploadDialog=!0}}},r),[a("v-icon",{},[e._v("cloud_upload")]),e._v(" "),a("span",{staticClass:"hidden-sm-and-down ml-2"},[e._v("Upload")])],1)]}}])},[e._v(" "),a("span",[e._v("Upload Data")])]),e._v(" "),a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({staticClass:"mb-2",attrs:{color:"grey",flat:"",icon:e.iconise},on:{click:function(t){e.analysisDialog=!0}}},r),[a("v-icon",{},[e._v("assessment")]),e._v(" "),a("span",{staticClass:"hidden-sm-and-down ml-2"},[e._v("Update Feature Analysis")])],1)]}}])},[e._v(" "),a("span",[e._v("Update Feature Analysis")])]),e._v(" "),a("v-menu",{attrs:{"offset-y":"","min-width":"300px",dark:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",{attrs:{color:"grey"}},[e._v("more_vert")])],1)]}}])},[e._v(" "),a("v-list",{attrs:{dense:"",dark:""}},[a("v-list-tile",{on:{click:function(t){e.deleteAllDialog=!0}}},[a("v-list-tile-action",[a("v-icon",[e._v("delete")])],1),e._v(" "),a("v-list-tile-content",[a("v-list-tile-title",[e._v("Delete All")])],1)],1)],1)],1)],1)]),e._v(" "),a("v-tabs",{staticClass:"mt-2 mx-4 manage-data",attrs:{color:"background","slider-color":"primary","show-arrows":""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[e._l(e.tabs,function(t,r,i){return a("v-tab",{key:i,attrs:{ripple:""},on:{click:function(t){return e.update(r)}}},[e._v(e._s(t.text_en))])}),e._v(" "),e._l(e.tabs,function(t,r,i){return a("v-tab-item",{key:i,staticClass:"pt-4",attrs:{lazy:""}},[e.$vuetify.breakpoint.xsOnly?a("layer-select",{staticClass:"ejmap-border pa-2",staticStyle:{"background-color":"white"},attrs:{collection:t.filter.collection}}):e._e(),e._v(" "),a("div",{staticClass:"text-xs-right caption grey--text",style:{marginTop:e.$vuetify.breakpoint.xsOnly?"10px":"-20px"}},[a("span",[e._v("Layer id: "+e._s(e.$store.state["_col_"+t.uploadLayerCol+"_selected"]))])]),e._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"",xs12:""}},[e.$vuetify.breakpoint.smAndUp?a("editable-data-list",{attrs:{collection:t.filter.collection,listKey:t.filter.listKey,addbottom:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[t.map?a("v-flex",{staticClass:"mb-2",style:{height:e.$vuetify.breakpoint.xsOnly?"602px":"402px"},attrs:{xs12:""}},[a("map-view",{class:t.map.classObj||{minimap:e.minimapOn,fullmap:!e.minimapOn,"ejmap-border":!0},style:t.map.style||"position:relative;height:402px;",attrs:{featuresCollection:t.map.featuresCollection,height:t.map.height||"400px",featureLayers:t.map.featureLayers,editable:t.map.editable,options:t.map.options||{areaSelect:!0},legendBottom:e.scrollLow||e.$vuetify.breakpoint.xsOnly}})],1):e._e(),e._v(" "),e._l(t.tables,function(t,r){return["datalist"===t.type&&t.collection?a("v-flex",{key:r,attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 py-2"}),e._v(" "),"datalist"===t.type&&t.collection?a("editable-data-list",{attrs:{collection:t.collection,filter:t.filter,title:t.heading,datatable:!1!==t.datatable,multiselect:t.multiselect,nestedPath:t.nestedPath,searchable:t.searchable,childClass:t.childClass,addtop:!t.addbottom,addbottom:t.addbottom,areas:"areas"===t.collection}}):e._e()],1):"json"===t.type&&e.$store.state.selectedFeature?a("v-flex",{key:r,staticClass:"py-5",attrs:{xs12:""}},[a("div",{staticClass:"py-2 subheading font-weight-light  ejmap-border-bottom"},[e._v("Indicators ")]),e._v(" "),a("v-tabs",{attrs:{"slider-color":"primary",color:"background","show-arrows":""}},[e._l(e.$store.getters.indicatorsForSelectedArea,function(t,r){return a("v-tab",{key:r,attrs:{ripple:""}},[e._v("\n        "+e._s(t.year)+"\n      ")])}),e._v(" "),e._l(e.$store.getters.indicatorsForSelectedArea,function(e,t){return a("v-tab-item",{key:t},[a("v-card",{attrs:{flat:""}},[a("vue-json-pretty",{staticClass:"pa-3 mb-2 code caption",attrs:{data:e}})],1)],1)})],2)],1):e._e()]})],2)],1)],1)],1)})],2)],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.uploadDialog,callback:function(t){e.uploadDialog=t},expression:"uploadDialog"}},[a("upload",{attrs:{layer:e.tabs[e.tab].uploadLayer,layerCollection:e.tabs[e.tab].uploadLayerCol},on:{close:function(t){e.uploadDialog=!1}}})],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.analysisDialog,callback:function(t){e.analysisDialog=t},expression:"analysisDialog"}},[a("analysis",{attrs:{layerCollection:e.tabs[e.tab].uploadLayerCol,areaLayer:e.$store.state._col_areaLayers_selected},on:{close:function(t){e.analysisDialog=!1}}})],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.deleteAllDialog,callback:function(t){e.deleteAllDialog=t},expression:"deleteAllDialog"}},[a("delete-all",{on:{close:function(t){e.deleteAllDialog=!1}}})],1)],1)};de._withStripped=!0;var pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-3"},[a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),a("v-select",{attrs:{name:"areaLayer",items:e.areaLayers,label:"Area"},model:{value:e.areaLayerSelected,callback:function(t){e.areaLayerSelected=t},expression:"areaLayerSelected"}}),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{color:"blue",dark:"",depressed:"",loading:e.processing},on:{click:function(t){return e.updateAnalysis()}}},[e._v("Analyse")])],1)],1)};pe._withStripped=!0;a(38);var fe={props:["layer","areaLayer","layerCollection"],data:function(){return{processing:!1,layerSelected:"",areaLayerSelected:""}},methods:{close:function(){this.processing=!1,this.$emit("close",!0)},updateAnalysis:function(){var e=this;this.processing=!0,N.a.updateAnalysis("features",this.areaLayerSelected,{},{},this.layerSelected).then(function(t,a){a&&console.log(a),e.processing=!1,e.$store.dispatch("UPDATE_COLLECTION",{name:"indicators",layer:e.$store.state._col_areaLayers_selected})})}},computed:{layers:function(){return this.$store.state["_col_"+this.layerCollection].map(function(e){return{text:e.name,value:e._id}})||[]},areaLayers:function(){return this.$store.state._col_areaLayers.map(function(e){return{text:e.name,value:e._id}})||[]}},mounted:function(){this.layerSelected=this.$store.state["_col_"+this.layerCollection+"_selected"],this.areaLayerSelected=this.areaLayer||this.$store.state._col_areaLayers_selected}},he=Object(b.a)(fe,pe,[],!1,null,null,null);he.options.__file="src/components/Analysis.vue";var me=he.exports,ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-3"},[a("div",[e._v("Are you sure you want to delete all features in layer: "+e._s(e.layer.name)+" ?")]),e._v(" "),a("v-text-field",{attrs:{label:"Type DELETE to confirm"},model:{value:e.deleteConfirm,callback:function(t){e.deleteConfirm=t},expression:"deleteConfirm"}}),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{loading:e.processing,color:"red",dark:"",depressed:""},on:{click:function(t){return e.deleteAll()}}},[e._v("Delete")])],1)],1)};ye._withStripped=!0;var ve={data:function(){return{processing:!1,deleteConfirm:""}},methods:{close:function(){this.$emit("close",!0)},deleteAll:function(){var e=this;if("DELETE"!==this.deleteConfirm)return null;this.processing=!0,N.a.deleteMany("features","",{layer:"ObjectId:"+this.$store.state._col_layers_selected},"",this.$store.state._col_layers_selected).then(function(){console.log("deleted"),e.processing=!1,e.$store.dispatch("UPDATE_COLLECTION",{name:"features",layer:e.$store.state._col_layers_selected})}).catch(function(e){console.log(e)})}},computed:{layer:function(){return this.$store.getters.selectedLayer}}},_e=Object(b.a)(ve,ye,[],!1,null,null,null);_e.options.__file="src/components/DeleteAll.vue";var ge=_e.exports,be={components:{EditableDataList:W,MapView:A.a,Upload:R,VueJsonPretty:P.a,Analysis:me,AreaSelect:Z.a,LayerSelect:X.a,DeleteAll:ge},data:function(){return{deleteAllDialog:!1,uploadDialog:!1,analysisDialog:!1,activeTab:null,pages:null,tab:"features",scrollLow:!1,minimap:{position:"fixed",top:"20px",left:"20px",width:"20%",height:"200px"}}},computed:{minimapOn:function(){return this.scrollLow&&this.$vuetify.breakpoint.mdAndUp},iconise:function(){return this.$vuetify.breakpoint.smAndDown},tabs:function(){return{features:{text_en:"Features",uploadLayer:this.$store.state._col_layers_selected,uploadLayerCol:"layers",filter:{collection:"layers",listKey:"data_type"},map:{featuresCollection:"features",featureLayers:this.$store.state._col_layers_selected},tables:[{type:"datalist",heading:"Attributes",collection:"layerAttributes",filter:"layers"},{type:"datalist",heading:"Calculations",collection:"layerCalcs",filter:"layers"},{type:"datalist",heading:"Features Table",multiselect:!0,collection:"features",filter:"layers",nestedPath:"feature.properties",searchable:!0},{type:"datalist",heading:"Style",collection:"styles",filter:"layers",searchable:!0}]},areas:{text_en:"Areas",uploadLayer:"areas",uploadLayerCol:"areaLayers",filter:{collection:"areaLayers"},map:{featuresCollection:"areas"},tables:[{type:"datalist",heading:"Attributes",collection:"areaAttributes",filter:"areaLayers"},{type:"datalist",heading:"Areas",collection:"areas",filter:"areaLayers",multiselect:!0,nestedPath:"feature.properties",searchable:!0}]},indicatorAttributes:{text_en:"Indicators",uploadLayer:this.$store.state._col_areaLayers_selected,uploadLayerCol:"areaLayers",filter:{collection:"areaLayers"},map:{featuresCollection:"areas"},tables:[{type:"datalist",heading:"Attached Attributes",collection:"indicatorAttributes",filter:"areaLayers"},{type:"json"}]},indicatorSections:{text_en:"Sections",filter:{collection:"indicatorSections"},tables:[{type:"datalist",heading:"Blocks",collection:"indicatorBlocks",filter:"indicatorSections"}]},surveys:{text_en:"Surveys",uploadLayer:this.$store.state._col_surveyLayers_selected,uploadLayerCol:"surveyLayers",filter:{collection:"surveyLayers"},map:{featuresCollection:"features",featureLayers:this.$store.getters.getSelected("surveyLayers").featureLayer,editable:!0},tables:[{type:"datalist",heading:"Questions",collection:"surveyLayerAttributes",filter:"surveyLayers"},{type:"datalist",heading:"Survey Results",multiselect:!0,collection:"surveyRecords",filter:"surveyLayers",nestedPath:"properties"}]}}}},methods:{update:function(e){var t=this;this.tab=e,this.$store.commit("UPDATE",{key:"tab",value:e}),this.$nextTick(function(){t.$forceUpdate()})},log:function(){console.log("data",this),console.log("store",this.$store.state)}},mounted:function(){var e=this;window.addEventListener("scroll",function(t){window.scrollY>500&&!e.scrollLow?e.scrollLow=!0:window.scrollY<500&&e.scrollLow&&(e.scrollLow=!1)})}},xe=(a(474),Object(b.a)(be,de,[],!1,null,null,null));xe.options.__file="src/components/ManageDataMaster.vue";var ke=xe.exports,Se=a(128),Ce=a.n(Se),we=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-layout",{attrs:{row:"",wrap:""}},e._l(e.items,function(t,r){return a("v-flex",{attrs:{xs12:"","py-4":""}},[a("div",{staticClass:"title pb-2"},[e._v(e._s(t.heading))]),e._v(" "),a("div",{staticClass:"subheading",staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.text))]),e._v(" "),t.code?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:t.code}}):e._e()],1)}),1)};we._withStripped=!0;var $e={components:{VueJsonPretty:P.a},data:function(){return{itemsX:[{heading:"Features"},{heading:"Features"},{heading:"Features"}],items:[{heading:"Features",text:"Spatial data points (either points, polygons or lines) with attribute information including which feature layer it is associated with.",code:{type:"point",geometry:[],properties:{year:2015,feature_layer:"education",type:"college",students:500,gender:"mixed",quality_rating:10}}},{heading:"Feature Layers",text:"Feature layers determine the layer type and methods of analysis to be performed on it.",code:{name:"education",type:"point",columns:{type:{type:"string",func:"count"},students:{type:"integer",func:"sum"},gender:{type:"string",func:"count"},quality_rating:{type:"integer",func:"average"}}}},{heading:"Areas",text:"Statistical areas with which the features should be grouped for analysis"},{heading:"Area Indicators",text:"Area indicators include the results of spatial analysis between the Areas and Features and any additional secondary data e.g from JIIS"},{heading:"Surveys",text:"Surveys are extensions of Feature Layers that can be used for collecting field data.\n\nSurveys can use an existing Feature Layer as a template or create a new one. In most cases spatial data will need to be uploaded in advance of the conducting the survey.However, point data can be added live via the survey map"}]}}},Le=Object(b.a)($e,we,[],!1,null,null,null);Le.options.__file="src/components/Help.vue";var Ae=Le.exports;"http://localhost:8080"===window.location.origin||window.location.origin;console.log("routing from",{redirect_uri:window.location.origin+"/implicit/callback"}),r.default.use(Ce.a,{client_id:"***REMOVED***",issuer:"https://dev-160658.okta.com/oauth2/default",redirect_uri:window.location.origin+"/implicit/callback",scope:"openid profile email groups",response_type:"id_token"}),r.default.use(i.a);var je=new i.a({mode:"history",routes:[{path:"/",component:oe},{path:"/upload",component:R,meta:{requiresAuth:!0}},{path:"/manage",component:ke,meta:{requiresAuth:!0}},{path:"/map",component:ue},{path:"/indicators",component:oe},{path:"/implicit/callback",component:Ce.a.handleCallback()},{path:"/help",component:Ae}]});je.beforeEach(r.default.prototype.$auth.authRedirectGuard());t.a=je},322:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",{attrs:{id:"keep",app:""}},[r("v-toolbar",{staticClass:"ejmap-border-bottom",attrs:{app:"",light:"","clipped-left":"",flat:"",color:"#fff"}},[r("img",{attrs:{src:a(365)},on:{click:function(t){return e.log()}}}),e._v(" "),r("v-toolbar-title",[r("div",{staticStyle:{"margin-bottom":"-5px"}},[e._v("Urban Analytics")]),e._v(" "),r("div",{staticClass:"grey--text",staticStyle:{"font-size":"0.6em"}},[e._v("East Jerusalem")])]),e._v(" "),r("v-spacer"),e._v(" "),e._l(e.items,function(t,a){return r("v-tooltip",{key:a,attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(a){var i=a.on;return[r("v-btn",e._g({staticClass:"hidden-xs-only",attrs:{to:t.route,icon:""}},i),[r("v-icon",{attrs:{color:"grey darken-1"}},[e._v(e._s(t.icon))])],1)]}}],null,!0)},[e._v(" "),r("span",[e._v(e._s(t.text))])])}),e._v(" "),r("v-menu",{scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[r("v-btn",e._g({staticClass:"hidden-sm-and-up",attrs:{icon:""}},a),[r("v-icon",[e._v("more_vert")])],1)]}}])},[e._v(" "),r("v-list",[e._l(e.items,function(t,a){return r("v-list-tile",{key:a,attrs:{bottom:"",to:t.route}},[r("v-list-tile-action",[r("v-icon",{attrs:{color:"grey darken-1"}},[e._v(e._s(t.icon))])],1),e._v(" "),r("v-list-tile-content",[e._v("\n              "+e._s(t.text)+"\n          ")])],1)}),e._v(" "),r("v-list-tile",{on:{click:e.toggleLogin}},[r("v-list-tile-action",[r("v-icon",{attrs:{color:"grey darken-1"}},[e._v("person")])],1),e._v(" "),e.activeUser?r("v-list-tile-content",[e._v("\n            Logout\n          ")]):r("v-list-tile-content",[e._v("\n            Login\n          ")])],1)],2)],1),e._v(" "),r("v-menu",{attrs:{"min-width":"300","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[r("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[r("v-list-tile",{staticClass:"hidden-xs-only"},[r("v-list-tile-content",[e.activeUser?r("v-list-tile-title",{staticClass:"grey--text body-1"},[e._v("\n                "+e._s(e.activeUser.email)+"\n              ")]):r("v-list-tile-title",{staticClass:"grey--text hidden-xs-only"},[e._v("\n                Login\n              ")])],1),e._v(" "),r("v-list-tile-action",[r("v-btn",e._g({staticClass:"hidden-xs-only",attrs:{icon:""}},Object.assign({},a,i)),[r("v-icon",{attrs:{color:"grey darken-1"}},[e._v("person")])],1)],1)],1)]}}],null,!0)},[e._v(" "),r("span",[e._v("Account")])])]}}])},[e._v(" "),r("v-card",[r("v-list",[e.activeUser?r("v-list-tile",{attrs:{avatar:""}},[r("v-list-tile-content",[r("v-list-tile-title",[e._v(e._s(e.activeUser.name))]),e._v(" "),r("v-list-tile-sub-title",[e._v("IPCC")])],1)],1):e._e()],1),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),e.activeUser?r("v-btn",{attrs:{color:"primary",flat:""},on:{click:e.logout}},[e._v("Logout")]):r("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return t.preventDefault(),e.login(t)}}},[e._v("Login")])],1)],1)],1)],2),e._v(" "),e.loading?r("v-container",[r("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[r("div",{staticClass:"text-xs-center"},[r("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),r("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)])],1):r("v-content",[r("router-view",{staticStyle:{height:"100%"}})],1)],1)};r._withStripped=!0;var i=a(21),n=a.n(i),o=a(3),s=a.n(o),l=a(25),c=a.n(l),u=a(54),d=a.n(u),p=a(24),f=(a(126),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.desserts},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.name))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.calories))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.fat))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.carbs))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.iron))])]}}])})});f._withStripped=!0;var h={data:function(){return{headers:[{text:"Dessert (100g serving)",align:"left",sortable:!1,value:"name"},{text:"Calories",value:"calories"},{text:"Fat (g)",value:"fat"},{text:"Carbs (g)",value:"carbs"},{text:"Protein (g)",value:"protein"},{text:"Iron (%)",value:"iron"}],desserts:[{name:"Frozen Yogurt",calories:159,fat:6,carbs:24,protein:4,iron:"1%"},{name:"Ice cream sandwich",calories:237,fat:9,carbs:37,protein:4.3,iron:"1%"},{name:"Eclair",calories:262,fat:16,carbs:23,protein:6,iron:"7%"},{name:"Cupcake",calories:305,fat:3.7,carbs:67,protein:4.3,iron:"8%"},{name:"Gingerbread",calories:356,fat:16,carbs:49,protein:3.9,iron:"16%"},{name:"Jelly bean",calories:375,fat:0,carbs:94,protein:0,iron:"0%"},{name:"Lollipop",calories:392,fat:.2,carbs:98,protein:0,iron:"2%"},{name:"Honeycomb",calories:408,fat:3.2,carbs:87,protein:6.5,iron:"45%"},{name:"Donut",calories:452,fat:25,carbs:51,protein:4.9,iron:"22%"},{name:"KitKat",calories:518,fat:26,carbs:65,protein:7,iron:"6%"}]}}},m=a(2),y=Object(m.a)(h,f,[],!1,null,null,null);y.options.__file="src/components/Viewer.vue";var v=y.exports,_=a(32),g=a.n(_),b=(a(5),a(38)),x={name:"App",components:{MapView:p.a,Viewer:v},data:function(){return{loading:!0,miniNav:!0,authenticated:!1,drawerIndicators:!1,layersPanel:!0,currentView:"map-view",layers:[]}},computed:{items:function(){var e=[{icon:"help",text:"About",route:"help"},{icon:"map",route:"map",text:"Map"},{icon:"bar_chart",text:"Urban Indicators",route:"indicators"}];return this.activeUser?e.concat([{icon:"settings",text:"Manage Data",route:"manage"}]):e},activeUser:function(){return this.$store.state.activeUser.email?this.$store.state.activeUser:null}},props:{source:String},created:function(){var e=this;return d()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshActiveUser();case 2:case"end":return t.stop()}},t,e)}))()},watch:{$route:"refreshActiveUser"},methods:{log:function(){console.log("store",this.$store.getters,this.$store.state),g.a.create({baseURL:"http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,json:!0})({method:"POST",url:"/planmonitor"}).then(function(e){console.log("logdata",e)})},toggleLogin:function(){this.activeUser?this.logout():this.login()},login:function(){this.$auth.loginRedirect()},refreshActiveUser:function(){var e=this;return d()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$auth.getUser().then(function(t){e.$store.commit("UPDATE_USER",t)});case 1:case"end":return t.stop()}},t,e)}))()},logout:function(){var e=this;return d()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.logout();case 2:return t.next=4,e.refreshActiveUser();case 4:e.$router.push("/");case 5:case"end":return t.stop()}},t,e)}))()},printUser:function(){console.log("USER"),console.log(this.activeUser),console.log(this.$auth)}},mounted:function(){var e=this,t=s()(b).reduce(function(e,t){var a=b[t].layerCollection;return a&&e.indexOf(a)<0&&e.push(a),e},[]);n.a.all(t.map(function(t){return e.$store.dispatch("UPDATE_COLLECTION",t)})).then(function(a){var r=a.reduce(function(e,a,r){return e[t[r]]=a,e},{});return console.log("layerColsObj",r),n.a.all(s()(b).reduce(function(t,a){var i=b[a].layerCollection;if(b[a].storeByLayer){var n=r[i].reduce(function(e,t){return e[t._id]=[],e},{});e.$store.commit("UPDATE",{key:"_col_"+a,value:n})}else i?(console.log("update by layer",a,i,r[i][0]._id),t.push(e.$store.dispatch("UPDATE_COLLECTION",{name:a,layer:r[i][0]._id}))):r[a]?console.log("did not dispatch",a):(console.log("this.$store.dispatch",a),t.push(e.$store.dispatch("UPDATE_COLLECTION",a)));return t},[]))}).then(function(){console.log("LOADING COMPLETE"),e.loading=!1})}},k=(a(469),Object(m.a)(x,r,[],!1,null,null,null));k.options.__file="src/App.vue";t.a=k.exports},323:function(e,t,a){"use strict";a.r(t),function(e){var t=a(27),r=a.n(t),i=a(49),n=a.n(i),o=a(21),s=a.n(o),l=a(7),c=a.n(l),u=a(3),d=a.n(u),p=a(8),f=a(322),h=a(321),m=a(320),y=a.n(m),v=(a(1),a(475),a(476),a(317)),_=a(130),g=a(5),b=a(42),x=a.n(b),k=a(65),S=a(318),C=a(319),w=a(38),$=a(313)(),L=a(64);e.DEBUG=!1,p.default.use(y.a,{options:{customProperties:!0},theme:k.a}),p.default.use(v.a),p.default.use(_.a),p.default.use(C.a),p.default.config.productionTip=!0;var A=d()(w).reduce(function(e,t){return e["_col_"+t]=w[t].storeByLayer?{}:[],e["_col_"+t+"_selected"]="",e},{}),j=new _.a.Store({state:c()({mode:null,activeUser:{},selectedFeatureLayers:[],updateCount:0,indicators:[],collections:{},cityIndicators:[],neighbourhood:2412,areaLayer:"5cf510e19bfa58b6c509903b",year:2016,language:"en",languages:[{name:"en",text:"English"},{name:"ar",text:"Arabic"}],theme:k.a,tab:"",colorScale:x.a.scale([k.a.scaleMin,k.a.scaleMax]),colors:["#ff267e","#26ffa7","#267eff","#000","#f46441"],map:{zoom:15,center:{lat:31.827982118391024,lng:35.22958321000619},defaultCenter:{lat:31.78845754836993,lng:35.2121981978},opacity:1},hidden:{},navigator:{zoom:11.8,center:{lat:31.827982118391024,lng:35.22958321000619},defaultCenter:{lat:31.827982118391024,lng:35.22958321000619},indicator:{figure:"pop_year_end",name:"Population"}},styles:{},legendStyles:{},geo:{areas:[],facilities:[],educational:[],features:[],selected:null},layers:[]},A),actions:{UPDATE_COLLECTION:function(e,t){var a=e.state,r=e.commit,i={name:t.name||t,query:t.query||{},layer:t.layer};if(w[i.name].storeByLayer){if(i.layer=i.layer||a._col_layers_selected,i.layer||rej("no feature layer defined"),console.log(i.layer),a["_col_"+w[i.name].layerCollection].filter(function(e){return e._id===i.layer})[0].filtered){var n=a._col_areaLayers.filter(function(e){return e._id===a._col_areaLayers_selected})[0].code;i.query["feature.properties."+n]=a.neighbourhood,i.nestedKey=a.neighbourhood}}else i.name;function o(e){if(w[i.name].storeByLayer)r("UPDATE_FEATURES",{collection:i.name,key:i.layer,value:e,nestedKey:i.nestedKey});else{var t="_col_"+i.name,n=t+"_selected";r("UPDATE",{key:t,value:e}),!a[n]&&e[0]&&r("UPDATE",{key:n,value:e[0]._id})}}return new s.a(function(e,a){if(t.data)return o(t.data),e(t.data);console.log("making api request",i.name,i.query,i.layer),g.a.find(i.name,i.query,"",{lean:!0},i.layer).then(function(t,r){r&&(console.log("api error",r),a(r)),o(t.data),e(t.data)}).catch(function(e){e.response&&console.log("api error: "+i.name,e.response)})})},UPDATE_INDICATORS:function(e){var t=e.state,a=e.commit;g.a.find("indicators",{areaLayer:t.areaLayer}).then(function(e){return a("UPDATE",{key:"indicators",value:e.data})}).catch(function(e){console.log("failed to update indicators",e)})}},mutations:{GET_INDICATORS:function(e){g.a.find("areas",{}).then(function(t){e.geo.areas=t.data}),g.a.find("indicators",{}).then(function(t){if(!t.data)return console.log("cannot retrieve in"),null;var a=t.data.map(function(e){return e.dependency_youth=((e.age_0_4+e.age_5_14+e.age_15_24)/e.pop_year_end*100).toFixed(1),e.growth_total=(e.pop_growth_total/e.pop_year_end*100).toFixed(1),e.growth_natural=(e.pop_growth_natural/e.pop_year_end*100).toFixed(1),e.household_size=(e.pop_year_end/e.dwellings_total).toFixed(1),e.dwelling_density=(e.dwelling_area_avg/e.household_size).toFixed(1),e.prevyear=t.data.filter(function(t){return t.name===e.name&&t.year===e.year-1})[0],e.dwellings_new=e.prevyear?e.dwellings_total-e.prevyear.dwellings_total:null,e.dwelling_growth=(e.dwellings_new/e.dwellings_total*100).toFixed(1),e.age_distribution_labels=["age_0_4","age_5_14","age_15_24","age_25_44","age_45_64","age_65_74","age_75_"],e.age_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.pop_year_end*100}),e.dwelling_area_distribution_labels=["dwellings_area_0_40","dwellings_area_41_60","dwellings_area_61_80","dwellings_area_81_100","dwellings_area_101_140","dwellings_area_141"],e.dwelling_area_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.dwellings_total*100}),e});e.indicators=a.filter(function(e){return 9999!==e.area_code}),e.cityIndicators=a.filter(function(e){return 9999===e.area_code});var r=Object(S.a)();g.a.find("features",{}).then(function(t){e.geo.facilities=t.data,e.facilities=t.data.map(function(e){return e.feature.properties}),console.log("facilities",e.facilities);var a=t.data.filter(function(e){return"Educational"===e.feature.properties.Use});e.geo.educational=a,a=r.sum(a,["Sort1","Sort2","Gender","no_student","no_females","no_classes","Type"]),e.indicators.forEach(function(t,r){2015===t.year&&t.area_code&&(e.indicators[r]=c()({},t,a[t.area_code.toString()]))}),e.cityIndicators.forEach(function(t,r){2015===t.year&&(e.cityIndicators[r]=c()({},t,a.total))}),console.log("cityindicators",e.cityIndicators)})})},UPDATE_FEATURES:function(e,t){console.log("updating feature",t.nestedKey,t.key,t.value);var a=w[t.collection].sort,r=w[t.collection].embedIds;t.value&&a&&(t.value=L.sort(t.value,!1,a)),t.value&&r&&(t.value=t.value.map(function(e){return L.getNested(r,e)._id=e._id,e})),p.default.set(e["_col_"+t.collection],t.key,t.value)},UPDATE_FEATURE_PROPERTIES:function(e,t){e._col_features[t.layer].splice(t.feature._index,1,t.feature);var a=function e(t){if(Array.isArray(t)){if("number"==typeof t[0])return t;e(t[0])}else e(t.geometry.coordinates)}(t.feature.feature.geometry.coordinates);console.log("coords",a),e.map.center={lat:a[1],lng:a[0]}},SET_HIDDEN:function(e,t){t.value?p.default.set(e.map,t.key,t.value):p.default.delete(e.map,t.key)},UPDATE_USER:function(e,t){t.groups=n()(t.groups).reduce(function(e,t){return e[t]=!0,e},{}),e.activeUser=t},UPDATE:function(e,t){var a,i;Array.isArray(t.key)?(t.key.length<3?(a=e[t.key[0]],i=t.key[1]):(a=L.getNested(t.key.slice(0,t.key.length-1),e),i=t.key[t.key.length-1]),console.log("updating store nested: "+i,t.value,a)):(console.log("updating store value: "+t.key,t.value),a=e,i=t.key),"object"!==r()(t.value)||Array.isArray(t.value)?p.default.set(a,i,t.value):d()(t.value).forEach(function(e){p.default.set(a[i],e,t.value[e])})},UPDATE_AREA:function(e,t){var a=e.geo.areas.filter(function(e){return e.feature.properties.id===t})[0];console.log(a),e.neighbourhood=t,e.map.center={lon:a.feature.properties.Centroids_x,lat:a.feature.properties.Centroids_y}}},getters:{styles:function(e){var t=e._col_styles.reduce(function(e,t){return e[t.layer]=e[t.layer]||{},e[t.layer][t.attribute]=e[t.layer][t.attribute]||{},e[t.layer][t.attribute][t.name]=t,e},{});return d()(t).forEach(function(a){d()(t[a]).forEach(function(r){var i=d()(t[a][r]),n=e.colors;i.length>e.colors.length&&(n=x.a.scale(e.colors).mode("lch").colors(i.length));var o=t[a][r];i.forEach(function(e,t){o[e].color=o[e].color||n[t],o[e].on=!0})})}),t},areaSelect:function(e,t){return e.indicators?t.dataByYear.concat(t.dataByCityYear):[]},neighbourhoods:function(e,t){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.name)&&e.push(t.name),e},[]):[]},years:function(e){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.year)&&t.year&&e.push(t.year),e},[]):[]},dataByYear:function(e){return e.indicators?e.indicators.filter(function(t){return t.year===e.year}):[]},dataByNeighbourhood:function(e){if(!e.indicators)return[];var t=e.indicators.filter(function(t){return t.area_code===e.neighbourhood});return t.length>0?t:e.cityIndicators},dataByHoodYear:function(e,t){return e._col_indicators.filter(function(t){return t.areaCode===e.neighbourhood&&t.year===e.year})[0]||{}},dataByCityYear:function(e){return e.cityIndicators.filter(function(t){return t.year===e.year})[0]||{}},educationalByHood:function(e){console.log("edubyhood - init",e.geo.educational);var t=e.geo.educational.reduce(function(t,a){return a.feature.properties.mygeodat_5===e.neighbourhood&&t.push(a.feature.properties),t},[]);return console.log("edubyhood",t),t},educationalGeoByHood:function(e){if(!e.geo.educational)return[];var t=e.geo.educational.filter(function(t){return t.feature.properties.mygeodat_5===e.neighbourhood});return console.log("educational geo",t),t},selectedAreas:function(e){return e._col_areas.filter(function(t){return t.layer===e._col_areaLayers_selected})},selectedArea:function(e,t){return t.selectedAreas.filter(function(t){return t.feature.properties.id===e.neighbourhood})[0]},areaNames:function(e,t){return t.selectedAreas?t.selectedAreas.reduce(function(e,t){return e[t.feature.properties.areaCode]=t.feature.properties.name,e},{}):null},selectedLayer:function(e){return e._col_layers?e._col_layers.filter(function(t){return t._id===e._col_layers_selected})[0]:null},selectedLayerAttributes:function(e){return e._col_layerAttributes?e._col_layerAttributes.filter(function(t){return t.layer===e._col_layers_selected}):null},selectedIndicatorBlocks:function(e){return e._col_indicatorBlocks?e._col_indicatorBlocks.filter(function(t){return t.active&&t.layer===e._col_indicatorSections_selected}):null},selectedIndicatorSection:function(e){return e._col_indicatorSections_selected?e._col_indicatorSections.filter(function(t){return t._id===e._col_indicatorSections_selected})[0]:null},allIndicatorKeyYears:function(e,t){var a=t.allIndicatorsByYear;return a?d()(a).reduce(function(e,t){var r=parseInt(t);return a[t].forEach(function(t){d()(t).forEach(function(a){e[a]=e[a]||[],t[a]&&-1===e[a].indexOf(r)&&e[a].push(r)})}),e},{}):null},allIndicatorsByYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.year?(e[t.year]=e[t.year]||[],e[t.year].push($(t)),e):e},{}):null},allIndicatorsByArea:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||[],e[t.areaCode].push($(t)),e):e},{}):null},allIndicatorsByAreaYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||{},e[t.areaCode][t.year]=$(t),e):e},{}):null},indicatorsForSelectedYear:function(e,t){if(t.allIndicatorsByYear)return t.allIndicatorsByYear[e.year]},indicatorsForSelectedArea:function(e,t){if(t.allIndicatorsByArea&&t.allIndicatorsByArea[e.neighbourhood])return t.allIndicatorsByArea[e.neighbourhood].sort(function(e,t){return e.year-t.year})},selectedIndicator:function(e,t){return L.getNested([e.neighbourhood,e.year],t.allIndicatorsByAreaYear)},featuresBySelectedArea:function(e){return d()(e._col_features).reduce(function(t,a){return t[a]=e._col_features[a][e.neighbourhood],t},{})},selectedFeatures:function(e,t){var a=void 0;return"indicatorSections"===e.mode?a=t.selectedIndicatorSection?t.selectedIndicatorSection.geodata:null:"layers"===e.mode&&(a=[e._col_layers_selected]),a&&a[0]?a.map(function(t){var a=e._col_features[t];return a?a.map(function(e){return e.feature}):[e._col_features,t,e._col_features[t],d()(e._col_features),r()(e._col_features)]}):null},collectionSchema:function(e){return function(t,a){var r=c()({},w[t]);if("string"==typeof r.schema){var i=e["_col_"+r.schema].filter(function(t){return t.layer===e["_col_"+a+"_selected"]}),o=w[r.schema].translate;r.schema=n()(i).reduce(function(t,a){return o&&o.forEach(function(t){a[t]=a[t+"_"+e.language]}),a._text=a._text||a.name,t[a.name]=a,t},{}),console.log("collectionSchema translate",o)}return console.log("collectionSchema",r),r||{}}},getSelected:function(e){return function(t){var a=e["_col_"+t+"_selected"];return e["_col_"+t].filter(function(e){return e._id===a})[0]||{}}},surveyRecordsByFeature:function(e){return e._col_surveyRecords[e._col_surveyLayers_selected]?e._col_surveyRecords[e._col_surveyLayers_selected].reduce(function(e,t){return e[t.feature]=e[t.feature]||[],e[t.feature].push(t),e},{}):null}}});new p.default({router:h.a,store:j,render:function(e){return e(f.a)}}).$mount("#app")}.call(this,a(19))},365:function(e,t,a){e.exports=a.p+"static/img/ejmap-logo.defd5c5.svg"},38:function(e,t,a){var r=a(402),i=["Text","Number","Boolean","Array","Date"];e.exports={layers:{name:"Layers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},data_type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Point",icon:"scatter_plot"},{name:"LineString",icon:"timeline"},{name:"MultiPolygon",icon:"bubble_chart"}]},spatial_intersect:{type:Array,_text:"Areas for Analysis",_multiple:!0,_options:function(e){return console.log("areas analysis select function"),e.state._col_areaLayers}},filtered:{type:Boolean,_text:"Filtered by area"},sourceUrl:{type:String,_text:"Source Link"},sourceLong:{type:String,_text:"Source - Full Text"},sourceShort:{type:String,_text:"Source - Short Text"}}},layerAttributes:{name:"Attributes",canPaste:!0,schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:i},func:{type:Array,_text:"Functions",_multiple:!0,_options:[{name:"count",color:"secondary"},{name:"sum",color:"tertiary"}],_computed:function(e,t,a,r){var i=e.state["_col_"+a].filter(function(e){return e.layer===r});if(i){var n=["count",""];return n="Number"===t.type?n.concat(["sum"]):n,i.reduce(function(e,t){return"Number"===t.type&&e.push("sum: "+t.name),e},n)}}},required:{type:Boolean,_text:"Required"},public:{type:Boolean,_text:"Public"},legend:{type:Boolean,_text:"Legend"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},layerCalcs:{name:"Attributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:i},layer:{type:r.Schema.Types.ObjectId,required:!0},func:{type:Array,_text:"Functions",_multiple:!0,_combobox:!0,_categorised:!0,_options:function(e,t){var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{}),i=e.state._col_layerAttributes,n=r[e.state._col_layers_selected].spatial_intersect,o=a.reduce(function(e,t){return t.spatial_intersect.some(function(e){return n.indexOf(e)>-1})&&e.push(t._id),e},[]);return i.reduce(function(e,t){if(t.func.length>0){var a=o.indexOf(t.layer);if(a>-1){var i=o[a];e[i]=e[i]||{name:r[i].text_en,items:["count"]},t.func.forEach(function(a){a&&e[i].items.push(t.name+"."+a)})}}return e},{})}}}},indicatorSections:{name:"Sections",schema:{name:{type:String,required:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},geodata:{type:Array,_text:"Feature Layers",_multiple:!0,_options:function(e){return e.state._col_layers}}}},indicatorBlocks:{name:"Modules",canPaste:!0,schema:{type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Figure"},{name:"Chart"},{name:"Table"},{name:"List"},{name:"Map"},{name:"Timeline"}]},active:{type:Boolean,_text:"Active"},layer:{type:r.Schema.Types.ObjectId,required:!0},text_en:{type:String,required:!0,_text:"Name (English)"},text_ar:{type:String,_text:"Name (Arabic)"},areaLayer:{type:Array,_text:"Spatial Intersect",_multiple:!0,_options:function(e){return e.state._col_areaLayers}},figure:{type:Array,_text:"Figure",_categorised:!0,_options:function(e,t){var a=e.state._col_layers;if("Map"===t.type)return a.reduce(function(e,t){return e.push({name:t.text_en,value:t._id}),e},[]);if(!t.areaLayer)return{error:{name:"First select a spatial intersect",value:"error"}};var r=a.reduce(function(e,t){return e[t._id]=t,e},{attached:{text_en:"Area"}}),i=e.state._col_indicatorAttributes.map(function(e){return e.func=["%%%"],e.layer="attached",e}),n=e.state._col_layerCalcs.map(function(e){return e.func=["%%%"],e}).concat(e.state._col_layerAttributes).concat(i);console.log("options layerAttrs",n);var o=a.reduce(function(e,a){return a.spatial_intersect.some(function(e){return t.areaLayer.indexOf(e)>-1})&&e.push(a._id),e},["attached"]),s=n.reduce(function(e,t){if(t.func.length>0){var a=o.indexOf(t.layer);if(a>-1){var i=o[a];e[i]=e[i]||{name:r[i].text_en,items:[]},t.func.forEach(function(a){a&&e[i].items.push((t.name+"."+a).replace(".%%%",""))})}}return e},{});return console.log("categorised options",s),s}},description_en:{type:String,_text:"Description (English)"},description_ar:{type:String,_text:"Description (Arabic)"},unit:{type:String,_text:"Unit"}}},features:{name:"Features",schema:"layerAttributes",params:"/:collection",sort:"feature.properties.year",canUpload:!0,storeByLayer:!0,embedIds:"feature.properties",layerCollection:"layers",layerAttributes:"layerAttributes"},indicators:{name:"Indicators",schema:"indicatorAttributes",schemaOpts:{strict:!0},layerCollection:"areaLayers",params:"/:collection",canUpload:!0},areaLayers:{name:"AreasLayers",schema:{name:{type:String,required:!0,_text:"Name"},code:{type:String,required:!0,unique:!0,_text:"Column Name"}}},areas:{name:"Areas",schema:"areaAttributes",params:"/:collection",canUpload:!0,layerCollection:"areaLayers"},areaAttributes:{name:"AreaAttributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:i},required:{type:Boolean,_text:"Required"},layer:{type:String,required:!0}}},indicatorAttributes:{name:"IndicatorAttributes",canPaste:!0,_description_en:"For non-spatial attribute data that is directly associatied with the spatial area i.e data from JIIS relating to a statistical area",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:i},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},surveyLayers:{name:"SurveyLayers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},featureLayer:{type:Array,_text:"Feature Layers",_multiple:!0,_options:function(e){return e.state._col_layers}}}},surveyLayerAttributes:{name:"Attributes",canPaste:!0,translate:["_text"],schema:{name:{type:String,required:!0,_text:"Name"},_text_en:{type:String,required:!0,_text:"Text (English)"},_text_ar:{type:String,required:!0,_text:"Text (Arabic)"},required:{type:Boolean,_text:"Required"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:i},_options:{type:Array,multiple:!0,_text:"Options",_categorised:!0,_options:"dynamic"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},surveyRecords:{name:"Survey Records",schema:"surveyLayerAttributes",params:"/:collection",layerCollection:"surveyLayers",storeByLayer:!0},styles:{name:"Styles",schema:{layer:{type:r.Schema.Types.ObjectId,required:!0},name:{type:String,required:!0},attribute:{type:String,required:!0},color:String}}}},394:function(e,t){e.exports=[{params:"/:query",name:"find",method:"get"},{params:"/:key",name:"distinct",method:"get"},{params:"",name:"create",auth:!0,method:"post",middleware:"formidable"},{params:"/:id",name:"del",auth:!0,method:"post"},{params:"/:params",name:"update",auth:!0,method:"post"},{params:"/:areaLayerId",name:"updateAnalysis",auth:!0,method:"post",restrict:["features"]},{params:"",name:"updateMany",auth:!0,method:"post",middleware:"formidable"},{params:"",name:"deleteMany",auth:!0,method:"post",middleware:""}]},400:function(e,t,a){"use strict";var r=a(77);a.n(r).a},401:function(e,t,a){"use strict";var r=a(78);a.n(r).a},464:function(e,t,a){var r={"./af":186,"./af.js":186,"./ar":187,"./ar-dz":188,"./ar-dz.js":188,"./ar-kw":189,"./ar-kw.js":189,"./ar-ly":190,"./ar-ly.js":190,"./ar-ma":191,"./ar-ma.js":191,"./ar-sa":192,"./ar-sa.js":192,"./ar-tn":193,"./ar-tn.js":193,"./ar.js":187,"./az":194,"./az.js":194,"./be":195,"./be.js":195,"./bg":196,"./bg.js":196,"./bm":197,"./bm.js":197,"./bn":198,"./bn.js":198,"./bo":199,"./bo.js":199,"./br":200,"./br.js":200,"./bs":201,"./bs.js":201,"./ca":202,"./ca.js":202,"./cs":203,"./cs.js":203,"./cv":204,"./cv.js":204,"./cy":205,"./cy.js":205,"./da":206,"./da.js":206,"./de":207,"./de-at":208,"./de-at.js":208,"./de-ch":209,"./de-ch.js":209,"./de.js":207,"./dv":210,"./dv.js":210,"./el":211,"./el.js":211,"./en-SG":212,"./en-SG.js":212,"./en-au":213,"./en-au.js":213,"./en-ca":214,"./en-ca.js":214,"./en-gb":215,"./en-gb.js":215,"./en-ie":216,"./en-ie.js":216,"./en-il":217,"./en-il.js":217,"./en-nz":218,"./en-nz.js":218,"./eo":219,"./eo.js":219,"./es":220,"./es-do":221,"./es-do.js":221,"./es-us":222,"./es-us.js":222,"./es.js":220,"./et":223,"./et.js":223,"./eu":224,"./eu.js":224,"./fa":225,"./fa.js":225,"./fi":226,"./fi.js":226,"./fo":227,"./fo.js":227,"./fr":228,"./fr-ca":229,"./fr-ca.js":229,"./fr-ch":230,"./fr-ch.js":230,"./fr.js":228,"./fy":231,"./fy.js":231,"./ga":232,"./ga.js":232,"./gd":233,"./gd.js":233,"./gl":234,"./gl.js":234,"./gom-latn":235,"./gom-latn.js":235,"./gu":236,"./gu.js":236,"./he":237,"./he.js":237,"./hi":238,"./hi.js":238,"./hr":239,"./hr.js":239,"./hu":240,"./hu.js":240,"./hy-am":241,"./hy-am.js":241,"./id":242,"./id.js":242,"./is":243,"./is.js":243,"./it":244,"./it-ch":245,"./it-ch.js":245,"./it.js":244,"./ja":246,"./ja.js":246,"./jv":247,"./jv.js":247,"./ka":248,"./ka.js":248,"./kk":249,"./kk.js":249,"./km":250,"./km.js":250,"./kn":251,"./kn.js":251,"./ko":252,"./ko.js":252,"./ku":253,"./ku.js":253,"./ky":254,"./ky.js":254,"./lb":255,"./lb.js":255,"./lo":256,"./lo.js":256,"./lt":257,"./lt.js":257,"./lv":258,"./lv.js":258,"./me":259,"./me.js":259,"./mi":260,"./mi.js":260,"./mk":261,"./mk.js":261,"./ml":262,"./ml.js":262,"./mn":263,"./mn.js":263,"./mr":264,"./mr.js":264,"./ms":265,"./ms-my":266,"./ms-my.js":266,"./ms.js":265,"./mt":267,"./mt.js":267,"./my":268,"./my.js":268,"./nb":269,"./nb.js":269,"./ne":270,"./ne.js":270,"./nl":271,"./nl-be":272,"./nl-be.js":272,"./nl.js":271,"./nn":273,"./nn.js":273,"./pa-in":274,"./pa-in.js":274,"./pl":275,"./pl.js":275,"./pt":276,"./pt-br":277,"./pt-br.js":277,"./pt.js":276,"./ro":278,"./ro.js":278,"./ru":279,"./ru.js":279,"./sd":280,"./sd.js":280,"./se":281,"./se.js":281,"./si":282,"./si.js":282,"./sk":283,"./sk.js":283,"./sl":284,"./sl.js":284,"./sq":285,"./sq.js":285,"./sr":286,"./sr-cyrl":287,"./sr-cyrl.js":287,"./sr.js":286,"./ss":288,"./ss.js":288,"./sv":289,"./sv.js":289,"./sw":290,"./sw.js":290,"./ta":291,"./ta.js":291,"./te":292,"./te.js":292,"./tet":293,"./tet.js":293,"./tg":294,"./tg.js":294,"./th":295,"./th.js":295,"./tl-ph":296,"./tl-ph.js":296,"./tlh":297,"./tlh.js":297,"./tr":298,"./tr.js":298,"./tzl":299,"./tzl.js":299,"./tzm":300,"./tzm-latn":301,"./tzm-latn.js":301,"./tzm.js":300,"./ug-cn":302,"./ug-cn.js":302,"./uk":303,"./uk.js":303,"./ur":304,"./ur.js":304,"./uz":305,"./uz-latn":306,"./uz-latn.js":306,"./uz.js":305,"./vi":307,"./vi.js":307,"./x-pseudo":308,"./x-pseudo.js":308,"./yo":309,"./yo.js":309,"./zh-cn":310,"./zh-cn.js":310,"./zh-hk":311,"./zh-hk.js":311,"./zh-tw":312,"./zh-tw.js":312};function i(e){var t=n(e);return a(t)}function n(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=n,e.exports=i,i.id=464},465:function(e,t,a){"use strict";var r=a(79);a.n(r).a},468:function(e,t,a){"use strict";var r=a(80);a.n(r).a},469:function(e,t,a){"use strict";var r=a(81);a.n(r).a},470:function(e,t,a){"use strict";var r=a(82);a.n(r).a},472:function(e,t,a){"use strict";var r=a(83);a.n(r).a},473:function(e,t,a){"use strict";var r=a(84);a.n(r).a},474:function(e,t,a){"use strict";var r=a(85);a.n(r).a},5:function(e,t,a){"use strict";var r=a(50),i=a.n(r),n=a(27),o=a.n(n),s=a(25),l=a.n(s),c=a(7),u=a.n(c),d=a(54),p=a.n(d),f=a(8),h=a(32),m=a.n(h),y=a(394);a(395);var v,_="http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,g=m.a.create({baseURL:_,json:!0}),b=(v=p()(l.a.mark(function e(t,a,r,i){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},r=r||{},console.log("execute function"),e.next=5,f.default.prototype.$auth.getAccessToken();case 5:return n=e.sent,e.abrupt("return",g({method:t,url:a,data:r,headers:u()({Authorization:"Bearer "+n},i)}));case 7:case"end":return e.stop()}},e,this)})),function(e,t,a,r){return v.apply(this,arguments)});function x(e){return e=(e="object"===(void 0===e?"undefined":o()(e))&&e?i()(e):e)?"/"+e:""}t.a=y.reduce(function(e,t){return e[t.name]=function(e,a,r,i,n){return a=x(a),n=x(n),console.log(t.method,""+e+n+"/"+t.name+a,r,i),b(t.method,""+e+n+"/"+t.name+a,r,i)},e},{})},51:function(t,a,r){"use strict";r.d(a,"a",function(){return i});var i={props:{title:String,"x-labels":Boolean,"y-labels":Boolean,clickHandler:Boolean},data:function(){var t=this;return{options:{axes:{display:!1},scales:{yAxes:[{display:t.$props.yLabels,gridLines:{display:!1},scaleLabel:{display:t.$props.yLabels},ticks:{display:t.$props.yLabels}}],xAxes:[{display:t.$props.xLabels,gridLines:{display:!1},scaleLabel:{display:t.$props.xLabels},ticks:{display:t.$props.xLabels}}]},legend:{display:!1},title:{display:!0,text:t.$props.title||""},maintainAspectRatio:!1,onClick:function(a,r){if(console.log("chartoutput",r[0]),t.$props.clickHandler){var i=t.$store.getters.selectedAreas.filter(function(e){return e.feature.properties.name===r[0]._model.label})[0].feature.properties;console.log("chartoutput",r[0]),t.$store.commit("UPDATE",{key:"neighbourhood",value:i.areaCode}),t.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),t.$store.commit("UPDATE",{key:["map","center"],value:{lon:i.centroid_lng,lat:i.centroid_lat}})}}}}}}},52:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement;return(e._self._c||t)("v-select",{staticClass:"area-select",attrs:{items:e.$store.state["_col_"+e.collection],"item-text":"name","item-value":"_id",flat:"",box:"",label:e.label,"append-icon":"icon"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})};r._withStripped=!0;var i={props:["collection","label","icon"],data:function(){return{selected:""}},computed:{},methods:{update:function(e){this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:e})}},watch:{selected:function(e,t){console.log(e,t),e!==t&&this.update(e)}},created:function(){this.selected=this.$store.state["_col_"+this.collection+"_selected"]},mounted:function(){var e=this;this.$store.watch(function(t,a){return t["_col_"+e.collection+"_selected"]},function(t,a){e.selected=t})}},n=a(2),o=Object(n.a)(i,r,[],!1,null,null,null);o.options.__file="src/components/LayerSelect.vue";t.a=o.exports},53:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.items?a("v-select",{staticClass:"area-select",attrs:{items:e.items,"item-text":"name","item-value":"value","return-object":"",solo:"",flat:"",dense:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e()};r._withStripped=!0;var i={data:function(){return{selected:""}},computed:{items:function(){return this.$store.getters.selectedAreas?this.$store.getters.selectedAreas.map(function(e){return{name:e.feature.properties.name,value:e.feature.properties}}):null}},methods:{update:function(e){this.$store.commit("UPDATE",{key:"neighbourhood",value:e.areaCode}),this.$store.commit("UPDATE",{key:["map","center"],value:{lon:e.centroid_lng,lat:e.centroid_lat}})}},watch:{selected:function(e,t){console.log(e,t),e!==t&&this.update(e.value)}},created:function(){var e=this.$store.getters.selectedArea;this.selected={name:e.feature.properties.name,value:e.feature.properties}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedArea},function(t,a){e.selected={name:t.feature.properties.name,value:t.feature.properties}})}},n=(a(401),a(2)),o=Object(n.a)(i,r,[],!1,null,null,null);o.options.__file="src/components/AreaSelect.vue";t.a=o.exports},64:function(e,t){var a=function(e,t,a){if(!e)return null;var i=t?-1:1,n=t?1:-1;var o=e.sort(function(e,t){var o=a?r(a,e):parseInt(e),s=a?r(a,t):parseInt(t);return o>s?i:o<s?n:0});return console.log("arrayUtils",o),o},r=function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t};t.rowsToObjects=function(e,t){return t.reduce(function(t,a){return t.push(e.reduce(function(e,t,r){return e[t]=a[r],e},{})),t},[])},t.sortNumbers=function(e,t){if(!e||!t)return null;e=e.reduce(function(e,a){var i=r(t,a);return i&&e.push(i),e},[]);for(var i=a(e),n={min:i[0]},o=i.length-1;o>=0;o--){var s=i[o];if("number"==typeof s){n.max=s;break}}return n.constant=n.max-n.min,console.log("sorted",i,n),n},t.getNested=r,t.sort=a},65:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var r=a(15),i=a.n(r),n={primary:i.a.orange.lighten1,secondary:i.a.grey.lighten3,tertiary:i.a.blue.base,error:i.a.red.base,background:"#f8f9fa",scaleMin:"#ff267e",scaleMax:"#267eff",grey:i.a.grey.base,borderColor:"#e3e3e3"}},77:function(e,t,a){},78:function(e,t,a){},79:function(e,t,a){},80:function(e,t,a){},81:function(e,t,a){},82:function(e,t,a){},83:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{style:e.timelineStyle},[a("div",{staticClass:"pa-2 grey--text text--darken-2 ejmap-border-bottom",staticStyle:{height:"40px"}},[e._v(e._s(e.title))]),e._v(" "),e.slider&&e.dateRange?a("v-range-slider",{attrs:{min:e.dateMin,max:e.dateMax,"thumb-label":"always","thumb-color":"rgba(0,0,0,0)","thumb-size":"15",light:""},scopedSlots:e._u([{key:"thumb-label",fn:function(t){return[a("span",{staticStyle:{color:"black"}},[e._v("\n            "+e._s(t.value)+"\n          ")])]}}],null,!1,2136086678),model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}):e._e(),e._v(" "),a("div",{staticStyle:{"overflow-y":"auto",flex:"1"}},[e.chartData?a("chart-timeline",{staticClass:"px-3 pb-5",style:e.chartStyle,attrs:{"x-labels":!0,"y-labels":!1,"chart-data":e.chartData}}):e._e()],1),e._v(" "),e.legend&&e.attributeStyle?a("table",{staticClass:"caption"},e._l(e.attributeStyle.categories,function(t,r){return a("tr",[a("td",{staticClass:"key-icon",style:{color:t}},[e._v("●")]),e._v(" "),a("td",{staticClass:"key-figures"},[a("span",{staticClass:"body-1 grey--text text--darken-2",staticStyle:{padding:"1px 5px"}},[e._v(e._s(r))])])])}),0):e._e()],1)};r._withStripped=!0;var i=a(7),n=a.n(i),o=a(51),s=a(28),l=s.d.reactiveProp,c={extends:s.c,mixins:[o.a,l],mounted:function(){this.options.scales.xAxes[0].scaleLabel={fontSize:7,lineHeight:.8,padding:0},this.options.scales.xAxes[0].time={bounds:"ticks",source:"auto",stepSize:5,tooltipFormat:"MMM YYYY"},this.options.title.display=!1,this.options.scales.xAxes[0].position="top",this.options.scales.xAxes[0].type="time",this.options.scales.xAxes[0].distribution="linear",this.options.scales.xAxes[0].ticks.display=!0,this.options.scales.xAxes[0].gridLines.display=!0,this.options.animation=!1,this.renderChart(this.chartData,this.options)}},u=(a(42),a(64)),d={props:["features","figure","dateKey","attribute","labelKey","slider","legend","attributeStyle","title"],components:{chartTimeline:c},data:function(){return{processing:!1,layerSelected:"",areaLayerSelected:"",dateRange:null,dateMin:null,dateMax:null,dateLabels:null}},methods:{setDateRange:function(){var e=this.featuresFiltered;if(!e[0])return null;var t=e[0].properties.year,a=e[e.length-1].properties.year;this.dateMin=parseInt(t),this.dateMax=parseInt(a),this.dateRange=[parseInt(t),parseInt(a)]},getColor:function(e){var t=this.attributeStyle;return t&&t.range?this.$store.state.colorScale(1-(e-t.range.min)/t.range.constant).hex():t.categories[e].color}},computed:{timelineStyle:function(){return{height:document.getElementById("map_features").clientHeight+"px",display:"flex",flexDirection:"column"}},chartStyle:function(){return{height:15*this.featuresFiltered.length+"px",minHeight:this.timelineStyle.height,marginTop:"0px"}},featuresFiltered:function(){var e=this,t=this.features.filter(function(t){return t.properties[e.figure]});return u.sort(t,!1,"feature.properties.year")},chartData:function(){var e=this;if(!this.dateRange)return null;var t={borderColor:"#e3e3e3",type:"line",fill:!1};return{datasets:this.featuresFiltered.map(function(a,r){var i=a.properties[e.figure];return n()({},t,{label:a.properties[e.labelKey],borderColor:e.getColor(a.properties[e.attribute]),data:i.map(function(t){return{t:t[e.dateKey],y:r}})})})}}},mounted:function(){this.setDateRange()}},p=a(2),f=Object(p.a)(d,r,[],!1,null,null,null);f.options.__file="src/components/Timeline.vue";t.a=f.exports},87:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",[e.title?a("v-card-title",[e.schema&&e.schema.name?a("span",{staticClass:"headline"},[e._v(e._s(e.mode)+" "+e._s(e.schema.name.slice(0,e.schema.name.length-1)))]):e._e()]):e._e(),e._v(" "),a("v-tabs",{attrs:{color:"#f3f3f3","slider-color":"grey",grow:"",height:e.schema.canPaste?null:"0px"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Single")]),e._v(" "),e.schema.canPaste?a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Multiple")]):e._e(),e._v(" "),a("v-tab-item",[a("v-form",{ref:"form"},[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},e._l(e.schema.schema,function(t,r){return a("v-flex",{attrs:{xs12:""}},[t._options&&Array.isArray(t._options)&&t._options.length>0?a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,clearable:"","item-text":"text_"+e.$store.state.language||!1,"item-value":"value",rules:[e.validateItem(e.edited[r],t)],items:t._options},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):t._options&&"dynamic"===t._options?a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[a("p",{staticClass:"subheading"},[e._v(" "+e._s(Object.keys(e.edited[r]).length?"Choices":"")+" ")]),e._v(" "),a("div",{staticStyle:{"flex-basis":"100%"}}),e._v(" "),e._l(e.edited[r],function(t,i){return a("div",{staticStyle:{width:"100%",display:"flex"}},[e._l(e.$store.state.languages,function(n){return a("v-text-field",{staticClass:"pl-2",attrs:{label:i+1+". "+n.text,rules:[e.validateItem(e.edited[r],i)]},model:{value:t["text_"+n.name],callback:function(a){e.$set(t,"text_"+n.name,a)},expression:"item['text_'+l.name]"}})}),e._v(" "),a("v-btn",{attrs:{icon:""},on:{click:function(t){return e.edited[r].splice(i,1)}}},[a("v-icon",{attrs:{color:"grey"}},[e._v("clear")])],1)],2)}),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{flat:"",outline:"",color:"grey"},on:{click:function(t){return e.addItem(e.edited[r])}}},[e._v(e._s(Object.keys(e.edited[r]).length?"add option":"Make Multiple Choice"))])],2):"function"!=typeof t._options||t._categorised?t._categorised?a("div",[a("v-combobox",{attrs:{multiple:"","small-chips":""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}),e._v(" "),a("v-menu",{attrs:{"full-width":"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",color:"grey",outline:""},slot:"activator"},[e._v("\n            "+e._s(r)+"\n          ")]),e._v(" "),a("v-list",{attrs:{dense:""}},[e._l(t._options(e.$store,e.edited,e.collection),function(t,i){return[t.value?a("v-list-tile",{key:i,on:{click:function(a){return e.edited[r].push(t.value)}}},[e._v("\n                "+e._s(t.name)+"\n\n              ")]):t.items?a("v-menu",{key:i,attrs:{"full-width":"","offset-x":"","max-height":"500","open-on-hover":""}},[a("v-list-tile",{attrs:{slot:"activator"},on:{click:function(e){}},slot:"activator"},[a("v-list-tile-title",[e._v(e._s(t.name))])],1),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t.items,function(t,n){return a("v-list-tile",{on:{click:function(a){return e.edited[r].push(i+"."+t)}}},[a("v-list-tile-title",[e._v(e._s(t))])],1)}),1)],1):e._e()]})],2)],1)],1):t.type===Boolean||"Boolean"===t.type?a("v-switch",{attrs:{label:t._text,color:"primary"},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):t._text?a("v-text-field",{attrs:{label:t._text,type:"Number"===t.type?"number":"text",rules:[e.validateItem(e.edited[r],t)]},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-text-field",{attrs:{label:t._text,disabled:""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,clearable:"",items:t._options(e.$store,e.edited,e.collection),"item-text":"name","item-value":"_id",rules:[e.validateItem(e.edited[r],t)]},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}})],1)}),1)],1)],1),e._v(" "),a("v-card-actions",[a("v-btn",{attrs:{color:"red darken-1",flat:""},on:{click:function(t){return e.save(!0)}}},[e._v("Delete")]),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Close")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.save()}}},[e._v("Save")])],1)],1)],1),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("div",{staticClass:"title pb-2"},[e._v("Paste attributes")]),e._v("\n      Paste as rows of text, separated by commas or tabs: "),a("br"),e._v(" "),a("v-text-field",{attrs:{hint:Object.keys(e.schema.schema).join(", "),textarea:"","auto-grow":"",rows:"3"},model:{value:e.pasted,callback:function(t){e.pasted=t},expression:"pasted"}}),e._v("\n\n      Preview\n      "),e.pastedComputed?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:e.pastedComputed}}):e._e()],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.saveMany()}}},[e._v("Save")])],1)],1)],1),e._v(" "),a("v-snackbar",{attrs:{top:"",timeout:1e3,color:e.$store.state.colors[2]},model:{value:e.success,callback:function(t){e.success=t},expression:"success"}},[a("v-icon",[e._v("check")]),e._v("Saved")],1)],1)};r._withStripped=!0;var i=a(50),n=a.n(i),o=a(7),s=a.n(o),l=a(3),c=a.n(l),u=a(33),d=a.n(u),p=a(5),f=a(38),h=a(64),m={components:{VueJsonPretty:d.a},props:["collection","filter","nestedPath","editItem","attributes","linkedFeature","permanent","title"],data:function(){return{activeTab:null,saving:!1,editedIndex:null,pasted:null,attributeTypes:["String","Number","Boolean"],editedCollection:null,edited:{},uploadDialog:!1,featureEdit:[],datatableTab:null,selectAll:!1,runedit:!1,success:!1}},computed:{mode:function(){return this.editItem?"Edit":"Add"},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},schema:function(){return this.$store.getters.collectionSchema(this.collection,this.filter)},schemaNames:function(){return this.schema.name?[this.schema.name,this.relatedSchema.name].reduce(function(e,t){return t&&e.push(t.slice(0,t.length-1)),e},[]):null},pastedComputed:function(){var e=this,t=this.pasted;if(!t)return[];t=t.replace(/\t/g,","),console.log("replaced",t);var a=c()(this.schema.schema);return t.split("\n").reduce(function(t,r){var i=r.split(",");return i.length<2?t:(t.push(i.reduce(function(t,r,i){var n=a[i];return r=r.trim(),e.schema.schema[n].type===Boolean&&(r="true"===r.toLowerCase()),t[n]=r,t},{})),t)},[])}},methods:{validateItem:function(e,t){return!(t.required&&!e&&0!==e)||t._text_en+" is required"},addItem:function(e){var t=s()({value:e.length.toString()},this.$store.state.languages.reduce(function(e,t){return e["text_"+t.name]="",e},{}));this.$set(e,e.length,t)},edit:function(){var e=this;this.runedit=!0;var t=this.templateFromSchema(this.schema.schema),a=s()({},t,h.getNested(this.nestedPath,this.editItem));c()(a).forEach(function(t){e.$set(e.edited,t,a[t])}),console.log("editItem",this.edited,t,this.editItem)},save:function(e){var t=this;if(this.saving=!0,console.log(this.$refs.form.validate()),!e&&!this.$refs.form.validate())return this.saving=!1,null;var a=this.editItem?this.editItem._id:null,r=e?a:{id:a},i=this,n=s()({},this.edited);this.nestedPath&&(n=c()(this.edited).reduce(function(e,a){var r=i.edited[a];return r=(r=(r="string"==typeof r&&""===r.trim()?null:r)&&"Number"===t.schema.schema[a].type?parseInt(r):r)&&"Text"===t.schema.schema[a].type?r.toString():r,e[i.nestedPath+"."+a]=r,e},{})),this.filter&&(n.layer=this.filterId),this.linkedFeature&&(n.feature=this.linkedFeature);var o=f[this.collection].params?this.filterId:"";console.log("saving",[this.collection,r.id,n]);var l=e?"del":"update";p.a[l](this.collection,r,n,{},o).then(function(){t.edit(),t.$emit("update",!0),t.saving=!1,t.success=!0,t.$forceUpdate(),t.permanent||t.$emit("close",!0)}).catch(function(e){alert(e)})},close:function(){this.edited={},this.$emit("close",!0)},saveMany:function(){var e=this;if(this.saving=!0,console.log("filterId: "+this.filterId+" collection: "+this.collection),this.pastedComputed[0]&&c()(this.pastedComputed[0]).length>1){this.pastedComputed=this.pastedComputed.map(function(t){return t.layer=e.filterId,t});var t=new FormData;t.append("data",n()(this.pastedComputed)),console.log("making request..."),p.a.create(this.collection,"",t).then(function(t){console.log("uploaded"),e.close(),e.pasted=""})}},templateFromSchema:function(e){if(e)return c()(e).reduce(function(t,a){return e[a].type===Array?t[a]=[]:e[a].type===Boolean?t[a]=!1:t[a]="",t},{})}},watch:{editItem:function(){this.edit()}},mounted:function(){var e=f[this.collection].schema;"string"==typeof e&&(e=this.attributes),this.edit()}},y=a(2),v=Object(y.a)(m,r,[],!1,null,null,null);v.options.__file="src/components/Editor.vue";t.a=v.exports}});