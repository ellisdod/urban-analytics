!function(e){function t(t){for(var r,n,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)n=s[d],i[n]&&p.push(i[n][0]),i[n]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);p.length;)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,s=1;s<a.length;s++){var l=a[s];0!==i[l]&&(r=!1)}r&&(o.splice(t--,1),e=n(n.s=a[0]))}return e}var r={},i={0:0},o=[];function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;o.push([457,1]),a()}({342:function(e,t,a){e.exports=a.p+"static/img/undp-logo.92bc5f1.svg"},373:function(e,t){e.exports=[{params:"/:query",name:"find",method:"get"},{params:"/:key",name:"distinct",method:"get"},{params:"",name:"create",auth:!0,method:"post",middleware:"formidable"},{params:"/:id",name:"del",auth:!0,method:"post"},{params:"/:params",name:"update",auth:!0,method:"post"},{params:"",name:"update",auth:!0,method:"post"},{params:"/:areaLayerId",name:"updateAnalysis",auth:!0,method:"post",restrict:["features"]},{params:"",name:"updateMany",auth:!0,method:"post",middleware:"formidable"}]},379:function(e,t,a){"use strict";var r=a(70);a.n(r).a},380:function(e,t,a){"use strict";var r=a(71);a.n(r).a},381:function(e,t,a){"use strict";var r=a(72);a.n(r).a},383:function(e,t,a){var r={"./af":146,"./af.js":146,"./ar":147,"./ar-dz":148,"./ar-dz.js":148,"./ar-kw":149,"./ar-kw.js":149,"./ar-ly":150,"./ar-ly.js":150,"./ar-ma":151,"./ar-ma.js":151,"./ar-sa":152,"./ar-sa.js":152,"./ar-tn":153,"./ar-tn.js":153,"./ar.js":147,"./az":154,"./az.js":154,"./be":155,"./be.js":155,"./bg":156,"./bg.js":156,"./bm":157,"./bm.js":157,"./bn":158,"./bn.js":158,"./bo":159,"./bo.js":159,"./br":160,"./br.js":160,"./bs":161,"./bs.js":161,"./ca":162,"./ca.js":162,"./cs":163,"./cs.js":163,"./cv":164,"./cv.js":164,"./cy":165,"./cy.js":165,"./da":166,"./da.js":166,"./de":167,"./de-at":168,"./de-at.js":168,"./de-ch":169,"./de-ch.js":169,"./de.js":167,"./dv":170,"./dv.js":170,"./el":171,"./el.js":171,"./en-SG":172,"./en-SG.js":172,"./en-au":173,"./en-au.js":173,"./en-ca":174,"./en-ca.js":174,"./en-gb":175,"./en-gb.js":175,"./en-ie":176,"./en-ie.js":176,"./en-il":177,"./en-il.js":177,"./en-nz":178,"./en-nz.js":178,"./eo":179,"./eo.js":179,"./es":180,"./es-do":181,"./es-do.js":181,"./es-us":182,"./es-us.js":182,"./es.js":180,"./et":183,"./et.js":183,"./eu":184,"./eu.js":184,"./fa":185,"./fa.js":185,"./fi":186,"./fi.js":186,"./fo":187,"./fo.js":187,"./fr":188,"./fr-ca":189,"./fr-ca.js":189,"./fr-ch":190,"./fr-ch.js":190,"./fr.js":188,"./fy":191,"./fy.js":191,"./ga":192,"./ga.js":192,"./gd":193,"./gd.js":193,"./gl":194,"./gl.js":194,"./gom-latn":195,"./gom-latn.js":195,"./gu":196,"./gu.js":196,"./he":197,"./he.js":197,"./hi":198,"./hi.js":198,"./hr":199,"./hr.js":199,"./hu":200,"./hu.js":200,"./hy-am":201,"./hy-am.js":201,"./id":202,"./id.js":202,"./is":203,"./is.js":203,"./it":204,"./it-ch":205,"./it-ch.js":205,"./it.js":204,"./ja":206,"./ja.js":206,"./jv":207,"./jv.js":207,"./ka":208,"./ka.js":208,"./kk":209,"./kk.js":209,"./km":210,"./km.js":210,"./kn":211,"./kn.js":211,"./ko":212,"./ko.js":212,"./ku":213,"./ku.js":213,"./ky":214,"./ky.js":214,"./lb":215,"./lb.js":215,"./lo":216,"./lo.js":216,"./lt":217,"./lt.js":217,"./lv":218,"./lv.js":218,"./me":219,"./me.js":219,"./mi":220,"./mi.js":220,"./mk":221,"./mk.js":221,"./ml":222,"./ml.js":222,"./mn":223,"./mn.js":223,"./mr":224,"./mr.js":224,"./ms":225,"./ms-my":226,"./ms-my.js":226,"./ms.js":225,"./mt":227,"./mt.js":227,"./my":228,"./my.js":228,"./nb":229,"./nb.js":229,"./ne":230,"./ne.js":230,"./nl":231,"./nl-be":232,"./nl-be.js":232,"./nl.js":231,"./nn":233,"./nn.js":233,"./pa-in":234,"./pa-in.js":234,"./pl":235,"./pl.js":235,"./pt":236,"./pt-br":237,"./pt-br.js":237,"./pt.js":236,"./ro":238,"./ro.js":238,"./ru":239,"./ru.js":239,"./sd":240,"./sd.js":240,"./se":241,"./se.js":241,"./si":242,"./si.js":242,"./sk":243,"./sk.js":243,"./sl":244,"./sl.js":244,"./sq":245,"./sq.js":245,"./sr":246,"./sr-cyrl":247,"./sr-cyrl.js":247,"./sr.js":246,"./ss":248,"./ss.js":248,"./sv":249,"./sv.js":249,"./sw":250,"./sw.js":250,"./ta":251,"./ta.js":251,"./te":252,"./te.js":252,"./tet":253,"./tet.js":253,"./tg":254,"./tg.js":254,"./th":255,"./th.js":255,"./tl-ph":256,"./tl-ph.js":256,"./tlh":257,"./tlh.js":257,"./tr":258,"./tr.js":258,"./tzl":259,"./tzl.js":259,"./tzm":260,"./tzm-latn":261,"./tzm-latn.js":261,"./tzm.js":260,"./ug-cn":262,"./ug-cn.js":262,"./uk":263,"./uk.js":263,"./ur":264,"./ur.js":264,"./uz":265,"./uz-latn":266,"./uz-latn.js":266,"./uz.js":265,"./vi":267,"./vi.js":267,"./x-pseudo":268,"./x-pseudo.js":268,"./yo":269,"./yo.js":269,"./zh-cn":270,"./zh-cn.js":270,"./zh-hk":271,"./zh-hk.js":271,"./zh-tw":272,"./zh-tw.js":272};function i(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=383},384:function(e,t,a){"use strict";var r=a(73);a.n(r).a},449:function(e,t,a){"use strict";var r=a(74);a.n(r).a},450:function(e,t,a){"use strict";var r=a(75);a.n(r).a},451:function(e,t,a){"use strict";var r=a(76);a.n(r).a},452:function(e,t,a){"use strict";var r=a(77);a.n(r).a},457:function(e,t,a){"use strict";a.r(t);var r=a(28),i=a.n(r),o=a(15),n=a.n(o),s=a(5),l=a.n(s),c=a(37),u=a.n(c),d=a(16),p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",{attrs:{id:"keep",app:""}},[r("v-toolbar",{staticClass:"ejmap-border-bottom",attrs:{app:"",light:"","clipped-left":"",flat:"",color:"#fff"}},[r("v-toolbar-side-icon",{on:{click:function(t){t.stopPropagation(),e.miniNav=!e.miniNav}}}),e._v(" "),r("v-toolbar-title",[r("div",{staticStyle:{"margin-bottom":"-5px"}},[e._v("Urban Analytics")]),e._v(" "),r("div",{staticClass:"grey--text",staticStyle:{"font-size":"0.6em"}},[e._v("East Jerusalem")])]),e._v(" "),r("v-spacer"),e._v(" "),e._l(e.items,function(t){return r("v-btn",{attrs:{to:t.route,icon:""}},[r("v-icon",[e._v(e._s(t.icon))])],1)}),e._v(" "),r("v-menu",{attrs:{"min-width":"300","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[r("v-list-tile",e._g({},a),[r("v-list-tile-action",[r("v-icon",[e._v("person")])],1),e._v(" "),r("v-list-tile-content",[e.activeUser?r("v-list-tile-title",{staticClass:"grey--text"},[e._v("\n            "+e._s(e.activeUser.email)+"\n          ")]):r("v-list-tile-title",{staticClass:"grey--text"},[e._v("\n            Login\n          ")])],1)],1)]}}])},[e._v(" "),r("v-card",[r("v-list",[e.activeUser?r("v-list-tile",{attrs:{avatar:""}},[r("v-list-tile-content",[r("v-list-tile-title",[e._v(e._s(e.activeUser.name))]),e._v(" "),r("v-list-tile-sub-title",[e._v("IPCC")])],1)],1):e._e()],1),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),e.activeUser?r("v-btn",{attrs:{color:"primary",flat:""},on:{click:e.logout}},[e._v("Logout")]):r("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return t.preventDefault(),e.login(t)}}},[e._v("Login")])],1)],1)],1)],2),e._v(" "),e.loading?r("v-content",{staticClass:"py-5 my-5 text-xs-center",staticStyle:{height:"100%"}},[r("v-progress-circular",{staticClass:"py-5 my-5",attrs:{indeterminate:""}}),e._v(" "),r("div",{staticClass:"mt-3"},[e._v("Loading data...")])],1):r("v-content",[r("router-view",{staticStyle:{height:"100%"}})],1),e._v(" "),r("div",{staticClass:"pa-3",staticStyle:{position:"absolute",bottom:"20px",left:"20px"}},[r("img",{staticStyle:{position:"absolute",bottom:"20px"},attrs:{src:a(342),width:"46px;"}})])],1)};p._withStripped=!0;var f=a(23),v=a.n(f),h=a(45),m=a.n(h),_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("l-map",{ref:"myMap",staticClass:"main-map",attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"map_"+e.featuresCollection},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["detailed"==e.baseMap?a("l-protobuf",{attrs:{url:"https://maps.tilehosting.com/data/v3/{z}/{x}/{y}.pbf?key=ArAI1SXQTYA6P3mWFnDs",options:e.protobufOpts}}):e._e(),e._v(" "),"basic"==e.baseMap?a("l-tile-layer",{attrs:{url:"https://cartodb-basemaps-b.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png",options:e.protobufOpts}}):e._e(),e._v(" "),e._l(e.$store.state._col_areas.filter(function(e){return e.feature}),function(t,r){return e.areas?a("l-geo-json",{key:t._id,attrs:{geojson:t.feature,"options-style":e.areaStyle}}):e._e()}),e._v(" "),e._l(e.featuresWithIds,function(t,r){return e.featuresWithIds[0]?a("l-geo-json",{key:r,attrs:{geojson:t.feature,options:e.geoJsonPointOptions(e.dataType,t)}}):e._e()})],2),e._v(" "),a("div",{staticClass:"map-menu"},[a("v-menu",{attrs:{"min-width":"300px",flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}])},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{attrs:{dense:""}},[a("div",{staticClass:"px-4"},[a("div",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return[a("v-switch",{key:r,attrs:{label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})]})],2),e._v(" "),e._l(e.items,function(t,r){return t.children?a("v-list-group",{key:t.text,attrs:{"prepend-icon":t.model?t.icon:t["icon-alt"],"append-icon":""},scopedSlots:e._u([{key:"activator",fn:function(){return[a("v-list-tile",[a("v-list-tile-content",[a("v-list-tile-title",[e._v("\n              "+e._s(t.heading)+"\n            ")])],1)],1)]},proxy:!0}],null,!0),model:{value:t.model,callback:function(a){e.$set(t,"model",a)},expression:"item.model"}},[e._v(" "),e._l(t.children,function(t,r){return[a("v-switch",{key:r,attrs:{label:t.text},on:{click:function(a){return e.getSurveyData(t.text)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"child.selected"}})]})],2):t.heading?a("v-layout",{key:r,attrs:{row:"","align-center":""}},[a("v-flex",{attrs:{xs6:""}},[t.heading?a("v-subheader",[e._v("\n        "+e._s(t.heading)+"\n      ")]):e._e()],1)],1):t.divider?a("v-divider",{key:r,staticClass:"my-3",attrs:{dark:""}}):e._e()}),e._v(" "),a("v-divider")],2)],1)],1)],1)};_._withStripped=!0;var y=a(18),g=a.n(y),b=a(58),x=a.n(b),w=a(458),k=a(459),C=a(460),S=a(461),$=a(462),j=a(463),A=a(464),O=function(){var e=this.$createElement;return(this._self._c||e)("div")};O._withStripped=!0;var D=a(1),E=a.n(D);a(351);if(void 0===E.a)throw new Error("leaflet library must be installed in order to use vue2-leaflet-vectorgrid.");if(void 0===E.a.vectorGrid)throw new Error("leaflet.vectorgrid library must be installed in order to use vue2-leaflet-vectorgrid.");var F={props:{url:{type:String,required:!0},options:{type:Object,default:function(){return{}}}},watch:{url:function(){this.updateLayer()},options:function(){this.updateLayer()}},mounted:function(){this.mapObject=E.a.vectorGrid.protobuf(this.url,this.options),this.$parent._isMounted&&this.deferredMountedTo(this.$parent.mapObject)},beforeDestroy:function(){this.removeLayer()},methods:{deferredMountedTo:function(e){this.mapObject.addTo(e),this.attributionControl=e.attributionControl;for(var t=0;t<this.$children.length;t++)"function"==typeof this.$children[t].deferredMountedTo&&this.$children[t].deferredMountedTo(this.mapObject)},setAttribution:function(e,t){this.attributionControl.removeAttribution(t),this.attributionControl.addAttribution(e)},setToken:function(e){this.options.token=e},removeLayer:function(){this.$parent.mapObject.removeLayer(this.mapObject)},updateLayer:function(){this.removeLayer(),this.mapObject=E.a.vectorGrid.protobuf(this.url,this.options),this.deferredMountedTo(this.$parent.mapObject)}}},T=a(3),P=Object(T.a)(F,O,[],!1,null,null,null);P.options.__file="public/Vue2LeafletVectorGridProtobuf.vue";var I=P.exports,U=a(117),M=a.n(U),N=(M()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.4},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.4},landcover:{fill:!0,weight:1,fillColor:"#53e033",color:"#53e033",fillOpacity:.1,opacity:.4},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.2,opacity:.4},park:{fill:!0,weight:1,fillColor:"#84ea5b",color:"#84ea5b",fillOpacity:.2,opacity:.4},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.2,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.2,opacity:.8}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.8}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[]),M()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.2},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.2},landcover:{fill:!0,weight:1,fillColor:"#fafafa",color:"#fafafa",fillOpacity:.1,opacity:.2},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.1,opacity:.2},park:{fill:!0,weight:1,fillColor:"#f3f3f3",color:"#f3f3f3",fillOpacity:.1,opacity:.2},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.1,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.1,opacity:.4}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.1,opacity:.4}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[])),B=a(22),z=a.n(B),Y=a(373);a(374);var q,H="http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,G=z.a.create({baseURL:H,json:!0}),K=(q=m()(v.a.mark(function e(t,a,r,i){var o;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},r=r||{},e.next=4,d.default.prototype.$auth.getAccessToken();case 4:return o=e.sent,e.abrupt("return",G({method:t,url:a,data:r,headers:l()({Authorization:"Bearer "+o},i)}));case 6:case"end":return e.stop()}},e,this)})),function(e,t,a,r){return q.apply(this,arguments)});function J(e){return e=(e="object"===(void 0===e?"undefined":n()(e))&&e?i()(e):e)?"/"+e:""}var V=Y.reduce(function(e,t){return e[t.name]=function(e,a,r,i,o){return a=J(a),o=J(o),console.log(t.method,""+e+o+"/"+t.name+a,r,i),K(t.method,""+e+o+"/"+t.name+a,r,i)},e},{}),R=a(57),Z=a.n(R),W=a(46),Q={name:"MapView",props:["features","featuresCollection","zoomLevel","dataType","areas"],components:{LMap:w.a,LTileLayer:k.a,LMarker:C.a,LPopup:S.a,LTooltip:$.a,LProtobuf:I,LPolygon:j.a,LGeoJson:A.a},$_veeValidate:{validator:"new"},data:function(){var e=this;return{language:"ar",languages:["ar","en"],basemaps:{url:"https://{s}.basemaps.cartocdn.com/{z}/{x}/{y}.png",url2:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",url3:"http://a.tile.openstreetmap.fr/hot/${z}/${x}/${y}.png "},center:E.a.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:E.a.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5},areaStyle:{weight:1,color:"#ccc",opacity:1,fillOpacity:0},geoJsonOptions:{onEachFeature:function(t,a){var r=e,i=t.properties,o=r.$store.getters.indicatorsForSelectedYear.filter(function(e){return e.areaCode===i.id})[0];a.bindPopup("<p>"+o.name+"</p><p>"+r.$store.state.navigator.indicator.name+": "+o[r.$store.state.navigator.indicator.figure]+"</p>"),a.on({click:function(e){console.log(e.target)},mouseover:function(e){}})}},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;console.log(e.target),r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),r.$store.commit("UPDATE",{key:"selectedFeature",value:e.target.feature.properties._id}),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.Centroids_x,lat:t.Centroids_y}})}})}},layers:{areas:!0},pointStyle:{radius:4,fillColor:"blue",weight:0,opacity:1,fillOpacity:.5},survey:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!0},{text:"Detailed",type:"detailed",selected:!1}],baseMap:"basic",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}}}},computed:{items:function(){return this.$auth.isAuthenticated(),[]},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return x()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:N,maxNativeZoom:18,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},surveyQuestions:function(){return this.translate(W,"label",this.language)},scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return t[e.$store.state.map.indicator.figure]}).sort(function(e,t){return e-t});return{min:t[0],max:t[t.length-1]-t[0]}},zoom:function(){return parseInt(this.zoomLevel)||this.$store.state.map.zoom||14},featuresWithIds:function(){if(this.features.length>0)return console.log("features",this.features.length),this.features.map(function(e){return e.feature.properties._id=e._id,e})},featuresAsGeojson:function(){return this.features?this.features.map(function(e){return e.feature}):[]}},methods:{geoJsonPointOptions:function(e,t){if("Point"!==e)return this.areasGeoJsonOptions;var a=this;t.feature.geometry.coordinates[0],t.feature.geometry.coordinates[1];return{pointToLayer:function(e,t){return E.a.circleMarker(t,a.pointStyle)},onEachFeature:function(e,t){var r=e.properties;t.bindPopup("<p>"+r.type+"</p><p>"+r.students+"</p>"),t.on({click:function(e){a.$store.commit("UPDATE",{key:"selectedFeature",value:e.target.feature.properties._id})},mouseover:function(e){e.target.openPopup()},mouseout:function(e){e.target.closePopup()}})}}},getPointStyle:function(e){return{color:"blue",opacity:1,weight:5}},getAreaStyle:function(e){return this.$store.state.neighbourhood===e?{weight:2,color:"black",opacity:.6,fillColor:"#fff",fillOpacity:0}:{opacity:0,fillOpacity:0}},updateBaseMap:function(e,t){console.log(e,t),this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},showLongText:function(){this.showParagraph=!this.showParagraph},innerClick:function(){console.log(!0)},popup:function(e){console.log(e)},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return E.a.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;V.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;V.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){var e=document.getElementsByClassName("v-toolbar__extension")[0].style;console.log(e),e.overflow="auto"},500)},translate:function(e,t,a){return function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":n()(i)))return i[a]=i[a+"_"+r],g()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(e,t,a)},log:function(){this.$refs.myMap.mapObject.invalidateSize()}},mounted:function(){window.screen.width<800&&this.updateBaseMap("basic",!0),this.editFeature=W.reduce(function(e,t){return e[t.name]="",e},{}),this.editFeatureDefaults=l()({},this.editFeature);var e=this;setTimeout(function(){console.log("mounting map"),e.$refs.myMap.mapObject.invalidateSize()},1e3)}},X=(a(379),Object(T.a)(Q,_,[],!1,null,null,null));X.options.__file="src/components/MapView.vue";var ee=X.exports,te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("table",{attrs:{id:"navigator-key"}},[a("tr",{attrs:{id:"navigator-header"}},[a("td",{staticClass:"subheading grey--text text--darken-2",attrs:{colspan:"2"}},[e._v("\n          "+e._s(e.$store.state.navigator.indicator.name)+"\n          "),a("div",{staticClass:"caption py-1"},[e._v("\n          "+e._s(e.details.neighbourhood)+"\n          "),a("div",[e._v("\n          "+e._s(e.details.value)+"\n        ")])])])]),e._v(" "),a("tr"),e._v(" "),a("tr",[a("td",{staticClass:"key-gradient"}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n            "+e._s(e.scale.max.toFixed(0))+"\n          ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n            "+e._s(e.scale.min.toFixed(0))+"\n          ")])])])]),e._v(" "),a("l-map",{attrs:{zoom:e.$store.state.navigator.zoom,center:e.$store.state.navigator.center,options:e.mapOptions,id:"navigation-map"}},e._l(e.$store.state._col_areas.filter(function(e){return e.feature}),function(t,r){return a("l-geo-json",{key:t._id,attrs:{geojson:t.feature,options:e.areasGeoJsonOptions,"options-style":e.getAreaStyle(t.feature.properties.id)}})}),1)],1)};te._withStripped=!0;var ae={name:"MapView",components:{LMap:w.a,LTileLayer:k.a,LMarker:C.a,LPopup:S.a,LTooltip:$.a,LPolygon:j.a,LGeoJson:A.a},data:function(){var e=this;return{zoom:14,center:L.latLng(31.801141899926307,35.18584083885216),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',showParagraph:!1,details:{neighbourhood:"",value:"",key:""},detailsDefault:{neighbourhood:"",value:"",key:""},mapOptions:{zoomSnap:.5},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.Centroids_x,lat:t.Centroids_y}})},mouseover:function(e){var t=r.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e.target.feature.properties.id})[0];r.details={neighbourhood:t.name,value:t[r.$store.state.navigator.indicator.figure],key:""}},mouseout:function(e){r.details=r.detailsDefault}})}},layers:{areas:!0}}},computed:{scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return parseInt(t[e.$store.state.navigator.indicator.figure])}).sort(function(e,t){return e-t});return console.log("scale sorted",this.$store.state.navigator.indicator.figure,t),{min:t[0]||0,constant:t[t.length-1]-t[0]||0,max:t[t.length-1]||0}}},methods:{getAreaStyle:function(e){var t=Z.a.scale(["white","orange"]),a=this.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=t((a[this.$store.state.navigator.indicator.figure]-this.scale.min)/this.scale.constant),i=this.$store.state.neighbourhood===e?this.$vuetify.theme.tertiary:"#eee";return{weight:(this.$store.state.neighbourhood,1),color:i,opacity:1,fillColor:r,fillOpacity:1}},selectArea:function(e){},mouseoverArea:function(e){}},mounted:function(){}},re=(a(380),Object(T.a)(ae,te,[],!1,null,null,null));re.options.__file="src/components/MapNavigator.vue";var ie=re.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.desserts},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.name))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.calories))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.fat))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.carbs))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.iron))])]}}])})};oe._withStripped=!0;var ne={data:function(){return{headers:[{text:"Dessert (100g serving)",align:"left",sortable:!1,value:"name"},{text:"Calories",value:"calories"},{text:"Fat (g)",value:"fat"},{text:"Carbs (g)",value:"carbs"},{text:"Protein (g)",value:"protein"},{text:"Iron (%)",value:"iron"}],desserts:[{name:"Frozen Yogurt",calories:159,fat:6,carbs:24,protein:4,iron:"1%"},{name:"Ice cream sandwich",calories:237,fat:9,carbs:37,protein:4.3,iron:"1%"},{name:"Eclair",calories:262,fat:16,carbs:23,protein:6,iron:"7%"},{name:"Cupcake",calories:305,fat:3.7,carbs:67,protein:4.3,iron:"8%"},{name:"Gingerbread",calories:356,fat:16,carbs:49,protein:3.9,iron:"16%"},{name:"Jelly bean",calories:375,fat:0,carbs:94,protein:0,iron:"0%"},{name:"Lollipop",calories:392,fat:.2,carbs:98,protein:0,iron:"2%"},{name:"Honeycomb",calories:408,fat:3.2,carbs:87,protein:6.5,iron:"45%"},{name:"Donut",calories:452,fat:25,carbs:51,protein:4.9,iron:"22%"},{name:"KitKat",calories:518,fat:26,carbs:65,protein:7,iron:"6%"}]}}},se=Object(T.a)(ne,oe,[],!1,null,null,null);se.options.__file="src/components/Viewer.vue";var le={name:"App",components:{MapView:ee,Viewer:se.exports},data:function(){return{loading:!0,miniNav:!0,activeUser:null,authenticated:!1,drawerIndicators:!1,layersPanel:!0,currentView:"map-view",layers:[],indicators:[{heading:"Demographics",icon:"keyboard_arrow_up","icon-alt":"keyboard_arrow_down",text:"More",model:!1,children:[{name:"Persons",value:29e4},{name:"Median Age",value:25.4},{name:"Growth - natural (2018)",value:"3.5%"},{name:"Growth - migration (2018)",value:"4.5%"},{name:"Gender m/f",value:"49/50"}]},{heading:"Housing",icon:"keyboard_arrow_up","icon-alt":"keyboard_arrow_down",text:"More",model:!1,children:[{name:"Housing Units",value:36700},{name:"Avg. Persons per Household",value:5.2},{name:"Avg. Rooms per Household",value:3.5},{name:"Avg. Area of Household",value:"70m2"}]},{heading:"Services",icon:"keyboard_arrow_up","icon-alt":"keyboard_arrow_down",text:"More",model:!1,children:[{name:"Secondary Schools",value:3},{name:"Primary Schools",value:2},{name:"Kindergartens",value:5}]}]}},computed:{items:function(){var e=[{icon:"help",text:"Help",route:"help"},{icon:"cloud_download",text:"Export Data"},{icon:"bar_chart",text:"Urban Indicators",route:"indicators"}];return this.activeUser?e.concat([{divider:!0},{icon:"settings",text:"Manage Data",route:"manage"}]):e}},props:{source:String},created:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshActiveUser();case 2:case"end":return t.stop()}},t,e)}))()},watch:{$route:"refreshActiveUser"},methods:{login:function(){this.$auth.loginRedirect()},refreshActiveUser:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.getUser();case 2:e.activeUser=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},logout:function(){var e=this;return m()(v.a.mark(function t(){return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.logout();case 2:return t.next=4,e.refreshActiveUser();case 4:e.$router.push("/");case 5:case"end":return t.stop()}},t,e)}))()},printUser:function(){console.log("USER"),console.log(this.activeUser),console.log(this.$auth)}},mounted:function(){var e=this;this.$store.dispatch("UPDATE_COLLECTION","layers").then(function(t){var a=[e.$store.dispatch("UPDATE_COLLECTION","indicators"),e.$store.dispatch("UPDATE_COLLECTION","indicatorSections"),e.$store.dispatch("UPDATE_COLLECTION","indicatorBlocks"),e.$store.dispatch("UPDATE_COLLECTION","layers"),e.$store.dispatch("UPDATE_COLLECTION","layerCalcs"),e.$store.dispatch("UPDATE_COLLECTION","layerAttributes"),e.$store.dispatch("UPDATE_COLLECTION","areas"),e.$store.dispatch("UPDATE_COLLECTION","areaAttributes"),e.$store.dispatch("UPDATE_COLLECTION","areaLayers")];return u.a.all(a)}).then(function(){return e.loading=!1})}},ce=(a(381),Object(T.a)(le,p,[],!1,null,null,null));ce.options.__file="src/App.vue";var ue=ce.exports,de=a(119),pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{attrs:{sm7:"",xs12:""}},[a("v-container",{attrs:{fluid:"","grid-list-xl":"","pa-0":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[e.$store.state._col_features?a("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",features:e.$store.state._col_features,featuresCollection:"features",dataType:"Point",zoomLevel:"12",areas:!0}}):e._e()],1),e._v(" "),e._l(e.items,function(t){return a("v-flex",{key:t._id,attrs:{sm6:"",xs12:""}},[t.datatable?a("div",{staticClass:"py-3"},[a("v-divider"),e._v(" "),a("div",{staticClass:"title py-3"},[e._v(e._s(t.name))]),e._v(" "),a("v-data-table",{attrs:{items:t.data,headers:t.headers,"rows-per-page-items":[-1]},scopedSlots:e._u([{key:"items",fn:function(r){return e._l(t.headers,function(t){return a("td",[e._v(e._s(r.item[t.value]))])})}}],null,!0)})],1):"Figure"===t.type||"List"===t.type||"Chart"===t.type?a("indicator-key-stat",{attrs:{name:t.text,figure:t.figure,description:t.description,unit:t.unit,year:t.year,type:t.type}}):e._e()],1)})],2)],1)],1),e._v(" "),a("v-flex",{attrs:{sm2:"",xs12:""}},[e.$store.getters.indicatorsForSelectedYear?a("map-navigator",{attrs:{id:"map-panel-navigator"}}):e._e(),e._v(" "),a("div",{attrs:{id:"info-panel"}})],1)],1)],1)],1)};pe._withStripped=!0;var fe={props:{title:String,"x-labels":Boolean,"y-labels":Boolean,clickHandler:Boolean},data:function(){var e=this;return{options:{axes:{display:!1},scales:{yAxes:[{display:e.$props.yLabels,gridLines:{display:!1},scaleLabel:{display:e.$props.yLabels},ticks:{display:e.$props.yLabels}}],xAxes:[{display:e.$props.xLabels,gridLines:{display:!1},scaleLabel:{display:e.$props.xLabels},ticks:{display:e.$props.xLabels}}]},legend:{display:!1},title:{display:!0,text:e.$props.title||""},maintainAspectRatio:!1,onClick:function(t,a){if(e.$props.clickHandler){var r=e.$store.getters.dataByYear.filter(function(e){return e.name===a[0]._model.label})[0].area_code;e.$store.commit("UPDATE_AREA",r)}}}}}},ve=a(47),he=ve.c.reactiveProp,me={extends:ve.b,mixins:[fe,he],mounted:function(){this.renderChart(this.chartData,this.options)}},_e=ve.c.reactiveProp,ye={extends:ve.a,mixins:[_e,fe],mounted:function(){this.renderChart(this.chartData,this.options)}},ge=function(){var e=this,t=e.$createElement,a=e._self._c||t;return"List"===e.type&&e.selectedIndicator?a("div",[a("v-list",e._l(e.selectedIndicator[e.figure[0]],function(t,r){return a("v-list-item",[a("v-list-tile-action",[e._v("\n          "+e._s(r)+"\n        ")]),e._v(" "),a("v-list-tile-content",[e._v("\n          "+e._s(t)+"\n        ")])],1)}),1)],1):e.selectedIndicator?a("div",{staticClass:"pa-2 indicator-hover",staticStyle:{"background-color":"white",position:"relative"},on:{click:function(t){return e.updateIndicator({figure:e.figure[0],name:e.name})}}},[a("div",{staticClass:"subheading font-weight-light",staticStyle:{width:"40%"}},[e._v(e._s(e.name))]),e._v(" "),"Figure"===e.type?a("div",{staticStyle:{"overflow-x":"visible",display:"inline-block","white-space":"nowrap"}},[a("span",{staticClass:"display-1 py-0"},[e._v(e._s(e.selectedIndicator[e.figure[0]]))]),e._v(" "),e.unit?a("span",{staticClass:"subheading ml-1"},[e._v(e._s(e.unit))]):e._e(),e._v(" "),a("div",{staticClass:"font-weight-light"},[e._v(e._s(e.year))])]):e._e(),e._v(" "),a("div",{staticClass:"caption"},[e._v(e._s(e.description))]),e._v(" "),e.dataYears.length>1?a("div",{staticClass:"px-1",staticStyle:{position:"absolute",top:"-10px",right:"15px",width:"50%"}},[a("v-slider",{attrs:{color:"grey lighten-2","track-color":"transparent","always-dirty":"","inverse-label":"","tick-labels":e.dataYears,ticks:"always","tick-size":2,min:e.dataYears[0],max:e.dataYears[e.dataYears.length-1]},model:{value:e.selectedYear,callback:function(t){e.selectedYear=t},expression:"selectedYear"}})],1):e._e(),e._v(" "),a("div",{style:e.chartWidthClass},["Figure"===e.type?a("bar-vertical",{staticClass:"bar-chart-minimal",staticStyle:{"margin-top":"0px"},attrs:{"chart-data":e.prepBarChartData,"click-handler":!0,"x-labels":!1,"y-labels":!1}}):"Chart"===e.type&&e.selectedIndicator?a("bar-vertical",{staticStyle:{height:"300px","margin-bottom":"-30px"},attrs:{"x-labels":!0,"y-labels":!0,"chart-data":e.generateChartDataSets}}):e._e()],1),e._v(" "),a("div",{staticClass:"text-xs-right",staticStyle:{"margin-right":"-18px",clear:"both",display:"block","margin-bottom":"-10px"}},[a("v-btn",{attrs:{icon:""},on:{click:function(t){return e.toggleExpand()}}},[a("v-icon",{style:e.rotateStyle,attrs:{color:"grey"}},[e._v("keyboard_arrow_down")])],1)],1),e._v(" "),e.expand?a("div",{staticClass:"pa-2"},[e._v("\n  Lorem ipsum dolor sit amet, id principes honestatis sadipscing eum, malorum ceteros percipitur ea qui. Omnesque postulant eu quo, ei mei wisi vituperata repudiandae. No est meliore consulatu,e.\n  "),a("br"),a("br"),e._v(" "),a("div",{staticClass:"grey--text text--darken-2"},[e._v("\n    Source: JIIS "+e._s(e.year||e.$store.state.year)+" "),a("span",{staticStyle:{float:"right"}},[a("v-icon",[e._v("save_alt")]),e._v(" Download data")],1)]),e._v(" "),a("v-btn",{on:{click:e.log}},[e._v("LOG")])],1):e._e()]):e._e()};ge._withStripped=!0;var be=a(29),xe=a.n(be),we={components:{BarVertical:ye},data:function(){return{expand:!1,rotation:0,selectedYear:""}},props:["name","figure","description","unit","type","small","noChart"],methods:{log:function(){console.log("data",this),console.log("store",this.$store.state)},toggleExpand:function(){this.expand=!this.expand,this.rotation=0===this.rotation?180:0},updateIndicator:function(e,t){if(!e||!this.year)return null;this.$store.commit("UPDATE",{key:["navigator","indicator"],value:e}),this.$store.commit("UPDATE",{key:"year",value:this.year})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},validateYear:function(e){for(var t=e,a=0;a<this.dataYears.length;a++){if(-1!==this.dataYears.indexOf(t)){this.year=t;break}t++}}},computed:{rotateStyle:function(){return{transform:"rotate("+this.rotation+"deg)"}},getDataByHoodYear:function(){var e=this;return this.$store.getters.dataByNeighbourhood.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByCityYear:function(){var e=this;return this.$store.state.cityIndicators.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByYear:function(){var e=this;return this.$store.state.indicators.filter(function(t){return t.year===e.thisYear})||[]},areaDataMatched:function(){var e=this,t=this.$store.getters.indicatorsForSelectedArea;if(!t)return null;var a=t.reduce(function(t,a){return e.figure.some(function(e){return a[e]})&&t.push(a),t},[]);return console.log("areaDataMatched",a),a},areaDataLatest:function(){return console.log("something"),this.areaDataMatched?this.areaDataMatched[this.areaDataMatched.length-1]:null},latestYear:function(){if(this.areaDataLatest)return console.log("arealatest",this.areaDataLatest),this.selectedYear},year:function(){return this.selectedYear||this.latestYear},selectedIndicator:function(){return this.dataYears&&this.selectedYear?this.areaDataMatched[this.dataYears.indexOf(this.selectedYear)]:{}},dataYears:function(){return this.areaDataMatched?this.areaDataMatched.map(function(e){return e.year}):null},generateChartDataSets:function(){var e=this;return"Chart"===this.type&&this.selectedIndicator?{datasets:[{data:this.figure.map(function(t){return e.selectedIndicator[t]}),borderColor:"#000",type:"line",fill:!1}],labels:this.figure}:(console.log("chart data test",this.selectedIndicator),null)},chartWidthClass:function(){var e="Chart"===this.type?{width:"100%"}:{width:"70%",marginTop:"-60px"};return l()({position:"relative",float:"right"},e)},prepBarChartData:function(){if(" Figure"===!this.type)return{};var e=this.figure,t=this.$store.state.neighbourhood,a=this.$vuetify.theme.tertiary,r=this.$store.getters.allIndicatorsByYear;if(console.log("citydata",r),!r||!this.year)return{};r=r[this.year],console.log("citydata.year",r,this.year);var i=(r=r.map(function(t){return t[e]=t[e]||0,t})).sort(function(t,a){return!a[e]-!t[e]||+(t[e]>a[e])||-(t[e]<a[e])}),o=this.name;return console.log("sorted",i),{labels:i.map(function(e){return e.name}),area_code:t,datasets:[{label:o,backgroundColor:i.map(function(e){return e.area_code===t?a:xe.a.grey.lighten2}),data:i.map(function(t){return t[e]})}]}}},mounted:function(){this.areaDataLatest&&(this.selectedYear=this.areaDataLatest.year)}},ke=(a(384),Object(T.a)(we,ge,[],!1,null,null,null));ke.options.__file="src/components/IndicatorKeyStat.vue";var Ce=ke.exports,Se=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mt-5 mb-4",staticStyle:{background:"none"}},[t("div",{staticClass:"grey--text text--darken-2",staticStyle:{"text-transform":"uppercase","font-size":"18px",background:"none"}},[this._v(this._s(this.text))]),this._v(" "),t("v-divider",{staticClass:"my-2"})],1)};Se._withStripped=!0;var $e={props:["text"]},je=Object(T.a)($e,Se,[],!1,null,null,null);je.options.__file="src/components/IndicatorHeading.vue";var Ae=je.exports;var Le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[e.datatable?a("div",[e.addtop?a("v-btn",{staticClass:"mb-2",staticStyle:{"margin-top":"-40px",float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n        ")],1):e._e(),e._v(" "),a("v-data-table",{class:e.cssclass,attrs:{headers:e.featureHeaders,items:e.items,"rows-per-page-items":[10,20,50,100,-1]},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",{staticClass:"attribute-row",on:{dblclick:function(a){return e.edit(e.collection,t.item,e.nestedPath)}}},e._l(e.featureHeaders,function(r,i){return a("td",[r.type===Array?e._l(e.getNested(e.nestedPath,t.item)[r.value],function(t){return a("v-chip",{attrs:{outline:"",small:""}},[e._v("\n              "+e._s(t)+"\n            ")])}):[e._v("\n            "+e._s(e.getNested(e.nestedPath,t.item)[r.value])+"\n          ")],e._v(" "),i===e.featureHeaders.length-1?a("div",{staticClass:"attribute-controls-wrapper"},[a("div",{staticClass:"attribute-controls",staticStyle:{top:"-30px"}},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.edit(e.collection,t.item,e.nestedPath)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t.item._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()],2)}),0)]}}],null,!1,2180154156)}),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e()],1):a("div",[e.addtop?a("v-btn",{staticClass:"mb-2",staticStyle:{"margin-top":"-40px",float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e(),e._v(" "),a("v-list",{class:e.cssclass,attrs:{dense:""}},e._l(e.listItems,function(t,r){return a("v-list-tile",{key:t._id,staticClass:"attribute-row",on:{click:function(a){return e.select(r,t._id)}},model:{value:t.active,callback:function(a){e.$set(t,"active",a)},expression:"x.active"}},[e.listKey&&e.schema.schema[e.listKey]._options&&e.schema.schema[e.listKey]._options[0]?a("v-list-tile-action",[a("v-icon",[e._v(e._s(e.schema.schema[e.listKey]._options.filter(function(a){return a.name===t[e.listKey]})[0].icon)+" ")])],1):e._e(),e._v(" "),a("v-list-tile-content",[t._id?a("div",{staticClass:"attribute-controls-wrapper"},[e._v("\n        "+e._s(t.text||t.text_en||t.name)+"\n        "),a("div",{staticClass:"attribute-controls"},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.edit(e.collection,t)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()]),e._v(" "),t.active?a("div",{staticStyle:{height:"100%"}}):e._e()],1)}),1),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n")],1):e._e()],1)]),e._v(" "),e.editedSchema?a("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v(e._s(e.mode)+" "+e._s(e.schema.name.slice(0,e.schema.name.length-1)))])]),e._v(" "),a("v-tabs",{attrs:{color:"#f3f3f3","slider-color":"grey",grow:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Single")]),e._v(" "),e.editedSchema.canPaste?a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Multiple")]):e._e(),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},e._l(e.editedSchema.schema,function(t,r){return a("v-flex",{attrs:{xs12:""}},[t._options&&Array.isArray(t._options)?a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options.map(function(e){return e.name})},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):"function"!=typeof t._options||t._categorised?t._categorised?a("div",[a("v-combobox",{attrs:{multiple:"","small-chips":""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}),e._v(" "),a("v-menu",{attrs:{"full-width":"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",color:"grey",outline:""},slot:"activator"},[e._v("\n              "+e._s(r)+"\n            ")]),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t._options(e.$store,e.edited,e.collection),function(t,i){return a("v-menu",{key:i,attrs:{"full-width":"","offset-x":"","max-height":"500","open-on-hover":""}},[a("v-list-tile",{attrs:{slot:"activator"},on:{click:function(e){}},slot:"activator"},[a("v-list-tile-title",[e._v(e._s(t.name))])],1),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t.items,function(t,o){return a("v-list-tile",{on:{click:function(a){return e.edited[r].push(i+"."+t)}}},[a("v-list-tile-title",[e._v(e._s(t))])],1)}),1)],1)}),1)],1)],1):t.type===Boolean?a("v-switch",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):t._text?a("v-text-field",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-text-field",{attrs:{label:t._text,disabled:""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options(e.$store,e.edited,e.collection),"item-text":"name","item-value":"_id"},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}})],1)}),1)],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.save(e.editedCollection,e.edited._id)}}},[e._v("Save")])],1)],1),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("div",{staticClass:"title pb-2"},[e._v("Paste attributes")]),e._v("\n      Paste as rows of text, separated by commas or tabs: "),a("br"),e._v(" "),a("v-text-field",{attrs:{hint:Object.keys(e.editedSchema.schema).join(", "),textarea:"","auto-grow":"",rows:"3"},model:{value:e.pasted,callback:function(t){e.pasted=t},expression:"pasted"}}),e._v("\n\n      Preview\n      "),e.pastedComputed?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:e.pastedComputed}}):e._e()],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.saveMany(e.editedCollection,e.edited.layer)}}},[e._v("Save")])],1)],1)],1)],1)],1):e._e()],1)};Le._withStripped=!0;var Oe=a(78),De=a.n(Oe),Ee=a(44),Fe=a.n(Ee),Te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("form",{attrs:{enctype:"multipart/form-data",novalidate:""},on:{submit:function(t){return t.preventDefault(),e.processForm(t)}}},[a("div",{staticClass:"dropbox pa-3",staticStyle:{"background-color":"#fff"}},[a("input",{ref:"file",staticClass:"input-file",attrs:{type:"file",name:e.uploadFieldName},on:{change:function(t){return e.filesChange()}}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"function",items:e.uploadFunctions,label:"Function"},model:{value:e.uploadFunction,callback:function(t){e.uploadFunction=t},expression:"uploadFunction"}}):e._e(),e._v(" "),"update"==e.uploadFunction?a("div",[a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Existing Records"},model:{value:e.update.matchExisting,callback:function(t){e.$set(e.update,"matchExisting",t)},expression:"update.matchExisting"}}),e._v(" "),a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Upload"},model:{value:e.update.matchUpload,callback:function(t){e.$set(e.update,"matchUpload",t)},expression:"update.matchUpload"}}),e._v(" "),a("v-text-field",{attrs:{label:"Update Key"},model:{value:e.update.key,callback:function(t){e.$set(e.update,"key",t)},expression:"update.key"}})],1):e._e(),e._v(" "),a("v-select",{attrs:{name:"collection",items:e.collections,label:"Collection"},model:{value:e.collection,callback:function(t){e.collection=t},expression:"collection"}}),e._v(" "),e.layer?e._e():a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"format",items:e.indicatorFormats,label:"Format"},model:{value:e.indicatorFormat,callback:function(t){e.indicatorFormat=t},expression:"indicatorFormat"}}):e._e(),e._v(" "),e.isSaving?a("v-text-field",{attrs:{label:"Location"},model:{value:e.neighbourhood,callback:function(t){e.neighbourhood=t},expression:"neighbourhood"}}):e._e(),e._v(" "),e.isSaving?a("v-btn",{attrs:{type:"submit",color:"blue",dark:"",depressed:""}},[e._v("Upload")]):e._e()],1)])])};Te._withStripped=!0;var Pe=a(94),Ie={props:["layer","layerCollection"],data:function(){return{isSaving:!1,uploadedFiles:[],uploadError:null,currentStatus:null,uploadFieldName:"GeoJSON",file:"",neighbourhood:"",collection:"",collections:["features","areas","indicators"],layerSelected:"",indicatorFormats:["geojson","json","csv"],indicatorFormat:null,uploadFunction:"create",uploadFunctions:["create","update"],update:{key:"",matchUpload:"",matchExisting:""}}},methods:{filesChange:function(){this.isSaving=!0,this.file=this.$refs.file.files[0],this.neighbourhood=this.file.name.split(".")[0],this.indicatorFormat=this.file.name.split(".")[1]},processForm:function(){var e=new FormData;e.append("neighbourhood",this.neighbourhood),e.append("layer",this.layerSelected||this.layer),e.append("file",this.file),e.append("format",this.indicatorFormat),e.append("update",i()(this.update));var t=Pe[this.collection].params?this.layer:"",a=this.collection||alert("Collection required"),r="update"===this.uploadFunction?"updateMany":"create";V[r](a,null,e,{"Content-Type":"multipart/form-data"},t).then(function(){console.log("SUCCESS!!")}).catch(function(){console.log("FAILURE!!")})}},computed:{layers:function(){this.$store.state["_col_"+this.layerCollection]}},mounted:function(){this.layerSelected=this.layer}},Ue=Object(T.a)(Ie,Te,[],!1,null,null,null);Ue.options.__file="src/components/Upload.vue";var Me=Ue.exports,Ne=a(94),Be={components:{VueJsonPretty:Fe.a,Upload:Me},props:["collection","filter","datatable","listKey","nestedPath","cssclass","addtop","addbottom"],data:function(){return{updateKey:0,activeTab:null,dialog:!1,mode:null,saving:!1,editedIndex:null,layerDialog:!1,attributeDialog:!1,selected:0,selectedId:"",pasted:null,attributeTypes:["String","Number","Boolean"],editedCollection:null,edited:{},uploadDialog:!1,featureEdit:[],datatableTab:null}},computed:{menuItems:function(){return this.$store.getters.areaLayers},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},listItems:function(){var e=this;return this.items.map(function(t,a){return t.active=e.selected===a,t})},items:function(){var e=this,t=De()(this.$store.state["_col_"+this.collection]);return console.log("collectiondata",this.collection,t),t[0]?this.filter&&t[0]?(console.log("filterlayer",this.filter),t.filter(function(t){return t.layer===e.filterId})):t:[]},filteredItems:function(){},firstItem:function(){return this.$store.state["_col_"+self.collection]?this.$store.state["_col_"+self.collection][0]:{}},schema:function(){var e=this,t=Ne[this.collection];if("features"===this.collection){var a=this.$store.getters.selectedLayerAttributes;a?(console.log("attrs",a),t=l()(t,{schema:this.schemaFromAttributes(De()(a))})):this.$store.dispatch("UPDATE_COLLECTION","layerAttributes").then(function(a){console.log("callback attrs",a),t=l()(t,{schema:e.schemaFromAttributes(De()(a))})})}return console.log("schema",t),console.log("schematype",n()(t.schema)),t||{}},editedSchema:function(){return l()({},this.schema)},schemaNames:function(){return[this.schema.name,this.relatedSchema.name].reduce(function(e,t){return t&&e.push(t.slice(0,t.length-1)),e},[])},tabledata:function(){if(this.layer)return this.layer.attributes},featureHeaders:function(){var e=this;if(!this.schema.schema)return[];var t=g()(this.schema.schema).reduce(function(t,a){return e.schema.schema[a]._text&&t.push({value:a,text:e.schema.schema[a]._text,type:e.schema.schema[a].type}),t},[]);return console.log("featureHeaders",t),t},pastedComputed:function(){var e=this,t=this.pasted;if(!t)return[];t=t.replace(/\t/g,","),console.log("replaced",t);var a=g()(this.editedSchema.schema);return t.split("\n").reduce(function(t,r){var i=r.split(",");return i.length<2?t:(t.push(i.reduce(function(t,r,i){var o=a[i];return r=r.trim(),e.editedSchema.schema[o].type===Boolean&&(r="true"===r.toLowerCase()),t[o]=r,t},{})),t)},[])}},methods:{updateStore:function(e){var t=this;if(!e&&"features"===!this.collection&&this.$store.state["_col_"+this.collection+"_selected"])return null;var a=this;return new u.a(function(e,r){var i=t.collection;if("features"===t.collection){var o=a.filterId;i={name:"features",layer:o},o||r()}a.$store.dispatch("UPDATE_COLLECTION",i).then(function(t){a.$forceUpdate(),e(t)}).catch(function(e){console.log("update failed",e),r()})})},templateFromSchema:function(e){if(e)return g()(e).reduce(function(t,a){return e[a].type===Array?t[a]=[]:e[a].type===Boolean?t[a]=!1:t[a]="",t},{})},schemaFromAttributes:function(e){var t=this;return console.log("schema from attributes, attrs",e),e.reduce(function(e,a){return a.layer===t.$store.state._col_layers_selected&&(a._text=a._text||a.name,e[a.name]=a),e},{})},select:function(e,t){var a=this;this.selected=e,this.selectedId=t,console.log("updating after select"),this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:t}),this.$nextTick(function(){return a.$forceUpdate()})},add:function(e){console.log(e),this.mode="Add",this.editedCollection=e,this.edited=this.templateFromSchema(Ne[e].schema),this.dialog=!0,console.log("dialog data",e,this.edited)},edit:function(e,t,a){this.mode="Edit";var r=this.templateFromSchema(Ne[e].schema),i=this.$store.state["_col_"+e];if(a){for(var o=0;o<i.length;o++)if(t===this.getNested(a,i[o])){t._id=i[o]._id,this.editedIndex=o;break}r=this.getNested(a,r),t._path=a}else this.editedIndex=i.indexOf(t);this.edited=l()({},r,t),this.editedCollection=e,this.dialog=!0,console.log("this",this)},del:function(e,t){var a=this;this.loading=!0,confirm("Are you sure you want to delete this item?")&&V.del(e,t).then(function(e){a.updateStore(),a.selected=a.selected>0?a.selected-1:0,a.loading=!1})},close:function(){this.saving=!1,this.dialog=!1},save:function(e,t,a){var r=this;this.saving=!0,this.close(),this.filter&&(this.edited.layer=this.filterId);var i=Ne[e].params?this.selectedId:"",o={id:t,path:this.edited._path};console.log("saving",[e,t,this.edited]),V.update(e,o,this.edited,{},i).then(function(e){r.updateStore(),r.close()})},saveMany:function(e,t){var a=this;if(this.saving=!0,console.log("filterId: "+this.filterId+" collection: "+e),this.pastedComputed[0]&&g()(this.pastedComputed[0]).length>1){this.pastedComputed=this.pastedComputed.map(function(e){return e.layer=a.filterId,e});var r=new FormData;r.append("data",i()(this.pastedComputed)),console.log("making request..."),V.create(e,"",r).then(function(e){console.log("uploaded"),a.updateStore(),a.close(),a.pasted=""})}},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},forceUpdate:function(){this.$forceUpdate(),console.log("force updated",this.$store.getters.selectedLayerAttributes)},logStore:function(){console.log("data",this),console.log("store",this.$store.state)},updateFeatures:function(e){var t=this,a={name:this.collection,query:{},layer:e};this.$store.dispatch("UPDATE_COLLECTION",a).then(function(e){var a=t;setTimeout(function(){console.log("update store:",a.$store.state._col_features),a.$forceUpdate()},500)})}},watch:{dialog:function(e){console.log(e),e||this.close()},menuItems:function(e){console.log("menuItems",newValue)},filterId:function(e){console.log("WATCH: layerchanged",e),"features"===this.collection&&this.updateFeatures(e)}},created:function(){var e=this;console.log("created"),this.updateStore().then(function(t){console.log("fetching "+e.collection,t),e.$store.state["_col_"+e.collection+"_selected"]||e.select(0,t[0]._id),console.log("firstid",t[0]._id)}).catch(function(e){return console.log("failed to update store")})},mounted:function(){}},ze=(a(449),Object(T.a)(Be,Le,[],!1,null,null,null));ze.options.__file="src/components/EditableDataList.vue";var Ye=ze.exports,qe={components:{MapView:ee,MapNavigator:ie,BarHorizontal:me,BarVertical:ye,IndicatorKeyStat:Ce,IndicatorHeading:Ae,EditableDataList:Ye},data:function(){return{activeTab:null,selectedData:this.$store.getters.selected}},computed:{items:function(){var e=this.$store.getters.selectedIndicatorBlocks;console.log("indicator blocks",e);var t,a,r,i=(t=e,a=["text","description"],r=this.$store.state.language,a="string"==typeof a?[a]:a,function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":n()(i)))return a.forEach(function(e){i[e+"_"+r]&&(i[e]=i[e+"_"+r])}),g()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(t=Array.isArray(t)?t:[t],a,r));return console.log("translateion",i),console.log("indicatorsByArea",this.$store.getters.indicatorsByArea),i}},methods:{},mounted:function(){}},He=(a(450),Object(T.a)(qe,pe,[],!1,null,null,null));He.options.__file="src/components/IndicatorsNew.vue";var Ge=He.exports,Ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-layout",{attrs:{row:"","align-center":"","justify-center":""}},[a("v-dialog",{attrs:{persistent:"","max-width":"500"},model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}},[a("v-card",[a("v-card-title",[a("svg",{attrs:{width:"80vh",height:"200"},domProps:{innerHTML:e._s(e.editFeaturePath)}})]),e._v(" "),a("v-card-text",[e._l(e.surveyQuestions,function(t){return["text"==t.type?a("v-text-field",{attrs:{name:t.name,"data-vv-name":t.name,label:t.label,"v-validate":"required|numeric","error-messages":e.errors.collect(t.name)},model:{value:e.editFeature[t.name],callback:function(a){e.$set(e.editFeature,t.name,a)},expression:"editFeature[item.name]"}}):"textarea"==t.type?a("v-textarea",{attrs:{name:t.name,"data-vv-name":t.name,label:t.label,"v-validate":t.validation,"error-messages":e.errors.collect(t.name)},model:{value:e.editFeature[t.name],callback:function(a){e.$set(e.editFeature,t.name,a)},expression:"editFeature[item.name]"}}):"radio"==t.type?a("v-radio-group",{attrs:{name:t.name,"data-vv-name":t.name,label:t.label,"error-messages":e.errors.collect(t.name)},model:{value:e.editFeature[t.name],callback:function(a){e.$set(e.editFeature,t.name,a)},expression:"editFeature[item.name]"}},e._l(t.options,function(e){return a("v-radio",{attrs:{label:e.label,value:e.value}})}),1):e._e()]})],2),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{on:{click:e.closeEditor}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{color:"primary"},on:{click:e.saveEditor}},[e._v("Save")])],1)],1)],1)],1),e._v(" "),a("l-map",{attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"main-map"},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["detailed"==e.baseMap?a("l-protobuf",{attrs:{url:"https://maps.tilehosting.com/data/v3/{z}/{x}/{y}.pbf?key=ArAI1SXQTYA6P3mWFnDs",options:e.protobufOpts}}):e._e(),e._v(" "),"basic"==e.baseMap?a("l-tile-layer",{attrs:{url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:"&copy; <a href='http://osm.org/copyright'>OpenStreetMap</a> contributors",options:e.protobufOpts}}):e._e(),e._v(" "),e._l(e.surveyData,function(t,r){return e.survey?a("l-geo-json",{key:t._id,attrs:{options:e.geoJsonOptions,"options-style":t.feature.properties.style,geojson:t.feature}}):e._e()}),e._v(" "),e._l(e.$store.state.geo.areas,function(t,r){return e.layers.areas?a("l-geo-json",{key:t._id,attrs:{options:e.areasGeoJsonOptions,geojson:t.feature,"options-style":e.getAreaStyle(t.feature.properties.id)}}):e._e()})],2),e._v(" "),a("div",{attrs:{id:"map-menu"}},[a("v-menu",{attrs:{"close-on-content-click":!1,"min-width":"300px",flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}])},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{attrs:{dense:""}},[a("div",{staticClass:"px-4"},[a("div",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return[a("v-switch",{key:r,attrs:{label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})]})],2),e._v(" "),e._l(e.items,function(t,r){return t.children?a("v-list-group",{key:t.text,attrs:{"prepend-icon":t.model?t.icon:t["icon-alt"],"append-icon":""},scopedSlots:e._u([{key:"activator",fn:function(){return[a("v-list-tile",[a("v-list-tile-content",[a("v-list-tile-title",[e._v("\n              "+e._s(t.heading)+"\n            ")])],1)],1)]},proxy:!0}],null,!0),model:{value:t.model,callback:function(a){e.$set(t,"model",a)},expression:"item.model"}},[e._v(" "),e._l(t.children,function(t,r){return[a("v-switch",{key:r,attrs:{label:t.text},on:{click:function(a){return e.getSurveyData(t.text)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"child.selected"}})]})],2):t.heading?a("v-layout",{key:r,attrs:{row:"","align-center":""}},[a("v-flex",{attrs:{xs6:""}},[t.heading?a("v-subheader",[e._v("\n        "+e._s(t.heading)+"\n      ")]):e._e()],1)],1):t.divider?a("v-divider",{key:r,staticClass:"my-3",attrs:{dark:""}}):e._e()}),e._v(" "),a("v-divider"),e._v(" "),a("v-subheader",[e._v("Survey Data")]),e._v(" "),a("v-list-tile",{staticClass:"mb-3"},[e.surveyNames?a("v-select",{attrs:{items:e.surveyNames,"menu-props":"auto",label:"Select a survey","hide-details":"","prepend-icon":"map","single-line":""},on:{input:function(t){return e.getSurveyData(t)}},model:{value:e.selectedSurvey,callback:function(t){e.selectedSurvey=t},expression:"selectedSurvey"}}):a("v-btn",{on:{click:e.getSurveyNames}},[e._v("Load surveys")])],1),e._v(" "),e.survey?[a("v-divider"),e._v(" "),a("v-subheader",[e._v("Survey key")]),e._v(" "),e._l(e.surveyKeyArray,function(t,r){return a("v-list-tile",[a("v-list-tile-action",[a("v-icon",{attrs:{color:t.color}},[e._v("label")])],1),e._v(" "),a("v-list-tile-content",[e._v("\n      "+e._s(t.text)+"\n    ")])],1)}),e._v(" "),a("v-list-tile",[a("v-select",{attrs:{items:e.languages,"menu-props":"auto",label:"Select language","single-line":""},model:{value:e.language,callback:function(t){e.language=t},expression:"language"}})],1)]:e._e()],2)],1)],1)],1)};Ke._withStripped=!0;var Je={name:"MapView",components:{LMap:w.a,LTileLayer:k.a,LMarker:C.a,LPopup:S.a,LTooltip:$.a,LProtobuf:I,LPolygon:j.a,LGeoJson:A.a},$_veeValidate:{validator:"new"},data:function(){var e=this;return{language:"ar",languages:["ar","en"],url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",zoom:14,center:L.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:L.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5},geoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){r.openEditor(e)}})}},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){r.selectArea(e)}})}},layers:{areas:!0},areaStyle:{2111:{weight:2,color:"#fff",opacity:.9,fillColor:"#fff",fillOpacity:.5}},survey:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!1},{text:"Detailed",type:"detailed",selected:!0}],baseMap:"detailed",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}}}},computed:{items:function(){return this.$auth.isAuthenticated(),[]},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return x()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:N,maxNativeZoom:14,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},surveyQuestions:function(){return this.translate(W,"label",this.language)},scale:function(){var e=this,t=this.$store.getters.dataByYear.map(function(t){return t[e.$store.state.map.indicator]}).sort(function(e,t){return e-t});return{min:t[0],max:t[t.length-1]-t[0]}}},methods:{getAreaStyle:function(e){var t=Z.a.scale(["yellow","red"]),a=this.$store.getters.dataByYear.filter(function(t){return t.area_code===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=a[this.$store.state.map.indicator],i=t((r-this.scale.min)/this.scale.max);return console.log(e,this.scale,r,i,(r-this.scale.min)/this.scale.max),{weight:1,color:"#fff",opacity:.9,fillColor:i,fillOpacity:.6}},updateBaseMap:function(e,t){console.log(e,t),this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},showLongText:function(){this.showParagraph=!this.showParagraph},innerClick:function(){console.log(!0)},popup:function(e){console.log(e)},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return L.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;V.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;V.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},selectArea:function(e){this.$store.commit("UPDATE",{key:"neighbourhood",value:e.target.feature.properties.id}),this.$store.commit("UPDATE",{key:["map","zoom"],value:15}),this.$store.commit("UPDATE",{key:["map","center"],value:{lon:e.target.feature.properties.Centroids_x,lat:e.target.feature.properties.Centroids_y}})},openEditor:function(e){var t=this;this.surveyData.forEach(function(a,r){a._id==e.target.feature.properties.Id&&(t.editIndex=r)}),l()(this.editFeature,this.surveyData[this.editIndex].feature.properties.survey),this.editDialog=!0;var a=e.target._path.outerHTML,r=1/this.currentZoom*1/this.currentZoom*1/this.currentZoom*1/this.currentZoom*2e5,i=(a=a.replace(">",'transform="translate() scale('+r+')">')).match(/d="M[\d\s-]*/)[0].slice(4).split(" ").map(function(e){return parseInt(e)});i[0]=-i[0]*r+200,i[1]=-i[1]*r+50,a=(a=a.replace("translate()","translate("+i[0]+" "+i[1]+")")).replace(/stroke-width="\d"/,'stroke-width="0.2"'),this.editFeaturePath=a,this.editMapFeature=e.target.feature,this.editMapCenter=this.getCoordsPoint(e.target.feature)},closeEditor:function(){this.editDialog=!1,console.log(this.editFeatureDefaults),l()(this.editFeature,this.editFeatureDefaults),this.styleSurveyData(),this.$validator.reset()},saveEditor:function(){this.$validator.validateAll().then(function(e){e?alert("success"):alert("error")}).catch(function(){});var e=this.surveyData[this.editIndex],t={lastEdited:{time:new Date,user:this.$auth.getUser().email}};l()(e.feature.properties.survey,t,this.editFeature),V.update("buildings",{id:e._id},e),this.closeEditor()},styleSurveyData:function(){var e=this,t=g()(this.editFeature).length;this.surveyData.forEach(function(a){var r=x()(a.feature.properties.survey).filter(function(e){return null!=e&&null!=e}),i=e.surveyKey.notStarted.color;r.length>t?i=e.surveyKey.complete.color:a.feature.properties.survey.lastEdited&&(i=e.surveyKey.inProgress.color),a.feature.properties.style={weight:2,color:i,opacity:.9,fillColor:i,fillOpacity:.5}})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){var e=document.getElementsByClassName("v-toolbar__extension")[0].style;console.log(e),e.overflow="auto"},500)},translate:function(e,t,a){return function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":n()(i)))return i[a]=i[a+"_"+r],g()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),t.push(i),t},[])}(e,t,a)}},mounted:function(){var e=this;window.screen.width<800&&this.updateBaseMap("basic",!0),this.getSurveyNames(),this.editFeature=W.reduce(function(e,t){return e[t.name]="",e},{}),this.editFeatureDefaults=l()({},this.editFeature),this.$store.watch(function(e,t){return e.neighbourhood},function(t,a){9999===t&&(e.$store.commit("UPDATE",{key:["map","zoom"],value:12}),e.$store.commit("UPDATE",{key:["map","center"],value:e.$store.state.map.defaultCenter}))}),this.$store.watch(function(e,t){return e.map.indicator},function(t,a){9999===t&&(e.$store.commit("UPDATE",{key:["map","zoom"],value:12}),e.$store.commit("UPDATE",{key:["map","center"],value:e.$store.state.map.defaultCenter}))})}},Ve=(a(451),Object(T.a)(Je,Ke,[],!1,null,null,null));Ve.options.__file="src/components/MapSurvey.vue";var Re=Ve.exports,Ze=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-tabs",{staticClass:"mt-2",attrs:{color:"background","slider-color":"primary"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{key:1,attrs:{ripple:""},on:{click:function(t){return e.update("layers")}}},[e._v("Features ")]),e._v(" "),a("v-tab",{key:2,attrs:{ripple:""},on:{click:function(t){return e.update("areaLayers")}}},[e._v("Spatial Analysis")]),e._v(" "),a("v-tab",{key:3,attrs:{ripple:""},on:{click:function(t){return e.update("indicatorSections")}}},[e._v("Indicator Sections")]),e._v(" "),a("v-tab-item",{key:"0a"},["layers"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("div",{staticClass:"text-xs-right caption grey--text",staticStyle:{"margin-top":"-20px"}},[a("span",[e._v("Layer id: "+e._s(e.$store.state["_col_"+e.tab+"_selected"]))])]),e._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{collection:"layers",listKey:"data_type",addbottom:!0}})],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs9:""}},[e.$store.state._col_features?a("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",features:e.$store.state._col_features,featuresCollection:"features",dataType:"Point",zoomLevel:"12"}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs3:""}},[e.$store.getters.selectedLayer?a("div",{staticClass:"ejmap-border-top pl-3"},[a("div",{staticClass:"subheading font-weight-light py-2"},[e._v("Summary")]),e._v(" "),a("v-layout",{staticClass:"body-1 ejmap-border-bottom grey--text text--darken-2",attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[e._v("\n          Name: "),a("span",{staticStyle:{float:"right"}},[e._v(" "+e._s(e.$store.getters.selectedLayer.text_en)+" ")])]),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e._v("\n          Data Type: "),a("span",{staticStyle:{float:"right"}},[e._v(e._s(e.$store.getters.selectedLayer.data_type))])]),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e._v("\n          Feature Count: "),a("span",{staticStyle:{float:"right"}},[e._v(e._s(e.$store.state._col_features.length))])]),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e._v("\n          Source:\n        ")])],1)],1):e._e()]),e._v(" "),a("v-flex",{attrs:{xs6:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 pb-2"},[e._v("Layer Attributes")]),e._v(" "),e.$store.state._col_layers_selected?a("editable-data-list",{attrs:{collection:"layerAttributes",filter:"layers",datatable:!0,cssclass:"no-background",addtop:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs6:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 pb-2"},[e._v("Layer Calculations")]),e._v(" "),e.$store.state._col_layers_selected?a("editable-data-list",{attrs:{collection:"layerCalcs",filter:"layers",datatable:!0,cssclass:"no-background",addtop:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pb-2 pt-5 pl-3"},[e._v("Features Table")]),e._v(" "),a("editable-data-list",{directives:[{name:"show",rawName:"v-show",value:e.$store.state._col_layerAttributes_selected,expression:"$store.state._col_layerAttributes_selected"}],attrs:{collection:"features",filter:"layers",datatable:!0,nestedPath:"feature.properties",cssclass:"no-background",addtop:!0}})],1)],1)],1)],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"1a"},["areaLayers"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"areaLayers"}})],1),e._v(" "),a("v-flex",{attrs:{xs9:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm7:"",xs12:""}},[e.$store.state._col_areas?a("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",features:e.$store.state._col_areas.filter(function(e){return e.feature}),featuresCollection:"areas",dataType:"MultiPolygon",zoomLevel:"12"}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{sm5:"",xs12:""}},[a("v-card",[e.$store.state._col_areaLayers_selected?a("editable-data-list",{attrs:{addbottom:!0,collection:"areaAttributes",filter:"areaLayers",datatable:!0}}):e._e()],1)],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e.$store.state.selectedFeature?a("vue-json-pretty",{staticClass:"px-3 mb-2 code",attrs:{data:e.$store.getters.indicatorsForSelectedArea}}):e._e(),e._v(" "),a("v-card")],1),e._v(" "),a("v-flex",{attrs:{"offset-sm3":"",sm9:"",xs12:""}},[a("v-card")],1)],1)],1),e._v(" "),a("v-btn",{on:{click:e.logStore}},[e._v("log")])],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"2a"},["indicatorSections"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-card",[e.$store.state._col_indicatorSections_selected?a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorBlocks",filter:"indicatorSections",datatable:!0}}):e._e()],1)],1)],1)],1):e._e()],1)],1),e._v(" "),a("div",{staticClass:"data-toolbar"},[a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){e.uploadDialog=!0}}},[a("v-icon",{staticClass:"mr-2"},[e._v("cloud_upload")]),e._v("\n    Upload\n    ")],1),e._v(" "),a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){e.analysisDialog=!0}}},[a("v-icon",{staticClass:"mr-2"},[e._v("assessment")]),e._v("\n    Update Feature Analysis\n    ")],1)],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.uploadDialog,callback:function(t){e.uploadDialog=t},expression:"uploadDialog"}},[a("upload",{attrs:{layer:e.$store.state["_col_"+e.tab+"_selected"]}})],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.analysisDialog,callback:function(t){e.analysisDialog=t},expression:"analysisDialog"}},[a("analysis",{attrs:{layer:e.$store.state._col_layers_selected,areaLayer:e.$store.state._col_areaLayers_selected}})],1)],1)};Ze._withStripped=!0;var We=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-3"},[a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),a("v-select",{attrs:{name:"areaLayer",items:e.areaLayers,label:"Area"},model:{value:e.areaLayerSelected,callback:function(t){e.areaLayerSelected=t},expression:"areaLayerSelected"}}),e._v(" "),a("v-btn",{attrs:{color:"blue",dark:"",depressed:""},on:{click:function(t){return e.updateAnalysis()}}},[e._v("Analyse")])],1)};We._withStripped=!0;a(94);var Qe={props:["layer","areaLayer"],data:function(){return{layerSelected:"",areaLayerSelected:""}},methods:{updateAnalysis:function(){V.updateAnalysis("features",this.areaLayerSelected,{},{},this.layerSelected)}},computed:{layers:function(){return this.$store.state._col_layers.map(function(e){return{text:e.name,value:e._id}})||[]},areaLayers:function(){return this.$store.state._col_areaLayers.map(function(e){return{text:e.name,value:e._id}})||[]}},mounted:function(){this.layerSelected=this.layer||this.$store.state._col_areaLayers_selected,this.areaLayerSelected=this.areaLayer||this.$store.state._col_layers_selected}},Xe=Object(T.a)(Qe,We,[],!1,null,null,null);Xe.options.__file="src/components/Analysis.vue";var et=Xe.exports,tt={components:{EditableDataList:Ye,MapView:ee,Upload:Me,VueJsonPretty:Fe.a,Analysis:et},data:function(){return{uploadDialog:!1,analysisDialog:!1,activeTab:null,pages:null,tab:"layers",pagesX:[{name:"features",mainCollection:"layers",relatedCollection:"layerAttributes",featuresCollection:"features"},{name:"spatial_areas",mainCollection:"areaLayers",featuresCollection:"areas",indicators:!0},{name:"indicators",mainCollection:"indicatorSections",relatedCollection:"indicatorBlocks",featuresCollection:"indicators",indicators:!0}]}},computed:{},methods:{update:function(e){var t=this;this.tab=e,this.$store.commit("UPDATE",{key:"tab",value:e}),this.$nextTick(function(){t.$forceUpdate()})},logStore:function(){console.log("data",this),console.log("store",this.$store.state)}},created:function(){this.$store.dispatch("UPDATE_COLLECTION","layers"),this.$store.dispatch("UPDATE_COLLECTION","areas"),this.$store.dispatch("UPDATE_COLLECTION","indicators"),this.$store.dispatch("UPDATE_COLLECTION","layerCalcs"),this.$store.dispatch("UPDATE_COLLECTION","layerAttributes"),this.$store.dispatch("UPDATE_COLLECTION","areaAttributes"),this.$store.dispatch("UPDATE_COLLECTION","areaLayers")}},at=(a(452),Object(T.a)(tt,Ze,[],!1,null,null,null));at.options.__file="src/components/ManageDataMaster.vue";var rt=at.exports,it=a(118),ot=a.n(it),nt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-layout",{attrs:{row:"",wrap:""}},e._l(e.items,function(t,r){return a("v-flex",{attrs:{xs12:"","py-4":""}},[a("div",{staticClass:"title pb-2"},[e._v(e._s(t.heading))]),e._v(" "),a("div",{staticClass:"subheading",staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.text))]),e._v(" "),t.code?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:t.code}}):e._e()],1)}),1)],1)};nt._withStripped=!0;var st={components:{VueJsonPretty:Fe.a},data:function(){return{itemsX:[{heading:"Features"},{heading:"Features"},{heading:"Features"}],items:[{heading:"Features",text:"Spatial data points (either points, polygons or lines) with attribute information including which feature layer it is associated with.",code:{type:"point",geometry:[],properties:{year:2015,feature_layer:"education",type:"college",students:500,gender:"mixed",quality_rating:10}}},{heading:"Feature Layers",text:"Feature layers determine the layer type and methods of analysis to be performed on it.",code:{name:"education",type:"point",columns:{type:{type:"string",func:"count"},students:{type:"integer",func:"sum"},gender:{type:"string",func:"count"},quality_rating:{type:"integer",func:"average"}}}},{heading:"Areas",text:"Statistical areas with which the features should be grouped for analysis"},{heading:"Area Indicators",text:"Area indicators include the results of spatial analysis between the Areas and Features and any additional secondary data e.g from JIIS"},{heading:"Surveys",text:"Surveys are extensions of Feature Layers that can be used for collecting field data.\n\nSurveys can use an existing Feature Layer as a template or create a new one. In most cases spatial data will need to be uploaded in advance of the conducting the survey.However, point data can be added live via the survey map"}]}}},lt=Object(T.a)(st,nt,[],!1,null,null,null);lt.options.__file="src/components/Help.vue";var ct=lt.exports;"http://localhost:8080"===window.location.origin||window.location.origin;console.log("routing from",{redirect_uri:window.location.origin+"/implicit/callback"}),d.default.use(ot.a,{client_id:"0oafa51gkZcH6RVN4356",issuer:"https://dev-160658.okta.com/oauth2/default",redirect_uri:window.location.origin+"/implicit/callback",scope:"openid profile email"}),d.default.use(de.a);var ut=new de.a({mode:"history",routes:[{path:"/",component:Ge},{path:"/upload",component:Me},{path:"/manage",component:rt,meta:{requiresAuth:!0}},{path:"/map",component:Re},{path:"/indicators",component:Ge},{path:"/implicit/callback",component:ot.a.handleCallback()},{path:"/help",component:ct}]});ut.beforeEach(d.default.prototype.$auth.authRedirectGuard());var dt=ut,pt=a(306),ft=a.n(pt),vt=(a(453),a(454),a(305)),ht=a(120),mt={primary:xe.a.orange.lighten1,secondary:xe.a.grey.lighten3,tertiary:xe.a.blue.base,error:"#b71c1c",background:"#f8f9fa"},_t=a(455)();d.default.use(ft.a,{options:{customProperties:!0},theme:mt}),d.default.use(vt.a),d.default.use(ht.a),d.default.config.productionTip=!0;var yt=new ht.a.Store({state:{_col_layers:[],_col_layers_selected:"",_col_layerAttributes:[],_col_areas:[],_col_areas_selected:"",_col_areaLayers:[],_col_areaLayers_selected:"",_col_features:[],_col_features_selected:"",_col_indicators:[],_col_indicators_selected:"",_col_indicatorSections:[],_col_indicatorSections_selected:"",_col_indicatorBlocks:[],_col_indicatorBlocks_selected:"",neighbourhoodsTest:null,updateCount:0,indicators:[],collections:{},cityIndicators:[],neighbourhood:2112,selectedFeature:"",areaLayer:"5cf510e19bfa58b6c509903b",year:2016,language:"en",languages:["ar","en"],theme:mt,tab:"",map:{zoom:14,center:{lat:31.827982118391024,lng:35.22958321000619},defaultCenter:{lat:31.827982118391024,lng:35.22958321000619}},navigator:{zoom:11,center:{lat:31.800558330295235,lng:35.201552314749975},defaultCenter:{lat:31.809357074964257,lng:35.18584083885216},indicator:{figure:"pop_year_end",name:"Population"}},geo:{areas:[],facilities:[],educational:[],features:[],selected:null},layers:[]},actions:{UPDATE_COLLECTION:function(e,t){var a=e.state,r=e.commit;return new u.a(function(e,i){var o={name:t.name||t,query:t.query||{},layer:t.layer};"features"!==t.name||o.layer||(o.layer=a._col_layers_selected,layers||i()),console.log("collection",t),V.find(o.name,o.query,"",{lean:!0},o.layer).then(function(t){r("UPDATE",{key:"_col_"+o.name,value:t.data}),console.log("updated collection: _col_"+o.name,t.data.length,t.data[0]),e(t.data)}).catch(function(e){console.log("caught error",e),i(e)})})},UPDATE_INDICATORS:function(e){var t=e.state,a=e.commit;V.find("indicators",{areaLayer:t.areaLayer}).then(function(e){return a("UPDATE",{key:"indicators",value:e.data})}).catch(function(e){console.log("failed to update indicators",e)})}},mutations:{GET_INDICATORS:function(e){V.find("areas",{}).then(function(t){e.geo.areas=t.data}),V.find("indicators",{}).then(function(t){if(!t.data)return console.log("cannot retrieve in"),null;var a=t.data.map(function(e){return e.dependency_youth=((e.age_0_4+e.age_5_14+e.age_15_24)/e.pop_year_end*100).toFixed(1),e.growth_total=(e.pop_growth_total/e.pop_year_end*100).toFixed(1),e.growth_natural=(e.pop_growth_natural/e.pop_year_end*100).toFixed(1),e.household_size=(e.pop_year_end/e.dwellings_total).toFixed(1),e.dwelling_density=(e.dwelling_area_avg/e.household_size).toFixed(1),e.prevyear=t.data.filter(function(t){return t.name===e.name&&t.year===e.year-1})[0],e.dwellings_new=e.prevyear?e.dwellings_total-e.prevyear.dwellings_total:null,e.dwelling_growth=(e.dwellings_new/e.dwellings_total*100).toFixed(1),e.age_distribution_labels=["age_0_4","age_5_14","age_15_24","age_25_44","age_45_64","age_65_74","age_75_"],e.age_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.pop_year_end*100}),e.dwelling_area_distribution_labels=["dwellings_area_0_40","dwellings_area_41_60","dwellings_area_61_80","dwellings_area_81_100","dwellings_area_101_140","dwellings_area_141"],e.dwelling_area_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.dwellings_total*100}),e});e.indicators=a.filter(function(e){return 9999!==e.area_code}),e.cityIndicators=a.filter(function(e){return 9999===e.area_code});var r={sum:function(e,t){return e.reduce(function(e,a){if(!a.feature.properties.mygeodat_5)return e;var r=a.feature.properties;return["total",a.feature.properties.mygeodat_5.toString()].forEach(function(a){e[a]=e[a]||{},e[a].types=e[a].types||{},t.forEach(function(t){"string"==typeof r[t]?e[a].types[r[t]]=e[a].types[r[t]]?e[a].types[r[t]]+1:1:e[a][t]=e[a][t]?e[a][t]+parseInt(r[t]):r[t]||0})}),e},{})}};V.find("features",{}).then(function(t){e.geo.facilities=t.data,e.facilities=t.data.map(function(e){return e.feature.properties}),console.log("facilities",e.facilities);var a=t.data.filter(function(e){return"Educational"===e.feature.properties.Use});e.geo.educational=a,a=r.sum(a,["Sort1","Sort2","Gender","no_student","no_females","no_classes","Type"]),e.indicators.forEach(function(t,r){2015===t.year&&t.area_code&&(e.indicators[r]=l()({},t,a[t.area_code.toString()]))}),e.cityIndicators.forEach(function(t,r){2015===t.year&&(e.cityIndicators[r]=l()({},t,a.total))}),console.log("cityindicators",e.cityIndicators)})})},UPDATE_FEATURES:function(e,t){V.find(t.collection,t.query).then(function(t){e.geo.features=t.data})},UPDATE:function(e,t){if(Array.isArray(t.key)){var a=t.key.slice(0,t.key.length-1).reduce(function(e,t){return e&&"undefined"!==e[t]?e[t]:void 0},e),r={};r[t.key.slice(-1)[0]]=t.value,l()(a,r)}else"object"!==n()(e[t.key])||"object"!==n()(e[t.value])||Array.isArray(t.value)?(console.log("is array",Array.isArray(t.value),t.value),console.log("updating store value: "+t.key,t.value),e[t.key]=t.value):(console.log("updating store object: "+i()(t.key),t.value),e[t.key]=l()({},e[t.key],t.value))},UPDATE_AREA:function(e,t){var a=e.geo.areas.filter(function(e){return e.feature.properties.id==t})[0];console.log(a),e.neighbourhood=t,e.map.center={lon:a.feature.properties.Centroids_x,lat:a.feature.properties.Centroids_y}}},getters:{areaSelect:function(e,t){return e.indicators?t.dataByYear.concat(t.dataByCityYear):[]},neighbourhoods:function(e,t){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.name)&&e.push(t.name),e},[]):[]},years:function(e){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.year)&&t.year&&e.push(t.year),e},[]):[]},dataByYear:function(e){return e.indicators?e.indicators.filter(function(t){return t.year===e.year}):[]},dataByNeighbourhood:function(e){if(!e.indicators)return[];var t=e.indicators.filter(function(t){return t.area_code===e.neighbourhood});return t.length>0?t:e.cityIndicators},dataByHoodYear:function(e,t){return e._col_indicators.filter(function(t){return t.areaCode===e.neighbourhood&&t.year===e.year})[0]||{}},dataByCityYear:function(e){return e.cityIndicators.filter(function(t){return t.year===e.year})[0]||{}},educationalByHood:function(e){console.log("edubyhood - init",e.geo.educational);var t=e.geo.educational.reduce(function(t,a){return a.feature.properties.mygeodat_5===e.neighbourhood&&t.push(a.feature.properties),t},[]);return console.log("edubyhood",t),t},educationalGeoByHood:function(e){if(!e.geo.educational)return[];var t=e.geo.educational.filter(function(t){return t.feature.properties.mygeodat_5===e.neighbourhood});return console.log("educational geo",t),t},selectedFeature:function(e){return e._col_features.filter(function(t){return t.feature.properties._id===e.selectedFeature})[0]},selectedAreas:function(e){return console.log("areas",e._col_areas.filter(function(t){return t.layer===e._col_areaLayers_selected})),e._col_areas.filter(function(t){return t.layer===e._col_areaLayers_selected})},selectedArea:function(e,t){return t.selectedAreas.filter(function(t){return t.feature.properties._id===e.selectedFeature})[0]},geojson:function(e){return e._col_features?e._col_features.map(function(e){return e.feature}):[]},selectedLayer:function(e){return e._col_layers?e._col_layers.filter(function(t){return t._id===e._col_layers_selected})[0]:null},selectedLayerAttributes:function(e){return e._col_layerAttributes?e._col_layerAttributes.filter(function(t){return t.layer===e._col_layers_selected}):null},selectedIndicatorBlocks:function(e){return e._col_indicatorBlocks?e._col_indicatorBlocks.filter(function(t){return t.active&&t.layer===e._col_indicatorSections_selected}):null},allIndicatorsByYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.year?(e[t.year]=e[t.year]||[],e[t.year].push(_t(t)),e):e},{}):null},allIndicatorsByArea:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||[],e[t.areaCode].push(_t(t)),e):e},{}):null},allIndicatorsByAreaYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||{},e[t.areaCode][t.year]=t,e):e},{}):null},indicatorsForSelectedYear:function(e,t){if(t.allIndicatorsByYear)return t.allIndicatorsByYear[e.year]},indicatorsForSelectedArea:function(e,t){if(t.allIndicatorsByArea)return t.allIndicatorsByArea[e.neighbourhood].sort(function(e,t){return e.year-t.year})},selectedIndicator:function(e,t){return a=[e.neighbourhood,e.year],r=t.allIndicatorsByAreaYear,(a="string"==typeof a?a.split("."):a)?a.reduce(function(e,t){return e&&e[t]?e[t]:null},r):r;var a,r}}});new d.default({router:dt,store:yt,render:function(e){return e(ue)}}).$mount("#app")},46:function(e){e.exports=[{name:"building_use",label_en:"The current use of the building",label_ar:"  ",validation:"'required'",type:"radio",options:[{value:1,label_en:"For housing only",label_ar:" "},{value:2,label_en:"For housing and work",label_ar:" "},{value:3,label_en:"For work only (workshops and shops)",label_ar:"( ( "},{value:4,label_en:"Housing and General Facility",label_ar:"  "},{value:5,label_en:"General annex",label_ar:" "},{value:6,label_en:"Not used",label_ar:" "},{value:7,label_en:"Hangars for animals and birds",label_ar:"  "},{value:8,label_en:"For storage",label_ar:""}]},{name:"housing_units",label_en:"Number of housing units",label_ar:"   ",type:"text",validation:{required:!0}},{name:"building_stories",label_en:"Number of stories",label_ar:"  ",type:"text",validation:"required|numeric|min:1"},{name:"building_type",label_en:"The type building",label_ar:" ",type:"radio",validation:"'required'",options:[{value:1,label_en:"Villa or detached",label_ar:".+ "},{value:2,label_en:"Apartment",label_ar:""},{value:3,label_en:"Tent",label_ar:" "},{value:4,label_en:"Other",label_ar:" "}]},{name:"building_condition",label_en:"The state of the public building",label_ar:"   ",type:"text",validation:"'required'"},{name:"notes",label_en:"Notes",label_ar:"",type:"textarea",validation:""}]},70:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){},75:function(e,t,a){},76:function(e,t,a){},77:function(e,t,a){},94:function(e,t,a){var r=a(388);e.exports={layers:{name:"Layers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},data_type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Point",icon:"scatter_plot"},{name:"LineString",icon:"timeline"},{name:"MultiPolygon",icon:"bubble_chart"}]},spatial_intersect:{type:Array,_text:"Areas for Analysis",_multiple:!0,_options:function(e){return console.log("areas analysis select function"),e.state._col_areaLayers}}}},layerAttributes:{name:"Attributes",canPaste:!0,schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},func:{type:Array,_text:"Functions",_multiple:!0,_options:[{name:"count",color:"secondary"},{name:"sum",color:"tertiary"}],_computed:function(e,t,a,r){var i=e.state["_col_"+a].filter(function(e){return e.layer===r});if(i){var o=["count",""];return o="Number"===t.type?o.concat(["sum"]):o,i.reduce(function(e,t){return"Number"===t.type&&e.push("sum: "+t.name),e},o)}}},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},layerCalcs:{name:"Attributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},layer:{type:r.Schema.Types.ObjectId,required:!0},func:{type:Array,_text:"Functions",_multiple:!0,_combobox:!0,_categorised:!0,_options:function(e,t){var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{}),i=e.state._col_layerAttributes,o=r[e.state._col_layers_selected].spatial_intersect,n=a.reduce(function(e,t){return t.spatial_intersect.some(function(e){return o.indexOf(e)>-1})&&e.push(t._id),e},[]);return i.reduce(function(e,t){if(t.func.length>0){var a=n.indexOf(t.layer);if(a>-1){var i=n[a];e[i]=e[i]||{name:r[i].text_en,items:["count"]},t.func.forEach(function(a){a&&e[i].items.push(t.name+"."+a)})}}return e},{})}}}},indicatorSections:{name:"Sections",schema:{name:{type:String,required:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},geodata:{type:Array,_text:"Feature Layers",_multiple:!0,_options:function(e){return e.state._col_layers}}}},indicatorBlocks:{name:"Modules",canPaste:!0,schema:{type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Figure"},{name:"Chart"},{name:"Table"},{name:"List"}]},active:{type:Boolean,_text:"Active"},layer:{type:r.Schema.Types.ObjectId,required:!0},text_en:{type:String,required:!0,_text:"Name (English)"},text_ar:{type:String,_text:"Name (Arabic)"},areaLayer:{type:Array,_text:"Spatial Intersect",_multiple:!0,_options:function(e){return e.state._col_areaLayers}},figure:{type:Array,_text:"Figure",_categorised:!0,_options:function(e,t){if(!t.areaLayer)return{};var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{attached:{text_en:"Area"}}),i=e.state._col_areaAttributes.map(function(e){return e.func=["%%%"],e.layer="attached",e}),o=e.state._col_layerCalcs.map(function(e){return e.func=["%%%"],e}).concat(e.state._col_layerAttributes).concat(i);console.log("options layerAttrs",o);var n=a.reduce(function(e,a){return a.spatial_intersect.some(function(e){return t.areaLayer.indexOf(e)>-1})&&e.push(a._id),e},["attached"]),s=o.reduce(function(e,t){if(t.func.length>0){var a=n.indexOf(t.layer);if(a>-1){var i=n[a];e[i]=e[i]||{name:r[i].text_en,items:[]},t.func.forEach(function(a){a&&e[i].items.push((t.name+"."+a).replace(".%%%",""))})}}return e},{});return console.log("categorised options",s),s}},description_en:{type:String,_text:"Description (English)"},description_ar:{type:String,_text:"Description (Arabic)"},unit:{type:String,_text:"Unit"}}},features:{name:"Features",schema:"meta",params:"/:collection"},indicators:{name:"Indicators",schema:{},schemaOpts:{strict:!1}},areaLayers:{name:"AreasLayers",schema:{name:{type:String,required:!0,_text:"Name"},code:{type:String,required:!0,unique:!0,_text:"Column Name"}}},areas:{name:"Areas",schema:"spatial"},areaAttributes:{name:"Area Attributes",canPaste:!0,_description_en:"For non-spatial attribute data that is directly associatied with the spatial area i.e data from JIIS relating to a statistical area",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},buildings:{name:"Buildings",schema:"spatial"}}}});