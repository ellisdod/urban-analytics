!function(e){function t(t){for(var r,n,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)n=s[d],i[n]&&p.push(i[n][0]),i[n]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);p.length;)p.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,s=1;s<a.length;s++){var l=a[s];0!==i[l]&&(r=!1)}r&&(o.splice(t--,1),e=n(n.s=a[0]))}return e}var r={},i={0:0},o=[];function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;o.push([458,1]),a()}({302:function(e,t){var a=function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t};t.rowsToObjects=function(e,t){return t.reduce(function(t,a){return t.push(e.reduce(function(e,t,r){return e[t]=a[r],e},{})),t},[])},t.sortNumbers=function(e,t){if(!e||!t)return null;var r=(e=e.map(function(e){return a(t,e)})).sort(function(e,t){var a=parseInt(e),r=parseInt(t);return a>r?1:a<r?-1:0}),i={min:r[0]};console.log("sorted",r);for(var o=r.length-1;o>=0;o--){var n=r[o];if("number"==typeof n){i.max=n;break}}return i.constant=i.max-i.min,i},t.getNested=a},303:function(e){e.exports=[{name:"building_use",label_en:"The current use of the building",label_ar:"الإستخدام الحالي للمبنى",validation:"'required'",type:"radio",options:[{value:1,label_en:"For housing only",label_ar:"للسكن فقط"},{value:2,label_en:"For housing and work",label_ar:"للسكن والعمل"},{value:3,label_en:"For work only (workshops and shops)",label_ar:"(للعمل فقط(مشاغل ودكاكين"},{value:4,label_en:"Housing and General Facility",label_ar:"سكن ومرفق عام"},{value:5,label_en:"General annex",label_ar:"مرفق عام"},{value:6,label_en:"Not used",label_ar:"غير مستخدم"},{value:7,label_en:"Hangars for animals and birds",label_ar:"حظائر للحيوانات والطيور"},{value:8,label_en:"For storage",label_ar:"للتخزين"}]},{name:"housing_units",label_en:"Number of housing units",label_ar:"عدد الشقق في المبنى",type:"text",validation:{required:!0}},{name:"building_stories",label_en:"Number of stories",label_ar:"عدد طوابق المبنى",type:"text",validation:"required|numeric|min:1"},{name:"building_type",label_en:"The type building",label_ar:"نوع المبنى",type:"radio",validation:"'required'",options:[{value:1,label_en:"Villa or detached",label_ar:".فيلا+بيت مستقل"},{value:2,label_en:"Apartment",label_ar:"عمارة"},{value:3,label_en:"Tent",label_ar:"خيم وبركسات"},{value:4,label_en:"Other",label_ar:"شيء آخر"}]},{name:"building_condition",label_en:"The state of the public building",label_ar:"حالة المبنى العامة ",type:"text",validation:"'required'"},{name:"notes",label_en:"Notes",label_ar:"ملاحظات",type:"textarea",validation:""}]},374:function(e,t){e.exports=[{params:"/:query",name:"find",method:"get"},{params:"/:key",name:"distinct",method:"get"},{params:"",name:"create",auth:!0,method:"post",middleware:"formidable"},{params:"/:id",name:"del",auth:!0,method:"post"},{params:"/:params",name:"update",auth:!0,method:"post"},{params:"",name:"update",auth:!0,method:"post"},{params:"/:areaLayerId",name:"updateAnalysis",auth:!0,method:"post",restrict:["features"]},{params:"",name:"updateMany",auth:!0,method:"post",middleware:"formidable"},{params:"",name:"deleteMany",auth:!0,method:"post",middleware:""}]},380:function(e,t,a){"use strict";var r=a(68);a.n(r).a},381:function(e,t,a){"use strict";var r=a(69);a.n(r).a},382:function(e,t,a){"use strict";var r=a(70);a.n(r).a},383:function(e,t,a){"use strict";var r=a(71);a.n(r).a},385:function(e,t,a){var r={"./af":143,"./af.js":143,"./ar":144,"./ar-dz":145,"./ar-dz.js":145,"./ar-kw":146,"./ar-kw.js":146,"./ar-ly":147,"./ar-ly.js":147,"./ar-ma":148,"./ar-ma.js":148,"./ar-sa":149,"./ar-sa.js":149,"./ar-tn":150,"./ar-tn.js":150,"./ar.js":144,"./az":151,"./az.js":151,"./be":152,"./be.js":152,"./bg":153,"./bg.js":153,"./bm":154,"./bm.js":154,"./bn":155,"./bn.js":155,"./bo":156,"./bo.js":156,"./br":157,"./br.js":157,"./bs":158,"./bs.js":158,"./ca":159,"./ca.js":159,"./cs":160,"./cs.js":160,"./cv":161,"./cv.js":161,"./cy":162,"./cy.js":162,"./da":163,"./da.js":163,"./de":164,"./de-at":165,"./de-at.js":165,"./de-ch":166,"./de-ch.js":166,"./de.js":164,"./dv":167,"./dv.js":167,"./el":168,"./el.js":168,"./en-SG":169,"./en-SG.js":169,"./en-au":170,"./en-au.js":170,"./en-ca":171,"./en-ca.js":171,"./en-gb":172,"./en-gb.js":172,"./en-ie":173,"./en-ie.js":173,"./en-il":174,"./en-il.js":174,"./en-nz":175,"./en-nz.js":175,"./eo":176,"./eo.js":176,"./es":177,"./es-do":178,"./es-do.js":178,"./es-us":179,"./es-us.js":179,"./es.js":177,"./et":180,"./et.js":180,"./eu":181,"./eu.js":181,"./fa":182,"./fa.js":182,"./fi":183,"./fi.js":183,"./fo":184,"./fo.js":184,"./fr":185,"./fr-ca":186,"./fr-ca.js":186,"./fr-ch":187,"./fr-ch.js":187,"./fr.js":185,"./fy":188,"./fy.js":188,"./ga":189,"./ga.js":189,"./gd":190,"./gd.js":190,"./gl":191,"./gl.js":191,"./gom-latn":192,"./gom-latn.js":192,"./gu":193,"./gu.js":193,"./he":194,"./he.js":194,"./hi":195,"./hi.js":195,"./hr":196,"./hr.js":196,"./hu":197,"./hu.js":197,"./hy-am":198,"./hy-am.js":198,"./id":199,"./id.js":199,"./is":200,"./is.js":200,"./it":201,"./it-ch":202,"./it-ch.js":202,"./it.js":201,"./ja":203,"./ja.js":203,"./jv":204,"./jv.js":204,"./ka":205,"./ka.js":205,"./kk":206,"./kk.js":206,"./km":207,"./km.js":207,"./kn":208,"./kn.js":208,"./ko":209,"./ko.js":209,"./ku":210,"./ku.js":210,"./ky":211,"./ky.js":211,"./lb":212,"./lb.js":212,"./lo":213,"./lo.js":213,"./lt":214,"./lt.js":214,"./lv":215,"./lv.js":215,"./me":216,"./me.js":216,"./mi":217,"./mi.js":217,"./mk":218,"./mk.js":218,"./ml":219,"./ml.js":219,"./mn":220,"./mn.js":220,"./mr":221,"./mr.js":221,"./ms":222,"./ms-my":223,"./ms-my.js":223,"./ms.js":222,"./mt":224,"./mt.js":224,"./my":225,"./my.js":225,"./nb":226,"./nb.js":226,"./ne":227,"./ne.js":227,"./nl":228,"./nl-be":229,"./nl-be.js":229,"./nl.js":228,"./nn":230,"./nn.js":230,"./pa-in":231,"./pa-in.js":231,"./pl":232,"./pl.js":232,"./pt":233,"./pt-br":234,"./pt-br.js":234,"./pt.js":233,"./ro":235,"./ro.js":235,"./ru":236,"./ru.js":236,"./sd":237,"./sd.js":237,"./se":238,"./se.js":238,"./si":239,"./si.js":239,"./sk":240,"./sk.js":240,"./sl":241,"./sl.js":241,"./sq":242,"./sq.js":242,"./sr":243,"./sr-cyrl":244,"./sr-cyrl.js":244,"./sr.js":243,"./ss":245,"./ss.js":245,"./sv":246,"./sv.js":246,"./sw":247,"./sw.js":247,"./ta":248,"./ta.js":248,"./te":249,"./te.js":249,"./tet":250,"./tet.js":250,"./tg":251,"./tg.js":251,"./th":252,"./th.js":252,"./tl-ph":253,"./tl-ph.js":253,"./tlh":254,"./tlh.js":254,"./tr":255,"./tr.js":255,"./tzl":256,"./tzl.js":256,"./tzm":257,"./tzm-latn":258,"./tzm-latn.js":258,"./tzm.js":257,"./ug-cn":259,"./ug-cn.js":259,"./uk":260,"./uk.js":260,"./ur":261,"./ur.js":261,"./uz":262,"./uz-latn":263,"./uz-latn.js":263,"./uz.js":262,"./vi":264,"./vi.js":264,"./x-pseudo":265,"./x-pseudo.js":265,"./yo":266,"./yo.js":266,"./zh-cn":267,"./zh-cn.js":267,"./zh-hk":268,"./zh-hk.js":268,"./zh-tw":269,"./zh-tw.js":269};function i(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=385},386:function(e,t,a){"use strict";var r=a(72);a.n(r).a},451:function(e,t,a){"use strict";var r=a(73);a.n(r).a},452:function(e,t,a){"use strict";var r=a(74);a.n(r).a},453:function(e,t,a){"use strict";var r=a(75);a.n(r).a},458:function(t,a,r){"use strict";r.r(a);var i=r(29),o=r.n(i),n=r(5),s=r.n(n),l=r(30),c=r.n(l),u=r(9),d=r.n(u),p=r(18),f=r.n(p),h=r(10),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",{attrs:{id:"keep",app:""}},[a("v-toolbar",{staticClass:"ejmap-border-bottom",attrs:{app:"",light:"","clipped-left":"",flat:"",color:"#fff"}},[a("v-toolbar-side-icon",{on:{click:function(t){return e.log()}}}),e._v(" "),a("v-toolbar-title",[a("div",{staticStyle:{"margin-bottom":"-5px"}},[e._v("Urban Analytics")]),e._v(" "),a("div",{staticClass:"grey--text",staticStyle:{"font-size":"0.6em"}},[e._v("East Jerusalem")])]),e._v(" "),a("v-spacer"),e._v(" "),e._l(e.items,function(t,r){return a("v-tooltip",{key:r,attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(r){var i=r.on;return[a("v-btn",e._g({attrs:{to:t.route,icon:""}},i),[a("v-icon",{attrs:{color:"grey darken-2"}},[e._v(e._s(t.icon))])],1)]}}],null,!0)},[e._v(" "),a("span",[e._v(e._s(t.text))])])}),e._v(" "),a("v-menu",{attrs:{"min-width":"300","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-tooltip",{attrs:{bottom:"","open-delay":"100"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[a("v-list-tile",[a("v-list-tile-content",[e.activeUser?a("v-list-tile-title",{staticClass:"grey--text body-1"},[e._v("\n                "+e._s(e.activeUser.email)+"\n              ")]):a("v-list-tile-title",{staticClass:"grey--text"},[e._v("\n                Login\n              ")])],1),e._v(" "),a("v-list-tile-action",[a("v-btn",e._g({attrs:{icon:""}},Object.assign({},r,i)),[a("v-icon",{attrs:{color:"grey darken-2"}},[e._v("person")])],1)],1)],1)]}}],null,!0)},[e._v(" "),a("span",[e._v("Account")])])]}}])},[e._v(" "),a("v-card",[a("v-list",[e.activeUser?a("v-list-tile",{attrs:{avatar:""}},[a("v-list-tile-content",[a("v-list-tile-title",[e._v(e._s(e.activeUser.name))]),e._v(" "),a("v-list-tile-sub-title",[e._v("IPCC")])],1)],1):e._e()],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),e.activeUser?a("v-btn",{attrs:{color:"primary",flat:""},on:{click:e.logout}},[e._v("Logout")]):a("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(t){return t.preventDefault(),e.login(t)}}},[e._v("Login")])],1)],1)],1)],2),e._v(" "),e.loading?a("v-container",[a("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[a("div",{staticClass:"text-xs-center"},[a("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),a("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)])],1):a("v-content",[a("router-view",{staticStyle:{height:"100%"}})],1)],1)};m._withStripped=!0;var _=r(22),y=r.n(_),v=r(45),g=r.n(v),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"container",style:e.mapStyle},[e.layers?a("l-map",{ref:"myMap",staticClass:"main-map",style:{height:e.mapHeight},attrs:{zoom:e.$store.state.map.zoom,center:e.$store.state.map.center,options:e.mapOptions,id:"map_"+e.featuresCollection},on:{"update:center":e.centerUpdate,"update:zoom":e.zoomUpdate}},["detailed"===e.baseMap?a("l-protobuf",{attrs:{url:"https://maps.tilehosting.com/data/v3/{z}/{x}/{y}.pbf?key=ArAI1SXQTYA6P3mWFnDs",options:e.protobufOpts}}):e._e(),e._v(" "),"basic"===e.baseMap?a("l-tile-layer",{attrs:{url:"https://cartodb-basemaps-b.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png",options:e.protobufOpts}}):e._e(),e._v(" "),"areas"===e.featuresCollection?a("l-geo-json",{attrs:{geojson:e.areasGeoJson,options:e.getGeoJsonOptions(),"options-style":e.getAreaStyle()}}):e._e(),e._v(" "),e._l(e.layers,function(t,r){return e.layers[r].on&&e.layers[r].features?a("l-geo-json",{directives:[{name:"else",rawName:"v-else"}],key:r,attrs:{geojson:e.layers[r].features,options:e.getGeoJsonOptions(r),"options-style":e.geoJsonStyle(r)}}):e._e()}),e._v(" "),a("div",{staticClass:"map-menu"},[a("v-menu",{attrs:{"min-width":"300px",flat:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-btn",e._g({attrs:{icon:""}},r),[a("v-icon",[e._v("more_vert")])],1)]}}],null,!1,3491234933)},[a("v-spacer"),e._v(" "),e._v(" "),a("v-list",{attrs:{dense:""}},[a("div",{staticClass:"px-4"},[a("div",[e._v("Base Map")]),e._v(" "),e._l(e.baseMaps,function(t,r){return[a("v-switch",{key:r,attrs:{color:"primary",label:t.text},nativeOn:{click:function(a){return e.updateBaseMap(t.type,t.selected)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"map.selected"}})]}),e._v(" "),a("v-switch",{attrs:{color:"primary",label:"Legend"},model:{value:e.showLegend,callback:function(t){e.showLegend=t},expression:"showLegend"}})],2)])],1)],1),e._v(" "),e.loading?a("div",{staticStyle:{position:"absolute",top:"180px","z-index":"10",width:"100%"}},[a("div",{staticClass:"text-xs-center"},[a("v-progress-circular",{attrs:{indeterminate:""}}),e._v(" "),a("div",{staticClass:"mt-5"},[e._v("Loading data...")])],1)]):e._e()],2):e._e(),e._v(" "),e.showLegend?a("div",{staticClass:"legend-right",style:e.legendStyle,attrs:{id:"map-legend"}},[e.options&&e.options.areaSelect?a("area-select",{staticClass:"ejmap-border-bottom px-3",attrs:{titleclass:"pb-0 pt-3 px-3 font-weight-medium"}}):e._e(),e._v(" "),e.allLayers?a("div",[a("v-expansion-panel",{attrs:{expand:""},model:{value:e.layerPanels,callback:function(t){e.layerPanels=t},expression:"layerPanels"}},e._l(e.layers,function(t,r){return a("v-expansion-panel-content",{key:r,scopedSlots:e._u([{key:"header",fn:function(){return[e._v("\n        "+e._s(t.text_en)+"\n      ")]},proxy:!0}],null,!0)},[e._v(" "),a("v-card",{staticClass:"pt-0"},[a("v-card-text",{staticClass:"pt-0"},[e.layers[r].on?a("map-legend",{attrs:{legend:e.layers[r].legend,value:e.layers[r].attribute,items:Object.keys(e.layers[r].attributes)},on:{input:function(t){e.updateAttributeKey(r,t)}}}):e._e()],1)],1)],1)}),1)],1):a("v-card",{staticClass:"pt-0"},[a("v-card-text",{staticClass:"pt-0"},e._l(e.layers,function(t,r){return t.on?a("map-legend",{key:r,attrs:{legend:e.layers[r].legend,value:e.layers[r].attribute,items:Object.keys(e.layers[r].attributes)},on:{input:function(t){e.updateAttributeKey(r,t)}}}):e._e()}),1)],1)],1):e._e()],1)};b._withStripped=!0;var x=r(301),w=r.n(x),C=r(459),k=r(460),S=r(461),A=r(462),$=r(463),j=r(464),O=r(465),E=function(){var e=this.$createElement;return(this._self._c||e)("div")};E._withStripped=!0;var T=r(1),I=r.n(T);r(352);if(void 0===I.a)throw new Error("leaflet library must be installed in order to use vue2-leaflet-vectorgrid.");if(void 0===I.a.vectorGrid)throw new Error("leaflet.vectorgrid library must be installed in order to use vue2-leaflet-vectorgrid.");var D={props:{url:{type:String,required:!0},options:{type:Object,default:function(){return{}}}},watch:{url:function(){this.updateLayer()},options:function(){this.updateLayer()}},mounted:function(){this.mapObject=I.a.vectorGrid.protobuf(this.url,this.options),this.$parent._isMounted&&this.deferredMountedTo(this.$parent.mapObject)},beforeDestroy:function(){this.removeLayer()},methods:{deferredMountedTo:function(e){this.mapObject.addTo(e),this.attributionControl=e.attributionControl;for(var t=0;t<this.$children.length;t++)"function"==typeof this.$children[t].deferredMountedTo&&this.$children[t].deferredMountedTo(this.mapObject)},setAttribution:function(e,t){this.attributionControl.removeAttribution(t),this.attributionControl.addAttribution(e)},setToken:function(e){this.options.token=e},removeLayer:function(){this.$parent.mapObject.removeLayer(this.mapObject)},updateLayer:function(){this.removeLayer(),this.mapObject=I.a.vectorGrid.protobuf(this.url,this.options),this.deferredMountedTo(this.$parent.mapObject)}}},F=r(2),P=Object(F.a)(D,E,[],!1,null,null,null);P.options.__file="public/Vue2LeafletVectorGridProtobuf.vue";var U=P.exports,M=r(115),N=r.n(M),B=(N()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.4},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.4},landcover:{fill:!0,weight:1,fillColor:"#53e033",color:"#53e033",fillOpacity:.1,opacity:.4},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.2,opacity:.4},park:{fill:!0,weight:1,fillColor:"#84ea5b",color:"#84ea5b",fillOpacity:.2,opacity:.4},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.2,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.2,opacity:.8}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.8}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#f2b648",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[]),N()({water:{fill:!0,weight:1,fillColor:"#06cccc",color:"#06cccc",fillOpacity:.2,opacity:.2},admin:[],waterway:{weight:1,fillColor:"#2375e0",color:"#2375e0",fillOpacity:.2,opacity:.2},landcover:{fill:!0,weight:1,fillColor:"#fafafa",color:"#fafafa",fillOpacity:.1,opacity:.2},landuse:{fill:!0,weight:1,fillColor:"#efe6f2",color:"#efe6f2",fillOpacity:.1,opacity:.2},park:{fill:!0,weight:1,fillColor:"#f3f3f3",color:"#f3f3f3",fillOpacity:.1,opacity:.2},boundary:function(){return 1==arguments[0].disputed?{weight:3,fillColor:"red",color:"red",fillOpacity:.1,opacity:.8}:4==arguments[0].admin_level?{weight:2,fillColor:"pink",color:"pink",fillOpacity:.1,opacity:.4}:arguments[0].admin_level<4?{weight:3,fillColor:"#999",color:"#999",fillOpacity:.1,opacity:.4}:[]},aeroway:{weight:1,fillColor:"#51aeb5",color:"#51aeb5",fillOpacity:.2,opacity:.4},road:{weight:1,fillColor:"#999",color:"#999",fillOpacity:.2,opacity:.4},tunnel:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},bridge:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transportation:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},transit:{weight:.5,fillColor:"#f2b648",color:"#999",fillOpacity:.2,opacity:.4},building:{fill:!0,weight:.5,fillColor:"#999",color:"#999",fillOpacity:.4,opacity:.8},water_name:[],transportation_name:[],place:[],housenumber:[],poi:[],earth:[],country_label:[],marine_label:[],state_label:[],place_label:[],waterway_label:[],poi_label:[],road_label:[],housenum_label:[],country_name:[],marine_name:[],state_name:[],place_name:[],waterway_name:[],poi_name:[],road_name:[],housenum_name:[],mountain_peak:[]},"poi_name",[])),z=r(28),Y=r.n(z),q=r(374);r(375);var K,H="http://localhost:8080"===window.location.origin?"http://localhost:8081":window.location.origin,J=Y.a.create({baseURL:H,json:!0}),G=(K=g()(y.a.mark(function e(t,a,r,i){var o;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},r=r||{},e.next=4,h.default.prototype.$auth.getAccessToken();case 4:return o=e.sent,e.abrupt("return",J({method:t,url:a,data:r,headers:d()({Authorization:"Bearer "+o},i)}));case 6:case"end":return e.stop()}},e,this)})),function(e,t,a,r){return K.apply(this,arguments)});function V(e){return e=(e="object"===(void 0===e?"undefined":o()(e))&&e?c()(e):e)?"/"+e:""}var R=q.reduce(function(e,t){return e[t.name]=function(e,a,r,i,o){return a=V(a),o=V(o),console.log(t.method,""+e+o+"/"+t.name+a,r,i),G(t.method,""+e+o+"/"+t.name+a,r,i)},e},{}),W=r(56),Z=r.n(W),X=r(302),Q=r.n(X),ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.title?a("div",{staticClass:"body-1 mt-2"},[e._v(e._s(e.title))]):e._e(),e._v(" "),a("v-select",{staticClass:"caption",staticStyle:{width:"100%","margin-top":"-10px"},attrs:{color:"grey",items:e.items,value:e.value},on:{change:e.updateDisplayKey}}),e._v(" "),e.legend&&e.legend.type===Number?a("table",{staticClass:"body-1"},[a("tr",[a("td",{staticClass:"key-gradient",style:{backgroundImage:"linear-gradient("+e.legend.chroma(0)+","+e.legend.chroma(1)+")"}}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n          "+e._s(e.legend.items.max)+"\n        ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n          "+e._s(e.legend.items.min)+"\n        ")])])])]):e.legend?a("table",{staticClass:"caption"},e._l(e.legend.items,function(t,r){return a("tr",[a("td",{staticClass:"key-icon",style:{color:t}},[e._v("●")]),e._v(" "),a("td",{staticClass:"key-figures"},[a("span",{staticClass:"body-1 grey--text text--darken-2",staticStyle:{padding:"1px 5px"}},[e._v(e._s(r))])])])}),0):e._e()],1)};ee._withStripped=!0;var te={props:["legend","title","value","items"],data:function(){return{}},methods:{updateDisplayKey:function(e){console.log("updateDisplayKey",e),this.$emit("input",e)}}},ae=Object(F.a)(te,ee,[],!1,null,null,null);ae.options.__file="src/components/MapLegend.vue";var re=ae.exports,ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.items?a("v-select",{staticClass:"area-select font-weight-medium",attrs:{items:e.items,"item-text":"name","item-value":"value","return-object":"",solo:"",flat:""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}):e._e()};ie._withStripped=!0;var oe={props:["titleclass"],data:function(){return{selected:""}},computed:{items:function(){return this.$store.getters.selectedAreas?this.$store.getters.selectedAreas.map(function(e){return{name:e.feature.properties.name,value:e.feature.properties}}):null}},methods:{update:function(e){this.$store.commit("UPDATE",{key:"neighbourhood",value:e.areaCode}),this.$store.commit("UPDATE",{key:["map","center"],value:{lon:e.centroid_lng,lat:e.centroid_lat}})}},watch:{selected:function(e,t){console.log(e,t),e!==t&&this.update(e.value)}},created:function(){var e=this.$store.getters.selectedArea;this.selected={name:e.feature.properties.name,value:e.feature.properties}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedArea},function(t,a){e.selected={name:t.feature.properties.name,value:t.feature.properties}})}},ne=(r(380),Object(F.a)(oe,ie,[],!1,null,null,null));ne.options.__file="src/components/AreaSelect.vue";var se=ne.exports,le=r(303),ce={name:"MapView",props:["featureLayers","featuresCollection","zoomLevel","options","areas","height","allLayers","legendBottom"],components:{LMap:C.a,LTileLayer:k.a,LMarker:S.a,LPopup:A.a,LTooltip:$.a,LProtobuf:U,LPolygon:j.a,LGeoJson:O.a,MapLegend:re,AreaSelect:se},$_veeValidate:{validator:"new"},data:function(){var e=this;return{layerPanels:[],loadingValue:null,loading:!1,language:"ar",languages:["ar","en"],basemaps:{url:"https://{s}.basemaps.cartocdn.com/{z}/{x}/{y}.png",url2:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",url3:"http://a.tile.openstreetmap.fr/hot/${z}/${x}/${y}.png "},center:I.a.latLng(31.778837,35.243452),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',currentZoom:14,currentCenter:I.a.latLng(31.778837,35.243452),showParagraph:!1,mapOptions:{zoomSnap:.5},layers:{},geoJsonAreaOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.areaCode}),r.$store.commit("UPDATE",{key:"selectedFeature",value:t._id}),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.centroid_lng,lat:t.centroid_lat}})}})}},geoJsonPolygonStyle:function(e){var t=e._selected?"black":"white";return{weight:1,color:t,opacity:.9,fillColor:t,fillOpacity:.6}},filtered:!1,survey:!1,surveyData:[],surveyNames:!1,surveyOpacity:.5,editFeature:{},editFeatureDefaults:{},editDialog:!1,editFeaturePath:"",editFeatureViewBox:"",editIndex:0,editMapCenter:{lat:31.843725284728198,lng:35.22635998187065},editMapFeature:null,editMapZoom:16,optionsDialog:!1,selectedSurvey:null,baseMaps:[{text:"Basic",type:"basic",selected:!0},{text:"Detailed",type:"detailed",selected:!1}],baseMap:"basic",surveyKey:{complete:{color:"#00C7FF",text:"Complete"},inProgress:{color:"#FFBD00",text:"In Progress"},notStarted:{color:"#FF0063",text:"Not Started"}},geoJsonOptions:{onEachFeature:function(e,t){var a=s()(e.properties).reduce(function(t,a){return t+"<li>"+a+": "+e.properties[a]+"</li>"},"<ul>")+"</ul>";t.bindPopup(a),t.on({click:function(e){console.log(e.target)},mouseover:function(e){}})}}}},computed:{showLegend:function(){return!this.hideLegend&&"areas"!==this.featuresCollection},featureLayersArray:function(){return this.featureLayers?Array.isArray(this.featureLayers)?this.featureLayers:[this.featureLayers]:[]},legendStyle:function(){var e=this.options?this.options.legendStyle:{};return d()({height:this.options&&this.options.legendBottom?"200px":"auto",maxHeight:this.options&&this.options.legendBottom?"200px":"400px",overflowY:"auto",overflowX:"visible!important"},e||{})},widthSmall:function(){return!!(this.$refs.container&&this.$refs.container.clientWidth<300)},mapHeight:function(){var e=document.getElementsByTagName("nav")[0].clientHeight;return this.height||window.innerHeight-e+"px"},mapStyle:function(){var e=this.options?this.options.mapStyle:{};return d()({display:this.options&&this.options.legendBottom?"block":"flex"},e||{})},areaStyle:function(){return this.layers?{weight:1,color:"#ccc",opacity:1,fillOpacity:0}:{}},layerPanelHeight:function(){return this.survey?window.innerHeight-150:350},surveyKeyArray:function(){return w()(this.surveyKey)},protobufOpts:function(){var e=this.survey?this.surveyOpacity:1;return{vectorTileLayerStyles:B,maxNativeZoom:18,opacity:e}},tileOpts:function(){return{opacity:this.survey?this.surveyOpacity:1}},surveyQuestions:function(){return this.translate(le,"label",this.language)},scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return t[e.$store.state.map.indicator.figure]}).sort(function(e,t){return e-t});return{min:t[0],max:t[t.length-1]-t[0]}},zoom:function(){return parseInt(this.zoomLevel)||this.$store.state.map.zoom||14},areasGeoJson:function(){var e=this.$store.getters.selectedAreas;return e?e.reduce(function(e,t){return t.feature.properties._id=t._id,e.push(t.feature),e},[]):null}},methods:{updateLegend:function(e){var t=this.layers[e];if(t.on&&t.features){var a=t.attributes[t.attribute];if(a){var r={items:{}};if(console.log("attribute",a,r),"Number"===a.type)r.items=Q.a.sortNumbers(t.features,"properties."+t.attribute),r.type=Number,r.chroma=Z.a.scale(["#ff236c","#2377ff"]);else if("String"===a.type){var i=t.features.reduce(function(e,a){var r=a.properties[t.attribute];return-1===e.indexOf(r)&&e.push(r),e},[]);i=(i=i.filter(function(e){return null!==e})).sort();var o=["#ff236c","#2377ff","#f4f141","#42f4b9","#f46441"];i.length>o.length&&(o=Z.a.scale(o).mode("lch").colors(i.length)),r.items=i.reduce(function(e,t,a){return e[t]=o[a],e},{}),r.items.null="#999",r.type=String}else"Boolean"===a.type&&(r.items={true:"red",false:"blue"},r.type=Boolean);this.$set(this.layers[e],"legend",r)}}},updateLayers:function(e,t){e="number"==typeof e?s()(this.layers)[e]:e,this.$set(this.layers[e],"on",t),t?this.checkForUpdate():this.$forceUpdate(),console.log(this.layers)},updateAttributeKey:function(e,t){this.$set(this.layers[e],"attribute",t),this.updateLegend(e),console.log(this.layers)},getGeoJsonOptions:function(e){if(console.log("getgeojsonopts",e),"areas"===this.featuresCollection)return this.geoJsonAreaOptions;var t=this.layers[e].data_type,a="";return"Point"===t?(a=this.geoJsonPointOptions(e),console.log("geojsonopts - opts",a),a):"Polygon"===t||"MultiPolygon"===t||"LineString"===t||"MultiLineString"===t?this.geoJsonOptions:void 0},geoJsonPointOptions:function(e){console.log("geojsonopts",e);var t=this;return{pointToLayer:function(a,r){var i=t.getLegendStyle(a,e,t.layers[e].legend);return I.a.circleMarker(r,i)},onEachFeature:function(e,a){var r=e.properties;a.bindPopup("<p>"+r.type+"</p><p>"+r.students+"</p>"),a.on({click:function(e){t.$store.commit("UPDATE",{key:"selectedFeature",value:e.target.feature.properties._id}),console.log(e)},mouseover:function(e){e.target.openPopup()},mouseout:function(e){e.target.closePopup()}})}}},geoJsonStyle:function(e){var t={weight:2,opacity:1,fillOpacity:.7,stroke:!1},a=this;return function(r){return a.getLegendStyle(r,a.layers[e].attribute,a.layers[e].legend,t)}},getLegendStyle:function(e,t,a,r){r=d()({radius:4,fillColor:"blue",weight:0,opacity:1,fillOpacity:.5},r);var i="fillColor",o=e.properties[t];return"LineString"!==e.geometry.type&&"MultiLineString"!==e.geometry.type||(r.stroke=!0,i="color"),this.showLegend&&a?(this.showLegend&&a.type===Number?r[i]=a.chroma((o-a.items.min)/a.items.constant).hex():this.showLegend&&(r[i]=a.items[o]),r):r},getAreaStyle:function(){var e=this,t={weight:2,color:"grey",opacity:.4,fillColor:"grey",fillOpacity:.2};return function(a){return e.$store.state.neighbourhood===a.properties.areaCode?d()({},t,{color:"orange",fillColor:"orange"}):t}},updateMap:function(){},updateBaseMap:function(e,t){console.log(e,t),this.baseMap=t?e:"",this.baseMaps.forEach(function(a){return a.selected=a.type==e&&t})},zoomUpdate:function(e){this.currentZoom=e},centerUpdate:function(e){this.currentCenter=e},getCoordsPoint:function(e){var t=e.geometry.coordinates[0][0];return I.a.latLng(t[1],t[0])},getSurveyNames:function(){var e=this;R.distinct("buildings","feature.properties.neighbourhood").then(function(t){e.surveyNames=t.data})},getSurveyData:function(e){var t=this;R.getSurveyData(e).then(function(e){e.data.forEach(function(e){e.feature.properties.Id=e._id,e.feature.properties.survey=e.feature.properties.survey||{}}),t.surveyData=e.data,t.styleSurveyData(),t.survey=!0,t.center=t.editMapCenter=t.getCoordsPoint(e.data[0].feature)})},toggleOptionsDialog:function(){this.optionsDialog=!this.optionsDialog,this.optionsDialog&&setTimeout(function(){var e=document.getElementsByClassName("v-toolbar__extension")[0].style;console.log(e),e.overflow="auto"},500)},translate:function(e,t,a){return function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":o()(i)))return i[a]=i[a+"_"+r],s()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(e,t,a)},update:function(){console.log("updating map...");var e=this.$children[0]?this.$children[0].mapObject:null;if(!e)return console.log("no map object",this.$children,this.$refs.myMap),this.$forceUpdate(),null;console.log("invalidating map - layers",this.layers),setTimeout(function(){return e.invalidateSize()},500)},log:function(e){},checkForUpdate:function(){var e=this,t=this.$store.state._col_features;if(!this.layers)return null;var a=s()(this.layers).reduce(function(a,r){return e.layers[r].on?(a.push(new f.a(function(a,i){var o={},n=e.layers[r].filtered,s=t[r].length;if(e.loading||0!==s&&!n)return o[r]=t[r],a(o);e.loading=!0,e.$store.dispatch("UPDATE_COLLECTION",{layer:r,name:"features"}).then(function(t,i){return i&&console.log("update error",i),console.log("dispatch return",t),e.loading=!1,o[r]=t,a(o)})})),a):a},[]);f.a.all(a).then(function(t){console.log("promises complete",t,e.$store.state._col_features),t.forEach(function(t){var a=s()(t)[0];e.$set(e.layers[a],"features",t[a].map(function(e){return e.feature})),e.updateLegend(a)}),e.update()})},setLayers:function(){var e=this,t=this.$store.state._col_layers,a=this.$store.state._col_layerAttributes;this.allLayers,t.forEach(function(t){var r=d()({features:"",legend:""},t);r.attributes=a.reduce(function(e,t){return r._id===t.layer&&t.func.length>0&&(e[t.name]=t),e},{}),r.attribute=s()(r.attributes)[0],r.on=e.featureLayersArray.indexOf(r._id)>-1,e.layerPanels.push(r.on),e.$set(e.layers,r._id,r)}),console.log("layers",this.layers)}},created:function(){this.setLayers()},watch:{featureLayers:function(e,t){console.log("selected",e),this.updateLayers(t,!1),this.updateLayers(e,!0)},layerPanels:function(e,t){for(var a=0;a<e.length;a++)t[a]&&e[a]==t[a]||this.updateLayers(a,e[a])}},mounted:function(){var e=this;console.log("layers on mount",this.layers),this.$nextTick(function(){e.editFeatureDefaults=d()({},e.editFeature),e.checkForUpdate()}),this.$store.watch(function(e){return e.neighbourhood},this.checkForUpdate),this.$store.watch(function(e){return e._col_layers_selected},this.checkForUpdate),this.$store.watch(function(e){return e._col_indicatorSections_selected},this.checkForUpdate)}},ue=(r(381),Object(F.a)(ce,b,[],!1,null,null,null));ue.options.__file="src/components/MapView.vue";var de=ue.exports,pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("table",{attrs:{id:"navigator-key"}},[a("tr",{attrs:{id:"navigator-header"}},[a("td",{attrs:{colspan:"2"}},[a("area-select",{attrs:{titleclass:"title"}}),e._v(" "),a("div",{staticClass:"subheading grey--text text--darken-2"},[e._v("\n          "+e._s(e.$store.state.navigator.indicator.name)+" - "+e._s(e.$store.state.year)+"\n          ")]),e._v(" "),a("div",{staticClass:"caption py-1"},[e._v("\n          "+e._s(e.details.neighbourhood)+"\n          "),a("div",{staticStyle:{height:"15px"}},[e._v("\n          "+e._s(e.details.value)+"\n        ")])])],1)]),e._v(" "),a("tr"),e._v(" "),a("tr",[a("td",{staticClass:"key-gradient"}),e._v(" "),a("td",{staticClass:"key-figures"},[a("div",{staticClass:"key-max"},[e._v("\n            "+e._s(e.scale.max.toFixed(0))+"\n          ")]),e._v(" "),a("div",{staticClass:"key-min"},[e._v("\n            "+e._s(e.scale.min.toFixed(0))+"\n          ")])])])]),e._v(" "),a("l-map",{attrs:{zoom:e.$store.state.navigator.zoom,center:e.$store.state.navigator.center,options:e.mapOptions,id:"navigation-map"}},e._l(e.$store.state._col_areas.filter(function(e){return e.feature}),function(t,r){return a("l-geo-json",{key:t._id,attrs:{geojson:t.feature,options:e.areasGeoJsonOptions,"options-style":e.getAreaStyle(t.feature.properties.id)}})}),1)],1)};pe._withStripped=!0;var fe={name:"MapView",components:{LMap:C.a,LTileLayer:k.a,LMarker:S.a,LPopup:A.a,LTooltip:$.a,LPolygon:j.a,LGeoJson:O.a,AreaSelect:se},data:function(){var e=this;return{zoom:15,center:L.latLng(31.801141899926307,35.18584083885216),attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',showParagraph:!1,details:{neighbourhood:"",value:"",key:""},detailsDefault:{neighbourhood:"",value:"",key:""},mapOptions:{zoomSnap:.5},areasGeoJsonOptions:{onEachFeature:function(t,a){var r=e;a.on({click:function(e){var t=e.target.feature.properties;r.$store.commit("UPDATE",{key:"neighbourhood",value:t.id}),r.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),r.$store.commit("UPDATE",{key:["map","center"],value:{lon:t.centroid_lng,lat:t.centroid_lat}})},mouseover:function(e){var t=r.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e.target.feature.properties.id})[0];r.details={neighbourhood:t.name,value:t[r.$store.state.navigator.indicator.figure],key:""}},mouseout:function(e){r.details=r.detailsDefault}})}},layers:{areas:!0}}},computed:{scale:function(){var e=this,t=this.$store.getters.indicatorsForSelectedYear.map(function(t){return parseInt(t[e.$store.state.navigator.indicator.figure])}).sort(function(e,t){return e-t});return console.log("scale sorted",this.$store.state.navigator.indicator.figure,t),{min:t[0]||0,constant:t[t.length-1]-t[0]||0,max:t[t.length-1]||0}}},methods:{getAreaStyle:function(e){var t=Z.a.scale(["#eaeaea",this.$vuetify.theme.primary]),a=this.$store.getters.indicatorsForSelectedYear.filter(function(t){return t.areaCode===e})[0];if(!a)return{opacity:0,fillOpacity:0};var r=t((a[this.$store.state.navigator.indicator.figure]-this.scale.min)/this.scale.constant),i=this.$store.state.neighbourhood===e?this.$vuetify.theme.tertiary:"#eee";return{weight:(this.$store.state.neighbourhood,1),color:i,opacity:1,fillColor:r,fillOpacity:1}},selectArea:function(e){},mouseoverArea:function(e){}},mounted:function(){}},he=(r(382),Object(F.a)(fe,pe,[],!1,null,null,null));he.options.__file="src/components/MapNavigator.vue";var me=he.exports,_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.desserts},scopedSlots:e._u([{key:"items",fn:function(t){return[a("td",[e._v(e._s(t.item.name))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.calories))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.fat))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.carbs))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.protein))]),e._v(" "),a("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.iron))])]}}])})};_e._withStripped=!0;var ye={data:function(){return{headers:[{text:"Dessert (100g serving)",align:"left",sortable:!1,value:"name"},{text:"Calories",value:"calories"},{text:"Fat (g)",value:"fat"},{text:"Carbs (g)",value:"carbs"},{text:"Protein (g)",value:"protein"},{text:"Iron (%)",value:"iron"}],desserts:[{name:"Frozen Yogurt",calories:159,fat:6,carbs:24,protein:4,iron:"1%"},{name:"Ice cream sandwich",calories:237,fat:9,carbs:37,protein:4.3,iron:"1%"},{name:"Eclair",calories:262,fat:16,carbs:23,protein:6,iron:"7%"},{name:"Cupcake",calories:305,fat:3.7,carbs:67,protein:4.3,iron:"8%"},{name:"Gingerbread",calories:356,fat:16,carbs:49,protein:3.9,iron:"16%"},{name:"Jelly bean",calories:375,fat:0,carbs:94,protein:0,iron:"0%"},{name:"Lollipop",calories:392,fat:.2,carbs:98,protein:0,iron:"2%"},{name:"Honeycomb",calories:408,fat:3.2,carbs:87,protein:6.5,iron:"45%"},{name:"Donut",calories:452,fat:25,carbs:51,protein:4.9,iron:"22%"},{name:"KitKat",calories:518,fat:26,carbs:65,protein:7,iron:"6%"}]}}},ve=Object(F.a)(ye,_e,[],!1,null,null,null);ve.options.__file="src/components/Viewer.vue";var ge={name:"App",components:{MapView:de,Viewer:ve.exports},data:function(){return{loading:!0,miniNav:!0,activeUser:null,authenticated:!1,drawerIndicators:!1,layersPanel:!0,currentView:"map-view",layers:[]}},computed:{items:function(){var e=[{icon:"help",text:"About",route:"help"},{icon:"map",route:"map",text:"Map"},{icon:"bar_chart",text:"Urban Indicators",route:"indicators"}];return this.activeUser?e.concat([{icon:"settings",text:"Manage Data",route:"manage"}]):e}},props:{source:String},created:function(){var e=this;return g()(y.a.mark(function t(){return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refreshActiveUser();case 2:case"end":return t.stop()}},t,e)}))()},watch:{$route:"refreshActiveUser"},methods:{log:function(){console.log("store",this.$store.state)},login:function(){this.$auth.loginRedirect()},refreshActiveUser:function(){var e=this;return g()(y.a.mark(function t(){return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.getUser();case 2:e.activeUser=t.sent;case 3:case"end":return t.stop()}},t,e)}))()},logout:function(){var e=this;return g()(y.a.mark(function t(){return y.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.logout();case 2:return t.next=4,e.refreshActiveUser();case 4:e.$router.push("/");case 5:case"end":return t.stop()}},t,e)}))()},printUser:function(){console.log("USER"),console.log(this.activeUser),console.log(this.$auth)}},mounted:function(){var e,t=this;f.a.all([this.$store.dispatch("UPDATE_COLLECTION","areaLayers"),this.$store.dispatch("UPDATE_COLLECTION","layers")]).then(function(a){var r=a[0][0];e=a[1].reduce(function(e,t){return e[t._id]=[],e},{}),console.log("layerIds",e);var i=[t.$store.dispatch("UPDATE_COLLECTION",{name:"areas",layer:r._id}),t.$store.dispatch("UPDATE_COLLECTION",{name:"indicators",layer:r._id}),t.$store.dispatch("UPDATE_COLLECTION","indicatorSections"),t.$store.dispatch("UPDATE_COLLECTION","indicatorBlocks"),t.$store.dispatch("UPDATE_COLLECTION","layerCalcs"),t.$store.dispatch("UPDATE_COLLECTION","layerAttributes"),t.$store.dispatch("UPDATE_COLLECTION","areaAttributes"),t.$store.dispatch("UPDATE_COLLECTION","indicatorAttributes")];return f.a.all(i)}).then(function(){console.log("LOADING COMPLETE"),t.loading=!1,t.$store.commit("UPDATE",{key:"_col_features",value:e})})}},be=(r(383),Object(F.a)(ge,m,[],!1,null,null,null));be.options.__file="src/App.vue";var xe=be.exports,we=r(117),Ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm2:"","xs-12":""}},[a("editable-data-list",{attrs:{collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{attrs:{sm7:"",xs12:""}},[a("div",{staticStyle:{position:"relative",display:"block"}},[a("masonry",{attrs:{cols:2,gutter:20}},e._l(e.items,function(t,r){return a("div",{key:t._id,staticStyle:{"margin-bottom":"20px"},attrs:{sm6:"",xs12:""},on:{click:function(t){return e.updateSelected(r)}}},[t.datatable?a("div",{staticClass:"py-3"},[a("v-divider"),e._v(" "),a("div",{staticClass:"title py-3"},[e._v(e._s(t.name))]),e._v(" "),a("v-data-table",{attrs:{items:t.data,headers:t.headers,"rows-per-page-items":[-1]},scopedSlots:e._u([{key:"items",fn:function(r){return e._l(t.headers,function(t){return a("td",[e._v(e._s(r.item[t.value]))])})}}],null,!0)})],1):"Figure"===t.type||"List"===t.type||"Chart"===t.type?a("indicator-key-stat",{attrs:{selected:e.selected===r,name:t.text,figure:t.figure,description:t.description,unit:t.unit,year:t.year,type:t.type}}):"Map"===t.type?a("v-card",[a("v-card-title",[e._v("\n                "+e._s(t.text)+"\n              ")]),e._v(" "),a("map-view",{staticStyle:{position:"relative"},attrs:{contextmenu:"",featuresCollection:"features",zoomLevel:"12",height:"400px",featureLayers:t.figure,areas:!0,options:{legendBottom:!0}}})],1):e._e()],1)}),0)],1)]),e._v(" "),a("v-flex",{attrs:{sm3:"",xs12:""}},[e.$store.getters.indicatorsForSelectedYear?a("map-navigator",{attrs:{id:"map-panel-navigator"}}):e._e(),e._v(" "),a("div",{attrs:{id:"info-panel"}})],1)],1)],1)],1)};Ce._withStripped=!0;var ke={props:{title:String,"x-labels":Boolean,"y-labels":Boolean,clickHandler:Boolean},data:function(){var t=this;return{options:{axes:{display:!1},scales:{yAxes:[{display:t.$props.yLabels,gridLines:{display:!1},scaleLabel:{display:t.$props.yLabels},ticks:{display:t.$props.yLabels}}],xAxes:[{display:t.$props.xLabels,gridLines:{display:!1},scaleLabel:{display:t.$props.xLabels},ticks:{display:t.$props.xLabels}}]},legend:{display:!1},title:{display:!0,text:t.$props.title||""},maintainAspectRatio:!1,onClick:function(a,r){if(console.log("chartoutput",r[0]),t.$props.clickHandler){var i=t.$store.getters.selectedAreas.filter(function(e){return e.feature.properties.name===r[0]._model.label})[0].feature.properties;console.log("chartoutput",r[0]),t.$store.commit("UPDATE",{key:"neighbourhood",value:i.areaCode}),t.$store.commit("UPDATE",{key:["map","zoom"],value:15}),console.log("coords",e.target._map.getCenter()),t.$store.commit("UPDATE",{key:["map","center"],value:{lon:i.centroid_lng,lat:i.centroid_lat}})}}}}}},Se=r(46),Ae=Se.c.reactiveProp,$e={extends:Se.b,mixins:[ke,Ae],mounted:function(){this.renderChart(this.chartData,this.options)}},Le=Se.c.reactiveProp,je={extends:Se.a,mixins:[Le,ke],mounted:function(){this.renderChart(this.chartData,this.options)}},Oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{class:[{selected:e.selected},"indicator-hover"],attrs:{hover:"",ripple:"",raised:""}},["List"===e.type&&e.selectedIndicator?a("div",[a("v-list",e._l(e.selectedIndicator[e.figure[0]],function(t,r){return a("v-list-item",[a("v-list-tile-action",[e._v("\n            "+e._s(r)+"\n          ")]),e._v(" "),a("v-list-tile-content",[e._v("\n            "+e._s(t)+"\n          ")])],1)}),1)],1):e.selectedIndicator?a("div",{staticClass:"pa-2",staticStyle:{position:"relative"},on:{click:function(t){return e.updateIndicator()}}},[a("div",{staticClass:"subheading font-weight-light",staticStyle:{width:"40%"}},[e._v(e._s(e.name))]),e._v(" "),"Figure"===e.type?a("div",{staticStyle:{"overflow-x":"visible",display:"inline-block","white-space":"nowrap"}},[a("span",{staticClass:"display-1 py-0"},[e._v(e._s(e.selectedIndicator[e.figure[0]]))]),e._v(" "),e.unit?a("span",{staticClass:"subheading ml-1"},[e._v(e._s(e.unit))]):e._e(),e._v(" "),a("div",{staticClass:"font-weight-light"},[e._v(e._s(e.year))])]):e._e(),e._v(" "),a("div",{staticClass:"caption"},[e._v(e._s(e.description))]),e._v(" "),e.dataYears?a("div",{staticClass:"px-1",staticStyle:{position:"absolute",top:"-10px",right:"15px",width:"50%"}},[a("v-slider",{attrs:{"track-color":"transparent","always-dirty":"","inverse-label":"","tick-labels":e.makeSliderLabels(e.dataYears),ticks:"always","tick-size":2,min:e.dataYears[0],max:e.dataYears[e.dataYears.length-1]},model:{value:e.selectedYear,callback:function(t){e.selectedYear=t},expression:"selectedYear"}})],1):e._e(),e._v(" "),a("div",{style:e.chartWidthClass},["Figure"===e.type?a("bar-vertical",{staticClass:"bar-chart-minimal",staticStyle:{"margin-top":"0px"},attrs:{"chart-data":e.prepBarChartData,"click-handler":!0,"x-labels":!1,"y-labels":!1}}):"Chart"===e.type&&e.selectedIndicator?a("bar-vertical",{staticStyle:{height:"300px","margin-bottom":"-30px"},attrs:{"x-labels":!0,"y-labels":!0,"chart-data":e.generateChartDataSets}}):e._e()],1),e._v(" "),a("div",{staticClass:"text-xs-right",staticStyle:{"margin-right":"-18px",clear:"both",display:"block","margin-bottom":"-10px"}},[a("v-btn",{attrs:{icon:""},on:{click:function(t){return e.toggleExpand()}}},[a("v-icon",{style:e.rotateStyle,attrs:{color:"grey"}},[e._v("keyboard_arrow_down")])],1)],1),e._v(" "),e.selected?a("div",{staticClass:"pa-2"},[e._v("\n  Lorem ipsum dolor sit amet, id principes honestatis sadipscing eum, malorum ceteros percipitur ea qui. Omnesque postulant eu quo, ei mei wisi vituperata repudiandae. No est meliore consulatu,e.\n  "),a("br"),a("br"),e._v(" "),a("div",{staticClass:"grey--text text--darken-2"},[e._v("\n    Source: JIIS "+e._s(e.year||e.$store.state.year)+"\n  ")])]):e._e()]):e._e()])};Oe._withStripped=!0;var Ee=r(24),Te=r.n(Ee),Ie={components:{BarVertical:je},data:function(){return{expand:!1,rotation:0,selectedYear:""}},props:["name","figure","description","unit","type","small","noChart","selected"],methods:{makeSliderLabels:function(e){for(var t=e[0],a=e[e.length-1]-t+1,r=[],i=0;i<a;i++){var o=t+i;r.push(e.indexOf(o)>-1?o:"")}return console.log("labels",r,e),r},log:function(){console.log("data",this),console.log("store",this.$store.state)},clickHandler:function(){console.log("click")},toggleExpand:function(){this.expand=!this.expand,this.rotation=0===this.rotation?180:0},updateIndicator:function(){if(this.log(),!this.figure[0]||!this.year)return null;this.$store.commit("UPDATE",{key:["navigator","indicator"],value:{figure:this.figure[0],name:this.name}}),this.$store.commit("UPDATE",{key:"year",value:this.year})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},validateYear:function(e){for(var t=e,a=0;a<this.dataYears.length;a++){if(-1!==this.dataYears.indexOf(t)){this.selectedYear=t;break}t++}return!0}},computed:{rotateStyle:function(){return{transform:"rotate("+this.rotation+"deg)"}},getDataByHoodYear:function(){var e=this;return this.$store.getters.dataByNeighbourhood.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByCityYear:function(){var e=this;return this.$store.state.cityIndicators.filter(function(t){return t.year===e.thisYear})[0]||{}},getDataByYear:function(){var e=this;return this.$store.state.indicators.filter(function(t){return t.year===e.thisYear})||[]},areaDataMatched:function(){var e=this,t=this.$store.getters.indicatorsForSelectedArea;if(!t)return null;var a=t.reduce(function(t,a){return e.figure.some(function(e){return a[e]})&&t.push(a),t},[]);return console.log("areaDataMatched",a),a},areaDataLatest:function(){return console.log("something"),this.areaDataMatched?this.areaDataMatched[this.areaDataMatched.length-1]:null},latestYear:function(){if(this.areaDataLatest)return console.log("arealatest",this.areaDataLatest),this.selectedYear},year:function(){return this.selectedYear||this.latestYear},selectedIndicator:function(){if(!this.dataYears||!this.selectedYear)return{};var e=this.areaDataMatched[this.dataYears.indexOf(this.selectedYear)];return console.log("selectedIndicator",e),e},dataYears:function(){var e=this.$store.getters.allIndicatorKeyYears[this.figure[0]];return console.log("datayears",e,this.$store.getters.allIndicatorKeyYears,this.$store.getters.allIndicatorsByYear),e},generateChartDataSets:function(){var e=this;if("Chart"!==this.type||!this.selectedIndicator)return console.log("chart data test",this.selectedIndicator),null;var t=this.selected?this.$vuetify.theme.primary:this.$vuetify.theme.grey;return{datasets:[{data:this.figure.map(function(t){return e.selectedIndicator[t]}),borderColor:t,type:"line",fill:!1}],labels:this.figure}},chartWidthClass:function(){var e="Chart"===this.type?{width:"100%"}:{width:"70%",marginTop:"-60px"};return d()({position:"relative",float:"right"},e)},prepBarChartData:function(){if(" Figure"===!this.type)return{};var e=this.figure,t=this.$store.state.neighbourhood,a=this.name,r=this.selected?this.$vuetify.theme.primary:"#000",i=this.$store.getters.allIndicatorsByYear;if(console.log("citydata",i),!i||!this.year)return{};i=i[this.year],console.log("citydata.year",i,this.year);var o=(i=i.map(function(t){return t[e]=t[e]||0,t})).sort(function(t,a){return!a[e]-!t[e]||+(t[e]>a[e])||-(t[e]<a[e])}),n=this.$store.getters.areaNames,s=this.$store.getters.selectedAreas;return console.log("sorted",o,n,s),{labels:o.map(function(e){return n[e.areaCode]}),area_code:t,datasets:[{label:a,backgroundColor:o.map(function(e){return e.areaCode===t?r:Te.a.grey.lighten2}),data:o.map(function(t){return t[e]})}]}}},watch:{selectedYear:function(e,t){this.validateYear(e)}},mounted:function(){var e=this;this.areaDataLatest&&(this.selectedYear=this.areaDataLatest.year),this.$nextTick(function(){e.selected&&e.updateIndicator()})}},De=(r(386),Object(F.a)(Ie,Oe,[],!1,null,null,null));De.options.__file="src/components/IndicatorKeyStat.vue";var Fe=De.exports,Pe=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mt-5 mb-4",staticStyle:{background:"none"}},[t("div",{staticClass:"grey--text text--darken-2",staticStyle:{"text-transform":"uppercase","font-size":"18px",background:"none"}},[this._v(this._s(this.text))]),this._v(" "),t("v-divider",{staticClass:"my-2"})],1)};Pe._withStripped=!0;var Ue={props:["text"]},Me=Object(F.a)(Ue,Pe,[],!1,null,null,null);Me.options.__file="src/components/IndicatorHeading.vue";var Ne=Me.exports;var Be=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[e.datatable?a("div",[a("div",{staticStyle:{"margin-top":"-43px",float:"right"}},[e.multiselect?a("v-checkbox",{staticClass:"mt-2 mr-3",staticStyle:{float:"left"},attrs:{label:"Select All",color:"grey",flat:""},on:{change:function(t){return e.toggleSelectAll()}},model:{value:e.selectAll,callback:function(t){e.selectAll=t},expression:"selectAll"}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1):e._e(),e._v(" "),e.multiselect?a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){return e.deleteSelected(e.collection)}}},[e._v("\n            Delete Selected\n          ")]):e._e(),e._v(" "),a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n          ")],1)],1),e._v(" "),a("v-data-table",{class:e.cssclass,attrs:{headers:e.featureHeaders,items:e.items,"rows-per-page-items":[10,20,50,100,-1]},scopedSlots:e._u([{key:"items",fn:function(t){return[a("tr",{staticClass:"attribute-row",on:{dblclick:function(a){return e.edit(e.collection,t.item,e.nestedPath)}}},e._l(e.featureHeaders,function(r,i){return a("td",[r.type===Array?e._l(e.getNested(e.nestedPath,t.item)[r.value],function(t){return a("v-chip",{class:"func-"+t,attrs:{outline:"",small:""}},[e._v("\n              "+e._s(t)+"\n            ")])}):"select"===r.type?[a("v-checkbox",{staticStyle:{"padding-bottom":"0"},attrs:{color:"grey"},on:{change:function(a){return e.selectFeature(t.item)}},model:{value:t.item.feature._selected,callback:function(a){e.$set(t.item.feature,"_selected",a)},expression:"props.item.feature._selected"}})]:[e._v("\n            "+e._s(e.getNested(e.nestedPath,t.item)[r.value])+"\n          ")],e._v(" "),i===e.featureHeaders.length-1?a("div",{staticClass:"attribute-controls-wrapper"},[a("div",{staticClass:"attribute-controls",staticStyle:{top:"-30px"}},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.edit(e.collection,t.item,e.nestedPath)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t.item._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()],2)}),0)]}}],null,!1,1816074636)}),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e()],1):a("div",[e.addtop?a("v-btn",{staticClass:"mb-2",staticStyle:{"margin-top":"-40px",float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n  ")],1):e._e(),e._v(" "),a("v-list",{class:e.cssclass,attrs:{dense:""}},e._l(e.listItems,function(t,r){return a("v-list-tile",{key:r,staticClass:"attribute-row",on:{click:function(a){return e.select(r,t._id)}},model:{value:t.active,callback:function(a){e.$set(t,"active",a)},expression:"x.active"}},[e.listKey&&e.schema.schema[e.listKey]._options&&e.schema.schema[e.listKey]._options[0]?a("v-list-tile-action",[a("v-icon",[e._v(e._s(e.schema.schema[e.listKey]._options.filter(function(a){return a.name===t[e.listKey]})[0].icon)+" ")])],1):e._e(),e._v(" "),a("v-list-tile-content",[t._id?a("div",{staticClass:"attribute-controls-wrapper"},[e._v("\n        "+e._s(t.text||t.text_en||t.name)+"\n        "),a("div",{staticClass:"attribute-controls"},[a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.edit(e.collection,t)}}},[a("v-icon",[e._v("edit")])],1),e._v(" "),a("v-btn",{attrs:{small:"",fab:"",color:"grey",outline:""},on:{click:function(a){return e.del(e.collection,t._id)}}},[a("v-icon",[e._v("delete")])],1)],1)]):e._e()]),e._v(" "),t.active?a("div",{staticStyle:{height:"100%"}}):e._e()],1)}),1),e._v(" "),e.addbottom?a("v-btn",{staticClass:"mb-2",staticStyle:{float:"right"},attrs:{color:"grey",flat:""},on:{click:function(t){return e.add(e.collection)}}},[a("v-icon",[e._v("add")]),e._v("Add\n")],1):e._e()],1)]),e._v(" "),e.editedSchema?a("v-dialog",{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",[e.schema&&e.schema.name?a("span",{staticClass:"headline"},[e._v(e._s(e.mode)+" "+e._s(e.schema.name.slice(0,e.schema.name.length-1)))]):e._e()]),e._v(" "),a("v-tabs",{attrs:{color:"#f3f3f3","slider-color":"grey",grow:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Single")]),e._v(" "),e.editedSchema.canPaste?a("v-tab",{attrs:{ripple:""},on:{click:function(e){}}},[e._v("Multiple")]):e._e(),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("v-layout",{attrs:{wrap:""}},e._l(e.editedSchema.schema,function(t,r){return a("v-flex",{attrs:{xs12:""}},[t._options&&Array.isArray(t._options)?a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options.map(function(e){return e.name})},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):"function"!=typeof t._options||t._categorised?t._categorised?a("div",[a("v-combobox",{attrs:{multiple:"","small-chips":""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}),e._v(" "),a("v-menu",{attrs:{"full-width":"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",color:"grey",outline:""},slot:"activator"},[e._v("\n              "+e._s(r)+"\n            ")]),e._v(" "),a("v-list",{attrs:{dense:""}},[e._l(t._options(e.$store,e.edited,e.collection),function(t,i){return[t.value?a("v-list-tile",{key:i,on:{click:function(a){return e.edited[r].push(t.value)}}},[e._v("\n                  "+e._s(t.name)+"\n        \n                ")]):t.items?a("v-menu",{key:i,attrs:{"full-width":"","offset-x":"","max-height":"500","open-on-hover":""}},[a("v-list-tile",{attrs:{slot:"activator"},on:{click:function(e){}},slot:"activator"},[a("v-list-tile-title",[e._v(e._s(t.name))])],1),e._v(" "),a("v-list",{attrs:{dense:""}},e._l(t.items,function(t,o){return a("v-list-tile",{on:{click:function(a){return e.edited[r].push(i+"."+t)}}},[a("v-list-tile-title",[e._v(e._s(t))])],1)}),1)],1):e._e()]})],2)],1)],1):t.type===Boolean?a("v-switch",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):t._text?a("v-text-field",{attrs:{label:t._text},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-text-field",{attrs:{label:t._text,disabled:""},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}}):a("v-select",{attrs:{label:t._text,"small-chips":t._multiple,multiple:t._multiple,items:t._options(e.$store,e.edited,e.collection),"item-text":"name","item-value":"_id"},model:{value:e.edited[r],callback:function(t){e.$set(e.edited,r,t)},expression:"edited[key]"}})],1)}),1)],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.save(e.editedCollection,e.edited._id)}}},[e._v("Save")])],1)],1),e._v(" "),a("v-tab-item",[a("v-card-text",[a("v-container",{attrs:{"grid-list-md":""}},[a("div",{staticClass:"title pb-2"},[e._v("Paste attributes")]),e._v("\n      Paste as rows of text, separated by commas or tabs: "),a("br"),e._v(" "),a("v-text-field",{attrs:{hint:Object.keys(e.editedSchema.schema).join(", "),textarea:"","auto-grow":"",rows:"3"},model:{value:e.pasted,callback:function(t){e.pasted=t},expression:"pasted"}}),e._v("\n\n      Preview\n      "),e.pastedComputed?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:e.pastedComputed}}):e._e()],1)],1),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",flat:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.saving?a("v-progress-circular",{attrs:{indeterminate:"","mx-3":""}},[e._v("Saving...")]):a("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:function(t){return e.saveMany(e.editedCollection,e.edited.layer)}}},[e._v("Save")])],1)],1)],1)],1)],1):e._e()],1)};Be._withStripped=!0;var ze=r(76),Ye=r.n(ze),qe=r(44),Ke=r.n(qe),He=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("form",{attrs:{enctype:"multipart/form-data",novalidate:""},on:{submit:function(t){return t.preventDefault(),e.processForm(t)}}},[a("div",{staticClass:"dropbox pa-3",staticStyle:{"background-color":"#fff"}},[a("input",{ref:"file",staticClass:"input-file",attrs:{type:"file",name:e.uploadFieldName},on:{change:function(t){return e.filesChange()}}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"function",items:e.uploadFunctions,label:"Function"},model:{value:e.uploadFunction,callback:function(t){e.uploadFunction=t},expression:"uploadFunction"}}):e._e(),e._v(" "),"update"==e.uploadFunction?a("div",[a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Existing Records"},model:{value:e.update.matchExisting,callback:function(t){e.$set(e.update,"matchExisting",t)},expression:"update.matchExisting"}}),e._v(" "),a("v-combobox",{attrs:{items:[],chips:"",multiple:"",label:"Match Keys for Upload"},model:{value:e.update.matchUpload,callback:function(t){e.$set(e.update,"matchUpload",t)},expression:"update.matchUpload"}}),e._v(" "),a("v-text-field",{attrs:{label:"Update Key"},model:{value:e.update.key,callback:function(t){e.$set(e.update,"key",t)},expression:"update.key"}})],1):e._e(),e._v(" "),a("v-select",{attrs:{name:"collection",items:e.collections,label:"Collection"},model:{value:e.collection,callback:function(t){e.collection=t},expression:"collection"}}),e._v(" "),a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),e.isSaving?a("v-select",{attrs:{name:"format",items:e.indicatorFormats,label:"Format"},model:{value:e.indicatorFormat,callback:function(t){e.indicatorFormat=t},expression:"indicatorFormat"}}):e._e(),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),e.isSaving?a("v-btn",{attrs:{type:"submit",loading:e.processing,color:"blue",dark:"",depressed:""}},[e._v("Upload")]):e._e()],1)])])};He._withStripped=!0;var Je=r(92),Ge={props:["layer","layerCollection"],data:function(){return{processing:!1,isSaving:!1,uploadedFiles:[],uploadError:null,currentStatus:null,uploadFieldName:"GeoJSON",file:"",neighbourhood:"",collection:"",collections:["features","areas","indicators"],layerSelected:"",indicatorFormats:["geojson","json","csv"],indicatorFormat:null,uploadFunction:"create",uploadFunctions:["create","update"],update:{key:"",matchUpload:"",matchExisting:""}}},methods:{filesChange:function(){this.isSaving=!0,this.file=this.$refs.file.files[0],this.neighbourhood=this.file.name.split(".")[0],this.indicatorFormat=this.file.name.split(".")[1]},close:function(){this.processing=!1,this.$emit("close",!0)},processForm:function(){var e=this;this.processing=!0;var t=this.layerSelected||this.layer,a=Je[this.collection].params?this.layer:"",r=this.collection||alert("Collection required"),i="update"===this.uploadFunction?"updateMany":"create",o=new FormData;o.append("neighbourhood",this.neighbourhood),o.append("layer",t),o.append("file",this.file),o.append("format",this.indicatorFormat),o.append("update",c()(this.update)),R[i](r,null,o,{"Content-Type":"multipart/form-data"},a).then(function(){return console.log("SUCCESS!!"),e.$store.dispatch("UPDATE_COLLECTION",{name:r,layer:t})}).then(function(){e.$forceUpdate(),e.close()}).catch(function(t){if(e.processing=!1,console.log(t.response),!t.response)return console.log(t),null;var a=t.response.data.error.errors;alert(s()(a).reduce(function(e,t){return e=e+"\n"+a[t].name+": "+a[t].message},""))})}},computed:{layers:function(){var e=this.$store.state["_col_"+this.layerCollection];if(e)return e.map(function(e){return{text:e.name,value:e._id}})}},mounted:function(){this.layerSelected=this.layer}},Ve=Object(F.a)(Ge,He,[],!1,null,null,null);Ve.options.__file="src/components/Upload.vue";var Re=Ve.exports,We=r(92),Ze={components:{VueJsonPretty:Ke.a,Upload:Re},props:["collection","filter","datatable","listKey","nestedPath","cssclass","addtop","addbottom","multiselect"],data:function(){return{updateKey:0,activeTab:null,dialog:!1,mode:null,saving:!1,editedIndex:null,layerDialog:!1,attributeDialog:!1,selected:0,selectedId:"",pasted:null,attributeTypes:["String","Number","Boolean"],editedCollection:null,edited:{},uploadDialog:!1,featureEdit:[],datatableTab:null,selectAll:!1}},computed:{menuItems:function(){return this.$store.getters.areaLayers},filterId:function(){return this.$store.state["_col_"+this.filter+"_selected"]},listItems:function(){var e=this,t=this.items.map(function(t,a){return t.active=e.selected===a,t});return console.log("listitems",t),t},items:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=this;if("features"===this.collection){var t=this.$store.state._col_features[this.filterId];return t?(t=Array.isArray(t)?t:t[this.$store.state.neighbourhood],this.multiselect?t.map(function(e,t){return e.feature.properties._selected=e.feature.properties._selected||!1,e.feature.properties._index=t,e}):items):[]}var a=Ye()(this.$store.state["_col_"+this.collection]);return console.log("collectiondata",this.collection,a),a[0]?this.filter&&a[0]?(console.log("filterlayer",this.filter),a.filter(function(t){return t.layer===e.filterId})):a:[]}),filteredItems:function(){},firstItem:function(){return this.$store.state["_col_"+self.collection]?this.$store.state["_col_"+self.collection][0]:{}},schema:function(){var e=this,t=We[this.collection];if("string"==typeof t.schema){console.log("attrs1",this.$store.state["_col_"+t.schema]);var a=this.$store.state["_col_"+t.schema].filter(function(t){return t.layer===e.$store.state["_col_"+e.filter+"_selected"]});return console.log("attrs2",a,a.length),console.log("attrs3",this.schemaFromAttributes(Ye()(a))),{schema:this.schemaFromAttributes(Ye()(a))}}return t||{}},editedSchema:function(){return d()({},this.schema)},schemaNames:function(){return this.schema.name?[this.schema.name,this.relatedSchema.name].reduce(function(e,t){return t&&e.push(t.slice(0,t.length-1)),e},[]):null},tabledata:function(){if(this.layer)return this.layer.attributes},featureHeaders:function(){var e=this;if(!this.schema.schema)return[];var t=this.multiselect?[{value:"select",type:"select",_text:""}]:[],a=s()(this.schema.schema).reduce(function(t,a){return e.schema.schema[a]._text&&t.push({value:a,text:e.schema.schema[a]._text,type:e.schema.schema[a].type}),t},t);return console.log("featureHeaders",a),a},pastedComputed:function(){var e=this,t=this.pasted;if(!t)return[];t=t.replace(/\t/g,","),console.log("replaced",t);var a=s()(this.editedSchema.schema);return t.split("\n").reduce(function(t,r){var i=r.split(",");return i.length<2?t:(t.push(i.reduce(function(t,r,i){var o=a[i];return r=r.trim(),e.editedSchema.schema[o].type===Boolean&&(r="true"===r.toLowerCase()),t[o]=r,t},{})),t)},[])}},methods:{addSelects:function(e,t){return this.multiselect?e.map(function(e,a){return e.feature._selected=e._selected||t||!1,e.feature.properties._index=a,e}):e},updateCollection:function(e){var t=this;if(!e&&"features"===!this.collection&&!this.$store.state["_col_"+this.collection+"_selected"])return f.a.reject();var a=this;return console.log("EDITABLEDATALIST updating collection "+this.collection),new f.a(function(r,i){var o=t.collection;if("features"===t.collection||"areas"===t.collection){var n=a.filterId;o={name:t.collection,layer:n},(!n||!e&&t.$store.state._col_features[n])&&i("No layer specified")}a.$store.dispatch("UPDATE_COLLECTION",o).then(function(e){console.log("forcing update"),a.$forceUpdate(),r(e)}).catch(function(e){console.log("update failed",e),i()})})},templateFromSchema:function(e){if(e)return s()(e).reduce(function(t,a){return e[a].type===Array?t[a]=[]:e[a].type===Boolean?t[a]=!1:t[a]="",t},{})},schemaFromAttributes:function(e){return console.log("schema from attributes, attrs",e),e.reduce(function(e,t){return t._text=t._text||t.name,e[t.name]=t,e},{})},selectFeature:function(e,t){var a=this.$store.state._col_layers_selected;console.log(e,a),this.$store.commit("UPDATE_FEATURE_PROPERTIES",{layer:a,feature:e})},setMode:function(){this.$store.commit("UPDATE",{key:"mode",value:this.collection})},select:function(e,t){console.log("index",e,t),this.selected=e,this.selectedId=t,console.log("updating selected value: ",this.collection,t),this.$store.commit("UPDATE",{key:"_col_"+this.collection+"_selected",value:t}),this.setMode();var a=this;this.$nextTick(function(){return a.$forceUpdate()})},add:function(e){console.log(e),this.mode="Add",this.editedCollection=e,this.edited=this.templateFromSchema(We[e].schema),this.dialog=!0,console.log("dialog data",e,this.edited)},edit:function(e,t,a){this.mode="Edit";var r=this.templateFromSchema(We[e].schema),i=this.$store.state["_col_"+e];if(a){for(var o=0;o<i.length;o++)if(t===this.getNested(a,i[o])){t._id=i[o]._id,this.editedIndex=o;break}r=this.getNested(a,r),t._path=a}else this.editedIndex=i.indexOf(t);this.edited=d()({},r,t),this.editedCollection=e,this.dialog=!0,console.log("this",this)},del:function(e,t){var a=this;this.loading=!0,confirm("Are you sure you want to delete this item?")&&R.del(e,t).then(function(e){a.updateCollection(!0),a.selected=a.selected>0?a.selected-1:0,a.loading=!1})},close:function(){this.saving=!1,this.dialog=!1},save:function(e,t,a){var r=this;this.saving=!0,this.close(),this.filter&&(this.edited.layer=this.filterId);var i=We[e].params?this.selectedId:"",o={id:t,path:this.edited._path};console.log("saving",[e,t,this.edited]),R.update(e,o,this.edited,{},i).then(function(){r.updateCollection(!0),r.close()}).catch(function(e){alert(e)})},saveMany:function(e,t){var a=this;if(this.saving=!0,console.log("filterId: "+this.filterId+" collection: "+e),this.pastedComputed[0]&&s()(this.pastedComputed[0]).length>1){this.pastedComputed=this.pastedComputed.map(function(e){return e.layer=a.filterId,e});var r=new FormData;r.append("data",c()(this.pastedComputed)),console.log("making request..."),R.create(e,"",r).then(function(e){console.log("uploaded"),a.updateCollection(!0),a.close(),a.pasted=""})}},toggleSelectAll:function(){this.addSelects(this.items,this.selectAll);var e={name:"features",layer:this.$store.state["_col_"+this.filter+"_selected"],data:this.addSelects(this.items,this.selectAll)},t=this;this.$store.dispatch("UPDATE_COLLECTION",e).then(function(){return t.$forceUpdate()})},deleteSelected:function(){var e=this;console.log(this.items);var t=void 0,a=this.items.filter(function(e){return e.feature._selected}),r=We[this.collection].params?this.filterId:null;if(!confirm("Are you sure you want to delete "+a.length+" items?"))return null;t=this.selectAll&&this.filter?{layer:this.$store.state["_col_"+this.filter+"_selected"]}:a.map(function(e){return e._id}),R.deleteMany(this.collection,"",t,"",r).then(function(){console.log("deleted"),e.updateCollection(!0)})},getNested:function(e,t){return(e="string"==typeof e?e.split("."):e)?e.reduce(function(e,t){return e&&e[t]?e[t]:null},t):t},forceUpdate:function(){this.$forceUpdate(),console.log("force updated",this.$store.getters.selectedLayerAttributes)},logStore:function(){console.log("data",this),console.log("store",this.$store.state)}},watch:{dialog:function(e){console.log(e),e||this.close()},menuItems:function(e){console.log("menuItems",newValue)},filterId:function(e){console.log("WATCH: layerchanged",e),"features"===this.collection&&this.updateCollection()}},created:function(){console.log("created"),this.updateCollection().then(function(e){}).catch(function(e){return console.log("failed to update store")}),this.datatable||this.setMode()},mounted:function(){}},Xe=(r(451),Object(F.a)(Ze,Be,[],!1,null,null,null));Xe.options.__file="src/components/EditableDataList.vue";var Qe=Xe.exports,et={components:{MapView:de,MapNavigator:me,BarHorizontal:$e,BarVertical:je,IndicatorKeyStat:Fe,IndicatorHeading:Ne,EditableDataList:Qe},data:function(){return{selected:0,activeTab:null,selectedData:this.$store.getters.selected}},computed:{items:function(){var e=this.$store.getters.selectedIndicatorBlocks;console.log("indicator blocks",e);var t,a,r,i=(t=e,a=["text","description"],r=this.$store.state.language,a="string"==typeof a?[a]:a,function e(t,a,r){return t.reduce(function(t,i){if("object"===(void 0===i?"undefined":o()(i)))return a.forEach(function(e){i[e+"_"+r]&&(i[e]=i[e+"_"+r])}),s()(i).forEach(function(t){Array.isArray(i[t])&&e(i[t],a,r)}),(t=t||[]).push(i),t},[])}(t=Array.isArray(t)?t:[t],a,r));return console.log("translateion",i),console.log("indicatorsByArea",this.$store.getters.indicatorsByArea),i},featureLayers:function(){var e=this.$store.getters.selectedIndicatorSection;return e?e.geodata:null}},methods:{updateSelected:function(e){this.selected=e,console.log("updated select",this.selected)},log:function(){console.log("store",this.$store.state)}},mounted:function(){var e=this;this.$store.watch(function(e,t){return t.selectedIndicatorSection},function(t,a){if(console.log("section changed",t),e.selected=0,!t||!Array.isArray(t.geodata)||0===t.geodata.length)return null;t.geodata.forEach(function(t){e.$store.state["_col_"+t]||e.$store.dispatch("UPDATE_COLLECTION",{name:"features",query:{},layer:t})}),e.$store.commit("UPDATE",{key:["map","zoom"],value:15})}),console.log("store",this.$store.state)}},tt=(r(452),Object(F.a)(et,Ce,[],!1,null,null,null));tt.options.__file="src/components/IndicatorsNew.vue";var at=tt.exports,rt=function(){var e=this.$createElement,t=this._self._c||e;return this.$store.state._col_features?t("map-view",{staticStyle:{position:"relative",height:"400px"},attrs:{contextmenu:"",height:"",featureLayers:this.$store.state._col_layers_selected,featuresCollection:"features",zoomLevel:"12",allLayers:!0,options:{legendStyle:this.legendStyle,areaSelect:!0,mapStyle:{flexDirection:"row-reverse"}}}}):this._e()};rt._withStripped=!0;var it={components:{MapView:de},data:function(){return{legendStyle:{height:"100%",maxHeight:"100%",width:"25%",maxWidth:"300px",minWidth:"200px",left:0,borderRight:"1px solid #e3e3e3",backgroundColor:"#fff",flexDirection:"row-reverse"}}}},ot=Object(F.a)(it,rt,[],!1,null,null,null);ot.options.__file="src/components/MapFull.vue";var nt=ot.exports,st=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-tabs",{staticClass:"mt-2",attrs:{color:"background","slider-color":"primary"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[e._l(e.tabs,function(t,r,i){return a("v-tab",{key:i,attrs:{ripple:""},on:{click:function(t){return e.update(r)}}},[e._v(e._s(t.text_en))])}),e._v(" "),a("v-tab-item",{key:"0a"},["features"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("div",{staticClass:"text-xs-right caption grey--text",staticStyle:{"margin-top":"-20px"}},[a("span",[e._v("Layer id: "+e._s(e.$store.state["_col_"+e.tabs[e.tab].uploadLayerCol+"_selected"]))])]),e._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{collection:"layers",listKey:"data_type",addbottom:!0}})],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{staticStyle:{height:"402px"},attrs:{xs12:""}},[e.$store.state._col_features?a("map-view",{class:{minimap:e.scrollLow,fullmap:!e.scrollLow},staticStyle:{position:"relative",height:"402px"},attrs:{contextmenu:"",featuresCollection:"features",dataType:"Point",zoomLevel:"12",height:"400px",featureLayers:e.$store.state._col_layers_selected,options:{legendBottom:e.scrollLow,areaSelect:!0}}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 py-2"},[e._v("Layer Attributes")]),e._v(" "),e.$store.state._col_layers_selected?a("editable-data-list",{attrs:{collection:"layerAttributes",filter:"layers",datatable:!0,cssclass:"no-background",addtop:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom pl-3 py-2"},[e._v("Layer Calculations")]),e._v(" "),e.$store.state._col_layers_selected?a("editable-data-list",{attrs:{collection:"layerCalcs",filter:"layers",datatable:!0,cssclass:"no-background",addtop:!0}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[a("div",{staticClass:"subheading font-weight-light ejmap-border-bottom py-2 pt-5 pl-3"},[e._v("Features Table")]),e._v(" "),a("editable-data-list",{directives:[{name:"show",rawName:"v-show",value:e.$store.state._col_layerAttributes_selected,expression:"$store.state._col_layerAttributes_selected"}],attrs:{collection:"features",filter:"layers",datatable:!0,multiselect:!0,nestedPath:"feature.properties",cssclass:"no-background"}})],1)],1)],1)],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"1a"},["areas"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"areaLayers"}})],1),e._v(" "),a("v-flex",{attrs:{xs9:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[e.$store.state._col_areas?a("map-view",{staticStyle:{position:"relative",height:"402px"},attrs:{contextmenu:"",areas:!0,featuresCollection:"areas",dataType:"MultiPolygon",zoomLevel:"12",height:"400px"}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{sm5:"",xs12:""}},[a("div",{staticClass:"py-2 subheading font-weight-light"},[e._v("Attributes")]),e._v(" "),a("v-card",{attrs:{flat:""}},[e.$store.state._col_areaLayers_selected?a("editable-data-list",{attrs:{collection:"areaAttributes",datatable:!0}}):e._e()],1)],1),e._v(" "),a("v-flex",{attrs:{sm7:"",xs12:""}},[a("div",{staticClass:"py-2 subheading font-weight-light"},[e._v("Areas")]),e._v(" "),a("v-card",{attrs:{flat:""}},[a("editable-data-list",{directives:[{name:"show",rawName:"v-show",value:e.$store.state._col_layerAttributes_selected,expression:"$store.state._col_layerAttributes_selected"}],attrs:{collection:"areas",filter:"areaLayers",datatable:!0,multiselect:!0,nestedPath:"feature.properties",cssclass:"no-background"}})],1)],1)],1)],1)],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"2a"},["indicatorAttributes"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"areaLayers"}})],1),e._v(" "),a("v-flex",{attrs:{xs9:""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm7:"",xs12:""}},[e.$store.state._col_areas?a("map-view",{staticStyle:{position:"relative",height:"402px"},attrs:{contextmenu:"",areas:!0,featuresCollection:"areas",dataType:"MultiPolygon",zoomLevel:"12",height:"400px"}}):e._e()],1),e._v(" "),a("v-flex",{attrs:{sm5:"",xs12:""}},[a("div",{staticClass:"py-2 subheading font-weight-light"},[e._v("Attached Attributes")]),e._v(" "),a("v-card",[e.$store.state._col_areaLayers_selected?a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorAttributes",filter:"areaLayers",datatable:!0}}):e._e()],1)],1),e._v(" "),a("v-flex",{attrs:{xs12:""}},[e.$store.state.selectedFeature?a("div",{staticClass:"py-5"},[a("div",{staticClass:"py-2 subheading font-weight-light  ejmap-border-bottom"},[e._v("Indicators ")]),e._v(" "),a("v-tabs",{attrs:{"slider-color":"primary",color:"background"}},[e._l(e.$store.getters.indicatorsForSelectedArea,function(t,r){return a("v-tab",{key:r,attrs:{ripple:""}},[e._v("\n          "+e._s(t.year)+"\n        ")])}),e._v(" "),e._l(e.$store.getters.indicatorsForSelectedArea,function(e,t){return a("v-tab-item",{key:t},[a("v-card",{attrs:{flat:""}},[a("vue-json-pretty",{staticClass:"pa-3 mb-2 code caption",attrs:{data:e}})],1)],1)})],2)],1):e._e()]),e._v(" "),a("v-flex",{attrs:{xs12:""}})],1)],1)],1)],1):e._e()],1),e._v(" "),a("v-tab-item",{key:"3a"},["indicatorSections"===e.tab?a("v-container",{attrs:{fluid:"","grid-list-xl":""}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{sm3:"","xs-12":""}},[a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorSections"}})],1),e._v(" "),a("v-flex",{attrs:{sm9:"",xs12:""}},[a("v-card",[e.$store.state._col_indicatorSections_selected?a("editable-data-list",{attrs:{addbottom:!0,collection:"indicatorBlocks",filter:"indicatorSections",datatable:!0}}):e._e()],1)],1)],1)],1):e._e()],1)],2),e._v(" "),a("div",{staticClass:"data-toolbar"},[a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){e.uploadDialog=!0}}},[a("v-icon",{staticClass:"mr-2"},[e._v("cloud_upload")]),e._v("\n    Upload\n    ")],1),e._v(" "),a("v-btn",{staticClass:"mb-2",attrs:{color:"grey",flat:""},on:{click:function(t){e.analysisDialog=!0}}},[a("v-icon",{staticClass:"mr-2"},[e._v("assessment")]),e._v("\n    Update Feature Analysis\n    ")],1)],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.uploadDialog,callback:function(t){e.uploadDialog=t},expression:"uploadDialog"}},[a("upload",{attrs:{layer:e.tabs[e.tab].uploadLayer,layerCollection:e.tabs[e.tab].uploadLayerCol},on:{close:function(t){e.uploadDialog=!1}}})],1),e._v(" "),a("v-dialog",{attrs:{"max-width":"600"},model:{value:e.analysisDialog,callback:function(t){e.analysisDialog=t},expression:"analysisDialog"}},[a("analysis",{attrs:{layer:e.$store.state._col_layers_selected,areaLayer:e.$store.state._col_areaLayers_selected},on:{close:function(t){e.analysisDialog=!1}}})],1)],1)};st._withStripped=!0;var lt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-3"},[a("v-select",{attrs:{name:"layer",items:e.layers,label:"Layer"},model:{value:e.layerSelected,callback:function(t){e.layerSelected=t},expression:"layerSelected"}}),e._v(" "),a("v-select",{attrs:{name:"areaLayer",items:e.areaLayers,label:"Area"},model:{value:e.areaLayerSelected,callback:function(t){e.areaLayerSelected=t},expression:"areaLayerSelected"}}),e._v(" "),a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{attrs:{color:"grey lighten-1",dark:"",depressed:""},on:{click:function(t){return e.close()}}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{color:"blue",dark:"",depressed:"",loading:e.processing},on:{click:function(t){return e.updateAnalysis()}}},[e._v("Analyse")])],1)],1)};lt._withStripped=!0;r(92);var ct={props:["layer","areaLayer"],data:function(){return{processing:!1,layerSelected:"",areaLayerSelected:""}},methods:{close:function(){this.$emit("close",!0)},updateAnalysis:function(){var e=this;this.processing=!0,R.updateAnalysis("features",this.areaLayerSelected,{},{},this.layerSelected).then(function(t,a){a&&console.log(a),e.processing=!1})}},computed:{layers:function(){return this.$store.state._col_layers.map(function(e){return{text:e.name,value:e._id}})||[]},areaLayers:function(){return this.$store.state._col_areaLayers.map(function(e){return{text:e.name,value:e._id}})||[]}},mounted:function(){this.layerSelected=this.layer||this.$store.state._col_areaLayers_selected,this.areaLayerSelected=this.areaLayer||this.$store.state._col_layers_selected}},ut=Object(F.a)(ct,lt,[],!1,null,null,null);ut.options.__file="src/components/Analysis.vue";var dt=ut.exports,pt={components:{EditableDataList:Qe,MapView:de,Upload:Re,VueJsonPretty:Ke.a,Analysis:dt,AreaSelect:se},data:function(){return{uploadDialog:!1,analysisDialog:!1,activeTab:null,pages:null,tab:"features",scrollLow:!1,minimap:{position:"fixed",top:"20px",left:"20px",width:"20%",height:"200px"}}},computed:{tabs:function(){return{features:{text_en:"Features",uploadLayer:this.$store.state._col_layers_selected,uploadLayerCol:"layers"},areas:{text_en:"Areas",uploadLayer:"areas",uploadLayerCol:"areaLayers"},indicatorAttributes:{text_en:"Indicators",uploadLayer:this.$store.state._col_areaLayers_selected,uploadLayerCol:"areaLayers"},indicatorSections:{text_en:"Indicator Sections"}}}},methods:{update:function(e){console.log("activetab",this.activeTab);var t=this;this.tab=e,this.$store.commit("UPDATE",{key:"tab",value:e}),this.$nextTick(function(){t.$forceUpdate()})},log:function(){console.log("data",this),console.log("store",this.$store.state)}},mounted:function(){var e=this;window.addEventListener("scroll",function(t){window.scrollY>500&&!e.scrollLow?e.scrollLow=!0:window.scrollY<500&&e.scrollLow&&(e.scrollLow=!1)})}},ft=(r(453),Object(F.a)(pt,st,[],!1,null,null,null));ft.options.__file="src/components/ManageDataMaster.vue";var ht=ft.exports,mt=r(116),_t=r.n(mt),yt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-layout",{attrs:{row:"",wrap:""}},e._l(e.items,function(t,r){return a("v-flex",{attrs:{xs12:"","py-4":""}},[a("div",{staticClass:"title pb-2"},[e._v(e._s(t.heading))]),e._v(" "),a("div",{staticClass:"subheading",staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.text))]),e._v(" "),t.code?a("vue-json-pretty",{staticClass:"pa-3 my-2 code",attrs:{data:t.code}}):e._e()],1)}),1)],1)};yt._withStripped=!0;var vt={components:{VueJsonPretty:Ke.a},data:function(){return{itemsX:[{heading:"Features"},{heading:"Features"},{heading:"Features"}],items:[{heading:"Features",text:"Spatial data points (either points, polygons or lines) with attribute information including which feature layer it is associated with.",code:{type:"point",geometry:[],properties:{year:2015,feature_layer:"education",type:"college",students:500,gender:"mixed",quality_rating:10}}},{heading:"Feature Layers",text:"Feature layers determine the layer type and methods of analysis to be performed on it.",code:{name:"education",type:"point",columns:{type:{type:"string",func:"count"},students:{type:"integer",func:"sum"},gender:{type:"string",func:"count"},quality_rating:{type:"integer",func:"average"}}}},{heading:"Areas",text:"Statistical areas with which the features should be grouped for analysis"},{heading:"Area Indicators",text:"Area indicators include the results of spatial analysis between the Areas and Features and any additional secondary data e.g from JIIS"},{heading:"Surveys",text:"Surveys are extensions of Feature Layers that can be used for collecting field data.\n\nSurveys can use an existing Feature Layer as a template or create a new one. In most cases spatial data will need to be uploaded in advance of the conducting the survey.However, point data can be added live via the survey map"}]}}},gt=Object(F.a)(vt,yt,[],!1,null,null,null);gt.options.__file="src/components/Help.vue";var bt=gt.exports;"http://localhost:8080"===window.location.origin||window.location.origin;console.log("routing from",{redirect_uri:window.location.origin+"/implicit/callback"}),h.default.use(_t.a,{client_id:"***REMOVED***",issuer:"https://dev-160658.okta.com/oauth2/default",redirect_uri:window.location.origin+"/implicit/callback",scope:"openid profile email"}),h.default.use(we.a);var xt=new we.a({mode:"history",routes:[{path:"/",component:at},{path:"/upload",component:Re,meta:{requiresAuth:!0}},{path:"/manage",component:ht,meta:{requiresAuth:!0}},{path:"/map",component:nt},{path:"/indicators",component:at},{path:"/implicit/callback",component:_t.a.handleCallback()},{path:"/help",component:bt}]});xt.beforeEach(h.default.prototype.$auth.authRedirectGuard());var wt=xt,Ct=r(307),kt=r.n(Ct),St=(r(454),r(455),r(305)),At=r(118),$t={primary:Te.a.orange.lighten1,secondary:Te.a.grey.lighten3,tertiary:Te.a.blue.base,error:"#b71c1c",background:"#f8f9fa",grey:Te.a.grey.base},Lt=r(306),jt=r(456)();h.default.use(kt.a,{options:{customProperties:!0},theme:$t}),h.default.use(St.a),h.default.use(At.a),h.default.use(Lt.a),h.default.config.productionTip=!0;var Ot=new At.a.Store({state:{_col_layers:[],_col_layers_selected:"",_col_layerAttributes:[],_col_layerAttributes_selected:"",_col_areas:[],_col_areas_selected:"",_col_areaLayers:[],_col_areaLayers_selected:"",_col_features:{},_col_features_selected:"",_col_indicators:[],_col_indicators_selected:"",_col_indicatorSections:[],_col_indicatorSections_selected:"",_col_indicatorBlocks:[],_col_indicatorBlocks_selected:"",mode:null,neighbourhoodsTest:null,selectedFeatureLayers:[],updateCount:0,indicators:[],collections:{},cityIndicators:[],neighbourhood:2112,selectedFeature:"",areaLayer:"5cf510e19bfa58b6c509903b",year:2016,language:"en",languages:["ar","en"],theme:$t,tab:"",map:{zoom:15,center:{lat:31.827982118391024,lng:35.22958321000619},defaultCenter:{lat:31.827982118391024,lng:35.22958321000619}},navigator:{zoom:12,center:{lat:31.77487761850741,lng:35.20328852089031},defaultCenter:{lat:31.77487761850741,lng:35.20328852089031},indicator:{figure:"pop_year_end",name:"Population"}},geo:{areas:[],facilities:[],educational:[],features:[],selected:null},layers:[]},actions:{UPDATE_COLLECTION:function(e,t){var a=e.state,r=e.commit,i={name:t.name||t,query:t.query||{},layer:t.layer};if("features"===i.name){if(i.layer=i.layer||a._col_layers_selected,i.layer||rej("no feature layer defined"),console.log(i.layer),a._col_layers.filter(function(e){return e._id===i.layer})[0].filtered){var o=a._col_areaLayers.filter(function(e){return e._id===a._col_areaLayers_selected})[0].code;i.query["feature.properties."+o]=a.neighbourhood,i.nestedKey=a.neighbourhood}}else i.name;function n(e){if("features"===i.name)r("UPDATE_FEATURES",{key:i.layer,value:e,nestedKey:i.nestedKey});else{var t="_col_"+i.name,o=t+"_selected";r("UPDATE",{key:t,value:e}),!a[o]&&e[0]&&r("UPDATE",{key:o,value:e[0]._id})}}return new f.a(function(e,a){if(t.data)return console.log("supplied data",t.data),n(t.data),e(t.data);console.log("making api request",i.name,i.query,i.layer),R.find(i.name,i.query,"",{lean:!0},i.layer).then(function(t,r){r&&(console.log("api error",r),a(r)),n(t.data),e(t.data)}).catch(function(e){e.response&&console.log("api error: "+i.name,e.response)})})},UPDATE_INDICATORS:function(e){var t=e.state,a=e.commit;R.find("indicators",{areaLayer:t.areaLayer}).then(function(e){return a("UPDATE",{key:"indicators",value:e.data})}).catch(function(e){console.log("failed to update indicators",e)})}},mutations:{GET_INDICATORS:function(e){R.find("areas",{}).then(function(t){e.geo.areas=t.data}),R.find("indicators",{}).then(function(t){if(!t.data)return console.log("cannot retrieve in"),null;var a=t.data.map(function(e){return e.dependency_youth=((e.age_0_4+e.age_5_14+e.age_15_24)/e.pop_year_end*100).toFixed(1),e.growth_total=(e.pop_growth_total/e.pop_year_end*100).toFixed(1),e.growth_natural=(e.pop_growth_natural/e.pop_year_end*100).toFixed(1),e.household_size=(e.pop_year_end/e.dwellings_total).toFixed(1),e.dwelling_density=(e.dwelling_area_avg/e.household_size).toFixed(1),e.prevyear=t.data.filter(function(t){return t.name===e.name&&t.year===e.year-1})[0],e.dwellings_new=e.prevyear?e.dwellings_total-e.prevyear.dwellings_total:null,e.dwelling_growth=(e.dwellings_new/e.dwellings_total*100).toFixed(1),e.age_distribution_labels=["age_0_4","age_5_14","age_15_24","age_25_44","age_45_64","age_65_74","age_75_"],e.age_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.pop_year_end*100}),e.dwelling_area_distribution_labels=["dwellings_area_0_40","dwellings_area_41_60","dwellings_area_61_80","dwellings_area_81_100","dwellings_area_101_140","dwellings_area_141"],e.dwelling_area_distribution=e.age_distribution_labels.map(function(t){return e[t]/e.dwellings_total*100}),e});e.indicators=a.filter(function(e){return 9999!==e.area_code}),e.cityIndicators=a.filter(function(e){return 9999===e.area_code});var r={sum:function(e,t){return e.reduce(function(e,a){if(!a.feature.properties.mygeodat_5)return e;var r=a.feature.properties;return["total",a.feature.properties.mygeodat_5.toString()].forEach(function(a){e[a]=e[a]||{},e[a].types=e[a].types||{},t.forEach(function(t){"string"==typeof r[t]?e[a].types[r[t]]=e[a].types[r[t]]?e[a].types[r[t]]+1:1:e[a][t]=e[a][t]?e[a][t]+parseInt(r[t]):r[t]||0})}),e},{})}};R.find("features",{}).then(function(t){e.geo.facilities=t.data,e.facilities=t.data.map(function(e){return e.feature.properties}),console.log("facilities",e.facilities);var a=t.data.filter(function(e){return"Educational"===e.feature.properties.Use});e.geo.educational=a,a=r.sum(a,["Sort1","Sort2","Gender","no_student","no_females","no_classes","Type"]),e.indicators.forEach(function(t,r){2015===t.year&&t.area_code&&(e.indicators[r]=d()({},t,a[t.area_code.toString()]))}),e.cityIndicators.forEach(function(t,r){2015===t.year&&(e.cityIndicators[r]=d()({},t,a.total))}),console.log("cityindicators",e.cityIndicators)})})},UPDATE_FEATURES:function(e,t){console.log("updating feature",t.nestedKey,t.key,t.value),h.default.set(e._col_features,t.key,t.value)},UPDATE_FEATURE_PROPERTIES:function(e,t){e._col_features[t.layer].splice(t.feature._index,1,t.feature);var a=function e(t){if(Array.isArray(t)){if("number"==typeof t[0])return t;e(t[0])}else e(t.geometry.coordinates)}(t.feature.feature.geometry.coordinates);console.log("coords",a),e.map.center={lat:a[1],lng:a[0]}},UPDATE:function(e,t){if(Array.isArray(t.key))console.log("updating store nested: "+c()(t.key),t.value),h.default.set(e[t.key[0]],t.key[1],t.value);else{var a=t.value[0]&&t.value[0]._id?t.value.map(function(e){return e._id}):"";console.log("updating store value: "+t.key,t.value,a),e[t.key]=t.value}},UPDATE_AREA:function(e,t){var a=e.geo.areas.filter(function(e){return e.feature.properties.id===t})[0];console.log(a),e.neighbourhood=t,e.map.center={lon:a.feature.properties.Centroids_x,lat:a.feature.properties.Centroids_y}}},getters:{areaSelect:function(e,t){return e.indicators?t.dataByYear.concat(t.dataByCityYear):[]},neighbourhoods:function(e,t){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.name)&&e.push(t.name),e},[]):[]},years:function(e){return e.indicators?e.indicators.reduce(function(e,t){return-1===(e=e||[]).indexOf(t.year)&&t.year&&e.push(t.year),e},[]):[]},dataByYear:function(e){return e.indicators?e.indicators.filter(function(t){return t.year===e.year}):[]},dataByNeighbourhood:function(e){if(!e.indicators)return[];var t=e.indicators.filter(function(t){return t.area_code===e.neighbourhood});return t.length>0?t:e.cityIndicators},dataByHoodYear:function(e,t){return e._col_indicators.filter(function(t){return t.areaCode===e.neighbourhood&&t.year===e.year})[0]||{}},dataByCityYear:function(e){return e.cityIndicators.filter(function(t){return t.year===e.year})[0]||{}},educationalByHood:function(e){console.log("edubyhood - init",e.geo.educational);var t=e.geo.educational.reduce(function(t,a){return a.feature.properties.mygeodat_5===e.neighbourhood&&t.push(a.feature.properties),t},[]);return console.log("edubyhood",t),t},educationalGeoByHood:function(e){if(!e.geo.educational)return[];var t=e.geo.educational.filter(function(t){return t.feature.properties.mygeodat_5===e.neighbourhood});return console.log("educational geo",t),t},selectedFeature:function(e){return e._col_features.filter(function(t){return t.feature.properties._id===e.selectedFeature})[0]},selectedAreas:function(e){return e._col_areas.filter(function(t){return t.layer===e._col_areaLayers_selected})},selectedArea:function(e,t){return t.selectedAreas.filter(function(t){return t.feature.properties.id===e.neighbourhood})[0]},areaNames:function(e,t){return t.selectedAreas?t.selectedAreas.reduce(function(e,t){return e[t.feature.properties.areaCode]=t.feature.properties.name,e},{}):null},geojson:function(e){return e._col_features?e._col_features.map(function(e){return e.feature}):[]},selectedLayer:function(e){return e._col_layers?e._col_layers.filter(function(t){return t._id===e._col_layers_selected})[0]:null},selectedLayerAttributes:function(e){return e._col_layerAttributes?e._col_layerAttributes.filter(function(t){return t.layer===e._col_layers_selected}):null},selectedIndicatorBlocks:function(e){return e._col_indicatorBlocks?e._col_indicatorBlocks.filter(function(t){return t.active&&t.layer===e._col_indicatorSections_selected}):null},selectedIndicatorSection:function(e){return e._col_indicatorSections_selected?e._col_indicatorSections.filter(function(t){return t._id===e._col_indicatorSections_selected})[0]:null},allIndicatorKeyYears:function(e,t){var a=t.allIndicatorsByYear;return a?s()(a).reduce(function(e,t){var r=parseInt(t);return a[t].forEach(function(t){s()(t).forEach(function(t){e[t]=e[t]||[],-1===e[t].indexOf(r)&&e[t].push(r)})}),e},{}):null},allIndicatorsByYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.year?(e[t.year]=e[t.year]||[],e[t.year].push(jt(t)),e):e},{}):null},allIndicatorsByArea:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||[],e[t.areaCode].push(jt(t)),e):e},{}):null},allIndicatorsByAreaYear:function(e){return e._col_indicators?e._col_indicators.reduce(function(e,t){return t.areaCode?(e[t.areaCode]=e[t.areaCode]||{},e[t.areaCode][t.year]=t,e):e},{}):null},indicatorsForSelectedYear:function(e,t){if(t.allIndicatorsByYear)return t.allIndicatorsByYear[e.year]},indicatorsForSelectedArea:function(e,t){if(t.allIndicatorsByArea&&t.allIndicatorsByArea[e.neighbourhood])return t.allIndicatorsByArea[e.neighbourhood].sort(function(e,t){return e.year-t.year})},selectedIndicator:function(e,t){return a=[e.neighbourhood,e.year],r=t.allIndicatorsByAreaYear,(a="string"==typeof a?a.split("."):a)?a.reduce(function(e,t){return e&&e[t]?e[t]:null},r):r;var a,r},featuresBySelectedArea:function(e){return s()(e._col_features).reduce(function(t,a){return t[a]=e._col_features[a][e.neighbourhood],t},{})},selectedFeatures:function(e,t){var a=void 0;return"indicatorSections"===e.mode?a=t.selectedIndicatorSection?t.selectedIndicatorSection.geodata:null:"layers"===e.mode&&(a=[e._col_layers_selected]),a&&a[0]?a.map(function(t){var a=e._col_features[t];return a?a.map(function(e){return e.feature}):[e._col_features,t,e._col_features[t],s()(e._col_features),o()(e._col_features)]}):null}}});new h.default({router:wt,store:Ot,render:function(e){return e(xe)}}).$mount("#app")},68:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){},75:function(e,t,a){},92:function(e,t,a){var r=a(390);e.exports={layers:{name:"Layers",schema:{name:{type:String,required:!0,unique:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},data_type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Point",icon:"scatter_plot"},{name:"LineString",icon:"timeline"},{name:"MultiPolygon",icon:"bubble_chart"}]},spatial_intersect:{type:Array,_text:"Areas for Analysis",_multiple:!0,_options:function(e){return console.log("areas analysis select function"),e.state._col_areaLayers}},filtered:{type:Boolean,_text:"Filtered by area"}}},layerAttributes:{name:"Attributes",canPaste:!0,schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},func:{type:Array,_text:"Functions",_multiple:!0,_options:[{name:"count",color:"secondary"},{name:"sum",color:"tertiary"}],_computed:function(e,t,a,r){var i=e.state["_col_"+a].filter(function(e){return e.layer===r});if(i){var o=["count",""];return o="Number"===t.type?o.concat(["sum"]):o,i.reduce(function(e,t){return"Number"===t.type&&e.push("sum: "+t.name),e},o)}}},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}},layerCalcs:{name:"Attributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},layer:{type:r.Schema.Types.ObjectId,required:!0},func:{type:Array,_text:"Functions",_multiple:!0,_combobox:!0,_categorised:!0,_options:function(e,t){var a=e.state._col_layers,r=a.reduce(function(e,t){return e[t._id]=t,e},{}),i=e.state._col_layerAttributes,o=r[e.state._col_layers_selected].spatial_intersect,n=a.reduce(function(e,t){return t.spatial_intersect.some(function(e){return o.indexOf(e)>-1})&&e.push(t._id),e},[]);return i.reduce(function(e,t){if(t.func.length>0){var a=n.indexOf(t.layer);if(a>-1){var i=n[a];e[i]=e[i]||{name:r[i].text_en,items:["count"]},t.func.forEach(function(a){a&&e[i].items.push(t.name+"."+a)})}}return e},{})}}}},indicatorSections:{name:"Sections",schema:{name:{type:String,required:!0,_text:"Name"},text_en:{type:String,required:!0,_text:"Text (English)"},text_ar:{type:String,_text:"Text (Arabic)"},geodata:{type:Array,_text:"Feature Layers",_multiple:!0,_options:function(e){return e.state._col_layers}}}},indicatorBlocks:{name:"Modules",canPaste:!0,schema:{type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"Figure"},{name:"Chart"},{name:"Table"},{name:"List"},{name:"Map"}]},active:{type:Boolean,_text:"Active"},layer:{type:r.Schema.Types.ObjectId,required:!0},text_en:{type:String,required:!0,_text:"Name (English)"},text_ar:{type:String,_text:"Name (Arabic)"},areaLayer:{type:Array,_text:"Spatial Intersect",_multiple:!0,_options:function(e){return e.state._col_areaLayers}},figure:{type:Array,_text:"Figure",_categorised:!0,_options:function(e,t){var a=e.state._col_layers;if("Map"===t.type)return a.reduce(function(e,t){return e.push({name:t.text_en,value:t._id}),e},[]);if(!t.areaLayer)return{error:{name:"First select a spatial intersect",value:"error"}};var r=a.reduce(function(e,t){return e[t._id]=t,e},{attached:{text_en:"Area"}}),i=e.state._col_indicatorAttributes.map(function(e){return e.func=["%%%"],e.layer="attached",e}),o=e.state._col_layerCalcs.map(function(e){return e.func=["%%%"],e}).concat(e.state._col_layerAttributes).concat(i);console.log("options layerAttrs",o);var n=a.reduce(function(e,a){return a.spatial_intersect.some(function(e){return t.areaLayer.indexOf(e)>-1})&&e.push(a._id),e},["attached"]),s=o.reduce(function(e,t){if(t.func.length>0){var a=n.indexOf(t.layer);if(a>-1){var i=n[a];e[i]=e[i]||{name:r[i].text_en,items:[]},t.func.forEach(function(a){a&&e[i].items.push((t.name+"."+a).replace(".%%%",""))})}}return e},{});return console.log("categorised options",s),s}},description_en:{type:String,_text:"Description (English)"},description_ar:{type:String,_text:"Description (Arabic)"},unit:{type:String,_text:"Unit"}}},features:{name:"Features",schema:"layerAttributes",params:"/:collection"},indicators:{name:"Indicators",schema:"indicatorAttributes",schemaOpts:{strict:!0},params:"/:collection"},areaLayers:{name:"AreasLayers",schema:{name:{type:String,required:!0,_text:"Name"},code:{type:String,required:!0,unique:!0,_text:"Column Name"}}},areas:{name:"Areas",schema:"areaAttributes",params:"/:collection"},areaAttributes:{name:"AreaAttributes",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:String,required:!0}}},indicatorAttributes:{name:"IndicatorAttributes",canPaste:!0,_description_en:"For non-spatial attribute data that is directly associatied with the spatial area i.e data from JIIS relating to a statistical area",schema:{name:{type:String,required:!0,_text:"Name"},type:{type:String,required:!0,_text:"Type",_multiple:!1,_options:[{name:"String"},{name:"Number"},{name:"Boolean"}]},required:{type:Boolean,_text:"Required"},layer:{type:r.Schema.Types.ObjectId,required:!0}}}}}});